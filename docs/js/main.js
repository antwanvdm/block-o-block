!function(e){var t={};function s(i){if(t[i])return t[i].exports;var h=t[i]={i:i,l:!1,exports:{}};return e[i].call(h.exports,h,h.exports,s),h.l=!0,h.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);class i{constructor(e,t,s,i=""){this.x=t,this.y=s,this.el=document.createElement("div");let h=document.getElementById("main");if(null===h)throw new Error("<main> element doesn't exist!");if(this.el.style.transform=`translate(${this.x}px, ${this.y}px)`,this.el.classList.add(e),""===i)h.appendChild(this.el);else{let e=document.querySelector(`.${i}`);if(null===e)throw new Error(`<.${i}> element doesn't exist!`);e.appendChild(this.el)}}getClientReact(){return this.el.getBoundingClientRect()}}class h extends i{constructor(){super("score",10,10,"gui"),this.score=0,this.el.innerHTML=`score: ${this.score.toString()}`}get(){return this.score}update(e,t=!1){this.score=t?e:this.score+e,this.el.innerHTML=`score: ${this.score.toString()}`}}class n{static addEventListener(e,t){n.functionMap[e]=t,window.addEventListener(e.split(".")[0],n.functionMap[e])}static removeEventListener(e){window.removeEventListener(e.split(".")[0],n.functionMap[e]),delete n.functionMap[e]}}n.functionMap={};class r extends i{constructor(){super("messagescreen",0,0,"gui"),this.height=200,this.width=400,this.isActive=!1,this.messages={"game:start":"Welcome to Block-o-Block, it's time to catch them blocks!<br/><br/>Use your arrow keys to move your player around and press space to start.","game:end":"You made it, your final score is __SCORE__ out of max __MAX_SCORE__ points.<br/><br/>Thanks for playing, press space to restart the madness","level:success":"YEAH! Level completed! Press space to proceed to the next level","level:failed":"AAH! Level failed! Press space to restart this level"},this.x=window.outerWidth/2-this.width/2,this.y=document.documentElement.clientHeight/2-this.height/2,this.el.style.width=`${this.width}px`,this.el.style.height=`${this.height}px`,this.el.style.transform=`translate(${this.x}px, ${this.y}px)`,this.show("game:start"),n.addEventListener("keyup.messagescreen",e=>this.keyBoardHandler(e))}keyBoardHandler(e){32===e.keyCode&&!0===this.isActive&&window.dispatchEvent(new Event(`${this.currentEvent}:click`))}show(e,t={}){let s=this.messages[e];for(let e in t)s=s.replace(e,t[e]);this.el.innerHTML=s,this.el.classList.add("show"),this.currentEvent=e,this.isActive=!0}hide(){this.el.classList.remove("show"),this.isActive=!1}}class l extends i{constructor(){super("gui",0,0),this.score=new h,this.messageScreen=new r,window.addEventListener("level:scoreUpdate",e=>this.score.update(e.detail.score))}levelDone(e){this.messageScreen.show(e)}newLevel(){this.messageScreen.hide()}gameEnd(e){this.messageScreen.show("game:end",{__SCORE__:this.score.get().toString(),__MAX_SCORE__:e.toString()})}restart(){this.messageScreen.show("game:start"),this.score.update(0,!0)}}class o{static getRandomColor(){let e=Math.round,t=Math.random;return`rgba(${e(255*t())},${e(255*t())},${e(255*t())},1)`}static getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}static checkCollision(e,t){return e.left<=t.right&&t.left<=e.right&&e.top<=t.bottom&&t.top<=e.bottom}}class a extends i{constructor(e,t,s,i){super("block",0,0,"level"),this.destination={x:0,y:0},this.speed=t,this.width=s,this.height=i,this.color=e,this.el.style.backgroundImage=`repeating-linear-gradient(${o.getRandomInt(0,360)}deg, #000000, #000000 ${o.getRandomInt(2,10)}px, ${this.color} 10px, ${this.color} ${o.getRandomInt(20,40)}px)`,this.el.style.width=`${this.width}px`,this.el.style.height=`${this.height}px`,this.x=o.getRandomInt(0,window.outerWidth-this.width),this.y=o.getRandomInt(0,document.documentElement.clientHeight-this.height),this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}destroy(){this.el.remove()}update(){this.x>this.destination.x-this.speed&&this.x<this.destination.x+this.speed&&(this.destination.x=o.getRandomInt(0,window.outerWidth-this.width)),this.y>this.destination.y-this.speed&&this.y<this.destination.y+this.speed&&(this.destination.y=o.getRandomInt(0,document.documentElement.clientHeight-this.height)),this.destination.x>=this.x?this.x+=this.speed:this.x-=this.speed,this.destination.y>=this.y?this.y+=this.speed:this.y-=this.speed,this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}}class d extends i{constructor(){super("player",0,0,"level"),this.height=10,this.width=10,this.growthFactor=1.5,this.speed=2,this.speedIncreaseFactor=.2,this.keysAllowed=[37,38,39,40],this.keysPressed=[],this.x=window.outerWidth/2-this.width/2,this.y=document.documentElement.clientHeight/2-this.height/2,this.el.style.width=`${this.width}px`,this.el.style.height=`${this.height}px`,this.el.style.borderRadius=`${this.width}px`,n.addEventListener("keydown.player",e=>this.keyDownHandler(e)),n.addEventListener("keyup.player",e=>this.keyUpHandler(e))}keyDownHandler(e){let t=e.keyCode;this.keysAllowed.indexOf(t)>-1&&-1===this.keysPressed.indexOf(t)&&this.keysPressed.push(t)}keyUpHandler(e){let t=e.keyCode,s=this.keysPressed.indexOf(t);this.keysAllowed.indexOf(t)>-1&&s>-1&&this.keysPressed.splice(s,1)}update(){this.keysPressed.forEach(e=>{switch(e){case 37:this.x-=this.speed;break;case 38:this.y-=this.speed;break;case 39:this.x+=this.speed;break;case 40:this.y+=this.speed;break;default:return}}),this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x>window.outerWidth-this.width&&(this.x=window.outerWidth-this.width),this.y>document.documentElement.clientHeight-this.height&&(this.y=document.documentElement.clientHeight-this.height),this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}blockCaught(e){this.speed+=this.speedIncreaseFactor,this.width+=this.growthFactor,this.height+=this.growthFactor,this.el.style.height=`${this.height}px`,this.el.style.width=`${this.width}px`,this.el.style.borderRadius=`${this.width}px`,this.el.style.backgroundColor=e.color}destroy(){n.removeEventListener("keydown.player"),n.removeEventListener("keyup.player")}}class c extends i{constructor(){super("timer",10,40,"level"),this.seconds=10,this.el.innerHTML=`time: ${this.seconds}`,this.intervalId=setInterval(()=>this.update(),1e3)}update(){this.seconds--,this.el.innerHTML=`time: ${this.seconds}`,0===this.seconds&&window.dispatchEvent(new Event("timer:done"))}destroy(){clearInterval(this.intervalId)}}class p extends i{constructor(e,t){super("level",0,0),this.blocks=[],this.failed=!1,this.totalBlocks=e,this.scorePerBlock=t,this.player=new d,this.timer=new c;for(let e=0;e<this.totalBlocks;e++)this.blocks.push(new a(o.getRandomColor(),o.getRandomInt(1,5),o.getRandomInt(10,150),o.getRandomInt(10,150)));n.addEventListener("timer:done",()=>{this.failed=!0,this.destroy("level:failed")})}update(){this.player.update(),this.blocks.forEach((e,t)=>{e.update(),o.checkCollision(this.player.getClientReact(),e.getClientReact())&&!1===this.failed&&(this.player.blockCaught(e),e.destroy(),this.blocks.splice(t,1),window.dispatchEvent(new CustomEvent("level:scoreUpdate",{detail:{score:this.scorePerBlock}})),0===this.blocks.length&&this.destroy("level:success"))})}destroy(e){this.timer.destroy(),this.player.destroy(),this.blocks.forEach((e,t)=>{e.destroy(),this.blocks.splice(t,1)}),n.removeEventListener("timer:done"),window.dispatchEvent(new Event(e)),this.el.remove()}}window.addEventListener("load",()=>new class{constructor(){this.levelsPerGame=10,this.currentLevelsPlayed=0,this.elementsPerLevel=5,this.elementsIncreasePerLevel=5,this.scorePerElement=10,this.gui=new l,this.maxScore=this.calculateMaxScore(),this.gameLoop(),["level:success","level:failed"].map(e=>{window.addEventListener(e,e=>this.update(e.type))}),["game:start:click","level:success:click","level:failed:click"].map(e=>{window.addEventListener(e,()=>this.startNewLevel())}),window.addEventListener("game:end:click",()=>this.restart())}calculateMaxScore(){let e=0;for(let t=0;t<this.levelsPerGame;t++)e+=(this.elementsPerLevel+(0===t?0:this.elementsIncreasePerLevel*t))*this.scorePerElement;return e}gameLoop(){void 0!==this.level&&this.level.update(),requestAnimationFrame(()=>this.gameLoop())}update(e){this.currentLevelsPlayed++,this.currentLevelsPlayed!==this.levelsPerGame?this.gui.levelDone(e):this.gui.gameEnd(this.maxScore)}startNewLevel(){this.level&&!1===this.level.failed&&(this.elementsPerLevel+=this.elementsIncreasePerLevel),delete this.level,this.gui.newLevel(),this.level=new p(this.elementsPerLevel,this.scorePerElement)}restart(){this.gui.restart(),this.currentLevelsPlayed=0,this.elementsPerLevel=5}})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vZGV2L2RvbWVsZW1lbnQudHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L3Njb3JlLnRzIiwid2VicGFjazovLy8uL2Rldi93aW5kb3dldmVudGhhbmRsZXIudHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L21lc3NhZ2VzY3JlZW4udHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2d1aS50cyIsIndlYnBhY2s6Ly8vLi9kZXYvdXRpbHMudHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2Jsb2NrLnRzIiwid2VicGFjazovLy8uL2Rldi9wbGF5ZXIudHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L3RpbWVyLnRzIiwid2VicGFjazovLy8uL2Rldi9sZXZlbC50cyIsIndlYnBhY2s6Ly8vLi9kZXYvbWFpbi50cyIsIndlYnBhY2s6Ly8vLi9kZXYvZ2FtZS50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiY29uZmlndXJhYmxlIiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJ2YWx1ZSIsIm4iLCJfX2VzTW9kdWxlIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiRG9tRWxlbWVudCIsIltvYmplY3QgT2JqZWN0XSIsInR5cGUiLCJ4IiwieSIsInBhcmVudENsYXNzIiwidGhpcyIsImVsIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwibWFpbiIsImdldEVsZW1lbnRCeUlkIiwiRXJyb3IiLCJzdHlsZSIsInRyYW5zZm9ybSIsImNsYXNzTGlzdCIsImFkZCIsImFwcGVuZENoaWxkIiwicGFyZW50RWwiLCJxdWVyeVNlbGVjdG9yIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0Iiwic2NvcmVfU2NvcmUiLCJzdXBlciIsInNjb3JlIiwiaW5uZXJIVE1MIiwidG9TdHJpbmciLCJyZXNldCIsIldpbmRvd0V2ZW50SGFuZGxlciIsImV2ZW50IiwiZnVuYyIsImZ1bmN0aW9uTWFwIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsInNwbGl0IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIm1lc3NhZ2VzY3JlZW5fTWVzc2FnZVNjcmVlbiIsImhlaWdodCIsIndpZHRoIiwiaXNBY3RpdmUiLCJtZXNzYWdlcyIsImdhbWU6c3RhcnQiLCJnYW1lOmVuZCIsImxldmVsOnN1Y2Nlc3MiLCJsZXZlbDpmYWlsZWQiLCJvdXRlcldpZHRoIiwiZG9jdW1lbnRFbGVtZW50IiwiY2xpZW50SGVpZ2h0Iiwic2hvdyIsImUiLCJrZXlCb2FyZEhhbmRsZXIiLCJrZXlDb2RlIiwiZGlzcGF0Y2hFdmVudCIsIkV2ZW50IiwiY3VycmVudEV2ZW50IiwicmVwbGFjZW1lbnRzIiwibWVzc2FnZSIsInJlcGxhY2VtZW50IiwicmVwbGFjZSIsInJlbW92ZSIsImd1aV9HVUkiLCJtZXNzYWdlU2NyZWVuIiwidXBkYXRlIiwiZGV0YWlsIiwiaGlkZSIsIm1heFNjb3JlIiwiX19TQ09SRV9fIiwiX19NQVhfU0NPUkVfXyIsIlV0aWxzIiwiTWF0aCIsInJvdW5kIiwicmFuZG9tIiwibWluIiwibWF4IiwiZmxvb3IiLCJhIiwiYiIsImxlZnQiLCJyaWdodCIsInRvcCIsImJvdHRvbSIsImJsb2NrX0Jsb2NrIiwiY29sb3IiLCJzcGVlZCIsImRlc3RpbmF0aW9uIiwiYmFja2dyb3VuZEltYWdlIiwiZ2V0UmFuZG9tSW50IiwicGxheWVyX1BsYXllciIsImdyb3d0aEZhY3RvciIsInNwZWVkSW5jcmVhc2VGYWN0b3IiLCJrZXlzQWxsb3dlZCIsImtleXNQcmVzc2VkIiwiYm9yZGVyUmFkaXVzIiwia2V5RG93bkhhbmRsZXIiLCJrZXlVcEhhbmRsZXIiLCJrZXkiLCJpbmRleE9mIiwicHVzaCIsImtleVByZXNzZWRQb3NpdGlvbiIsInNwbGljZSIsImZvckVhY2giLCJibG9jayIsImJhY2tncm91bmRDb2xvciIsInRpbWVyX1RpbWVyIiwic2Vjb25kcyIsImludGVydmFsSWQiLCJzZXRJbnRlcnZhbCIsImNsZWFySW50ZXJ2YWwiLCJsZXZlbF9MZXZlbCIsInRvdGFsQmxvY2tzIiwic2NvcmVQZXJCbG9jayIsImJsb2NrcyIsImZhaWxlZCIsInBsYXllciIsInRpbWVyIiwiZ2V0UmFuZG9tQ29sb3IiLCJkZXN0cm95IiwiaW5kZXgiLCJjaGVja0NvbGxpc2lvbiIsImdldENsaWVudFJlYWN0IiwiYmxvY2tDYXVnaHQiLCJDdXN0b21FdmVudCIsImxlbmd0aCIsImV2ZW50VHlwZSIsImxldmVsc1BlckdhbWUiLCJjdXJyZW50TGV2ZWxzUGxheWVkIiwiZWxlbWVudHNQZXJMZXZlbCIsImVsZW1lbnRzSW5jcmVhc2VQZXJMZXZlbCIsInNjb3JlUGVyRWxlbWVudCIsImd1aSIsImNhbGN1bGF0ZU1heFNjb3JlIiwiZ2FtZUxvb3AiLCJtYXAiLCJzdGFydE5ld0xldmVsIiwicmVzdGFydCIsImxldmVsIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwibGV2ZWxEb25lIiwiZ2FtZUVuZCIsIm5ld0xldmVsIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxLQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLElBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsWUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FB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QyxpQkFBaUIwRixFQUFZMUUsR0FBTTFDLEtBQUt1RCxPQUFPYixFQUFFOUMsVUFFM0QsbUJBQW9CLHNCQUF1QixzQkFBc0JpSSxJQUFLVCxJQUNuRTNGLE9BQU9DLGlCQUFpQjBGLEVBQVcsSUFBTXBILEtBQUs4SCxtQkFFbERyRyxPQUFPQyxpQkFBaUIsaUJBQWtCLElBQU0xQixLQUFLK0gsV0FTakRwSSxvQkFDSixJQUFJK0QsRUFBVyxFQUNmLElBQUssSUFBSXpGLEVBQUksRUFBR0EsRUFBSStCLEtBQUtxSCxjQUFlcEosSUFFcEN5RixJQURlMUQsS0FBS3VILGtCQUEwQixJQUFOdEosRUFBVSxFQUFLK0IsS0FBS3dILHlCQUEyQnZKLElBQy9EK0IsS0FBS3lILGdCQUVqQyxPQUFPL0QsRUFNSC9ELGdCQUNzQixJQUFmSyxLQUFLZ0ksT0FDWmhJLEtBQUtnSSxNQUFNekUsU0FFZjBFLHNCQUFzQixJQUFNakksS0FBSzRILFlBUTdCakksT0FBT0MsR0FDWEksS0FBS3NILHNCQUNEdEgsS0FBS3NILHNCQUF3QnRILEtBQUtxSCxjQUt0Q3JILEtBQUswSCxJQUFJUSxVQUFVdEksR0FKZkksS0FBSzBILElBQUlTLFFBQVFuSSxLQUFLMEQsVUFVdEIvRCxnQkFDQUssS0FBS2dJLFFBQStCLElBQXRCaEksS0FBS2dJLE1BQU12QixTQUN6QnpHLEtBQUt1SCxrQkFBb0J2SCxLQUFLd0gsaUNBRzNCeEgsS0FBS2dJLE1BQ1poSSxLQUFLMEgsSUFBSVUsV0FFVHBJLEtBQUtnSSxNQUFRLElBQUkzQixFQUFNckcsS0FBS3VILGlCQUFrQnZILEtBQUt5SCxpQkFNL0M5SCxVQUNKSyxLQUFLMEgsSUFBSUssVUFDVC9ILEtBQUtzSCxvQkFBc0IsRUFDM0J0SCxLQUFLdUgsaUJBQW1CIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbiBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbiBcdFx0XHR9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRG9tRWxlbWVudCB7XG4gICAgcHJvdGVjdGVkIGVsOiBIVE1MRWxlbWVudDtcbiAgICBwcm90ZWN0ZWQgeDogbnVtYmVyO1xuICAgIHByb3RlY3RlZCB5OiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBzdHJpbmcsIHg6IG51bWJlciwgeTogbnVtYmVyLCBwYXJlbnRDbGFzczogc3RyaW5nID0gJycpIHtcbiAgICAgICAgdGhpcy54ID0geDtcbiAgICAgICAgdGhpcy55ID0geTtcblxuICAgICAgICB0aGlzLmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGxldCBtYWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4nKTtcbiAgICAgICAgaWYgKG1haW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIjxtYWluPiBlbGVtZW50IGRvZXNuJ3QgZXhpc3QhXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lbC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7dGhpcy54fXB4LCAke3RoaXMueX1weClgO1xuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQodHlwZSk7XG5cbiAgICAgICAgaWYgKHBhcmVudENsYXNzID09PSAnJykge1xuICAgICAgICAgICAgbWFpbi5hcHBlbmRDaGlsZCh0aGlzLmVsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBwYXJlbnRFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke3BhcmVudENsYXNzfWApO1xuICAgICAgICAgICAgaWYgKHBhcmVudEVsID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGA8LiR7cGFyZW50Q2xhc3N9PiBlbGVtZW50IGRvZXNuJ3QgZXhpc3QhYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJlbnRFbC5hcHBlbmRDaGlsZCh0aGlzLmVsKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIENsaWVudFJlY3RcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0Q2xpZW50UmVhY3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIH1cbn1cbiIsImltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuL2RvbWVsZW1lbnRcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2NvcmUgZXh0ZW5kcyBEb21FbGVtZW50IHtcbiAgICBwcml2YXRlIHNjb3JlOiBudW1iZXIgPSAwO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCdzY29yZScsIDEwLCAxMCwgJ2d1aScpO1xuICAgICAgICB0aGlzLmVsLmlubmVySFRNTCA9IGBzY29yZTogJHt0aGlzLnNjb3JlLnRvU3RyaW5nKCl9YDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZSBjdXJyZW50IHNjb3JlXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNjb3JlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgc2NvcmUgYmFzZWQgb24gYSBDdXN0b20gRXZlbnQgZnJvbSB0aGUgQmxvY2sgb2JqZWN0XG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2NvcmVcbiAgICAgKiBAcGFyYW0gW3Jlc2V0XVxuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGUoc2NvcmU6IG51bWJlciwgcmVzZXQ6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgICAgICB0aGlzLnNjb3JlID0gcmVzZXQgPyBzY29yZSA6IHRoaXMuc2NvcmUgKyBzY29yZTtcbiAgICAgICAgdGhpcy5lbC5pbm5lckhUTUwgPSBgc2NvcmU6ICR7dGhpcy5zY29yZS50b1N0cmluZygpfWA7XG4gICAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgV2luZG93RXZlbnRIYW5kbGVyIHtcbiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbk1hcDogeyBbazogc3RyaW5nXTogYW55IH0gPSB7fTtcblxuICAgIHB1YmxpYyBzdGF0aWMgYWRkRXZlbnRMaXN0ZW5lcihldmVudDogc3RyaW5nLCBmdW5jOiBhbnkpIHtcbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLmZ1bmN0aW9uTWFwW2V2ZW50XSA9IGZ1bmM7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKGV2ZW50LnNwbGl0KCcuJylbMF0sIFdpbmRvd0V2ZW50SGFuZGxlci5mdW5jdGlvbk1hcFtldmVudF0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgcmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudDogc3RyaW5nKSB7XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LnNwbGl0KCcuJylbMF0sIFdpbmRvd0V2ZW50SGFuZGxlci5mdW5jdGlvbk1hcFtldmVudF0pO1xuICAgICAgICBkZWxldGUgV2luZG93RXZlbnRIYW5kbGVyLmZ1bmN0aW9uTWFwW2V2ZW50XTtcbiAgICB9XG59XG4iLCJpbXBvcnQgRG9tRWxlbWVudCBmcm9tIFwiLi9kb21lbGVtZW50XCI7XG5pbXBvcnQgV2luZG93RXZlbnRIYW5kbGVyIGZyb20gXCIuL3dpbmRvd2V2ZW50aGFuZGxlclwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNZXNzYWdlU2NyZWVuIGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgcHJpdmF0ZSBoZWlnaHQ6IG51bWJlciA9IDIwMDtcbiAgICBwcml2YXRlIHdpZHRoOiBudW1iZXIgPSA0MDA7XG4gICAgcHJpdmF0ZSBjdXJyZW50RXZlbnQhOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBpc0FjdGl2ZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgcHJpdmF0ZSBtZXNzYWdlczogeyBbazogc3RyaW5nXTogc3RyaW5nIH0gPSB7XG4gICAgICAgICdnYW1lOnN0YXJ0JzogJ1dlbGNvbWUgdG8gQmxvY2stby1CbG9jaywgaXRcXCdzIHRpbWUgdG8gY2F0Y2ggdGhlbSBibG9ja3MhPGJyLz48YnIvPlVzZSB5b3VyIGFycm93IGtleXMgdG8gbW92ZSB5b3VyIHBsYXllciBhcm91bmQgYW5kIHByZXNzIHNwYWNlIHRvIHN0YXJ0LicsXG4gICAgICAgICdnYW1lOmVuZCc6ICdZb3UgbWFkZSBpdCwgeW91ciBmaW5hbCBzY29yZSBpcyBfX1NDT1JFX18gb3V0IG9mIG1heCBfX01BWF9TQ09SRV9fIHBvaW50cy48YnIvPjxici8+VGhhbmtzIGZvciBwbGF5aW5nLCBwcmVzcyBzcGFjZSB0byByZXN0YXJ0IHRoZSBtYWRuZXNzJyxcbiAgICAgICAgJ2xldmVsOnN1Y2Nlc3MnOiAnWUVBSCEgTGV2ZWwgY29tcGxldGVkISBQcmVzcyBzcGFjZSB0byBwcm9jZWVkIHRvIHRoZSBuZXh0IGxldmVsJyxcbiAgICAgICAgJ2xldmVsOmZhaWxlZCc6ICdBQUghIExldmVsIGZhaWxlZCEgUHJlc3Mgc3BhY2UgdG8gcmVzdGFydCB0aGlzIGxldmVsJ1xuICAgIH07XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ21lc3NhZ2VzY3JlZW4nLCAwLCAwLCAnZ3VpJyk7XG5cbiAgICAgICAgdGhpcy54ID0gd2luZG93Lm91dGVyV2lkdGggLyAyIC0gdGhpcy53aWR0aCAvIDI7XG4gICAgICAgIHRoaXMueSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLyAyIC0gdGhpcy5oZWlnaHQgLyAyO1xuXG4gICAgICAgIHRoaXMuZWwuc3R5bGUud2lkdGggPSBgJHt0aGlzLndpZHRofXB4YDtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5oZWlnaHQgPSBgJHt0aGlzLmhlaWdodH1weGA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgke3RoaXMueH1weCwgJHt0aGlzLnl9cHgpYDtcblxuICAgICAgICB0aGlzLnNob3coJ2dhbWU6c3RhcnQnKTtcbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwLm1lc3NhZ2VzY3JlZW4nLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4gdGhpcy5rZXlCb2FyZEhhbmRsZXIoZSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSB0aGUgc3BhY2ViYXJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7S2V5Ym9hcmRFdmVudH0gZVxuICAgICAqL1xuICAgIGtleUJvYXJkSGFuZGxlcihlOiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGlmIChlLmtleUNvZGUgPT09IDMyICYmIHRoaXMuaXNBY3RpdmUgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChgJHt0aGlzLmN1cnJlbnRFdmVudH06Y2xpY2tgKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaG93IHRoZSBkZXNpcmVkIG1lc3NhZ2UgKHR5cGUgbWF0Y2hlcyBpbmRleCBpbiBvYmplY3QpXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdHlwZVxuICAgICAqIEBwYXJhbSBbcmVwbGFjZW1lbnRzXVxuICAgICAqL1xuICAgIHB1YmxpYyBzaG93KHR5cGU6IHN0cmluZywgcmVwbGFjZW1lbnRzOiB7IFtrOiBzdHJpbmddOiBzdHJpbmcgfSA9IHt9KSB7XG4gICAgICAgIGxldCBtZXNzYWdlID0gdGhpcy5tZXNzYWdlc1t0eXBlXTtcbiAgICAgICAgZm9yIChsZXQgcmVwbGFjZW1lbnQgaW4gcmVwbGFjZW1lbnRzKSB7XG4gICAgICAgICAgICBtZXNzYWdlID0gbWVzc2FnZS5yZXBsYWNlKHJlcGxhY2VtZW50LCByZXBsYWNlbWVudHNbcmVwbGFjZW1lbnRdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZWwuaW5uZXJIVE1MID0gbWVzc2FnZTtcbiAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XG4gICAgICAgIHRoaXMuY3VycmVudEV2ZW50ID0gdHlwZTtcbiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGlkZSBtZXNzYWdlIG9uIHNjcmVlblxuICAgICAqL1xuICAgIHB1YmxpYyBoaWRlKCkge1xuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgIH1cbn1cbiIsImltcG9ydCBTY29yZSBmcm9tICcuL3Njb3JlJztcbmltcG9ydCBNZXNzYWdlU2NyZWVuIGZyb20gJy4vbWVzc2FnZXNjcmVlbic7XG5pbXBvcnQgRG9tRWxlbWVudCBmcm9tIFwiLi9kb21lbGVtZW50XCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdVSSBleHRlbmRzIERvbUVsZW1lbnQge1xuICAgIHByaXZhdGUgc2NvcmU6IFNjb3JlO1xuICAgIHByaXZhdGUgbWVzc2FnZVNjcmVlbjogTWVzc2FnZVNjcmVlbjtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcignZ3VpJywgMCwgMCk7XG5cbiAgICAgICAgdGhpcy5zY29yZSA9IG5ldyBTY29yZSgpO1xuICAgICAgICB0aGlzLm1lc3NhZ2VTY3JlZW4gPSBuZXcgTWVzc2FnZVNjcmVlbigpO1xuXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsZXZlbDpzY29yZVVwZGF0ZScsIChlKSA9PiB0aGlzLnNjb3JlLnVwZGF0ZSgoZSBhcyBDdXN0b21FdmVudCkuZGV0YWlsLnNjb3JlKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIHdoZW4gYSBsZXZlbCBpcyBkb25lXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZVxuICAgICAqL1xuICAgIHB1YmxpYyBsZXZlbERvbmUodHlwZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMubWVzc2FnZVNjcmVlbi5zaG93KHR5cGUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCB3aGVuIGEgbmV3IGxldmVsIHN0YXJ0c1xuICAgICAqL1xuICAgIHB1YmxpYyBuZXdMZXZlbCgpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlU2NyZWVuLmhpZGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgd2hlbiB0aGUgZ2FtZSBpcyBkb25lXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWF4U2NvcmVcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2FtZUVuZChtYXhTY29yZTogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMubWVzc2FnZVNjcmVlbi5zaG93KCdnYW1lOmVuZCcsIHtcbiAgICAgICAgICAgICdfX1NDT1JFX18nOiB0aGlzLnNjb3JlLmdldCgpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAnX19NQVhfU0NPUkVfXyc6IG1heFNjb3JlLnRvU3RyaW5nKClcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIHdoZW4gd2UgbmVlZCB0byByZXN0YXJ0LCBnbyB0byBmaXJzdCBzY3JlZW4gYW5kIHNldCBzY29yZSB0byAwXG4gICAgICovXG4gICAgcHVibGljIHJlc3RhcnQoKSB7XG4gICAgICAgIHRoaXMubWVzc2FnZVNjcmVlbi5zaG93KCdnYW1lOnN0YXJ0Jyk7XG4gICAgICAgIHRoaXMuc2NvcmUudXBkYXRlKDAsIHRydWUpO1xuICAgIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFV0aWxzIHtcbiAgICBzdGF0aWMgZ2V0UmFuZG9tQ29sb3IoKSB7XG4gICAgICAgIGxldCBvID0gTWF0aC5yb3VuZCwgciA9IE1hdGgucmFuZG9tLCBzID0gMjU1O1xuICAgICAgICByZXR1cm4gYHJnYmEoJHtvKHIoKSAqIHMpfSwke28ocigpICogcyl9LCR7byhyKCkgKiBzKX0sMSlgO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRSYW5kb21JbnQobWluOiBudW1iZXIsIG1heDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpICsgbWluO1xuICAgIH1cblxuICAgIHN0YXRpYyBjaGVja0NvbGxpc2lvbihhOiBDbGllbnRSZWN0LCBiOiBDbGllbnRSZWN0KSB7XG4gICAgICAgIHJldHVybiAoYS5sZWZ0IDw9IGIucmlnaHQgJiZcbiAgICAgICAgICAgIGIubGVmdCA8PSBhLnJpZ2h0ICYmXG4gICAgICAgICAgICBhLnRvcCA8PSBiLmJvdHRvbSAmJlxuICAgICAgICAgICAgYi50b3AgPD0gYS5ib3R0b20pO1xuICAgIH1cbn1cbiIsImltcG9ydCBEb21FbGVtZW50IGZyb20gJy4vZG9tZWxlbWVudCc7XG5pbXBvcnQgVXRpbHMgZnJvbSBcIi4vdXRpbHNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQmxvY2sgZXh0ZW5kcyBEb21FbGVtZW50IHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNwZWVkOiBudW1iZXI7XG4gICAgcHJpdmF0ZSByZWFkb25seSB3aWR0aDogbnVtYmVyO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgaGVpZ2h0OiBudW1iZXI7XG4gICAgcHVibGljIGNvbG9yOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBkZXN0aW5hdGlvbiA9IHt4OiAwLCB5OiAwfTtcblxuICAgIGNvbnN0cnVjdG9yKGNvbG9yOiBzdHJpbmcsIHNwZWVkOiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKCdibG9jaycsIDAsIDAsICdsZXZlbCcpO1xuXG4gICAgICAgIHRoaXMuc3BlZWQgPSBzcGVlZDtcbiAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yO1xuXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQoJHtVdGlscy5nZXRSYW5kb21JbnQoMCwzNjApfWRlZywgIzAwMDAwMCwgIzAwMDAwMCAke1V0aWxzLmdldFJhbmRvbUludCgyLDEwKX1weCwgJHt0aGlzLmNvbG9yfSAxMHB4LCAke3RoaXMuY29sb3J9ICR7VXRpbHMuZ2V0UmFuZG9tSW50KDIwLDQwKX1weClgO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLndpZHRoID0gYCR7dGhpcy53aWR0aH1weGA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuaGVpZ2h0ID0gYCR7dGhpcy5oZWlnaHR9cHhgO1xuXG4gICAgICAgIHRoaXMueCA9IFV0aWxzLmdldFJhbmRvbUludCgwLCAod2luZG93Lm91dGVyV2lkdGggLSB0aGlzLndpZHRoKSk7XG4gICAgICAgIHRoaXMueSA9IFV0aWxzLmdldFJhbmRvbUludCgwLCAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAtIHRoaXMuaGVpZ2h0KSk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgke3RoaXMueH1weCwgJHt0aGlzLnl9cHgpYDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGVyIGZvciBjbGlja2luZyB0aGUgYmxvY2tzXG4gICAgICovXG4gICAgcHVibGljIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuZWwucmVtb3ZlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWFpbiB1cGRhdGUgaGFuZGxlciBmb3IgdGhlIGdhbWUgZm9yIG1vdmluZyBvdXIgYmxvY2sgcmFuZG9tbHkgb3ZlciB0aGUgc2NyZWVuXG4gICAgICovXG4gICAgcHVibGljIHVwZGF0ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMueCA+ICh0aGlzLmRlc3RpbmF0aW9uLnggLSB0aGlzLnNwZWVkKSAmJiB0aGlzLnggPCAodGhpcy5kZXN0aW5hdGlvbi54ICsgdGhpcy5zcGVlZCkpIHtcbiAgICAgICAgICAgIHRoaXMuZGVzdGluYXRpb24ueCA9IFV0aWxzLmdldFJhbmRvbUludCgwLCAod2luZG93Lm91dGVyV2lkdGggLSB0aGlzLndpZHRoKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMueSA+ICh0aGlzLmRlc3RpbmF0aW9uLnkgLSB0aGlzLnNwZWVkKSAmJiB0aGlzLnkgPCAodGhpcy5kZXN0aW5hdGlvbi55ICsgdGhpcy5zcGVlZCkpIHtcbiAgICAgICAgICAgIHRoaXMuZGVzdGluYXRpb24ueSA9IFV0aWxzLmdldFJhbmRvbUludCgwLCAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAtIHRoaXMuaGVpZ2h0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5kZXN0aW5hdGlvbi54ID49IHRoaXMueCkge1xuICAgICAgICAgICAgdGhpcy54ICs9IHRoaXMuc3BlZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnggLT0gdGhpcy5zcGVlZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmRlc3RpbmF0aW9uLnkgPj0gdGhpcy55KSB7XG4gICAgICAgICAgICB0aGlzLnkgKz0gdGhpcy5zcGVlZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMueSAtPSB0aGlzLnNwZWVkO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lbC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7dGhpcy54fXB4LCAke3RoaXMueX1weClgO1xuICAgIH1cbn1cbiIsImltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuL2RvbWVsZW1lbnRcIjtcbmltcG9ydCBCbG9jayBmcm9tIFwiLi9ibG9ja1wiO1xuaW1wb3J0IFdpbmRvd0V2ZW50SGFuZGxlciBmcm9tIFwiLi93aW5kb3dldmVudGhhbmRsZXJcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGxheWVyIGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgcHJpdmF0ZSBoZWlnaHQ6IG51bWJlciA9IDEwO1xuICAgIHByaXZhdGUgd2lkdGg6IG51bWJlciA9IDEwO1xuICAgIHByaXZhdGUgZ3Jvd3RoRmFjdG9yOiBudW1iZXIgPSAxLjU7XG4gICAgcHJpdmF0ZSBzcGVlZDogbnVtYmVyID0gMjtcbiAgICBwcml2YXRlIHNwZWVkSW5jcmVhc2VGYWN0b3I6IG51bWJlciA9IDAuMjtcbiAgICBwcml2YXRlIGtleXNBbGxvd2VkOiBudW1iZXJbXSA9IFszNywgMzgsIDM5LCA0MF07XG4gICAgcHJpdmF0ZSBrZXlzUHJlc3NlZDogbnVtYmVyW10gPSBbXTtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigncGxheWVyJywgMCwgMCwgJ2xldmVsJyk7XG4gICAgICAgIHRoaXMueCA9IHdpbmRvdy5vdXRlcldpZHRoIC8gMiAtIHRoaXMud2lkdGggLyAyO1xuICAgICAgICB0aGlzLnkgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC8gMiAtIHRoaXMuaGVpZ2h0IC8gMjtcblxuICAgICAgICB0aGlzLmVsLnN0eWxlLndpZHRoID0gYCR7dGhpcy53aWR0aH1weGA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuaGVpZ2h0ID0gYCR7dGhpcy5oZWlnaHR9cHhgO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLmJvcmRlclJhZGl1cyA9IGAke3RoaXMud2lkdGh9cHhgO1xuXG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duLnBsYXllcicsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB0aGlzLmtleURvd25IYW5kbGVyKGUpKTtcbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwLnBsYXllcicsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB0aGlzLmtleVVwSGFuZGxlcihlKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogS2V5IGRvd24gaGFuZGxlciBmb3IgbW92aW5nIHRoZSBwbGF5ZXJcbiAgICAgKlxuICAgICAqIEBwYXJhbSBlXG4gICAgICovXG4gICAgcHJpdmF0ZSBrZXlEb3duSGFuZGxlcihlOiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGxldCBrZXkgPSBlLmtleUNvZGU7XG4gICAgICAgIGlmICh0aGlzLmtleXNBbGxvd2VkLmluZGV4T2Yoa2V5KSA+IC0xICYmIHRoaXMua2V5c1ByZXNzZWQuaW5kZXhPZihrZXkpID09PSAtMSkge1xuICAgICAgICAgICAgdGhpcy5rZXlzUHJlc3NlZC5wdXNoKGtleSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBLZXkgZG93biBoYW5kbGVyIGZvciBtb3ZpbmcgdGhlIHBsYXllclxuICAgICAqXG4gICAgICogQHBhcmFtIGVcbiAgICAgKi9cbiAgICBwcml2YXRlIGtleVVwSGFuZGxlcihlOiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGxldCBrZXkgPSBlLmtleUNvZGU7XG4gICAgICAgIGxldCBrZXlQcmVzc2VkUG9zaXRpb24gPSB0aGlzLmtleXNQcmVzc2VkLmluZGV4T2Yoa2V5KTtcbiAgICAgICAgaWYgKHRoaXMua2V5c0FsbG93ZWQuaW5kZXhPZihrZXkpID4gLTEgJiYga2V5UHJlc3NlZFBvc2l0aW9uID4gLTEpIHtcbiAgICAgICAgICAgIHRoaXMua2V5c1ByZXNzZWQuc3BsaWNlKGtleVByZXNzZWRQb3NpdGlvbiwgMSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhlIGFjdHVhbCBwb3NpdGlvbiBiYXNlZCBvbiBlYXJsaWVyIGV2ZW50c1xuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGUoKSB7XG4gICAgICAgIHRoaXMua2V5c1ByZXNzZWQuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMzc6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMueCAtPSB0aGlzLnNwZWVkO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgMzg6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMueSAtPSB0aGlzLnNwZWVkO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgMzk6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMueCArPSB0aGlzLnNwZWVkO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgNDA6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMueSArPSB0aGlzLnNwZWVkO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9DaGVja3MgdG8gc3RheSBpbiBib3VuZHNcbiAgICAgICAgaWYgKHRoaXMueCA8IDApIHtcbiAgICAgICAgICAgIHRoaXMueCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMueSA8IDApIHtcbiAgICAgICAgICAgIHRoaXMueSA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMueCA+ICh3aW5kb3cub3V0ZXJXaWR0aCAtIHRoaXMud2lkdGgpKSB7XG4gICAgICAgICAgICB0aGlzLnggPSAod2luZG93Lm91dGVyV2lkdGggLSB0aGlzLndpZHRoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy55ID4gKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLSB0aGlzLmhlaWdodCkpIHtcbiAgICAgICAgICAgIHRoaXMueSA9IChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gdGhpcy5oZWlnaHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lbC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7dGhpcy54fXB4LCAke3RoaXMueX1weClgO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSBwbGF5ZXIgd2hlbiBhIGJsb2NrIGdvdCBjYXVnaHRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBibG9ja1xuICAgICAqL1xuICAgIHB1YmxpYyBibG9ja0NhdWdodChibG9jazogQmxvY2spIHtcbiAgICAgICAgdGhpcy5zcGVlZCArPSB0aGlzLnNwZWVkSW5jcmVhc2VGYWN0b3I7XG4gICAgICAgIHRoaXMud2lkdGggKz0gdGhpcy5ncm93dGhGYWN0b3I7XG4gICAgICAgIHRoaXMuaGVpZ2h0ICs9IHRoaXMuZ3Jvd3RoRmFjdG9yO1xuXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuaGVpZ2h0ID0gYCR7dGhpcy5oZWlnaHR9cHhgO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLndpZHRoID0gYCR7dGhpcy53aWR0aH1weGA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuYm9yZGVyUmFkaXVzID0gYCR7dGhpcy53aWR0aH1weGA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gYmxvY2suY29sb3I7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xlYW4gdXAhXG4gICAgICovXG4gICAgcHVibGljIGRlc3Ryb3koKSB7XG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duLnBsYXllcicpO1xuICAgICAgICBXaW5kb3dFdmVudEhhbmRsZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5dXAucGxheWVyJyk7XG4gICAgfVxufVxuIiwiaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4vZG9tZWxlbWVudFwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUaW1lciBleHRlbmRzIERvbUVsZW1lbnQge1xuICAgIHNlY29uZHM6IG51bWJlciA9IDEwO1xuICAgIGludGVydmFsSWQ6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigndGltZXInLCAxMCwgNDAsICdsZXZlbCcpO1xuICAgICAgICB0aGlzLmVsLmlubmVySFRNTCA9IGB0aW1lOiAke3RoaXMuc2Vjb25kc31gO1xuXG4gICAgICAgIHRoaXMuaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKCgpID0+IHRoaXMudXBkYXRlKCksIDEwMDApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvdW50ZG93biBvZiBzZWNvbmRzXG4gICAgICovXG4gICAgcHJpdmF0ZSB1cGRhdGUoKSB7XG4gICAgICAgIHRoaXMuc2Vjb25kcy0tO1xuICAgICAgICB0aGlzLmVsLmlubmVySFRNTCA9IGB0aW1lOiAke3RoaXMuc2Vjb25kc31gO1xuXG4gICAgICAgIGlmICh0aGlzLnNlY29uZHMgPT09IDApIHtcbiAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgndGltZXI6ZG9uZScpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBkZXN0cm95KCkge1xuICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJZCk7XG4gICAgfVxufVxuIiwiaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4vZG9tZWxlbWVudFwiO1xuaW1wb3J0IEJsb2NrIGZyb20gXCIuL2Jsb2NrXCI7XG5pbXBvcnQgUGxheWVyIGZyb20gXCIuL3BsYXllclwiO1xuaW1wb3J0IFRpbWVyIGZyb20gXCIuL3RpbWVyXCI7XG5pbXBvcnQgVXRpbHMgZnJvbSBcIi4vdXRpbHNcIjtcbmltcG9ydCBXaW5kb3dFdmVudEhhbmRsZXIgZnJvbSBcIi4vd2luZG93ZXZlbnRoYW5kbGVyXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExldmVsIGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgcHJpdmF0ZSByZWFkb25seSB0b3RhbEJsb2NrczogbnVtYmVyO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgc2NvcmVQZXJCbG9jazogbnVtYmVyO1xuICAgIHByaXZhdGUgYmxvY2tzOiBCbG9ja1tdID0gW107XG4gICAgcHJpdmF0ZSBwbGF5ZXI6IFBsYXllcjtcbiAgICBwcml2YXRlIHRpbWVyOiBUaW1lcjtcbiAgICBwdWJsaWMgZmFpbGVkID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3Rvcih0b3RhbEJsb2NrczogbnVtYmVyLCBzY29yZVBlckJsb2NrOiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIoJ2xldmVsJywgMCwgMCk7XG5cbiAgICAgICAgdGhpcy50b3RhbEJsb2NrcyA9IHRvdGFsQmxvY2tzO1xuICAgICAgICB0aGlzLnNjb3JlUGVyQmxvY2sgPSBzY29yZVBlckJsb2NrO1xuICAgICAgICB0aGlzLnBsYXllciA9IG5ldyBQbGF5ZXIoKTtcbiAgICAgICAgdGhpcy50aW1lciA9IG5ldyBUaW1lcigpO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50b3RhbEJsb2NrczsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLmJsb2Nrcy5wdXNoKG5ldyBCbG9jayhVdGlscy5nZXRSYW5kb21Db2xvcigpLCBVdGlscy5nZXRSYW5kb21JbnQoMSwgNSksIFV0aWxzLmdldFJhbmRvbUludCgxMCwgMTUwKSwgVXRpbHMuZ2V0UmFuZG9tSW50KDEwLCAxNTApKSk7XG4gICAgICAgIH1cblxuICAgICAgICBXaW5kb3dFdmVudEhhbmRsZXIuYWRkRXZlbnRMaXN0ZW5lcigndGltZXI6ZG9uZScsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZmFpbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveSgnbGV2ZWw6ZmFpbGVkJyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBmb3IgY29sbGlzaW9uIGFuZCBwb3RlbnRpYWwgc3VjY2VzcyBvZiB0aGlzIGxldmVsXG4gICAgICovXG4gICAgcHVibGljIHVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIudXBkYXRlKCk7XG4gICAgICAgIHRoaXMuYmxvY2tzLmZvckVhY2goKGJsb2NrLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgYmxvY2sudXBkYXRlKCk7XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5jaGVja0NvbGxpc2lvbih0aGlzLnBsYXllci5nZXRDbGllbnRSZWFjdCgpLCBibG9jay5nZXRDbGllbnRSZWFjdCgpKSAmJiB0aGlzLmZhaWxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllci5ibG9ja0NhdWdodChibG9jayk7XG4gICAgICAgICAgICAgICAgYmxvY2suZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYmxvY2tzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdsZXZlbDpzY29yZVVwZGF0ZScsIHtkZXRhaWw6IHtzY29yZTogdGhpcy5zY29yZVBlckJsb2NrfX0pKTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmJsb2Nrcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXN0cm95KCdsZXZlbDpzdWNjZXNzJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXN0cm95IG9iamVjdCAmIHRpbWVyIGFuZCB0cmlnZ2VyIGV2ZW50IHRvIG5vdGlmeSB0aGUgd29ybGQgYWJvdXQgdGhlIHN0YXR1cyBvZiB0aGlzIGxldmVsXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZXZlbnRUeXBlXG4gICAgICovXG4gICAgcHJpdmF0ZSBkZXN0cm95KGV2ZW50VHlwZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMudGltZXIuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLnBsYXllci5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMuYmxvY2tzLmZvckVhY2goKGJsb2NrLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgYmxvY2suZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5ibG9ja3Muc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5yZW1vdmVFdmVudExpc3RlbmVyKCd0aW1lcjpkb25lJyk7XG4gICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChldmVudFR5cGUpKTtcbiAgICAgICAgdGhpcy5lbC5yZW1vdmUoKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgR2FtZSBmcm9tICcuL2dhbWUnO1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgKCkgPT4gbmV3IEdhbWUoKSk7XG4iLCJpbXBvcnQgR1VJIGZyb20gJy4vZ3VpJztcbmltcG9ydCBMZXZlbCBmcm9tIFwiLi9sZXZlbFwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHYW1lIHtcbiAgICBwcml2YXRlIGxldmVsITogTGV2ZWw7XG4gICAgcHJpdmF0ZSBsZXZlbHNQZXJHYW1lOiBudW1iZXIgPSAxMDtcbiAgICBwcml2YXRlIGN1cnJlbnRMZXZlbHNQbGF5ZWQ6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBlbGVtZW50c1BlckxldmVsOiBudW1iZXIgPSA1O1xuICAgIHByaXZhdGUgZWxlbWVudHNJbmNyZWFzZVBlckxldmVsOiBudW1iZXIgPSA1O1xuICAgIHByaXZhdGUgc2NvcmVQZXJFbGVtZW50OiBudW1iZXIgPSAxMDtcbiAgICBwcml2YXRlIHJlYWRvbmx5IG1heFNjb3JlOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBndWk6IEdVSTtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmd1aSA9IG5ldyBHVUkoKTtcbiAgICAgICAgdGhpcy5tYXhTY29yZSA9IHRoaXMuY2FsY3VsYXRlTWF4U2NvcmUoKTtcbiAgICAgICAgdGhpcy5nYW1lTG9vcCgpO1xuXG4gICAgICAgIFsnbGV2ZWw6c3VjY2VzcycsICdsZXZlbDpmYWlsZWQnXS5tYXAoKGV2ZW50VHlwZSkgPT4ge1xuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCAoZSkgPT4gdGhpcy51cGRhdGUoZS50eXBlKSk7XG4gICAgICAgIH0pO1xuICAgICAgICBbJ2dhbWU6c3RhcnQ6Y2xpY2snLCAnbGV2ZWw6c3VjY2VzczpjbGljaycsICdsZXZlbDpmYWlsZWQ6Y2xpY2snXS5tYXAoKGV2ZW50VHlwZSkgPT4ge1xuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCAoKSA9PiB0aGlzLnN0YXJ0TmV3TGV2ZWwoKSk7XG4gICAgICAgIH0pO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZ2FtZTplbmQ6Y2xpY2snLCAoKSA9PiB0aGlzLnJlc3RhcnQoKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlIHRoZSBzY29yZSB3aXRoIGF2YWlsYWJsZSBwYXJhbWV0ZXJzXG4gICAgICpcbiAgICAgKiBAdG9kbyBEbyBJIHJlYWxseSBuZWVkIHRvIHRvIHRoaXMgc28gaW5lZmZpY2llbnQuLj9cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgICAqL1xuICAgIHByaXZhdGUgY2FsY3VsYXRlTWF4U2NvcmUoKSB7XG4gICAgICAgIGxldCBtYXhTY29yZSA9IDA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5sZXZlbHNQZXJHYW1lOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBlbGVtZW50cyA9IHRoaXMuZWxlbWVudHNQZXJMZXZlbCArIChpID09PSAwID8gMCA6ICh0aGlzLmVsZW1lbnRzSW5jcmVhc2VQZXJMZXZlbCAqIGkpKTtcbiAgICAgICAgICAgIG1heFNjb3JlICs9IChlbGVtZW50cyAqIHRoaXMuc2NvcmVQZXJFbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWF4U2NvcmU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIG9ubHkgcGxhY2UgZm9yIGEgcmVxdWVzdEFuaW1hdGlvbkZyYW1lXG4gICAgICovXG4gICAgcHJpdmF0ZSBnYW1lTG9vcCgpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmxldmVsICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5sZXZlbC51cGRhdGUoKTtcbiAgICAgICAgfVxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5nYW1lTG9vcCgpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhlIGdhbWUgYnkgZWl0aGVyIHRoZSBlbmQgb3IgYW55dGhpbmcgaW4gYmV0d2VlbiBsZXZlbHNcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlXG4gICAgICovXG4gICAgcHJpdmF0ZSB1cGRhdGUodHlwZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuY3VycmVudExldmVsc1BsYXllZCsrO1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50TGV2ZWxzUGxheWVkID09PSB0aGlzLmxldmVsc1BlckdhbWUpIHtcbiAgICAgICAgICAgIHRoaXMuZ3VpLmdhbWVFbmQodGhpcy5tYXhTY29yZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmd1aS5sZXZlbERvbmUodHlwZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGltZSB0byBzdGFydCBhIG5ldyBsZXZlbCB3aXRoIG1hZG5lc3NcbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXJ0TmV3TGV2ZWwoKSB7XG4gICAgICAgIGlmICh0aGlzLmxldmVsICYmIHRoaXMubGV2ZWwuZmFpbGVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50c1BlckxldmVsICs9IHRoaXMuZWxlbWVudHNJbmNyZWFzZVBlckxldmVsO1xuICAgICAgICB9XG5cbiAgICAgICAgZGVsZXRlIHRoaXMubGV2ZWw7XG4gICAgICAgIHRoaXMuZ3VpLm5ld0xldmVsKCk7XG5cbiAgICAgICAgdGhpcy5sZXZlbCA9IG5ldyBMZXZlbCh0aGlzLmVsZW1lbnRzUGVyTGV2ZWwsIHRoaXMuc2NvcmVQZXJFbGVtZW50KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTdGFydCBldmVyeXRoaW5nIGZyb20gdGhlIGJlZ2lubmluZ1xuICAgICAqL1xuICAgIHByaXZhdGUgcmVzdGFydCgpIHtcbiAgICAgICAgdGhpcy5ndWkucmVzdGFydCgpO1xuICAgICAgICB0aGlzLmN1cnJlbnRMZXZlbHNQbGF5ZWQgPSAwO1xuICAgICAgICB0aGlzLmVsZW1lbnRzUGVyTGV2ZWwgPSA1O1xuICAgIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=