!function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e){e.exports={game:{levelsPerGame:1,startElementsPerLevel:5,elementsIncreasePerLevel:5,scorePerElement:10,secondsPerLevel:10,blockSpeed:{min:1,max:5},blockPixels:{min:10,max:150},player:{growthFactor:1.5,speed:3,speedIncreaseFactor:.2}},functionalities:{dataService:!0},dataService:{baseUrl:"https://api.mlab.com/api/1",apiKey:"X17utv1FH2dFTeUo4yhNGL54sA7CY2jS",databaseName:"typescript_scores",collectionName:"scores"}}},function(e,t,s){"use strict";s.r(t);var i=s(0);class r{constructor(e,t,s,i=""){this.x=t,this.y=s,this.el=document.createElement("div");let r=document.getElementById("main");if(null===r)throw new Error("<main> element doesn't exist!");if(this.x>-1&&this.y>-1&&(this.el.style.transform=`translate(${this.x}px, ${this.y}px)`),this.el.classList.add(`game-${e}`),""===i)r.appendChild(this.el);else{let e=document.querySelector(`.game-${i}`);if(null===e)throw new Error(`<.game-${i}> element doesn't exist!`);e.appendChild(this.el)}}getClientReact(){return this.el.getBoundingClientRect()}}class a extends r{constructor(){super("score",-1,-1,"gui"),this.score=0,this.renderTemplate(),this.el.querySelector(".score-count").innerHTML=this.score.toString(),this.el.classList.add("message","is-warning")}get(){return this.score}update(e,t=!1){this.score=t?e:this.score+e,this.el.querySelector(".score-count").innerHTML=this.score.toString()}renderTemplate(){this.el.innerHTML='\n            <div class="message-body">\n                <span>score: </span>\n                <span class="score-count"></span>\n            </div>\n        '}}class n{static addEventListener(e,t){n.functionMap[e]=t,window.addEventListener(e.split(".")[0],n.functionMap[e])}static removeEventListener(e){window.removeEventListener(e.split(".")[0],n.functionMap[e]),delete n.functionMap[e]}}n.functionMap={};class o extends r{constructor(){super("messagescreen",-1,-1,"gui"),this.isActive=!1,this.messages={"game:start":{header:"Welcome to Block-o-Block!",body:"It's time to catch them blocks!<br/><br/>Use your arrow keys to move your player around and press space to start.<br/><br/>Press -<strong>H</strong>- to view the highscore list",className:"is-info"},"game:end":{header:"Your game is over!",body:"You made it, your final score is __SCORE__ out of max __MAX_SCORE__ points.<br/><br/>Thanks for playing, press space to restart the madness.<br/><br/>Press -<strong>H</strong>- to view the highscore list",className:"is-success"},"level:success":{header:"YEAH! Level completed!",body:"Performing like a boss! Press space to proceed to the next level and catch even more blocks",className:"is-success"},"level:failed":{header:"AAH! Level failed!",body:"Try again and show us what you're made off! Press space to restart this level",className:"is-danger"}},this.el.classList.add("message"),this.renderTemplate(),this.show("game:start"),n.addEventListener("keyup.messagescreen",e=>this.keyBoardHandler(e))}keyBoardHandler(e){" "===e.key&&!0===this.isActive&&window.dispatchEvent(new Event(`${this.currentEvent}:click`))}show(e,t={}){let s=this.messages[e].header,i=this.messages[e].body;for(let e in t)i=i.replace(e,t[e]);this.el.querySelector(".message-header").innerHTML=s,this.el.querySelector(".message-body").innerHTML=i,this.el.classList.add("show",this.messages[e].className),this.currentEvent=e,this.isActive=!0}hide(){this.el.classList.remove("show","is-info","is-success","is-danger"),this.isActive=!1}renderTemplate(){this.el.innerHTML='\n            <div class="message-header"></div>\n            <div class="message-body"></div>\n        '}}class h{constructor(){this.endPointList=`/databases/${i.dataService.databaseName}/collections/${i.dataService.collectionName}?apiKey=${i.dataService.apiKey}`,this.endPointSave=`/databases/${i.dataService.databaseName}/collections/${i.dataService.collectionName}?apiKey=${i.dataService.apiKey}`,this.disabledMessage="Dataservice is disabled"}saveScore(e){if(!1===i.functionalities.dataService)return this.disabled();let t=`${i.dataService.baseUrl}${this.endPointSave}`;return fetch(t,{body:JSON.stringify({score:e}),headers:{"content-type":"application/json"},method:"POST",mode:"cors"}).then(e=>e.json())}getScores(){if(!1===i.functionalities.dataService)return this.disabled();if(!1===window.navigator.onLine)return new Promise(e=>{e(JSON.parse(localStorage.getItem("scores")))});let e=`${i.dataService.baseUrl}${this.endPointList}&s={"score": -1}&l=10`;return fetch(e,{mode:"cors"}).then(e=>e.json()).then(e=>localStorage.getItem("scores")===JSON.stringify(e)?JSON.parse(localStorage.getItem("scores")):(localStorage.setItem("scores",JSON.stringify(e)),e))}disabled(){return new Promise(e=>{e({error:this.disabledMessage})})}}class l extends r{constructor(){super("highscorelist",-1,-1,"gui"),this.el.classList.add("message","is-warning"),this.renderTemplate(),this.tBody=this.el.querySelector(".tbody"),this.dataService=new h,this.loadScoreData(),window.addEventListener("game:scoreSaved",e=>this.updateData(e.detail.data))}loadScoreData(e=!1){this.dataService.getScores().then(t=>{this.scores=t,this.tBody.innerHTML=this.getTbodyTemplate(),!0===e&&this.el.classList.add("show")})}updateData(e){((0===this.scores.length?-1:this.scores[this.scores.length-1].score)<e.score||this.scores.length<10)&&(this.scores.push(e),this.scores.sort((e,t)=>t.score-e.score),this.scores.splice(10,1),this.tBody.innerHTML=this.getTbodyTemplate())}show(){void 0===this.scores?this.loadScoreData(!0):this.el.classList.add("show")}hide(){this.el.classList.remove("show")}getTbodyTemplate(){return`\n            ${this.scores.map((e,t)=>`<tr>\n                <td>${t+1}</td>\n                <td>${e._id.$oid}</td>\n                <td>${e.score.toString()}</td>\n            </tr>`).join("")}\n        `}renderTemplate(){this.el.innerHTML='\n            <div class="message-header">\n                <p>Top 10 High Scores (press -<strong>ESC</strong>- to return)</p>\n            </div>\n            <div class="message-body">\n                <table class="table">\n                    <thead>\n                    <tr>\n                        <th>#</th>\n                        <th>MongoID</th>\n                        <th>Score</th>\n                    </tr>\n                    </thead>\n                    <tbody class="tbody"></tbody>\n                </table>\n            </div>\n        '}}class d extends r{constructor(){super("gui",-1,-1),this.highScoreListVisible=!1,this.score=new a,this.messageScreen=new o,window.addEventListener("level:scoreUpdate",e=>this.score.update(e.detail.score)),!0===i.functionalities.dataService&&(this.highScoreList=new l,n.addEventListener("keyup.highscorelist",e=>this.keyBoardHandler(e)))}keyBoardHandler(e){let t=e.key.toLowerCase();"h"===t&&!1===this.highScoreListVisible?(this.highScoreListVisible=!0,this.highScoreList.show()):"escape"===t&&!0===this.highScoreListVisible&&(this.highScoreListVisible=!1,this.highScoreList.hide())}levelDone(e){this.messageScreen.show(e)}newLevel(){this.messageScreen.hide()}gameEnd(e){this.messageScreen.show("game:end",{__SCORE__:this.score.get().toString(),__MAX_SCORE__:e.toString()})}restart(){this.messageScreen.hide(),this.messageScreen.show("game:start"),this.score.update(0,!0)}getScore(){return this.score.get()}}class c{static getRandomColor(){let e=Math.round,t=Math.random;return`rgba(${e(255*t())},${e(255*t())},${e(255*t())},1)`}static getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}static checkCollision(e,t){return e.left<=t.right&&t.left<=e.right&&e.top<=t.bottom&&t.top<=e.bottom}}class m extends r{constructor(e,t,s,i){super("block",0,0,"level"),this.destination={x:0,y:0},this.speed=t,this.width=s,this.height=i,this.color=e,this.el.style.backgroundImage=`repeating-linear-gradient(${c.getRandomInt(0,360)}deg, #000000, #000000 ${c.getRandomInt(2,10)}px, ${this.color} 10px, ${this.color} ${c.getRandomInt(20,40)}px)`,this.el.style.width=`${this.width}px`,this.el.style.height=`${this.height}px`,this.x=c.getRandomInt(0,window.outerWidth-this.width),this.y=c.getRandomInt(0,document.documentElement.clientHeight-this.height),this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}destroy(){this.el.remove()}update(){this.x>this.destination.x-this.speed&&this.x<this.destination.x+this.speed&&(this.destination.x=c.getRandomInt(0,window.outerWidth-this.width)),this.y>this.destination.y-this.speed&&this.y<this.destination.y+this.speed&&(this.destination.y=c.getRandomInt(0,document.documentElement.clientHeight-this.height)),this.destination.x>=this.x?this.x+=this.speed:this.x-=this.speed,this.destination.y>=this.y?this.y+=this.speed:this.y-=this.speed,this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}}class g extends r{constructor(){super("player",0,0,"level"),this.height=10,this.width=10,this.growthFactor=i.game.player.growthFactor,this.speed=i.game.player.speed,this.speedIncreaseFactor=i.game.player.speedIncreaseFactor,this.keysAllowed=["arrowleft","arrowup","arrowright","arrowdown"],this.keysPressed=[],this.x=window.outerWidth/2-this.width/2,this.y=document.documentElement.clientHeight/2-this.height/2,this.el.style.width=`${this.width}px`,this.el.style.height=`${this.height}px`,this.el.style.borderRadius=`${this.width}px`,n.addEventListener("keydown.player",e=>this.keyDownHandler(e)),n.addEventListener("keyup.player",e=>this.keyUpHandler(e))}keyDownHandler(e){let t=e.key.toLowerCase();this.keysAllowed.indexOf(t)>-1&&-1===this.keysPressed.indexOf(t)&&this.keysPressed.push(t)}keyUpHandler(e){let t=e.key.toLowerCase(),s=this.keysPressed.indexOf(t);this.keysAllowed.indexOf(t)>-1&&s>-1&&this.keysPressed.splice(s,1)}update(){this.keysPressed.forEach(e=>{switch(e){case"arrowleft":this.x-=this.speed;break;case"arrowup":this.y-=this.speed;break;case"arrowright":this.x+=this.speed;break;case"arrowdown":this.y+=this.speed;break;default:return}}),this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x>window.outerWidth-this.width&&(this.x=window.outerWidth-this.width),this.y>document.documentElement.clientHeight-this.height&&(this.y=document.documentElement.clientHeight-this.height),this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}blockCaught(e){this.speed+=this.speedIncreaseFactor,this.width+=this.growthFactor,this.height+=this.growthFactor,this.el.style.height=`${this.height}px`,this.el.style.width=`${this.width}px`,this.el.style.borderRadius=`${this.width}px`,this.el.style.backgroundColor=e.color}destroy(){this.el.remove(),n.removeEventListener("keydown.player"),n.removeEventListener("keyup.player")}}class p extends r{constructor(){super("timer",-1,-1,"level"),this.seconds=i.game.secondsPerLevel,this.renderTemplate(),this.el.classList.add("message","is-primary"),this.el.querySelector(".seconds").innerHTML=this.seconds.toString(),this.intervalId=setInterval(()=>this.update(),1e3)}update(){this.seconds--,this.el.querySelector(".seconds").innerHTML=this.seconds.toString(),this.seconds<=3?(this.el.classList.remove("is-primary"),this.el.classList.add("is-danger")):(this.el.classList.add("is-primary"),this.el.classList.remove("is-danger")),0===this.seconds&&window.dispatchEvent(new Event("timer:done"))}destroy(){clearInterval(this.intervalId)}renderTemplate(){this.el.innerHTML='\n            <div class="message-body">\n                <span>time: </span>\n                <span class="seconds"></span>\n            </div>\n        '}}class u extends r{constructor(e,t){super("level",0,0),this.blocks=[],this.failed=!1,this.totalBlocks=e,this.scorePerBlock=t,this.player=new g,this.timer=new p;for(let e=0;e<this.totalBlocks;e++)this.blocks.push(new m(c.getRandomColor(),c.getRandomInt(i.game.blockSpeed.min,i.game.blockSpeed.max),c.getRandomInt(i.game.blockPixels.min,i.game.blockPixels.max),c.getRandomInt(i.game.blockPixels.min,i.game.blockPixels.max)));n.addEventListener("timer:done",()=>{this.failed=!0,this.destroy("level:failed")})}update(){this.player.update(),this.blocks.forEach((e,t)=>{e.update(),c.checkCollision(this.player.getClientReact(),e.getClientReact())&&!1===this.failed&&(this.player.blockCaught(e),e.destroy(),this.blocks.splice(t,1),window.dispatchEvent(new CustomEvent("level:scoreUpdate",{detail:{score:this.scorePerBlock}})),0===this.blocks.length&&this.destroy("level:success"))})}destroy(e){this.timer.destroy(),this.player.destroy(),this.blocks.forEach((e,t)=>{e.destroy(),this.blocks.splice(t,1)}),n.removeEventListener("timer:done"),window.dispatchEvent(new Event(e)),this.el.remove()}}window.addEventListener("load",()=>new class{constructor(){this.levelsPerGame=i.game.levelsPerGame,this.currentLevelsPlayed=0,this.startElementsPerLevel=i.game.startElementsPerLevel,this.elementsIncreasePerLevel=i.game.elementsIncreasePerLevel,this.scorePerElement=i.game.scorePerElement,this.gui=new d,this.maxScore=this.calculateMaxScore(),this.gameLoop(),this.dataService=new h,["level:success","level:failed"].map(e=>{window.addEventListener(e,e=>this.update(e.type))}),["game:start:click","level:success:click","level:failed:click"].map(e=>{window.addEventListener(e,()=>this.startNewLevel())}),window.addEventListener("game:end:click",()=>this.restart())}calculateMaxScore(){let e=0;for(let t=0;t<this.levelsPerGame;t++)e+=(this.startElementsPerLevel+(0===t?0:this.elementsIncreasePerLevel*t))*this.scorePerElement;return e}gameLoop(){void 0!==this.level&&this.level.update(),requestAnimationFrame(()=>this.gameLoop())}update(e){if(this.currentLevelsPlayed++,this.currentLevelsPlayed===this.levelsPerGame)return this.gui.gameEnd(this.maxScore),void this.saveScore();this.gui.levelDone(e)}startNewLevel(){this.level&&!1===this.level.failed&&(this.startElementsPerLevel+=this.elementsIncreasePerLevel),delete this.level,this.gui.newLevel(),this.level=new u(this.startElementsPerLevel,this.scorePerElement)}restart(){this.gui.restart(),this.currentLevelsPlayed=0,this.startElementsPerLevel=i.game.startElementsPerLevel}saveScore(){let e=this.gui.getScore();this.dataService.saveScore(e).then(e=>{window.dispatchEvent(new CustomEvent("game:scoreSaved",{detail:{data:e}}))})}})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vZGV2L2hlbHBlcnMvZG9tZWxlbWVudC50cyIsIndlYnBhY2s6Ly8vLi9kZXYvZ3VpL3Njb3JlLnRzIiwid2VicGFjazovLy8uL2Rldi9oZWxwZXJzL3dpbmRvd2V2ZW50aGFuZGxlci50cyIsIndlYnBhY2s6Ly8vLi9kZXYvZ3VpL21lc3NhZ2VzY3JlZW4udHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2RhdGFzZXJ2aWNlLnRzIiwid2VicGFjazovLy8uL2Rldi9ndWkvaGlnaHNjb3JlbGlzdC50cyIsIndlYnBhY2s6Ly8vLi9kZXYvZ3VpL2d1aS50cyIsIndlYnBhY2s6Ly8vLi9kZXYvaGVscGVycy91dGlscy50cyIsIndlYnBhY2s6Ly8vLi9kZXYvbGV2ZWwvYmxvY2sudHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2xldmVsL3BsYXllci50cyIsIndlYnBhY2s6Ly8vLi9kZXYvbGV2ZWwvdGltZXIudHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2xldmVsL2xldmVsLnRzIiwid2VicGFjazovLy8uL2Rldi9tYWluLnRzIiwid2VicGFjazovLy8uL2Rldi9nYW1lLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsInZhbHVlIiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJEb21FbGVtZW50IiwiW29iamVjdCBPYmplY3RdIiwidHlwZSIsIngiLCJ5IiwicGFyZW50Q2xhc3MiLCJ0aGlzIiwiZWwiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJtYWluIiwiZ2V0RWxlbWVudEJ5SWQiLCJFcnJvciIsInN0eWxlIiwidHJhbnNmb3JtIiwiY2xhc3NMaXN0IiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJwYXJlbnRFbCIsInF1ZXJ5U2VsZWN0b3IiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJzY29yZV9TY29yZSIsInN1cGVyIiwic2NvcmUiLCJyZW5kZXJUZW1wbGF0ZSIsImlubmVySFRNTCIsInRvU3RyaW5nIiwicmVzZXQiLCJXaW5kb3dFdmVudEhhbmRsZXIiLCJldmVudCIsImZ1bmMiLCJmdW5jdGlvbk1hcCIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJzcGxpdCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJtZXNzYWdlc2NyZWVuX01lc3NhZ2VTY3JlZW4iLCJpc0FjdGl2ZSIsIm1lc3NhZ2VzIiwiZ2FtZTpzdGFydCIsImhlYWRlciIsImJvZHkiLCJjbGFzc05hbWUiLCJnYW1lOmVuZCIsImxldmVsOnN1Y2Nlc3MiLCJsZXZlbDpmYWlsZWQiLCJzaG93IiwiZSIsImtleUJvYXJkSGFuZGxlciIsImtleSIsImRpc3BhdGNoRXZlbnQiLCJFdmVudCIsImN1cnJlbnRFdmVudCIsImJvZHlSZXBsYWNlbWVudHMiLCJtZXNzYWdlSGVhZGVyIiwibWVzc2FnZUJvZHkiLCJyZXBsYWNlbWVudCIsInJlcGxhY2UiLCJyZW1vdmUiLCJkYXRhc2VydmljZV9EYXRhU2VydmljZSIsImVuZFBvaW50TGlzdCIsImNvbmZpZyIsImRhdGFTZXJ2aWNlIiwiZGF0YWJhc2VOYW1lIiwiY29sbGVjdGlvbk5hbWUiLCJhcGlLZXkiLCJlbmRQb2ludFNhdmUiLCJkaXNhYmxlZE1lc3NhZ2UiLCJmdW5jdGlvbmFsaXRpZXMiLCJkaXNhYmxlZCIsInVybCIsImJhc2VVcmwiLCJmZXRjaCIsIkpTT04iLCJzdHJpbmdpZnkiLCJoZWFkZXJzIiwiY29udGVudC10eXBlIiwibWV0aG9kIiwibW9kZSIsInRoZW4iLCJyZXNwb25zZSIsImpzb24iLCJuYXZpZ2F0b3IiLCJvbkxpbmUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInBhcnNlIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsImRhdGEiLCJzZXRJdGVtIiwiZXJyb3IiLCJoaWdoc2NvcmVsaXN0X0hpZ2hTY29yZUxpc3QiLCJ0Qm9keSIsImxvYWRTY29yZURhdGEiLCJ1cGRhdGVEYXRhIiwiZGV0YWlsIiwic2hvd1NjcmVlbiIsImdldFNjb3JlcyIsInNjb3JlcyIsImdldFRib2R5VGVtcGxhdGUiLCJsZW5ndGgiLCJwdXNoIiwic29ydCIsImEiLCJiIiwic3BsaWNlIiwibWFwIiwiaXRlbSIsImluZGV4IiwiX2lkIiwiJG9pZCIsImpvaW4iLCJndWlfR1VJIiwiaGlnaFNjb3JlTGlzdFZpc2libGUiLCJtZXNzYWdlU2NyZWVuIiwidXBkYXRlIiwiaGlnaFNjb3JlTGlzdCIsInRvTG93ZXJDYXNlIiwiaGlkZSIsIm1heFNjb3JlIiwiX19TQ09SRV9fIiwiX19NQVhfU0NPUkVfXyIsIlV0aWxzIiwiTWF0aCIsInJvdW5kIiwicmFuZG9tIiwibWluIiwibWF4IiwiZmxvb3IiLCJsZWZ0IiwicmlnaHQiLCJ0b3AiLCJib3R0b20iLCJibG9ja19CbG9jayIsImNvbG9yIiwic3BlZWQiLCJ3aWR0aCIsImhlaWdodCIsImRlc3RpbmF0aW9uIiwiYmFja2dyb3VuZEltYWdlIiwiZ2V0UmFuZG9tSW50Iiwib3V0ZXJXaWR0aCIsImRvY3VtZW50RWxlbWVudCIsImNsaWVudEhlaWdodCIsInBsYXllcl9QbGF5ZXIiLCJncm93dGhGYWN0b3IiLCJnYW1lIiwicGxheWVyIiwic3BlZWRJbmNyZWFzZUZhY3RvciIsImtleXNBbGxvd2VkIiwia2V5c1ByZXNzZWQiLCJib3JkZXJSYWRpdXMiLCJrZXlEb3duSGFuZGxlciIsImtleVVwSGFuZGxlciIsImluZGV4T2YiLCJrZXlQcmVzc2VkUG9zaXRpb24iLCJmb3JFYWNoIiwiYmxvY2siLCJiYWNrZ3JvdW5kQ29sb3IiLCJ0aW1lcl9UaW1lciIsInNlY29uZHMiLCJzZWNvbmRzUGVyTGV2ZWwiLCJpbnRlcnZhbElkIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwibGV2ZWxfTGV2ZWwiLCJ0b3RhbEJsb2NrcyIsInNjb3JlUGVyQmxvY2siLCJibG9ja3MiLCJmYWlsZWQiLCJ0aW1lciIsImdldFJhbmRvbUNvbG9yIiwiYmxvY2tTcGVlZCIsImJsb2NrUGl4ZWxzIiwiZGVzdHJveSIsImNoZWNrQ29sbGlzaW9uIiwiZ2V0Q2xpZW50UmVhY3QiLCJibG9ja0NhdWdodCIsIkN1c3RvbUV2ZW50IiwiZXZlbnRUeXBlIiwibGV2ZWxzUGVyR2FtZSIsImN1cnJlbnRMZXZlbHNQbGF5ZWQiLCJzdGFydEVsZW1lbnRzUGVyTGV2ZWwiLCJlbGVtZW50c0luY3JlYXNlUGVyTGV2ZWwiLCJzY29yZVBlckVsZW1lbnQiLCJndWkiLCJjYWxjdWxhdGVNYXhTY29yZSIsImdhbWVMb29wIiwic3RhcnROZXdMZXZlbCIsInJlc3RhcnQiLCJsZXZlbCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImdhbWVFbmQiLCJzYXZlU2NvcmUiLCJsZXZlbERvbmUiLCJuZXdMZXZlbCIsImdldFNjb3JlIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxLQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLElBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsWUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsR0FDQUssY0FBQSxFQUNBQyxZQUFBLEVBQ0FDLElB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akwsS0FBS2tMLGlDQUdoQ2xMLEtBQUt5TCxNQUNaekwsS0FBS29MLElBQUlVLFdBRVQ5TCxLQUFLeUwsTUFBUSxJQUFJekIsRUFBTWhLLEtBQUtpTCxzQkFBdUJqTCxLQUFLbUwsaUJBTXBEeEwsVUFDSkssS0FBS29MLElBQUlJLFVBQ1R4TCxLQUFLZ0wsb0JBQXNCLEVBQzNCaEwsS0FBS2lMLHNCQUF3QjFILEVBQU9zRixLQUFLb0Msc0JBTXJDdEwsWUFDSixJQUFJc0IsRUFBUWpCLEtBQUtvTCxJQUFJVyxXQUNyQi9MLEtBQUt3RCxZQUFZb0ksVUFBVTNLLEdBQU93RCxLQUFNVSxJQUNwQ3pELE9BQU9rQixjQUFjLElBQUlpSSxZQUFZLG1CQUFvQm5GLFFBQVNQIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbiBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbiBcdFx0XHR9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDEpO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRG9tRWxlbWVudCB7XG4gICAgcHJvdGVjdGVkIGVsOiBIVE1MRWxlbWVudDtcbiAgICBwcm90ZWN0ZWQgeDogbnVtYmVyO1xuICAgIHByb3RlY3RlZCB5OiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBzdHJpbmcsIHg6IG51bWJlciwgeTogbnVtYmVyLCBwYXJlbnRDbGFzczogc3RyaW5nID0gJycpIHtcbiAgICAgICAgdGhpcy54ID0geDtcbiAgICAgICAgdGhpcy55ID0geTtcblxuICAgICAgICB0aGlzLmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGxldCBtYWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4nKTtcbiAgICAgICAgaWYgKG1haW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIjxtYWluPiBlbGVtZW50IGRvZXNuJ3QgZXhpc3QhXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8tMSBjaGVjayBpcyB0byBsZXQgQ1NTIGRvIGl0cyBvd24gam9iIEB0b2RvIGNsZWFuZXIgc29sdXRpb24/XG4gICAgICAgIGlmICh0aGlzLnggPiAtMSAmJiB0aGlzLnkgPiAtMSkge1xuICAgICAgICAgICAgdGhpcy5lbC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7dGhpcy54fXB4LCAke3RoaXMueX1weClgO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LmFkZChgZ2FtZS0ke3R5cGV9YCk7XG5cbiAgICAgICAgaWYgKHBhcmVudENsYXNzID09PSAnJykge1xuICAgICAgICAgICAgbWFpbi5hcHBlbmRDaGlsZCh0aGlzLmVsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBwYXJlbnRFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5nYW1lLSR7cGFyZW50Q2xhc3N9YCk7XG4gICAgICAgICAgICBpZiAocGFyZW50RWwgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYDwuZ2FtZS0ke3BhcmVudENsYXNzfT4gZWxlbWVudCBkb2Vzbid0IGV4aXN0IWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGFyZW50RWwuYXBwZW5kQ2hpbGQodGhpcy5lbCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBDbGllbnRSZWN0XG4gICAgICovXG4gICAgcHVibGljIGdldENsaWVudFJlYWN0KCk6IENsaWVudFJlY3QgfCBET01SZWN0IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgfVxufVxuIiwiaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL2hlbHBlcnMvZG9tZWxlbWVudFwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTY29yZSBleHRlbmRzIERvbUVsZW1lbnQge1xuICAgIHByaXZhdGUgc2NvcmU6IG51bWJlciA9IDA7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ3Njb3JlJywgLTEsIC0xLCAnZ3VpJyk7XG5cbiAgICAgICAgdGhpcy5yZW5kZXJUZW1wbGF0ZSgpO1xuICAgICAgICB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoJy5zY29yZS1jb3VudCcpLmlubmVySFRNTCA9IHRoaXMuc2NvcmUudG9TdHJpbmcoKTtcbiAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QuYWRkKCdtZXNzYWdlJywgJ2lzLXdhcm5pbmcnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZSBjdXJyZW50IHNjb3JlXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NvcmU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIHRoZSBzY29yZSBiYXNlZCBvbiBhIEN1c3RvbSBFdmVudCBmcm9tIHRoZSBCbG9jayBvYmplY3RcbiAgICAgKlxuICAgICAqIEBwYXJhbSBzY29yZVxuICAgICAqIEBwYXJhbSBbcmVzZXRdXG4gICAgICovXG4gICAgcHVibGljIHVwZGF0ZShzY29yZTogbnVtYmVyLCByZXNldDogYm9vbGVhbiA9IGZhbHNlKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2NvcmUgPSByZXNldCA/IHNjb3JlIDogdGhpcy5zY29yZSArIHNjb3JlO1xuICAgICAgICB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoJy5zY29yZS1jb3VudCcpLmlubmVySFRNTCA9IHRoaXMuc2NvcmUudG9TdHJpbmcoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZW1wbGF0ZSBuZWVkZWQgdG8gc2hvdyBtb3JlIGVsZW1lbnRzXG4gICAgICovXG4gICAgcHJpdmF0ZSByZW5kZXJUZW1wbGF0ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5lbC5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVzc2FnZS1ib2R5XCI+XG4gICAgICAgICAgICAgICAgPHNwYW4+c2NvcmU6IDwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInNjb3JlLWNvdW50XCI+PC9zcGFuPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIGA7XG4gICAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgV2luZG93RXZlbnRIYW5kbGVyIHtcbiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbk1hcDogeyBbazogc3RyaW5nXTogYW55IH0gPSB7fTtcblxuICAgIC8qKlxuICAgICAqIEFkZCBsaXN0ZW5lciB0byB3aW5kb3cgd2l0aCBuYW1lIHNwYWNpbmdcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudFxuICAgICAqIEBwYXJhbSBmdW5jXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBhZGRFdmVudExpc3RlbmVyKGV2ZW50OiBzdHJpbmcsIGZ1bmM6IGFueSk6IHZvaWQge1xuICAgICAgICBXaW5kb3dFdmVudEhhbmRsZXIuZnVuY3Rpb25NYXBbZXZlbnRdID0gZnVuYztcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQuc3BsaXQoJy4nKVswXSwgV2luZG93RXZlbnRIYW5kbGVyLmZ1bmN0aW9uTWFwW2V2ZW50XSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGxpc3RlbmVyIGZyb20gd2luZG93IHdpdGggbmFtZSBzcGFjaW5nXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQ6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudC5zcGxpdCgnLicpWzBdLCBXaW5kb3dFdmVudEhhbmRsZXIuZnVuY3Rpb25NYXBbZXZlbnRdKTtcbiAgICAgICAgZGVsZXRlIFdpbmRvd0V2ZW50SGFuZGxlci5mdW5jdGlvbk1hcFtldmVudF07XG4gICAgfVxufVxuIiwiaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL2hlbHBlcnMvZG9tZWxlbWVudFwiO1xuaW1wb3J0IFdpbmRvd0V2ZW50SGFuZGxlciBmcm9tIFwiLi4vaGVscGVycy93aW5kb3dldmVudGhhbmRsZXJcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWVzc2FnZVNjcmVlbiBleHRlbmRzIERvbUVsZW1lbnQge1xuICAgIHByaXZhdGUgY3VycmVudEV2ZW50ITogc3RyaW5nO1xuICAgIHByaXZhdGUgaXNBY3RpdmU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIHByaXZhdGUgbWVzc2FnZXM6IHsgW2s6IHN0cmluZ106IHsgJ2hlYWRlcic6IHN0cmluZywgJ2JvZHknOiBzdHJpbmcsICdjbGFzc05hbWUnOiBzdHJpbmcgfSB9ID0ge1xuICAgICAgICAnZ2FtZTpzdGFydCc6IHtcbiAgICAgICAgICAgICdoZWFkZXInOiAnV2VsY29tZSB0byBCbG9jay1vLUJsb2NrIScsXG4gICAgICAgICAgICAnYm9keSc6ICdJdFxcJ3MgdGltZSB0byBjYXRjaCB0aGVtIGJsb2NrcyE8YnIvPjxici8+VXNlIHlvdXIgYXJyb3cga2V5cyB0byBtb3ZlIHlvdXIgcGxheWVyIGFyb3VuZCBhbmQgcHJlc3Mgc3BhY2UgdG8gc3RhcnQuPGJyLz48YnIvPlByZXNzIC08c3Ryb25nPkg8L3N0cm9uZz4tIHRvIHZpZXcgdGhlIGhpZ2hzY29yZSBsaXN0JyxcbiAgICAgICAgICAgICdjbGFzc05hbWUnOiAnaXMtaW5mbydcbiAgICAgICAgfSxcbiAgICAgICAgJ2dhbWU6ZW5kJzoge1xuICAgICAgICAgICAgJ2hlYWRlcic6ICdZb3VyIGdhbWUgaXMgb3ZlciEnLFxuICAgICAgICAgICAgJ2JvZHknOiAnWW91IG1hZGUgaXQsIHlvdXIgZmluYWwgc2NvcmUgaXMgX19TQ09SRV9fIG91dCBvZiBtYXggX19NQVhfU0NPUkVfXyBwb2ludHMuPGJyLz48YnIvPlRoYW5rcyBmb3IgcGxheWluZywgcHJlc3Mgc3BhY2UgdG8gcmVzdGFydCB0aGUgbWFkbmVzcy48YnIvPjxici8+UHJlc3MgLTxzdHJvbmc+SDwvc3Ryb25nPi0gdG8gdmlldyB0aGUgaGlnaHNjb3JlIGxpc3QnLFxuICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdpcy1zdWNjZXNzJ1xuICAgICAgICB9LFxuICAgICAgICAnbGV2ZWw6c3VjY2Vzcyc6IHtcbiAgICAgICAgICAgICdoZWFkZXInOiAnWUVBSCEgTGV2ZWwgY29tcGxldGVkIScsXG4gICAgICAgICAgICAnYm9keSc6ICdQZXJmb3JtaW5nIGxpa2UgYSBib3NzISBQcmVzcyBzcGFjZSB0byBwcm9jZWVkIHRvIHRoZSBuZXh0IGxldmVsIGFuZCBjYXRjaCBldmVuIG1vcmUgYmxvY2tzJyxcbiAgICAgICAgICAgICdjbGFzc05hbWUnOiAnaXMtc3VjY2VzcydcbiAgICAgICAgfSxcbiAgICAgICAgJ2xldmVsOmZhaWxlZCc6IHtcbiAgICAgICAgICAgICdoZWFkZXInOiAnQUFIISBMZXZlbCBmYWlsZWQhJyxcbiAgICAgICAgICAgICdib2R5JzogJ1RyeSBhZ2FpbiBhbmQgc2hvdyB1cyB3aGF0IHlvdVxcJ3JlIG1hZGUgb2ZmISBQcmVzcyBzcGFjZSB0byByZXN0YXJ0IHRoaXMgbGV2ZWwnLFxuICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdpcy1kYW5nZXInXG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCdtZXNzYWdlc2NyZWVuJywgLTEsIC0xLCAnZ3VpJyk7XG4gICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LmFkZCgnbWVzc2FnZScpO1xuXG4gICAgICAgIHRoaXMucmVuZGVyVGVtcGxhdGUoKTtcbiAgICAgICAgdGhpcy5zaG93KCdnYW1lOnN0YXJ0Jyk7XG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5hZGRFdmVudExpc3RlbmVyKCdrZXl1cC5tZXNzYWdlc2NyZWVuJywgKGU6IEtleWJvYXJkRXZlbnQpID0+IHRoaXMua2V5Qm9hcmRIYW5kbGVyKGUpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgdGhlIHNwYWNlYmFyXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0tleWJvYXJkRXZlbnR9IGVcbiAgICAgKi9cbiAgICBwcml2YXRlIGtleUJvYXJkSGFuZGxlcihlOiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgICAgIGlmIChlLmtleSA9PT0gJyAnICYmIHRoaXMuaXNBY3RpdmUgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChgJHt0aGlzLmN1cnJlbnRFdmVudH06Y2xpY2tgKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaG93IHRoZSBkZXNpcmVkIG1lc3NhZ2UgKHR5cGUgbWF0Y2hlcyBpbmRleCBpbiBvYmplY3QpXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdHlwZVxuICAgICAqIEBwYXJhbSBbYm9keVJlcGxhY2VtZW50c11cbiAgICAgKi9cbiAgICBwdWJsaWMgc2hvdyh0eXBlOiBzdHJpbmcsIGJvZHlSZXBsYWNlbWVudHM6IHsgW2s6IHN0cmluZ106IHN0cmluZyB9ID0ge30pOiB2b2lkIHtcbiAgICAgICAgbGV0IG1lc3NhZ2VIZWFkZXIgPSB0aGlzLm1lc3NhZ2VzW3R5cGVdLmhlYWRlcjtcbiAgICAgICAgbGV0IG1lc3NhZ2VCb2R5ID0gdGhpcy5tZXNzYWdlc1t0eXBlXS5ib2R5O1xuICAgICAgICBmb3IgKGxldCByZXBsYWNlbWVudCBpbiBib2R5UmVwbGFjZW1lbnRzKSB7XG4gICAgICAgICAgICBtZXNzYWdlQm9keSA9IG1lc3NhZ2VCb2R5LnJlcGxhY2UocmVwbGFjZW1lbnQsIGJvZHlSZXBsYWNlbWVudHNbcmVwbGFjZW1lbnRdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZWwucXVlcnlTZWxlY3RvcignLm1lc3NhZ2UtaGVhZGVyJykuaW5uZXJIVE1MID0gbWVzc2FnZUhlYWRlcjtcbiAgICAgICAgdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcubWVzc2FnZS1ib2R5JykuaW5uZXJIVE1MID0gbWVzc2FnZUJvZHk7XG5cbiAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QuYWRkKCdzaG93JywgdGhpcy5tZXNzYWdlc1t0eXBlXS5jbGFzc05hbWUpO1xuICAgICAgICB0aGlzLmN1cnJlbnRFdmVudCA9IHR5cGU7XG4gICAgICAgIHRoaXMuaXNBY3RpdmUgPSB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhpZGUgbWVzc2FnZSBvbiBzY3JlZW5cbiAgICAgKi9cbiAgICBwdWJsaWMgaGlkZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93JywgJ2lzLWluZm8nLCAnaXMtc3VjY2VzcycsICdpcy1kYW5nZXInKTtcbiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlbXBsYXRlIG5lZWRlZCB0byBzaG93IG1vcmUgZWxlbWVudHNcbiAgICAgKi9cbiAgICBwcml2YXRlIHJlbmRlclRlbXBsYXRlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmVsLmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZXNzYWdlLWhlYWRlclwiPjwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lc3NhZ2UtYm9keVwiPjwvZGl2PlxuICAgICAgICBgO1xuICAgIH1cbn1cbiIsImltcG9ydCBjb25maWcgZnJvbSAnLi9jb25maWcuanNvbic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERhdGFTZXJ2aWNlIHtcbiAgICBwcml2YXRlIGVuZFBvaW50TGlzdDogc3RyaW5nID0gYC9kYXRhYmFzZXMvJHtjb25maWcuZGF0YVNlcnZpY2UuZGF0YWJhc2VOYW1lfS9jb2xsZWN0aW9ucy8ke2NvbmZpZy5kYXRhU2VydmljZS5jb2xsZWN0aW9uTmFtZX0/YXBpS2V5PSR7Y29uZmlnLmRhdGFTZXJ2aWNlLmFwaUtleX1gO1xuICAgIHByaXZhdGUgZW5kUG9pbnRTYXZlOiBzdHJpbmcgPSBgL2RhdGFiYXNlcy8ke2NvbmZpZy5kYXRhU2VydmljZS5kYXRhYmFzZU5hbWV9L2NvbGxlY3Rpb25zLyR7Y29uZmlnLmRhdGFTZXJ2aWNlLmNvbGxlY3Rpb25OYW1lfT9hcGlLZXk9JHtjb25maWcuZGF0YVNlcnZpY2UuYXBpS2V5fWA7XG4gICAgcHJpdmF0ZSBkaXNhYmxlZE1lc3NhZ2U6IHN0cmluZyA9ICdEYXRhc2VydmljZSBpcyBkaXNhYmxlZCc7XG5cbiAgICAvKipcbiAgICAgKiBTdG9yZSB0aGUgbGF0ZXN0IHNjb3JlIGluIHRoZSBEQlxuICAgICAqXG4gICAgICogQHBhcmFtIHNjb3JlXG4gICAgICogQHJldHVybnMge1Byb21pc2U8e30+fVxuICAgICAqL1xuICAgIHB1YmxpYyBzYXZlU2NvcmUoc2NvcmU6IG51bWJlcik6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGlmIChjb25maWcuZnVuY3Rpb25hbGl0aWVzLmRhdGFTZXJ2aWNlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB1cmwgPSBgJHtjb25maWcuZGF0YVNlcnZpY2UuYmFzZVVybH0ke3RoaXMuZW5kUG9pbnRTYXZlfWA7XG4gICAgICAgIHJldHVybiBmZXRjaCh1cmwsIHtcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICBzY29yZTogc2NvcmVcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIG1vZGU6ICdjb3JzJ1xuICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGFsbCB0aGUgY3VycmVudCBzY29yZXMgZnJvbSB0aGUgREJcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPFtdPn1cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0U2NvcmVzKCk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGlmIChjb25maWcuZnVuY3Rpb25hbGl0aWVzLmRhdGFTZXJ2aWNlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh3aW5kb3cubmF2aWdhdG9yLm9uTGluZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc2NvcmVzJykpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHVybCA9IGAke2NvbmZpZy5kYXRhU2VydmljZS5iYXNlVXJsfSR7dGhpcy5lbmRQb2ludExpc3R9JnM9e1wic2NvcmVcIjogLTF9Jmw9MTBgO1xuICAgICAgICByZXR1cm4gZmV0Y2godXJsLCB7XG4gICAgICAgICAgICBtb2RlOiAnY29ycydcbiAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc2NvcmVzJykgPT09IEpTT04uc3RyaW5naWZ5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Njb3JlcycpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Njb3JlcycsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2VuZXJhbCBtZXNzYWdlIHdoZW4gdGhpcyBzZXJ2aWNlIGlzIGluYWN0aXZlXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx7fT59XG4gICAgICovXG4gICAgcHJpdmF0ZSBkaXNhYmxlZCgpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUoe1wiZXJyb3JcIjogdGhpcy5kaXNhYmxlZE1lc3NhZ2V9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIiwiaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL2hlbHBlcnMvZG9tZWxlbWVudFwiO1xuaW1wb3J0IERhdGFTZXJ2aWNlIGZyb20gXCIuLi9kYXRhc2VydmljZVwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBIaWdoU2NvcmVMaXN0IGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgcHJpdmF0ZSBkYXRhU2VydmljZTogRGF0YVNlcnZpY2U7XG4gICAgcHJpdmF0ZSBzY29yZXM6IHsgc2NvcmU6IG51bWJlciwgX2lkOiB7ICRvaWQ6IHN0cmluZyB9IH1bXTtcbiAgICBwcml2YXRlIHRCb2R5OiBIVE1MRWxlbWVudDtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcignaGlnaHNjb3JlbGlzdCcsIC0xLCAtMSwgJ2d1aScpO1xuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoJ21lc3NhZ2UnLCAnaXMtd2FybmluZycpO1xuXG4gICAgICAgIHRoaXMucmVuZGVyVGVtcGxhdGUoKTtcbiAgICAgICAgdGhpcy50Qm9keSA9IHRoaXMuZWwucXVlcnlTZWxlY3RvcignLnRib2R5Jyk7XG5cbiAgICAgICAgdGhpcy5kYXRhU2VydmljZSA9IG5ldyBEYXRhU2VydmljZSgpO1xuICAgICAgICB0aGlzLmxvYWRTY29yZURhdGEoKTtcblxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZ2FtZTpzY29yZVNhdmVkJywgKGUpID0+IHRoaXMudXBkYXRlRGF0YSgoZSBhcyBDdXN0b21FdmVudCkuZGV0YWlsLmRhdGEpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsIHNjb3JlIGxvYWRpbmdcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gc2hvd1NjcmVlblxuICAgICAqL1xuICAgIHByaXZhdGUgbG9hZFNjb3JlRGF0YShzaG93U2NyZWVuOiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kYXRhU2VydmljZS5nZXRTY29yZXMoKS50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNjb3JlcyA9IGRhdGE7XG4gICAgICAgICAgICB0aGlzLnRCb2R5LmlubmVySFRNTCA9IHRoaXMuZ2V0VGJvZHlUZW1wbGF0ZSgpO1xuXG4gICAgICAgICAgICBpZiAoc2hvd1NjcmVlbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSBjdXJyZW50IHNjb3JlIG9mIHVzZXIgaW4gYXZhaWxhYmxlIGRhdGFcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7e319IGRhdGFcbiAgICAgKi9cbiAgICBwcml2YXRlIHVwZGF0ZURhdGEoZGF0YTogeyBzY29yZTogbnVtYmVyLCBfaWQ6IHsgJG9pZDogc3RyaW5nIH0gfSk6IHZvaWQge1xuICAgICAgICAvL0NoZWNrIGlmIGdpdmVuIHNjb3JlIGlzIHRvcCAxMCB3b3J0aHlcbiAgICAgICAgbGV0IGxvd2VzdEN1cnJlbnRTY29yZSA9IHRoaXMuc2NvcmVzLmxlbmd0aCA9PT0gMCA/IC0xIDogdGhpcy5zY29yZXNbdGhpcy5zY29yZXMubGVuZ3RoIC0gMV0uc2NvcmU7XG4gICAgICAgIGlmIChsb3dlc3RDdXJyZW50U2NvcmUgPCBkYXRhLnNjb3JlIHx8IHRoaXMuc2NvcmVzLmxlbmd0aCA8IDEwKSB7XG4gICAgICAgICAgICAvL1VwZGF0aW5nIHRoZSBzY29yZXMgYXJyYXkgJiBwcmVzZW50XG4gICAgICAgICAgICB0aGlzLnNjb3Jlcy5wdXNoKGRhdGEpO1xuICAgICAgICAgICAgdGhpcy5zY29yZXMuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpO1xuICAgICAgICAgICAgdGhpcy5zY29yZXMuc3BsaWNlKDEwLCAxKTtcbiAgICAgICAgICAgIHRoaXMudEJvZHkuaW5uZXJIVE1MID0gdGhpcy5nZXRUYm9keVRlbXBsYXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaG93IHRoZSBoaWdoIHNjb3JlIGxpc3RcbiAgICAgKi9cbiAgICBwdWJsaWMgc2hvdygpOiB2b2lkIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnNjb3JlcyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZFNjb3JlRGF0YSh0cnVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGlkZSBpdCBwZXJpb2RcbiAgICAgKi9cbiAgICBwdWJsaWMgaGlkZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSBtYXBwZWQgSFRNTCA8dHI+IGxpc3QgZm9yIGFwcGVuZGluZyBpbiA8dGJvZHk+XG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgICAqL1xuICAgIHByaXZhdGUgZ2V0VGJvZHlUZW1wbGF0ZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gYFxuICAgICAgICAgICAgJHt0aGlzLnNjb3Jlcy5tYXAoKGl0ZW0sIGluZGV4KSA9PiBgPHRyPlxuICAgICAgICAgICAgICAgIDx0ZD4ke2luZGV4ICsgMX08L3RkPlxuICAgICAgICAgICAgICAgIDx0ZD4ke2l0ZW0uX2lkLiRvaWR9PC90ZD5cbiAgICAgICAgICAgICAgICA8dGQ+JHtpdGVtLnNjb3JlLnRvU3RyaW5nKCl9PC90ZD5cbiAgICAgICAgICAgIDwvdHI+YCkuam9pbignJyl9XG4gICAgICAgIGA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVtcGxhdGUgbmVlZGVkIHRvIHNob3cgbW9yZSBlbGVtZW50c1xuICAgICAqL1xuICAgIHByaXZhdGUgcmVuZGVyVGVtcGxhdGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZWwuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lc3NhZ2UtaGVhZGVyXCI+XG4gICAgICAgICAgICAgICAgPHA+VG9wIDEwIEhpZ2ggU2NvcmVzIChwcmVzcyAtPHN0cm9uZz5FU0M8L3N0cm9uZz4tIHRvIHJldHVybik8L3A+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZXNzYWdlLWJvZHlcIj5cbiAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3M9XCJ0YWJsZVwiPlxuICAgICAgICAgICAgICAgICAgICA8dGhlYWQ+XG4gICAgICAgICAgICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0aD4jPC90aD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0aD5Nb25nb0lEPC90aD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0aD5TY29yZTwvdGg+XG4gICAgICAgICAgICAgICAgICAgIDwvdHI+XG4gICAgICAgICAgICAgICAgICAgIDwvdGhlYWQ+XG4gICAgICAgICAgICAgICAgICAgIDx0Ym9keSBjbGFzcz1cInRib2R5XCI+PC90Ym9keT5cbiAgICAgICAgICAgICAgICA8L3RhYmxlPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIGA7XG4gICAgfVxufVxuIiwiaW1wb3J0IFNjb3JlIGZyb20gJy4vc2NvcmUnO1xuaW1wb3J0IE1lc3NhZ2VTY3JlZW4gZnJvbSAnLi9tZXNzYWdlc2NyZWVuJztcbmltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuLi9oZWxwZXJzL2RvbWVsZW1lbnRcIjtcbmltcG9ydCBIaWdoU2NvcmVMaXN0IGZyb20gXCIuL2hpZ2hzY29yZWxpc3RcIjtcbmltcG9ydCBXaW5kb3dFdmVudEhhbmRsZXIgZnJvbSBcIi4uL2hlbHBlcnMvd2luZG93ZXZlbnRoYW5kbGVyXCI7XG5pbXBvcnQgY29uZmlnIGZyb20gJy4uL2NvbmZpZy5qc29uJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR1VJIGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgcHJpdmF0ZSBzY29yZTogU2NvcmU7XG4gICAgcHJpdmF0ZSBtZXNzYWdlU2NyZWVuOiBNZXNzYWdlU2NyZWVuO1xuICAgIHByaXZhdGUgaGlnaFNjb3JlTGlzdDogSGlnaFNjb3JlTGlzdDtcbiAgICBwcml2YXRlIGhpZ2hTY29yZUxpc3RWaXNpYmxlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ2d1aScsIC0xLCAtMSk7XG5cbiAgICAgICAgdGhpcy5zY29yZSA9IG5ldyBTY29yZSgpO1xuICAgICAgICB0aGlzLm1lc3NhZ2VTY3JlZW4gPSBuZXcgTWVzc2FnZVNjcmVlbigpO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbGV2ZWw6c2NvcmVVcGRhdGUnLCAoZSkgPT4gdGhpcy5zY29yZS51cGRhdGUoKGUgYXMgQ3VzdG9tRXZlbnQpLmRldGFpbC5zY29yZSkpO1xuXG4gICAgICAgIGlmIChjb25maWcuZnVuY3Rpb25hbGl0aWVzLmRhdGFTZXJ2aWNlID09PSB0cnVlKSB7XG4gICAgICAgICAgICB0aGlzLmhpZ2hTY29yZUxpc3QgPSBuZXcgSGlnaFNjb3JlTGlzdCgpO1xuICAgICAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwLmhpZ2hzY29yZWxpc3QnLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4gdGhpcy5rZXlCb2FyZEhhbmRsZXIoZSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIHRoZSBzcGFjZWJhclxuICAgICAqXG4gICAgICogQHBhcmFtIHtLZXlib2FyZEV2ZW50fSBlXG4gICAgICovXG4gICAga2V5Qm9hcmRIYW5kbGVyKGU6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgbGV0IGtleSA9IGUua2V5LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGlmIChrZXkgPT09ICdoJyAmJiB0aGlzLmhpZ2hTY29yZUxpc3RWaXNpYmxlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy5oaWdoU2NvcmVMaXN0VmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmhpZ2hTY29yZUxpc3Quc2hvdygpO1xuICAgICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ2VzY2FwZScgJiYgdGhpcy5oaWdoU2NvcmVMaXN0VmlzaWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgdGhpcy5oaWdoU2NvcmVMaXN0VmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5oaWdoU2NvcmVMaXN0LmhpZGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCB3aGVuIGEgbGV2ZWwgaXMgZG9uZVxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGVcbiAgICAgKi9cbiAgICBwdWJsaWMgbGV2ZWxEb25lKHR5cGU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICB0aGlzLm1lc3NhZ2VTY3JlZW4uc2hvdyh0eXBlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgd2hlbiBhIG5ldyBsZXZlbCBzdGFydHNcbiAgICAgKi9cbiAgICBwdWJsaWMgbmV3TGV2ZWwoKTogdm9pZCB7XG4gICAgICAgIHRoaXMubWVzc2FnZVNjcmVlbi5oaWRlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIHdoZW4gdGhlIGdhbWUgaXMgZG9uZVxuICAgICAqXG4gICAgICogQHBhcmFtIG1heFNjb3JlXG4gICAgICovXG4gICAgcHVibGljIGdhbWVFbmQobWF4U2NvcmU6IG51bWJlcik6IHZvaWQge1xuICAgICAgICB0aGlzLm1lc3NhZ2VTY3JlZW4uc2hvdygnZ2FtZTplbmQnLCB7XG4gICAgICAgICAgICAnX19TQ09SRV9fJzogdGhpcy5zY29yZS5nZXQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgJ19fTUFYX1NDT1JFX18nOiBtYXhTY29yZS50b1N0cmluZygpXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCB3aGVuIHdlIG5lZWQgdG8gcmVzdGFydCwgZ28gdG8gZmlyc3Qgc2NyZWVuIGFuZCBzZXQgc2NvcmUgdG8gMFxuICAgICAqL1xuICAgIHB1YmxpYyByZXN0YXJ0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLm1lc3NhZ2VTY3JlZW4uaGlkZSgpO1xuICAgICAgICB0aGlzLm1lc3NhZ2VTY3JlZW4uc2hvdygnZ2FtZTpzdGFydCcpO1xuICAgICAgICB0aGlzLnNjb3JlLnVwZGF0ZSgwLCB0cnVlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRTY29yZSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5zY29yZS5nZXQoKTtcbiAgICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVdGlscyB7XG4gICAgLyoqXG4gICAgICogQHJldHVybnMge3N0cmluZ31cbiAgICAgKi9cbiAgICBzdGF0aWMgZ2V0UmFuZG9tQ29sb3IoKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IG8gPSBNYXRoLnJvdW5kLCByID0gTWF0aC5yYW5kb20sIHMgPSAyNTU7XG4gICAgICAgIHJldHVybiBgcmdiYSgke28ocigpICogcyl9LCR7byhyKCkgKiBzKX0sJHtvKHIoKSAqIHMpfSwxKWA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG1pblxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBtYXhcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgICAqL1xuICAgIHN0YXRpYyBnZXRSYW5kb21JbnQobWluOiBudW1iZXIsIG1heDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtDbGllbnRSZWN0fSBhXG4gICAgICogQHBhcmFtIHtDbGllbnRSZWN0fSBiXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgc3RhdGljIGNoZWNrQ29sbGlzaW9uKGE6IENsaWVudFJlY3QsIGI6IENsaWVudFJlY3QpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIChhLmxlZnQgPD0gYi5yaWdodCAmJlxuICAgICAgICAgICAgYi5sZWZ0IDw9IGEucmlnaHQgJiZcbiAgICAgICAgICAgIGEudG9wIDw9IGIuYm90dG9tICYmXG4gICAgICAgICAgICBiLnRvcCA8PSBhLmJvdHRvbSk7XG4gICAgfVxufVxuIiwiaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL2hlbHBlcnMvZG9tZWxlbWVudFwiO1xuaW1wb3J0IFV0aWxzIGZyb20gXCIuLi9oZWxwZXJzL3V0aWxzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJsb2NrIGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBzcGVlZDogbnVtYmVyO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgd2lkdGg6IG51bWJlcjtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGhlaWdodDogbnVtYmVyO1xuICAgIHB1YmxpYyBjb2xvcjogc3RyaW5nO1xuICAgIHByaXZhdGUgZGVzdGluYXRpb24gPSB7eDogMCwgeTogMH07XG5cbiAgICBjb25zdHJ1Y3Rvcihjb2xvcjogc3RyaW5nLCBzcGVlZDogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikge1xuICAgICAgICBzdXBlcignYmxvY2snLCAwLCAwLCAnbGV2ZWwnKTtcblxuICAgICAgICB0aGlzLnNwZWVkID0gc3BlZWQ7XG4gICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcblxuICAgICAgICB0aGlzLmVsLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGByZXBlYXRpbmctbGluZWFyLWdyYWRpZW50KCR7VXRpbHMuZ2V0UmFuZG9tSW50KDAsIDM2MCl9ZGVnLCAjMDAwMDAwLCAjMDAwMDAwICR7VXRpbHMuZ2V0UmFuZG9tSW50KDIsIDEwKX1weCwgJHt0aGlzLmNvbG9yfSAxMHB4LCAke3RoaXMuY29sb3J9ICR7VXRpbHMuZ2V0UmFuZG9tSW50KDIwLCA0MCl9cHgpYDtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS53aWR0aCA9IGAke3RoaXMud2lkdGh9cHhgO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLmhlaWdodCA9IGAke3RoaXMuaGVpZ2h0fXB4YDtcblxuICAgICAgICB0aGlzLnggPSBVdGlscy5nZXRSYW5kb21JbnQoMCwgKHdpbmRvdy5vdXRlcldpZHRoIC0gdGhpcy53aWR0aCkpO1xuICAgICAgICB0aGlzLnkgPSBVdGlscy5nZXRSYW5kb21JbnQoMCwgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLSB0aGlzLmhlaWdodCkpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHt0aGlzLnh9cHgsICR7dGhpcy55fXB4KWA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlciBmb3IgY2xpY2tpbmcgdGhlIGJsb2Nrc1xuICAgICAqL1xuICAgIHB1YmxpYyBkZXN0cm95KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmVsLnJlbW92ZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1haW4gdXBkYXRlIGhhbmRsZXIgZm9yIHRoZSBnYW1lIGZvciBtb3Zpbmcgb3VyIGJsb2NrIHJhbmRvbWx5IG92ZXIgdGhlIHNjcmVlblxuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGUoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnggPiAodGhpcy5kZXN0aW5hdGlvbi54IC0gdGhpcy5zcGVlZCkgJiYgdGhpcy54IDwgKHRoaXMuZGVzdGluYXRpb24ueCArIHRoaXMuc3BlZWQpKSB7XG4gICAgICAgICAgICB0aGlzLmRlc3RpbmF0aW9uLnggPSBVdGlscy5nZXRSYW5kb21JbnQoMCwgKHdpbmRvdy5vdXRlcldpZHRoIC0gdGhpcy53aWR0aCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnkgPiAodGhpcy5kZXN0aW5hdGlvbi55IC0gdGhpcy5zcGVlZCkgJiYgdGhpcy55IDwgKHRoaXMuZGVzdGluYXRpb24ueSArIHRoaXMuc3BlZWQpKSB7XG4gICAgICAgICAgICB0aGlzLmRlc3RpbmF0aW9uLnkgPSBVdGlscy5nZXRSYW5kb21JbnQoMCwgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLSB0aGlzLmhlaWdodCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZGVzdGluYXRpb24ueCA+PSB0aGlzLngpIHtcbiAgICAgICAgICAgIHRoaXMueCArPSB0aGlzLnNwZWVkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy54IC09IHRoaXMuc3BlZWQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5kZXN0aW5hdGlvbi55ID49IHRoaXMueSkge1xuICAgICAgICAgICAgdGhpcy55ICs9IHRoaXMuc3BlZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnkgLT0gdGhpcy5zcGVlZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZWwuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgke3RoaXMueH1weCwgJHt0aGlzLnl9cHgpYDtcbiAgICB9XG59XG4iLCJpbXBvcnQgY29uZmlnIGZyb20gJy4uL2NvbmZpZy5qc29uJztcbmltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuLi9oZWxwZXJzL2RvbWVsZW1lbnRcIjtcbmltcG9ydCBCbG9jayBmcm9tIFwiLi9ibG9ja1wiO1xuaW1wb3J0IFdpbmRvd0V2ZW50SGFuZGxlciBmcm9tIFwiLi4vaGVscGVycy93aW5kb3dldmVudGhhbmRsZXJcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGxheWVyIGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgcHJpdmF0ZSBoZWlnaHQ6IG51bWJlciA9IDEwO1xuICAgIHByaXZhdGUgd2lkdGg6IG51bWJlciA9IDEwO1xuICAgIHByaXZhdGUgZ3Jvd3RoRmFjdG9yOiBudW1iZXIgPSBjb25maWcuZ2FtZS5wbGF5ZXIuZ3Jvd3RoRmFjdG9yO1xuICAgIHByaXZhdGUgc3BlZWQ6IG51bWJlciA9IGNvbmZpZy5nYW1lLnBsYXllci5zcGVlZDtcbiAgICBwcml2YXRlIHNwZWVkSW5jcmVhc2VGYWN0b3I6IG51bWJlciA9IGNvbmZpZy5nYW1lLnBsYXllci5zcGVlZEluY3JlYXNlRmFjdG9yO1xuICAgIHByaXZhdGUga2V5c0FsbG93ZWQ6IHN0cmluZ1tdID0gWydhcnJvd2xlZnQnLCAnYXJyb3d1cCcsICdhcnJvd3JpZ2h0JywgJ2Fycm93ZG93biddO1xuICAgIHByaXZhdGUga2V5c1ByZXNzZWQ6IHN0cmluZ1tdID0gW107XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ3BsYXllcicsIDAsIDAsICdsZXZlbCcpO1xuICAgICAgICB0aGlzLnggPSB3aW5kb3cub3V0ZXJXaWR0aCAvIDIgLSB0aGlzLndpZHRoIC8gMjtcbiAgICAgICAgdGhpcy55ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAvIDIgLSB0aGlzLmhlaWdodCAvIDI7XG5cbiAgICAgICAgdGhpcy5lbC5zdHlsZS53aWR0aCA9IGAke3RoaXMud2lkdGh9cHhgO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLmhlaWdodCA9IGAke3RoaXMuaGVpZ2h0fXB4YDtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5ib3JkZXJSYWRpdXMgPSBgJHt0aGlzLndpZHRofXB4YDtcblxuICAgICAgICBXaW5kb3dFdmVudEhhbmRsZXIuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bi5wbGF5ZXInLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4gdGhpcy5rZXlEb3duSGFuZGxlcihlKSk7XG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5hZGRFdmVudExpc3RlbmVyKCdrZXl1cC5wbGF5ZXInLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4gdGhpcy5rZXlVcEhhbmRsZXIoZSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEtleSBkb3duIGhhbmRsZXIgZm9yIG1vdmluZyB0aGUgcGxheWVyXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZVxuICAgICAqL1xuICAgIHByaXZhdGUga2V5RG93bkhhbmRsZXIoZTogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgICAgICBsZXQga2V5ID0gZS5rZXkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgaWYgKHRoaXMua2V5c0FsbG93ZWQuaW5kZXhPZihrZXkpID4gLTEgJiYgdGhpcy5rZXlzUHJlc3NlZC5pbmRleE9mKGtleSkgPT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLmtleXNQcmVzc2VkLnB1c2goa2V5KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEtleSBkb3duIGhhbmRsZXIgZm9yIG1vdmluZyB0aGUgcGxheWVyXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZVxuICAgICAqL1xuICAgIHByaXZhdGUga2V5VXBIYW5kbGVyKGU6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgbGV0IGtleSA9IGUua2V5LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGxldCBrZXlQcmVzc2VkUG9zaXRpb24gPSB0aGlzLmtleXNQcmVzc2VkLmluZGV4T2Yoa2V5KTtcbiAgICAgICAgaWYgKHRoaXMua2V5c0FsbG93ZWQuaW5kZXhPZihrZXkpID4gLTEgJiYga2V5UHJlc3NlZFBvc2l0aW9uID4gLTEpIHtcbiAgICAgICAgICAgIHRoaXMua2V5c1ByZXNzZWQuc3BsaWNlKGtleVByZXNzZWRQb3NpdGlvbiwgMSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhlIGFjdHVhbCBwb3NpdGlvbiBiYXNlZCBvbiBlYXJsaWVyIGV2ZW50c1xuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMua2V5c1ByZXNzZWQuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2Fycm93bGVmdCc6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMueCAtPSB0aGlzLnNwZWVkO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ2Fycm93dXAnOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnkgLT0gdGhpcy5zcGVlZDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdhcnJvd3JpZ2h0JzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy54ICs9IHRoaXMuc3BlZWQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnYXJyb3dkb3duJzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy55ICs9IHRoaXMuc3BlZWQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvL0NoZWNrcyB0byBzdGF5IGluIGJvdW5kc1xuICAgICAgICBpZiAodGhpcy54IDwgMCkge1xuICAgICAgICAgICAgdGhpcy54ID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy55IDwgMCkge1xuICAgICAgICAgICAgdGhpcy55ID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy54ID4gKHdpbmRvdy5vdXRlcldpZHRoIC0gdGhpcy53aWR0aCkpIHtcbiAgICAgICAgICAgIHRoaXMueCA9ICh3aW5kb3cub3V0ZXJXaWR0aCAtIHRoaXMud2lkdGgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnkgPiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAtIHRoaXMuaGVpZ2h0KSkge1xuICAgICAgICAgICAgdGhpcy55ID0gKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLSB0aGlzLmhlaWdodCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVsLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHt0aGlzLnh9cHgsICR7dGhpcy55fXB4KWA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIHBsYXllciB3aGVuIGEgYmxvY2sgZ290IGNhdWdodFxuICAgICAqXG4gICAgICogQHBhcmFtIGJsb2NrXG4gICAgICovXG4gICAgcHVibGljIGJsb2NrQ2F1Z2h0KGJsb2NrOiBCbG9jayk6IHZvaWQge1xuICAgICAgICB0aGlzLnNwZWVkICs9IHRoaXMuc3BlZWRJbmNyZWFzZUZhY3RvcjtcbiAgICAgICAgdGhpcy53aWR0aCArPSB0aGlzLmdyb3d0aEZhY3RvcjtcbiAgICAgICAgdGhpcy5oZWlnaHQgKz0gdGhpcy5ncm93dGhGYWN0b3I7XG5cbiAgICAgICAgdGhpcy5lbC5zdHlsZS5oZWlnaHQgPSBgJHt0aGlzLmhlaWdodH1weGA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUud2lkdGggPSBgJHt0aGlzLndpZHRofXB4YDtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5ib3JkZXJSYWRpdXMgPSBgJHt0aGlzLndpZHRofXB4YDtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBibG9jay5jb2xvcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbGVhbiB1cCFcbiAgICAgKi9cbiAgICBwdWJsaWMgZGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5lbC5yZW1vdmUoKTtcbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24ucGxheWVyJyk7XG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXl1cC5wbGF5ZXInKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgY29uZmlnIGZyb20gJy4uL2NvbmZpZy5qc29uJztcbmltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuLi9oZWxwZXJzL2RvbWVsZW1lbnRcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGltZXIgZXh0ZW5kcyBEb21FbGVtZW50IHtcbiAgICBzZWNvbmRzOiBudW1iZXIgPSBjb25maWcuZ2FtZS5zZWNvbmRzUGVyTGV2ZWw7XG4gICAgaW50ZXJ2YWxJZDogbnVtYmVyO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCd0aW1lcicsIC0xLCAtMSwgJ2xldmVsJyk7XG5cbiAgICAgICAgdGhpcy5yZW5kZXJUZW1wbGF0ZSgpO1xuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoJ21lc3NhZ2UnLCAnaXMtcHJpbWFyeScpO1xuICAgICAgICB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoJy5zZWNvbmRzJykuaW5uZXJIVE1MID0gdGhpcy5zZWNvbmRzLnRvU3RyaW5nKCk7XG5cbiAgICAgICAgdGhpcy5pbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoKCkgPT4gdGhpcy51cGRhdGUoKSwgMTAwMCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ291bnRkb3duIG9mIHNlY29uZHNcbiAgICAgKi9cbiAgICBwcml2YXRlIHVwZGF0ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZWNvbmRzLS07XG4gICAgICAgIHRoaXMuZWwucXVlcnlTZWxlY3RvcignLnNlY29uZHMnKS5pbm5lckhUTUwgPSB0aGlzLnNlY29uZHMudG9TdHJpbmcoKTtcblxuICAgICAgICBpZiAodGhpcy5zZWNvbmRzIDw9IDMpIHtcbiAgICAgICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LnJlbW92ZSgnaXMtcHJpbWFyeScpO1xuICAgICAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QuYWRkKCdpcy1kYW5nZXInKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LmFkZCgnaXMtcHJpbWFyeScpO1xuICAgICAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QucmVtb3ZlKCdpcy1kYW5nZXInKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnNlY29uZHMgPT09IDApIHtcbiAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgndGltZXI6ZG9uZScpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBkZXN0cm95KCk6IHZvaWQge1xuICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVtcGxhdGUgbmVlZGVkIHRvIHNob3cgbW9yZSBlbGVtZW50c1xuICAgICAqL1xuICAgIHByaXZhdGUgcmVuZGVyVGVtcGxhdGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZWwuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lc3NhZ2UtYm9keVwiPlxuICAgICAgICAgICAgICAgIDxzcGFuPnRpbWU6IDwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInNlY29uZHNcIj48L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcbiAgICB9XG59XG4iLCJpbXBvcnQgY29uZmlnIGZyb20gJy4uL2NvbmZpZy5qc29uJztcbmltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuLi9oZWxwZXJzL2RvbWVsZW1lbnRcIjtcbmltcG9ydCBCbG9jayBmcm9tIFwiLi9ibG9ja1wiO1xuaW1wb3J0IFBsYXllciBmcm9tIFwiLi9wbGF5ZXJcIjtcbmltcG9ydCBUaW1lciBmcm9tIFwiLi90aW1lclwiO1xuaW1wb3J0IFV0aWxzIGZyb20gXCIuLi9oZWxwZXJzL3V0aWxzXCI7XG5pbXBvcnQgV2luZG93RXZlbnRIYW5kbGVyIGZyb20gXCIuLi9oZWxwZXJzL3dpbmRvd2V2ZW50aGFuZGxlclwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMZXZlbCBleHRlbmRzIERvbUVsZW1lbnQge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgdG90YWxCbG9ja3M6IG51bWJlcjtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNjb3JlUGVyQmxvY2s6IG51bWJlcjtcbiAgICBwcml2YXRlIGJsb2NrczogQmxvY2tbXSA9IFtdO1xuICAgIHByaXZhdGUgcGxheWVyOiBQbGF5ZXI7XG4gICAgcHJpdmF0ZSB0aW1lcjogVGltZXI7XG4gICAgcHVibGljIGZhaWxlZCA9IGZhbHNlO1xuXG4gICAgY29uc3RydWN0b3IodG90YWxCbG9ja3M6IG51bWJlciwgc2NvcmVQZXJCbG9jazogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKCdsZXZlbCcsIDAsIDApO1xuXG4gICAgICAgIHRoaXMudG90YWxCbG9ja3MgPSB0b3RhbEJsb2NrcztcbiAgICAgICAgdGhpcy5zY29yZVBlckJsb2NrID0gc2NvcmVQZXJCbG9jaztcbiAgICAgICAgdGhpcy5wbGF5ZXIgPSBuZXcgUGxheWVyKCk7XG4gICAgICAgIHRoaXMudGltZXIgPSBuZXcgVGltZXIoKTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudG90YWxCbG9ja3M7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5ibG9ja3MucHVzaChuZXcgQmxvY2soVXRpbHMuZ2V0UmFuZG9tQ29sb3IoKSwgVXRpbHMuZ2V0UmFuZG9tSW50KGNvbmZpZy5nYW1lLmJsb2NrU3BlZWQubWluLCBjb25maWcuZ2FtZS5ibG9ja1NwZWVkLm1heCksIFV0aWxzLmdldFJhbmRvbUludChjb25maWcuZ2FtZS5ibG9ja1BpeGVscy5taW4sIGNvbmZpZy5nYW1lLmJsb2NrUGl4ZWxzLm1heCksIFV0aWxzLmdldFJhbmRvbUludChjb25maWcuZ2FtZS5ibG9ja1BpeGVscy5taW4sIGNvbmZpZy5nYW1lLmJsb2NrUGl4ZWxzLm1heCkpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5hZGRFdmVudExpc3RlbmVyKCd0aW1lcjpkb25lJywgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5mYWlsZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5kZXN0cm95KCdsZXZlbDpmYWlsZWQnKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGZvciBjb2xsaXNpb24gYW5kIHBvdGVudGlhbCBzdWNjZXNzIG9mIHRoaXMgbGV2ZWxcbiAgICAgKi9cbiAgICBwdWJsaWMgdXBkYXRlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnBsYXllci51cGRhdGUoKTtcbiAgICAgICAgdGhpcy5ibG9ja3MuZm9yRWFjaCgoYmxvY2ssIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBibG9jay51cGRhdGUoKTtcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmNoZWNrQ29sbGlzaW9uKHRoaXMucGxheWVyLmdldENsaWVudFJlYWN0KCksIGJsb2NrLmdldENsaWVudFJlYWN0KCkpICYmIHRoaXMuZmFpbGVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLmJsb2NrQ2F1Z2h0KGJsb2NrKTtcbiAgICAgICAgICAgICAgICBibG9jay5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5ibG9ja3Muc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2xldmVsOnNjb3JlVXBkYXRlJywge2RldGFpbDoge3Njb3JlOiB0aGlzLnNjb3JlUGVyQmxvY2t9fSkpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYmxvY2tzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRlc3Ryb3koJ2xldmVsOnN1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlc3Ryb3kgb2JqZWN0ICYgdGltZXIgYW5kIHRyaWdnZXIgZXZlbnQgdG8gbm90aWZ5IHRoZSB3b3JsZCBhYm91dCB0aGUgc3RhdHVzIG9mIHRoaXMgbGV2ZWxcbiAgICAgKlxuICAgICAqIEBwYXJhbSBldmVudFR5cGVcbiAgICAgKi9cbiAgICBwcml2YXRlIGRlc3Ryb3koZXZlbnRUeXBlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy50aW1lci5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMucGxheWVyLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5ibG9ja3MuZm9yRWFjaCgoYmxvY2ssIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBibG9jay5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLmJsb2Nrcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9KTtcbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RpbWVyOmRvbmUnKTtcbiAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KGV2ZW50VHlwZSkpO1xuICAgICAgICB0aGlzLmVsLnJlbW92ZSgpO1xuICAgIH1cbn1cbiIsImltcG9ydCBHYW1lIGZyb20gJy4vZ2FtZSc7XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoKSA9PiBuZXcgR2FtZSgpKTtcbiIsImltcG9ydCBjb25maWcgZnJvbSAnLi9jb25maWcuanNvbic7XG5pbXBvcnQgR1VJIGZyb20gJy4vZ3VpL2d1aSc7XG5pbXBvcnQgTGV2ZWwgZnJvbSBcIi4vbGV2ZWwvbGV2ZWxcIjtcbmltcG9ydCBEYXRhU2VydmljZSBmcm9tIFwiLi9kYXRhc2VydmljZVwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHYW1lIHtcbiAgICBwcml2YXRlIGxldmVsITogTGV2ZWw7XG4gICAgcHJpdmF0ZSBsZXZlbHNQZXJHYW1lOiBudW1iZXIgPSBjb25maWcuZ2FtZS5sZXZlbHNQZXJHYW1lO1xuICAgIHByaXZhdGUgY3VycmVudExldmVsc1BsYXllZDogbnVtYmVyID0gMDtcbiAgICBwcml2YXRlIHN0YXJ0RWxlbWVudHNQZXJMZXZlbDogbnVtYmVyID0gY29uZmlnLmdhbWUuc3RhcnRFbGVtZW50c1BlckxldmVsO1xuICAgIHByaXZhdGUgZWxlbWVudHNJbmNyZWFzZVBlckxldmVsOiBudW1iZXIgPSBjb25maWcuZ2FtZS5lbGVtZW50c0luY3JlYXNlUGVyTGV2ZWw7XG4gICAgcHJpdmF0ZSBzY29yZVBlckVsZW1lbnQ6IG51bWJlciA9IGNvbmZpZy5nYW1lLnNjb3JlUGVyRWxlbWVudDtcbiAgICBwcml2YXRlIHJlYWRvbmx5IG1heFNjb3JlOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBndWk6IEdVSTtcbiAgICBwcml2YXRlIGRhdGFTZXJ2aWNlOiBEYXRhU2VydmljZTtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmd1aSA9IG5ldyBHVUkoKTtcbiAgICAgICAgdGhpcy5tYXhTY29yZSA9IHRoaXMuY2FsY3VsYXRlTWF4U2NvcmUoKTtcbiAgICAgICAgdGhpcy5nYW1lTG9vcCgpO1xuICAgICAgICB0aGlzLmRhdGFTZXJ2aWNlID0gbmV3IERhdGFTZXJ2aWNlKCk7XG5cbiAgICAgICAgWydsZXZlbDpzdWNjZXNzJywgJ2xldmVsOmZhaWxlZCddLm1hcCgoZXZlbnRUeXBlKSA9PiB7XG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsIChlKSA9PiB0aGlzLnVwZGF0ZShlLnR5cGUpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFsnZ2FtZTpzdGFydDpjbGljaycsICdsZXZlbDpzdWNjZXNzOmNsaWNrJywgJ2xldmVsOmZhaWxlZDpjbGljayddLm1hcCgoZXZlbnRUeXBlKSA9PiB7XG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsICgpID0+IHRoaXMuc3RhcnROZXdMZXZlbCgpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdnYW1lOmVuZDpjbGljaycsICgpID0+IHRoaXMucmVzdGFydCgpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGUgdGhlIHNjb3JlIHdpdGggYXZhaWxhYmxlIHBhcmFtZXRlcnNcbiAgICAgKlxuICAgICAqIEB0b2RvIERvIEkgcmVhbGx5IG5lZWQgdG8gZG8gdGhpcyBzbyBpbmVmZmljaWVudC4uP1xuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAgICovXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGVNYXhTY29yZSgpOiBudW1iZXIge1xuICAgICAgICBsZXQgbWF4U2NvcmUgPSAwO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubGV2ZWxzUGVyR2FtZTsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgZWxlbWVudHMgPSB0aGlzLnN0YXJ0RWxlbWVudHNQZXJMZXZlbCArIChpID09PSAwID8gMCA6ICh0aGlzLmVsZW1lbnRzSW5jcmVhc2VQZXJMZXZlbCAqIGkpKTtcbiAgICAgICAgICAgIG1heFNjb3JlICs9IChlbGVtZW50cyAqIHRoaXMuc2NvcmVQZXJFbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWF4U2NvcmU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIG9ubHkgcGxhY2UgZm9yIGEgcmVxdWVzdEFuaW1hdGlvbkZyYW1lXG4gICAgICovXG4gICAgcHJpdmF0ZSBnYW1lTG9vcCgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmxldmVsICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5sZXZlbC51cGRhdGUoKTtcbiAgICAgICAgfVxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5nYW1lTG9vcCgpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhlIGdhbWUgYnkgZWl0aGVyIHRoZSBlbmQgb3IgYW55dGhpbmcgaW4gYmV0d2VlbiBsZXZlbHNcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlXG4gICAgICovXG4gICAgcHJpdmF0ZSB1cGRhdGUodHlwZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY3VycmVudExldmVsc1BsYXllZCsrO1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50TGV2ZWxzUGxheWVkID09PSB0aGlzLmxldmVsc1BlckdhbWUpIHtcbiAgICAgICAgICAgIHRoaXMuZ3VpLmdhbWVFbmQodGhpcy5tYXhTY29yZSk7XG4gICAgICAgICAgICB0aGlzLnNhdmVTY29yZSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5ndWkubGV2ZWxEb25lKHR5cGUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRpbWUgdG8gc3RhcnQgYSBuZXcgbGV2ZWwgd2l0aCBtYWRuZXNzXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGFydE5ld0xldmVsKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5sZXZlbCAmJiB0aGlzLmxldmVsLmZhaWxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRFbGVtZW50c1BlckxldmVsICs9IHRoaXMuZWxlbWVudHNJbmNyZWFzZVBlckxldmVsO1xuICAgICAgICB9XG5cbiAgICAgICAgZGVsZXRlIHRoaXMubGV2ZWw7XG4gICAgICAgIHRoaXMuZ3VpLm5ld0xldmVsKCk7XG5cbiAgICAgICAgdGhpcy5sZXZlbCA9IG5ldyBMZXZlbCh0aGlzLnN0YXJ0RWxlbWVudHNQZXJMZXZlbCwgdGhpcy5zY29yZVBlckVsZW1lbnQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN0YXJ0IGV2ZXJ5dGhpbmcgZnJvbSB0aGUgYmVnaW5uaW5nXG4gICAgICovXG4gICAgcHJpdmF0ZSByZXN0YXJ0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmd1aS5yZXN0YXJ0KCk7XG4gICAgICAgIHRoaXMuY3VycmVudExldmVsc1BsYXllZCA9IDA7XG4gICAgICAgIHRoaXMuc3RhcnRFbGVtZW50c1BlckxldmVsID0gY29uZmlnLmdhbWUuc3RhcnRFbGVtZW50c1BlckxldmVsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbGwgdGhlIGRhdGEgc2VydmljZSBhbmQgbGV0IGl0IGRvIGl0cyBtYWdpY1xuICAgICAqL1xuICAgIHByaXZhdGUgc2F2ZVNjb3JlKCk6IHZvaWQge1xuICAgICAgICBsZXQgc2NvcmUgPSB0aGlzLmd1aS5nZXRTY29yZSgpO1xuICAgICAgICB0aGlzLmRhdGFTZXJ2aWNlLnNhdmVTY29yZShzY29yZSkudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdnYW1lOnNjb3JlU2F2ZWQnLCB7ZGV0YWlsOiB7ZGF0YX19KSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=