!function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e){e.exports={game:{levelsPerGame:1,startElementsPerLevel:5,elementsIncreasePerLevel:5,scorePerElement:10,secondsPerLevel:10,blockSpeed:{min:1,max:5},blockPixels:{min:10,max:150},player:{growthFactor:1.5,speed:3,speedIncreaseFactor:.2}},functionalities:{mLab:!1},mLab:{baseUrl:"https://api.mlab.com/api/1",apiKey:"X17utv1FH2dFTeUo4yhNGL54sA7CY2jS",databaseName:"typescript_scores",collectionName:"scores"}}},function(e,t,s){"use strict";s.r(t);var i=s(0);class r{constructor(e,t,s,i=""){this.x=t,this.y=s,this.el=document.createElement("div");let r=document.getElementById("main");if(null===r)throw new Error("<main> element doesn't exist!");if(this.x>-1&&this.y>-1&&(this.el.style.transform=`translate(${this.x}px, ${this.y}px)`),this.el.classList.add(`game-${e}`),""===i)r.appendChild(this.el);else{let e=document.querySelector(`.game-${i}`);if(null===e)throw new Error(`<.game-${i}> element doesn't exist!`);e.appendChild(this.el)}}getClientReact(){return this.el.getBoundingClientRect()}}class a extends r{constructor(){super("score",-1,-1,"gui"),this.score=0,this.renderTemplate(),this.el.querySelector(".score-count").innerHTML=this.score.toString(),this.el.classList.add("message","is-warning")}get(){return this.score}update(e,t=!1){this.score=t?e:this.score+e,this.el.querySelector(".score-count").innerHTML=this.score.toString()}renderTemplate(){this.el.innerHTML='\n            <div class="message-body">\n                <span>score: </span>\n                <span class="score-count"></span>\n            </div>\n        '}}class n{static addEventListener(e,t){n.functionMap[e]=t,window.addEventListener(e.split(".")[0],n.functionMap[e])}static removeEventListener(e){window.removeEventListener(e.split(".")[0],n.functionMap[e]),delete n.functionMap[e]}}n.functionMap={};class o extends r{constructor(){super("messagescreen",-1,-1,"gui"),this.isActive=!1,this.messages={"game:start":{header:"Welcome to Block-o-Block!",body:"It's time to catch them blocks!<br/><br/>Use your arrow keys to move your player around and press space to start.<br/><br/>Press -<strong>H</strong>- to view the highscore list",className:"is-info"},"game:end":{header:"Your game is over!",body:"You made it, your final score is __SCORE__ out of max __MAX_SCORE__ points.<br/><br/>Thanks for playing, press space to restart the madness.<br/><br/>Press -<strong>H</strong>- to view the highscore list",className:"is-success"},"level:success":{header:"YEAH! Level completed!",body:"Performing like a boss! Press space to proceed to the next level and catch even more blocks",className:"is-success"},"level:failed":{header:"AAH! Level failed!",body:"Try again and show us what you're made off! Press space to restart this level",className:"is-danger"}},this.el.classList.add("message"),this.renderTemplate(),this.show("game:start"),n.addEventListener("keyup.messagescreen",e=>this.keyBoardHandler(e))}keyBoardHandler(e){" "===e.key&&!0===this.isActive&&window.dispatchEvent(new Event(`${this.currentEvent}:click`))}show(e,t={}){let s=this.messages[e].header,i=this.messages[e].body;for(let e in t)i=i.replace(e,t[e]);this.el.querySelector(".message-header").innerHTML=s,this.el.querySelector(".message-body").innerHTML=i,this.el.classList.add("show",this.messages[e].className),this.currentEvent=e,this.isActive=!0}hide(){this.el.classList.remove("show","is-info","is-success","is-danger"),this.isActive=!1}renderTemplate(){this.el.innerHTML='\n            <div class="message-header"></div>\n            <div class="message-body"></div>\n        '}}class h{constructor(){this.endPointList=`/databases/${i.mLab.databaseName}/collections/${i.mLab.collectionName}?apiKey=${i.mLab.apiKey}`,this.endPointSave=`/databases/${i.mLab.databaseName}/collections/${i.mLab.collectionName}?apiKey=${i.mLab.apiKey}`,this.disabledMessage="Dataservice is disabled or you are offline",this.offlineUserScores=[],n.addEventListener("online.dataservice",()=>this.saveScoreToMlab())}static getInstance(){return h.instance||(h.instance=new h),h.instance}saveScore(e){if(!1===i.functionalities.mLab||!1===window.navigator.onLine)return this.offlineUserScores.push(e),this.disabled();let t=`${i.mLab.baseUrl}${this.endPointSave}`;return fetch(t,{body:JSON.stringify({score:e}),headers:{"content-type":"application/json"},method:"POST",mode:"cors"}).then(e=>e.json())}getScores(){if(!1===i.functionalities.mLab||!1===window.navigator.onLine)return new Promise(e=>{e(JSON.parse(localStorage.getItem("scores")))});let e=`${i.mLab.baseUrl}${this.endPointList}&s={"score": -1}&l=10`;return fetch(e,{mode:"cors"}).then(e=>e.json()).then(e=>localStorage.getItem("scores")===JSON.stringify(e)?JSON.parse(localStorage.getItem("scores")):(localStorage.setItem("scores",JSON.stringify(e)),e))}saveScoreToMlab(){this.offlineUserScores.length>0&&Promise.all(this.offlineUserScores.map(e=>this.saveScore(e))).then(()=>{this.offlineUserScores=[]})}disabled(){return new Promise(e=>{e({error:this.disabledMessage})})}}class l extends r{constructor(){super("highscorelist",-1,-1,"gui"),this.el.classList.add("message","is-warning"),this.renderTemplate(),this.tBody=this.el.querySelector(".tbody"),this.dataService=h.getInstance(),this.loadScoreData(),window.addEventListener("game:scoreSaved",e=>this.updateData(e.detail.data))}loadScoreData(e=!1){this.dataService.getScores().then(t=>{this.scores=t,this.tBody.innerHTML=this.getTbodyTemplate(),!0===e&&this.el.classList.add("show")})}updateData(e){((0===this.scores.length?-1:this.scores[this.scores.length-1].score)<e.score||this.scores.length<10)&&(this.scores.push(e),this.scores.sort((e,t)=>t.score-e.score),this.scores.splice(10,1),this.tBody.innerHTML=this.getTbodyTemplate())}show(){void 0===this.scores?this.loadScoreData(!0):this.el.classList.add("show")}hide(){this.el.classList.remove("show")}getTbodyTemplate(){return`\n            ${this.scores.map((e,t)=>`<tr>\n                <td>${t+1}</td>\n                <td>${e._id.$oid}</td>\n                <td>${e.score.toString()}</td>\n            </tr>`).join("")}\n        `}renderTemplate(){this.el.innerHTML='\n            <div class="message-header">\n                <p>Top 10 High Scores (press -<strong>ESC</strong>- to return)</p>\n            </div>\n            <div class="message-body">\n                <table class="table">\n                    <thead>\n                    <tr>\n                        <th>#</th>\n                        <th>MongoID</th>\n                        <th>Score</th>\n                    </tr>\n                    </thead>\n                    <tbody class="tbody"></tbody>\n                </table>\n            </div>\n        '}}class d extends r{constructor(){super("gui",-1,-1),this.highScoreListVisible=!1,this.score=new a,this.messageScreen=new o,window.addEventListener("level:scoreUpdate",e=>this.score.update(e.detail.score)),this.highScoreList=new l,n.addEventListener("keyup.highscorelist",e=>this.keyBoardHandler(e))}keyBoardHandler(e){let t=e.key.toLowerCase();"h"===t&&!1===this.highScoreListVisible?(this.highScoreListVisible=!0,this.highScoreList.show()):"escape"===t&&!0===this.highScoreListVisible&&(this.highScoreListVisible=!1,this.highScoreList.hide())}levelDone(e){this.messageScreen.show(e)}newLevel(){this.messageScreen.hide()}gameEnd(e){this.messageScreen.show("game:end",{__SCORE__:this.score.get().toString(),__MAX_SCORE__:e.toString()})}restart(){this.messageScreen.hide(),this.messageScreen.show("game:start"),this.score.update(0,!0)}getScore(){return this.score.get()}}class c{static getRandomColor(){let e=Math.round,t=Math.random;return`rgba(${e(255*t())},${e(255*t())},${e(255*t())},1)`}static getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}static checkCollision(e,t){return e.left<=t.right&&t.left<=e.right&&e.top<=t.bottom&&t.top<=e.bottom}}class m extends r{constructor(e,t,s,i){super("block",0,0,"level"),this.destination={x:0,y:0},this.speed=t,this.width=s,this.height=i,this.color=e,this.el.style.backgroundImage=`repeating-linear-gradient(${c.getRandomInt(0,360)}deg, #000000, #000000 ${c.getRandomInt(2,10)}px, ${this.color} 10px, ${this.color} ${c.getRandomInt(20,40)}px)`,this.el.style.width=`${this.width}px`,this.el.style.height=`${this.height}px`,this.x=c.getRandomInt(0,window.outerWidth-this.width),this.y=c.getRandomInt(0,document.documentElement.clientHeight-this.height),this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}destroy(){this.el.remove()}update(){this.x>this.destination.x-this.speed&&this.x<this.destination.x+this.speed&&(this.destination.x=c.getRandomInt(0,window.outerWidth-this.width)),this.y>this.destination.y-this.speed&&this.y<this.destination.y+this.speed&&(this.destination.y=c.getRandomInt(0,document.documentElement.clientHeight-this.height)),this.destination.x>=this.x?this.x+=this.speed:this.x-=this.speed,this.destination.y>=this.y?this.y+=this.speed:this.y-=this.speed,this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}}class g extends r{constructor(){super("player",0,0,"level"),this.height=10,this.width=10,this.growthFactor=i.game.player.growthFactor,this.speed=i.game.player.speed,this.speedIncreaseFactor=i.game.player.speedIncreaseFactor,this.keysAllowed=["arrowleft","arrowup","arrowright","arrowdown"],this.keysPressed=[],this.x=window.outerWidth/2-this.width/2,this.y=document.documentElement.clientHeight/2-this.height/2,this.el.style.width=`${this.width}px`,this.el.style.height=`${this.height}px`,this.el.style.borderRadius=`${this.width}px`,n.addEventListener("keydown.player",e=>this.keyDownHandler(e)),n.addEventListener("keyup.player",e=>this.keyUpHandler(e))}keyDownHandler(e){let t=e.key.toLowerCase();this.keysAllowed.indexOf(t)>-1&&-1===this.keysPressed.indexOf(t)&&this.keysPressed.push(t)}keyUpHandler(e){let t=e.key.toLowerCase(),s=this.keysPressed.indexOf(t);this.keysAllowed.indexOf(t)>-1&&s>-1&&this.keysPressed.splice(s,1)}update(){this.keysPressed.forEach(e=>{switch(e){case"arrowleft":this.x-=this.speed;break;case"arrowup":this.y-=this.speed;break;case"arrowright":this.x+=this.speed;break;case"arrowdown":this.y+=this.speed;break;default:return}}),this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x>window.outerWidth-this.width&&(this.x=window.outerWidth-this.width),this.y>document.documentElement.clientHeight-this.height&&(this.y=document.documentElement.clientHeight-this.height),this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}blockCaught(e){this.speed+=this.speedIncreaseFactor,this.width+=this.growthFactor,this.height+=this.growthFactor,this.el.style.height=`${this.height}px`,this.el.style.width=`${this.width}px`,this.el.style.borderRadius=`${this.width}px`,this.el.style.backgroundColor=e.color}destroy(){this.el.remove(),n.removeEventListener("keydown.player"),n.removeEventListener("keyup.player")}}class p extends r{constructor(){super("timer",-1,-1,"level"),this.seconds=i.game.secondsPerLevel,this.renderTemplate(),this.el.classList.add("message","is-primary"),this.el.querySelector(".seconds").innerHTML=this.seconds.toString(),this.intervalId=setInterval(()=>this.update(),1e3)}update(){this.seconds--,this.el.querySelector(".seconds").innerHTML=this.seconds.toString(),this.seconds<=3?(this.el.classList.remove("is-primary"),this.el.classList.add("is-danger")):(this.el.classList.add("is-primary"),this.el.classList.remove("is-danger")),0===this.seconds&&window.dispatchEvent(new Event("timer:done"))}destroy(){clearInterval(this.intervalId)}renderTemplate(){this.el.innerHTML='\n            <div class="message-body">\n                <span>time: </span>\n                <span class="seconds"></span>\n            </div>\n        '}}class u extends r{constructor(e,t){super("level",0,0),this.blocks=[],this.failed=!1,this.totalBlocks=e,this.scorePerBlock=t,this.player=new g,this.timer=new p;for(let e=0;e<this.totalBlocks;e++)this.blocks.push(new m(c.getRandomColor(),c.getRandomInt(i.game.blockSpeed.min,i.game.blockSpeed.max),c.getRandomInt(i.game.blockPixels.min,i.game.blockPixels.max),c.getRandomInt(i.game.blockPixels.min,i.game.blockPixels.max)));n.addEventListener("timer:done",()=>{this.failed=!0,this.destroy("level:failed")})}update(){this.player.update(),this.blocks.forEach((e,t)=>{e.update(),c.checkCollision(this.player.getClientReact(),e.getClientReact())&&!1===this.failed&&(this.player.blockCaught(e),e.destroy(),this.blocks.splice(t,1),window.dispatchEvent(new CustomEvent("level:scoreUpdate",{detail:{score:this.scorePerBlock}})),0===this.blocks.length&&this.destroy("level:success"))})}destroy(e){this.timer.destroy(),this.player.destroy(),this.blocks.forEach((e,t)=>{e.destroy(),this.blocks.splice(t,1)}),n.removeEventListener("timer:done"),window.dispatchEvent(new Event(e)),this.el.remove()}}window.addEventListener("load",()=>new class{constructor(){this.levelsPerGame=i.game.levelsPerGame,this.currentLevelsPlayed=0,this.startElementsPerLevel=i.game.startElementsPerLevel,this.elementsIncreasePerLevel=i.game.elementsIncreasePerLevel,this.scorePerElement=i.game.scorePerElement,this.gui=new d,this.maxScore=this.calculateMaxScore(),this.gameLoop(),this.dataService=h.getInstance(),["level:success","level:failed"].map(e=>{window.addEventListener(e,e=>this.update(e.type))}),["game:start:click","level:success:click","level:failed:click"].map(e=>{window.addEventListener(e,()=>this.startNewLevel())}),window.addEventListener("game:end:click",()=>this.restart())}calculateMaxScore(){let e=0;for(let t=0;t<this.levelsPerGame;t++)e+=(this.startElementsPerLevel+(0===t?0:this.elementsIncreasePerLevel*t))*this.scorePerElement;return e}gameLoop(){void 0!==this.level&&this.level.update(),requestAnimationFrame(()=>this.gameLoop())}update(e){if(this.currentLevelsPlayed++,this.currentLevelsPlayed===this.levelsPerGame)return this.gui.gameEnd(this.maxScore),void this.saveScore();this.gui.levelDone(e)}startNewLevel(){this.level&&!1===this.level.failed&&(this.startElementsPerLevel+=this.elementsIncreasePerLevel),delete this.level,this.gui.newLevel(),this.level=new u(this.startElementsPerLevel,this.scorePerElement)}restart(){this.gui.restart(),this.currentLevelsPlayed=0,this.startElementsPerLevel=i.game.startElementsPerLevel}saveScore(){let e=this.gui.getScore();this.dataService.saveScore(e).then(e=>{void 0===e.error&&window.dispatchEvent(new CustomEvent("game:scoreSaved",{detail:{data:e}}))})}})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vZGV2L2hlbHBlcnMvZG9tZWxlbWVudC50cyIsIndlYnBhY2s6Ly8vLi9kZXYvZ3VpL3Njb3JlLnRzIiwid2VicGFjazovLy8uL2Rldi9oZWxwZXJzL3dpbmRvd2V2ZW50aGFuZGxlci50cyIsIndlYnBhY2s6Ly8vLi9kZXYvZ3VpL21lc3NhZ2VzY3JlZW4udHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2RhdGFzZXJ2aWNlLnRzIiwid2VicGFjazovLy8uL2Rldi9ndWkvaGlnaHNjb3JlbGlzdC50cyIsIndlYnBhY2s6Ly8vLi9kZXYvZ3VpL2d1aS50cyIsIndlYnBhY2s6Ly8vLi9kZXYvaGVscGVycy91dGlscy50cyIsIndlYnBhY2s6Ly8vLi9kZXYvbGV2ZWwvYmxvY2sudHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2xldmVsL3BsYXllci50cyIsIndlYnBhY2s6Ly8vLi9kZXYvbGV2ZWwvdGltZXIudHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2xldmVsL2xldmVsLnRzIiwid2VicGFjazovLy8uL2Rldi9tYWluLnRzIiwid2VicGFjazovLy8uL2Rldi9nYW1lLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsInZhbHVlIiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJEb21FbGVtZW50IiwiW29iamVjdCBPYmplY3RdIiwidHlwZSIsIngiLCJ5IiwicGFyZW50Q2xhc3MiLCJ0aGlzIiwiZWwiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJtYWluIiwiZ2V0RWxlbWVudEJ5SWQiLCJFcnJvciIsInN0eWxlIiwidHJhbnNmb3JtIiwiY2xhc3NMaXN0IiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJwYXJlbnRFbCIsInF1ZXJ5U2VsZWN0b3IiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJzY29yZV9TY29yZSIsInN1cGVyIiwic2NvcmUiLCJyZW5kZXJUZW1wbGF0ZSIsImlubmVySFRNTCIsInRvU3RyaW5nIiwicmVzZXQiLCJXaW5kb3dFdmVudEhhbmRsZXIiLCJldmVudCIsImZ1bmMiLCJmdW5jdGlvbk1hcCIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJzcGxpdCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJtZXNzYWdlc2NyZWVuX01lc3NhZ2VTY3JlZW4iLCJpc0FjdGl2ZSIsIm1lc3NhZ2VzIiwiZ2FtZTpzdGFydCIsImhlYWRlciIsImJvZHkiLCJjbGFzc05hbWUiLCJnYW1lOmVuZCIsImxldmVsOnN1Y2Nlc3MiLCJsZXZlbDpmYWlsZWQiLCJzaG93IiwiZSIsImtleUJvYXJkSGFuZGxlciIsImtleSIsImRpc3BhdGNoRXZlbnQiLCJFdmVudCIsImN1cnJlbnRFdmVudCIsImJvZHlSZXBsYWNlbWVudHMiLCJtZXNzYWdlSGVhZGVyIiwibWVzc2FnZUJvZHkiLCJyZXBsYWNlbWVudCIsInJlcGxhY2UiLCJyZW1vdmUiLCJkYXRhc2VydmljZV9EYXRhU2VydmljZSIsImVuZFBvaW50TGlzdCIsImNvbmZpZyIsIm1MYWIiLCJkYXRhYmFzZU5hbWUiLCJjb2xsZWN0aW9uTmFtZSIsImFwaUtleSIsImVuZFBvaW50U2F2ZSIsImRpc2FibGVkTWVzc2FnZSIsIm9mZmxpbmVVc2VyU2NvcmVzIiwic2F2ZVNjb3JlVG9NbGFiIiwiaW5zdGFuY2UiLCJmdW5jdGlvbmFsaXRpZXMiLCJuYXZpZ2F0b3IiLCJvbkxpbmUiLCJwdXNoIiwiZGlzYWJsZWQiLCJ1cmwiLCJiYXNlVXJsIiwiZmV0Y2giLCJKU09OIiwic3RyaW5naWZ5IiwiaGVhZGVycyIsImNvbnRlbnQtdHlwZSIsIm1ldGhvZCIsIm1vZGUiLCJ0aGVuIiwicmVzcG9uc2UiLCJqc29uIiwiUHJvbWlzZSIsInJlc29sdmUiLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJkYXRhIiwic2V0SXRlbSIsImxlbmd0aCIsImFsbCIsIm1hcCIsInNhdmVTY29yZSIsImVycm9yIiwiaGlnaHNjb3JlbGlzdF9IaWdoU2NvcmVMaXN0IiwidEJvZHkiLCJkYXRhU2VydmljZSIsImdldEluc3RhbmNlIiwibG9hZFNjb3JlRGF0YSIsInVwZGF0ZURhdGEiLCJkZXRhaWwiLCJzaG93U2NyZWVuIiwiZ2V0U2NvcmVzIiwic2NvcmVzIiwiZ2V0VGJvZHlUZW1wbGF0ZSIsInNvcnQiLCJhIiwiYiIsInNwbGljZSIsIml0ZW0iLCJpbmRleCIsIl9pZCIsIiRvaWQiLCJqb2luIiwiZ3VpX0dVSSIsImhpZ2hTY29yZUxpc3RWaXNpYmxlIiwibWVzc2FnZVNjcmVlbiIsInVwZGF0ZSIsImhpZ2hTY29yZUxpc3QiLCJ0b0xvd2VyQ2FzZSIsImhpZGUiLCJtYXhTY29yZSIsIl9fU0NPUkVfXyIsIl9fTUFYX1NDT1JFX18iLCJVdGlscyIsIk1hdGgiLCJyb3VuZCIsInJhbmRvbSIsIm1pbiIsIm1heCIsImZsb29yIiwibGVmdCIsInJpZ2h0IiwidG9wIiwiYm90dG9tIiwiYmxvY2tfQmxvY2siLCJjb2xvciIsInNwZWVkIiwid2lkdGgiLCJoZWlnaHQiLCJkZXN0aW5hdGlvbiIsImJhY2tncm91bmRJbWFnZSIsImdldFJhbmRvbUludCIsIm91dGVyV2lkdGgiLCJkb2N1bWVudEVsZW1lbnQiLCJjbGllbnRIZWlnaHQiLCJwbGF5ZXJfUGxheWVyIiwiZ3Jvd3RoRmFjdG9yIiwiZ2FtZSIsInBsYXllciIsInNwZWVkSW5jcmVhc2VGYWN0b3IiLCJrZXlzQWxsb3dlZCIsImtleXNQcmVzc2VkIiwiYm9yZGVyUmFkaXVzIiwia2V5RG93bkhhbmRsZXIiLCJrZXlVcEhhbmRsZXIiLCJpbmRleE9mIiwia2V5UHJlc3NlZFBvc2l0aW9uIiwiZm9yRWFjaCIsImJsb2NrIiwiYmFja2dyb3VuZENvbG9yIiwidGltZXJfVGltZXIiLCJzZWNvbmRzIiwic2Vjb25kc1BlckxldmVsIiwiaW50ZXJ2YWxJZCIsInNldEludGVydmFsIiwiY2xlYXJJbnRlcnZhbCIsImxldmVsX0xldmVsIiwidG90YWxCbG9ja3MiLCJzY29yZVBlckJsb2NrIiwiYmxvY2tzIiwiZmFpbGVkIiwidGltZXIiLCJnZXRSYW5kb21Db2xvciIsImJsb2NrU3BlZWQiLCJibG9ja1BpeGVscyIsImRlc3Ryb3kiLCJjaGVja0NvbGxpc2lvbiIsImdldENsaWVudFJlYWN0IiwiYmxvY2tDYXVnaHQiLCJDdXN0b21FdmVudCIsImV2ZW50VHlwZSIsImxldmVsc1BlckdhbWUiLCJjdXJyZW50TGV2ZWxzUGxheWVkIiwic3RhcnRFbGVtZW50c1BlckxldmVsIiwiZWxlbWVudHNJbmNyZWFzZVBlckxldmVsIiwic2NvcmVQZXJFbGVtZW50IiwiZ3VpIiwiY2FsY3VsYXRlTWF4U2NvcmUiLCJnYW1lTG9vcCIsInN0YXJ0TmV3TGV2ZWwiLCJyZXN0YXJ0IiwibGV2ZWwiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJnYW1lRW5kIiwibGV2ZWxEb25lIiwibmV3TGV2ZWwiLCJnZXRTY29yZSJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdB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S0FBS3lMLHlCQUEyQnhOLElBQ3BFK0IsS0FBSzBMLGdCQUVqQyxPQUFPakUsRUFNSDlILGdCQUNzQixJQUFmSyxLQUFLZ00sT0FDWmhNLEtBQUtnTSxNQUFNM0UsU0FFZjRFLHNCQUFzQixJQUFNak0sS0FBSzZMLFlBUTdCbE0sT0FBT0MsR0FFWCxHQURBSSxLQUFLdUwsc0JBQ0R2TCxLQUFLdUwsc0JBQXdCdkwsS0FBS3NMLGNBR2xDLE9BRkF0TCxLQUFLMkwsSUFBSU8sUUFBUWxNLEtBQUt5SCxlQUN0QnpILEtBQUs0RixZQUlUNUYsS0FBSzJMLElBQUlRLFVBQVV2TSxHQU1mRCxnQkFDQUssS0FBS2dNLFFBQStCLElBQXRCaE0sS0FBS2dNLE1BQU1yQixTQUN6QjNLLEtBQUt3TCx1QkFBeUJ4TCxLQUFLeUwsaUNBR2hDekwsS0FBS2dNLE1BQ1poTSxLQUFLMkwsSUFBSVMsV0FFVHBNLEtBQUtnTSxNQUFRLElBQUl6QixFQUFNdkssS0FBS3dMLHNCQUF1QnhMLEtBQUswTCxpQkFNcEQvTCxVQUNKSyxLQUFLMkwsSUFBSUksVUFDVC9MLEtBQUt1TCxvQkFBc0IsRUFDM0J2TCxLQUFLd0wsc0JBQXdCakksRUFBTzZGLEtBQUtvQyxzQkFNckM3TCxZQUNKLElBQUlzQixFQUFRakIsS0FBSzJMLElBQUlVLFdBQ3JCck0sS0FBS2dHLFlBQVlKLFVBQVUzRSxHQUFPOEQsS0FBTVEsU0FDVixJQUFmQSxFQUFLTSxPQUNabkUsT0FBT2tCLGNBQWMsSUFBSXdJLFlBQVksbUJBQW9CaEYsUUFBU2IiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMSk7XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBEb21FbGVtZW50IHtcbiAgICBwcm90ZWN0ZWQgZWw6IEhUTUxFbGVtZW50O1xuICAgIHByb3RlY3RlZCB4OiBudW1iZXI7XG4gICAgcHJvdGVjdGVkIHk6IG51bWJlcjtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHhcbiAgICAgKiBAcGFyYW0ge251bWJlcn0geVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwYXJlbnRDbGFzc1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHR5cGU6IHN0cmluZywgeDogbnVtYmVyLCB5OiBudW1iZXIsIHBhcmVudENsYXNzOiBzdHJpbmcgPSAnJykge1xuICAgICAgICB0aGlzLnggPSB4O1xuICAgICAgICB0aGlzLnkgPSB5O1xuXG4gICAgICAgIHRoaXMuZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgbGV0IG1haW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbicpO1xuICAgICAgICBpZiAobWFpbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiPG1haW4+IGVsZW1lbnQgZG9lc24ndCBleGlzdCFcIik7XG4gICAgICAgIH1cblxuICAgICAgICAvLy0xIGNoZWNrIGlzIHRvIGxldCBDU1MgZG8gaXRzIG93biBqb2IgQHRvZG8gY2xlYW5lciBzb2x1dGlvbj9cbiAgICAgICAgaWYgKHRoaXMueCA+IC0xICYmIHRoaXMueSA+IC0xKSB7XG4gICAgICAgICAgICB0aGlzLmVsLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHt0aGlzLnh9cHgsICR7dGhpcy55fXB4KWA7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QuYWRkKGBnYW1lLSR7dHlwZX1gKTtcblxuICAgICAgICBpZiAocGFyZW50Q2xhc3MgPT09ICcnKSB7XG4gICAgICAgICAgICBtYWluLmFwcGVuZENoaWxkKHRoaXMuZWwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGV0IHBhcmVudEVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLmdhbWUtJHtwYXJlbnRDbGFzc31gKTtcbiAgICAgICAgICAgIGlmIChwYXJlbnRFbCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgPC5nYW1lLSR7cGFyZW50Q2xhc3N9PiBlbGVtZW50IGRvZXNuJ3QgZXhpc3QhYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJlbnRFbC5hcHBlbmRDaGlsZCh0aGlzLmVsKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIENsaWVudFJlY3RcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0Q2xpZW50UmVhY3QoKTogQ2xpZW50UmVjdCB8IERPTVJlY3Qge1xuICAgICAgICByZXR1cm4gdGhpcy5lbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgRG9tRWxlbWVudCBmcm9tIFwiLi4vaGVscGVycy9kb21lbGVtZW50XCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNjb3JlIGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgcHJpdmF0ZSBzY29yZTogbnVtYmVyID0gMDtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcignc2NvcmUnLCAtMSwgLTEsICdndWknKTtcblxuICAgICAgICB0aGlzLnJlbmRlclRlbXBsYXRlKCk7XG4gICAgICAgIHRoaXMuZWwucXVlcnlTZWxlY3RvcignLnNjb3JlLWNvdW50JykuaW5uZXJIVE1MID0gdGhpcy5zY29yZS50b1N0cmluZygpO1xuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoJ21lc3NhZ2UnLCAnaXMtd2FybmluZycpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIGN1cnJlbnQgc2NvcmVcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAgICovXG4gICAgcHVibGljIGdldCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5zY29yZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhlIHNjb3JlIGJhc2VkIG9uIGEgQ3VzdG9tIEV2ZW50IGZyb20gdGhlIEJsb2NrIG9iamVjdFxuICAgICAqXG4gICAgICogQHBhcmFtIHNjb3JlXG4gICAgICogQHBhcmFtIFtyZXNldF1cbiAgICAgKi9cbiAgICBwdWJsaWMgdXBkYXRlKHNjb3JlOiBudW1iZXIsIHJlc2V0OiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zY29yZSA9IHJlc2V0ID8gc2NvcmUgOiB0aGlzLnNjb3JlICsgc2NvcmU7XG4gICAgICAgIHRoaXMuZWwucXVlcnlTZWxlY3RvcignLnNjb3JlLWNvdW50JykuaW5uZXJIVE1MID0gdGhpcy5zY29yZS50b1N0cmluZygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlbXBsYXRlIG5lZWRlZCB0byBzaG93IG1vcmUgZWxlbWVudHNcbiAgICAgKi9cbiAgICBwcml2YXRlIHJlbmRlclRlbXBsYXRlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmVsLmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZXNzYWdlLWJvZHlcIj5cbiAgICAgICAgICAgICAgICA8c3Bhbj5zY29yZTogPC9zcGFuPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwic2NvcmUtY291bnRcIj48L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcbiAgICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBXaW5kb3dFdmVudEhhbmRsZXIge1xuICAgIHByaXZhdGUgc3RhdGljIGZ1bmN0aW9uTWFwOiB7IFtrOiBzdHJpbmddOiBhbnkgfSA9IHt9O1xuXG4gICAgLyoqXG4gICAgICogQWRkIGxpc3RlbmVyIHRvIHdpbmRvdyB3aXRoIG5hbWUgc3BhY2luZ1xuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50XG4gICAgICogQHBhcmFtIGZ1bmNcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGFkZEV2ZW50TGlzdGVuZXIoZXZlbnQ6IHN0cmluZywgZnVuYzogYW55KTogdm9pZCB7XG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5mdW5jdGlvbk1hcFtldmVudF0gPSBmdW5jO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihldmVudC5zcGxpdCgnLicpWzBdLCBXaW5kb3dFdmVudEhhbmRsZXIuZnVuY3Rpb25NYXBbZXZlbnRdKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgbGlzdGVuZXIgZnJvbSB3aW5kb3cgd2l0aCBuYW1lIHNwYWNpbmdcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudFxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LnNwbGl0KCcuJylbMF0sIFdpbmRvd0V2ZW50SGFuZGxlci5mdW5jdGlvbk1hcFtldmVudF0pO1xuICAgICAgICBkZWxldGUgV2luZG93RXZlbnRIYW5kbGVyLmZ1bmN0aW9uTWFwW2V2ZW50XTtcbiAgICB9XG59XG4iLCJpbXBvcnQgRG9tRWxlbWVudCBmcm9tIFwiLi4vaGVscGVycy9kb21lbGVtZW50XCI7XG5pbXBvcnQgV2luZG93RXZlbnRIYW5kbGVyIGZyb20gXCIuLi9oZWxwZXJzL3dpbmRvd2V2ZW50aGFuZGxlclwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNZXNzYWdlU2NyZWVuIGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgcHJpdmF0ZSBjdXJyZW50RXZlbnQhOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBpc0FjdGl2ZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgcHJpdmF0ZSBtZXNzYWdlczogeyBbazogc3RyaW5nXTogeyAnaGVhZGVyJzogc3RyaW5nLCAnYm9keSc6IHN0cmluZywgJ2NsYXNzTmFtZSc6IHN0cmluZyB9IH0gPSB7XG4gICAgICAgICdnYW1lOnN0YXJ0Jzoge1xuICAgICAgICAgICAgJ2hlYWRlcic6ICdXZWxjb21lIHRvIEJsb2NrLW8tQmxvY2shJyxcbiAgICAgICAgICAgICdib2R5JzogJ0l0XFwncyB0aW1lIHRvIGNhdGNoIHRoZW0gYmxvY2tzITxici8+PGJyLz5Vc2UgeW91ciBhcnJvdyBrZXlzIHRvIG1vdmUgeW91ciBwbGF5ZXIgYXJvdW5kIGFuZCBwcmVzcyBzcGFjZSB0byBzdGFydC48YnIvPjxici8+UHJlc3MgLTxzdHJvbmc+SDwvc3Ryb25nPi0gdG8gdmlldyB0aGUgaGlnaHNjb3JlIGxpc3QnLFxuICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdpcy1pbmZvJ1xuICAgICAgICB9LFxuICAgICAgICAnZ2FtZTplbmQnOiB7XG4gICAgICAgICAgICAnaGVhZGVyJzogJ1lvdXIgZ2FtZSBpcyBvdmVyIScsXG4gICAgICAgICAgICAnYm9keSc6ICdZb3UgbWFkZSBpdCwgeW91ciBmaW5hbCBzY29yZSBpcyBfX1NDT1JFX18gb3V0IG9mIG1heCBfX01BWF9TQ09SRV9fIHBvaW50cy48YnIvPjxici8+VGhhbmtzIGZvciBwbGF5aW5nLCBwcmVzcyBzcGFjZSB0byByZXN0YXJ0IHRoZSBtYWRuZXNzLjxici8+PGJyLz5QcmVzcyAtPHN0cm9uZz5IPC9zdHJvbmc+LSB0byB2aWV3IHRoZSBoaWdoc2NvcmUgbGlzdCcsXG4gICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2lzLXN1Y2Nlc3MnXG4gICAgICAgIH0sXG4gICAgICAgICdsZXZlbDpzdWNjZXNzJzoge1xuICAgICAgICAgICAgJ2hlYWRlcic6ICdZRUFIISBMZXZlbCBjb21wbGV0ZWQhJyxcbiAgICAgICAgICAgICdib2R5JzogJ1BlcmZvcm1pbmcgbGlrZSBhIGJvc3MhIFByZXNzIHNwYWNlIHRvIHByb2NlZWQgdG8gdGhlIG5leHQgbGV2ZWwgYW5kIGNhdGNoIGV2ZW4gbW9yZSBibG9ja3MnLFxuICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdpcy1zdWNjZXNzJ1xuICAgICAgICB9LFxuICAgICAgICAnbGV2ZWw6ZmFpbGVkJzoge1xuICAgICAgICAgICAgJ2hlYWRlcic6ICdBQUghIExldmVsIGZhaWxlZCEnLFxuICAgICAgICAgICAgJ2JvZHknOiAnVHJ5IGFnYWluIGFuZCBzaG93IHVzIHdoYXQgeW91XFwncmUgbWFkZSBvZmYhIFByZXNzIHNwYWNlIHRvIHJlc3RhcnQgdGhpcyBsZXZlbCcsXG4gICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2lzLWRhbmdlcidcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ21lc3NhZ2VzY3JlZW4nLCAtMSwgLTEsICdndWknKTtcbiAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QuYWRkKCdtZXNzYWdlJyk7XG5cbiAgICAgICAgdGhpcy5yZW5kZXJUZW1wbGF0ZSgpO1xuICAgICAgICB0aGlzLnNob3coJ2dhbWU6c3RhcnQnKTtcbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwLm1lc3NhZ2VzY3JlZW4nLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4gdGhpcy5rZXlCb2FyZEhhbmRsZXIoZSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSB0aGUgc3BhY2ViYXJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7S2V5Ym9hcmRFdmVudH0gZVxuICAgICAqL1xuICAgIHByaXZhdGUga2V5Qm9hcmRIYW5kbGVyKGU6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgaWYgKGUua2V5ID09PSAnICcgJiYgdGhpcy5pc0FjdGl2ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KGAke3RoaXMuY3VycmVudEV2ZW50fTpjbGlja2ApKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNob3cgdGhlIGRlc2lyZWQgbWVzc2FnZSAodHlwZSBtYXRjaGVzIGluZGV4IGluIG9iamVjdClcbiAgICAgKlxuICAgICAqIEBwYXJhbSB0eXBlXG4gICAgICogQHBhcmFtIFtib2R5UmVwbGFjZW1lbnRzXVxuICAgICAqL1xuICAgIHB1YmxpYyBzaG93KHR5cGU6IHN0cmluZywgYm9keVJlcGxhY2VtZW50czogeyBbazogc3RyaW5nXTogc3RyaW5nIH0gPSB7fSk6IHZvaWQge1xuICAgICAgICBsZXQgbWVzc2FnZUhlYWRlciA9IHRoaXMubWVzc2FnZXNbdHlwZV0uaGVhZGVyO1xuICAgICAgICBsZXQgbWVzc2FnZUJvZHkgPSB0aGlzLm1lc3NhZ2VzW3R5cGVdLmJvZHk7XG4gICAgICAgIGZvciAobGV0IHJlcGxhY2VtZW50IGluIGJvZHlSZXBsYWNlbWVudHMpIHtcbiAgICAgICAgICAgIG1lc3NhZ2VCb2R5ID0gbWVzc2FnZUJvZHkucmVwbGFjZShyZXBsYWNlbWVudCwgYm9keVJlcGxhY2VtZW50c1tyZXBsYWNlbWVudF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcubWVzc2FnZS1oZWFkZXInKS5pbm5lckhUTUwgPSBtZXNzYWdlSGVhZGVyO1xuICAgICAgICB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoJy5tZXNzYWdlLWJvZHknKS5pbm5lckhUTUwgPSBtZXNzYWdlQm9keTtcblxuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoJ3Nob3cnLCB0aGlzLm1lc3NhZ2VzW3R5cGVdLmNsYXNzTmFtZSk7XG4gICAgICAgIHRoaXMuY3VycmVudEV2ZW50ID0gdHlwZTtcbiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGlkZSBtZXNzYWdlIG9uIHNjcmVlblxuICAgICAqL1xuICAgIHB1YmxpYyBoaWRlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnLCAnaXMtaW5mbycsICdpcy1zdWNjZXNzJywgJ2lzLWRhbmdlcicpO1xuICAgICAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVtcGxhdGUgbmVlZGVkIHRvIHNob3cgbW9yZSBlbGVtZW50c1xuICAgICAqL1xuICAgIHByaXZhdGUgcmVuZGVyVGVtcGxhdGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZWwuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lc3NhZ2UtaGVhZGVyXCI+PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVzc2FnZS1ib2R5XCI+PC9kaXY+XG4gICAgICAgIGA7XG4gICAgfVxufVxuIiwiaW1wb3J0IGNvbmZpZyBmcm9tICcuL2NvbmZpZy5qc29uJztcbmltcG9ydCBXaW5kb3dFdmVudEhhbmRsZXIgZnJvbSBcIi4vaGVscGVycy93aW5kb3dldmVudGhhbmRsZXJcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGF0YVNlcnZpY2Uge1xuICAgIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBEYXRhU2VydmljZTtcblxuICAgIHByaXZhdGUgZW5kUG9pbnRMaXN0OiBzdHJpbmcgPSBgL2RhdGFiYXNlcy8ke2NvbmZpZy5tTGFiLmRhdGFiYXNlTmFtZX0vY29sbGVjdGlvbnMvJHtjb25maWcubUxhYi5jb2xsZWN0aW9uTmFtZX0/YXBpS2V5PSR7Y29uZmlnLm1MYWIuYXBpS2V5fWA7XG4gICAgcHJpdmF0ZSBlbmRQb2ludFNhdmU6IHN0cmluZyA9IGAvZGF0YWJhc2VzLyR7Y29uZmlnLm1MYWIuZGF0YWJhc2VOYW1lfS9jb2xsZWN0aW9ucy8ke2NvbmZpZy5tTGFiLmNvbGxlY3Rpb25OYW1lfT9hcGlLZXk9JHtjb25maWcubUxhYi5hcGlLZXl9YDtcbiAgICBwcml2YXRlIGRpc2FibGVkTWVzc2FnZTogc3RyaW5nID0gJ0RhdGFzZXJ2aWNlIGlzIGRpc2FibGVkIG9yIHlvdSBhcmUgb2ZmbGluZSc7XG4gICAgcHJpdmF0ZSBvZmZsaW5lVXNlclNjb3JlczogbnVtYmVyW10gPSBbXTtcblxuICAgIHByaXZhdGUgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUuZGF0YXNlcnZpY2UnLCAoKSA9PiB0aGlzLnNhdmVTY29yZVRvTWxhYigpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIGNsYXNzIG5lZWRzIHRvIHdvcmsgYXMgU2luZ2xlVG9uIHRvIHByZXZlbnQgZG91YmxlIGRhdGEgY2FsbHMgZXRjLlxuICAgICAqXG4gICAgICogQHJldHVybnMge0RhdGFTZXJ2aWNlfVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogRGF0YVNlcnZpY2Uge1xuICAgICAgICBpZiAoIURhdGFTZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICAgICAgICBEYXRhU2VydmljZS5pbnN0YW5jZSA9IG5ldyBEYXRhU2VydmljZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBEYXRhU2VydmljZS5pbnN0YW5jZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTdG9yZSB0aGUgbGF0ZXN0IHNjb3JlIGluIHRoZSBEQlxuICAgICAqXG4gICAgICogQHBhcmFtIHNjb3JlXG4gICAgICogQHJldHVybnMge1Byb21pc2U8e30+fVxuICAgICAqL1xuICAgIHB1YmxpYyBzYXZlU2NvcmUoc2NvcmU6IG51bWJlcik6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGlmIChjb25maWcuZnVuY3Rpb25hbGl0aWVzLm1MYWIgPT09IGZhbHNlIHx8IHdpbmRvdy5uYXZpZ2F0b3Iub25MaW5lID09PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy5vZmZsaW5lVXNlclNjb3Jlcy5wdXNoKHNjb3JlKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpc2FibGVkKCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgdXJsID0gYCR7Y29uZmlnLm1MYWIuYmFzZVVybH0ke3RoaXMuZW5kUG9pbnRTYXZlfWA7XG4gICAgICAgIHJldHVybiBmZXRjaCh1cmwsIHtcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICBzY29yZTogc2NvcmVcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIG1vZGU6ICdjb3JzJ1xuICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGFsbCB0aGUgY3VycmVudCBzY29yZXMgZnJvbSB0aGUgREJcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPFtdPn1cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0U2NvcmVzKCk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGlmIChjb25maWcuZnVuY3Rpb25hbGl0aWVzLm1MYWIgPT09IGZhbHNlIHx8IHdpbmRvdy5uYXZpZ2F0b3Iub25MaW5lID09PSBmYWxzZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdzY29yZXMnKSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgdXJsID0gYCR7Y29uZmlnLm1MYWIuYmFzZVVybH0ke3RoaXMuZW5kUG9pbnRMaXN0fSZzPXtcInNjb3JlXCI6IC0xfSZsPTEwYDtcbiAgICAgICAgcmV0dXJuIGZldGNoKHVybCwge1xuICAgICAgICAgICAgbW9kZTogJ2NvcnMnXG4gICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKS50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Njb3JlcycpID09PSBKU09OLnN0cmluZ2lmeShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdzY29yZXMnKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzY29yZXMnLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNhdmUgdGhlIHNjb3JlIHRvIG1MYWIgb25jZSBiYWNrIG9ubGluZVxuICAgICAqL1xuICAgIHByaXZhdGUgc2F2ZVNjb3JlVG9NbGFiKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5vZmZsaW5lVXNlclNjb3Jlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBQcm9taXNlLmFsbCh0aGlzLm9mZmxpbmVVc2VyU2NvcmVzLm1hcCgoc2NvcmUpID0+IHRoaXMuc2F2ZVNjb3JlKHNjb3JlKSkpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMub2ZmbGluZVVzZXJTY29yZXMgPSBbXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2VuZXJhbCBtZXNzYWdlIHdoZW4gdGhpcyBzZXJ2aWNlIGlzIGluYWN0aXZlXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx7fT59XG4gICAgICovXG4gICAgcHJpdmF0ZSBkaXNhYmxlZCgpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUoe1wiZXJyb3JcIjogdGhpcy5kaXNhYmxlZE1lc3NhZ2V9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIiwiaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL2hlbHBlcnMvZG9tZWxlbWVudFwiO1xuaW1wb3J0IERhdGFTZXJ2aWNlIGZyb20gXCIuLi9kYXRhc2VydmljZVwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBIaWdoU2NvcmVMaXN0IGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgcHJpdmF0ZSBkYXRhU2VydmljZTogRGF0YVNlcnZpY2U7XG4gICAgcHJpdmF0ZSBzY29yZXM6IHsgc2NvcmU6IG51bWJlciwgX2lkOiB7ICRvaWQ6IHN0cmluZyB9IH1bXTtcbiAgICBwcml2YXRlIHRCb2R5OiBIVE1MRWxlbWVudDtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcignaGlnaHNjb3JlbGlzdCcsIC0xLCAtMSwgJ2d1aScpO1xuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoJ21lc3NhZ2UnLCAnaXMtd2FybmluZycpO1xuXG4gICAgICAgIHRoaXMucmVuZGVyVGVtcGxhdGUoKTtcbiAgICAgICAgdGhpcy50Qm9keSA9IHRoaXMuZWwucXVlcnlTZWxlY3RvcignLnRib2R5Jyk7XG5cbiAgICAgICAgdGhpcy5kYXRhU2VydmljZSA9IERhdGFTZXJ2aWNlLmdldEluc3RhbmNlKCk7XG4gICAgICAgIHRoaXMubG9hZFNjb3JlRGF0YSgpO1xuXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdnYW1lOnNjb3JlU2F2ZWQnLCAoZSkgPT4gdGhpcy51cGRhdGVEYXRhKChlIGFzIEN1c3RvbUV2ZW50KS5kZXRhaWwuZGF0YSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEluaXRpYWwgc2NvcmUgbG9hZGluZ1xuICAgICAqXG4gICAgICogQHBhcmFtIHtib29sZWFufSBzaG93U2NyZWVuXG4gICAgICovXG4gICAgcHJpdmF0ZSBsb2FkU2NvcmVEYXRhKHNob3dTY3JlZW46IGJvb2xlYW4gPSBmYWxzZSk6IHZvaWQge1xuICAgICAgICB0aGlzLmRhdGFTZXJ2aWNlLmdldFNjb3JlcygpLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2NvcmVzID0gZGF0YTtcbiAgICAgICAgICAgIHRoaXMudEJvZHkuaW5uZXJIVE1MID0gdGhpcy5nZXRUYm9keVRlbXBsYXRlKCk7XG5cbiAgICAgICAgICAgIGlmIChzaG93U2NyZWVuID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIGN1cnJlbnQgc2NvcmUgb2YgdXNlciBpbiBhdmFpbGFibGUgZGF0YVxuICAgICAqXG4gICAgICogQHBhcmFtIHt7fX0gZGF0YVxuICAgICAqL1xuICAgIHByaXZhdGUgdXBkYXRlRGF0YShkYXRhOiB7IHNjb3JlOiBudW1iZXIsIF9pZDogeyAkb2lkOiBzdHJpbmcgfSB9KTogdm9pZCB7XG4gICAgICAgIC8vQ2hlY2sgaWYgZ2l2ZW4gc2NvcmUgaXMgdG9wIDEwIHdvcnRoeVxuICAgICAgICBsZXQgbG93ZXN0Q3VycmVudFNjb3JlID0gdGhpcy5zY29yZXMubGVuZ3RoID09PSAwID8gLTEgOiB0aGlzLnNjb3Jlc1t0aGlzLnNjb3Jlcy5sZW5ndGggLSAxXS5zY29yZTtcbiAgICAgICAgaWYgKGxvd2VzdEN1cnJlbnRTY29yZSA8IGRhdGEuc2NvcmUgfHwgdGhpcy5zY29yZXMubGVuZ3RoIDwgMTApIHtcbiAgICAgICAgICAgIC8vVXBkYXRpbmcgdGhlIHNjb3JlcyBhcnJheSAmIHByZXNlbnRcbiAgICAgICAgICAgIHRoaXMuc2NvcmVzLnB1c2goZGF0YSk7XG4gICAgICAgICAgICB0aGlzLnNjb3Jlcy5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7XG4gICAgICAgICAgICB0aGlzLnNjb3Jlcy5zcGxpY2UoMTAsIDEpO1xuICAgICAgICAgICAgdGhpcy50Qm9keS5pbm5lckhUTUwgPSB0aGlzLmdldFRib2R5VGVtcGxhdGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNob3cgdGhlIGhpZ2ggc2NvcmUgbGlzdFxuICAgICAqL1xuICAgIHB1YmxpYyBzaG93KCk6IHZvaWQge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMuc2NvcmVzID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5sb2FkU2NvcmVEYXRhKHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIaWRlIGl0IHBlcmlvZFxuICAgICAqL1xuICAgIHB1YmxpYyBoaWRlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdGhlIG1hcHBlZCBIVE1MIDx0cj4gbGlzdCBmb3IgYXBwZW5kaW5nIGluIDx0Ym9keT5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAgICovXG4gICAgcHJpdmF0ZSBnZXRUYm9keVRlbXBsYXRlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBgXG4gICAgICAgICAgICAke3RoaXMuc2NvcmVzLm1hcCgoaXRlbSwgaW5kZXgpID0+IGA8dHI+XG4gICAgICAgICAgICAgICAgPHRkPiR7aW5kZXggKyAxfTwvdGQ+XG4gICAgICAgICAgICAgICAgPHRkPiR7aXRlbS5faWQuJG9pZH08L3RkPlxuICAgICAgICAgICAgICAgIDx0ZD4ke2l0ZW0uc2NvcmUudG9TdHJpbmcoKX08L3RkPlxuICAgICAgICAgICAgPC90cj5gKS5qb2luKCcnKX1cbiAgICAgICAgYDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZW1wbGF0ZSBuZWVkZWQgdG8gc2hvdyBtb3JlIGVsZW1lbnRzXG4gICAgICovXG4gICAgcHJpdmF0ZSByZW5kZXJUZW1wbGF0ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5lbC5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVzc2FnZS1oZWFkZXJcIj5cbiAgICAgICAgICAgICAgICA8cD5Ub3AgMTAgSGlnaCBTY29yZXMgKHByZXNzIC08c3Ryb25nPkVTQzwvc3Ryb25nPi0gdG8gcmV0dXJuKTwvcD5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lc3NhZ2UtYm9keVwiPlxuICAgICAgICAgICAgICAgIDx0YWJsZSBjbGFzcz1cInRhYmxlXCI+XG4gICAgICAgICAgICAgICAgICAgIDx0aGVhZD5cbiAgICAgICAgICAgICAgICAgICAgPHRyPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHRoPiM8L3RoPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHRoPk1vbmdvSUQ8L3RoPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHRoPlNjb3JlPC90aD5cbiAgICAgICAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgICAgICAgICAgPC90aGVhZD5cbiAgICAgICAgICAgICAgICAgICAgPHRib2R5IGNsYXNzPVwidGJvZHlcIj48L3Rib2R5PlxuICAgICAgICAgICAgICAgIDwvdGFibGU+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcbiAgICB9XG59XG4iLCJpbXBvcnQgU2NvcmUgZnJvbSAnLi9zY29yZSc7XG5pbXBvcnQgTWVzc2FnZVNjcmVlbiBmcm9tICcuL21lc3NhZ2VzY3JlZW4nO1xuaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL2hlbHBlcnMvZG9tZWxlbWVudFwiO1xuaW1wb3J0IEhpZ2hTY29yZUxpc3QgZnJvbSBcIi4vaGlnaHNjb3JlbGlzdFwiO1xuaW1wb3J0IFdpbmRvd0V2ZW50SGFuZGxlciBmcm9tIFwiLi4vaGVscGVycy93aW5kb3dldmVudGhhbmRsZXJcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR1VJIGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgcHJpdmF0ZSBzY29yZTogU2NvcmU7XG4gICAgcHJpdmF0ZSBtZXNzYWdlU2NyZWVuOiBNZXNzYWdlU2NyZWVuO1xuICAgIHByaXZhdGUgaGlnaFNjb3JlTGlzdDogSGlnaFNjb3JlTGlzdDtcbiAgICBwcml2YXRlIGhpZ2hTY29yZUxpc3RWaXNpYmxlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ2d1aScsIC0xLCAtMSk7XG5cbiAgICAgICAgdGhpcy5zY29yZSA9IG5ldyBTY29yZSgpO1xuICAgICAgICB0aGlzLm1lc3NhZ2VTY3JlZW4gPSBuZXcgTWVzc2FnZVNjcmVlbigpO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbGV2ZWw6c2NvcmVVcGRhdGUnLCAoZSkgPT4gdGhpcy5zY29yZS51cGRhdGUoKGUgYXMgQ3VzdG9tRXZlbnQpLmRldGFpbC5zY29yZSkpO1xuXG4gICAgICAgIHRoaXMuaGlnaFNjb3JlTGlzdCA9IG5ldyBIaWdoU2NvcmVMaXN0KCk7XG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5hZGRFdmVudExpc3RlbmVyKCdrZXl1cC5oaWdoc2NvcmVsaXN0JywgKGU6IEtleWJvYXJkRXZlbnQpID0+IHRoaXMua2V5Qm9hcmRIYW5kbGVyKGUpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgdGhlIHNwYWNlYmFyXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0tleWJvYXJkRXZlbnR9IGVcbiAgICAgKi9cbiAgICBrZXlCb2FyZEhhbmRsZXIoZTogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgICAgICBsZXQga2V5ID0gZS5rZXkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgaWYgKGtleSA9PT0gJ2gnICYmIHRoaXMuaGlnaFNjb3JlTGlzdFZpc2libGUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICB0aGlzLmhpZ2hTY29yZUxpc3RWaXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuaGlnaFNjb3JlTGlzdC5zaG93KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnZXNjYXBlJyAmJiB0aGlzLmhpZ2hTY29yZUxpc3RWaXNpYmxlID09PSB0cnVlKSB7XG4gICAgICAgICAgICB0aGlzLmhpZ2hTY29yZUxpc3RWaXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmhpZ2hTY29yZUxpc3QuaGlkZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIHdoZW4gYSBsZXZlbCBpcyBkb25lXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZVxuICAgICAqL1xuICAgIHB1YmxpYyBsZXZlbERvbmUodHlwZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMubWVzc2FnZVNjcmVlbi5zaG93KHR5cGUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCB3aGVuIGEgbmV3IGxldmVsIHN0YXJ0c1xuICAgICAqL1xuICAgIHB1YmxpYyBuZXdMZXZlbCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlU2NyZWVuLmhpZGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgd2hlbiB0aGUgZ2FtZSBpcyBkb25lXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWF4U2NvcmVcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2FtZUVuZChtYXhTY29yZTogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMubWVzc2FnZVNjcmVlbi5zaG93KCdnYW1lOmVuZCcsIHtcbiAgICAgICAgICAgICdfX1NDT1JFX18nOiB0aGlzLnNjb3JlLmdldCgpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAnX19NQVhfU0NPUkVfXyc6IG1heFNjb3JlLnRvU3RyaW5nKClcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIHdoZW4gd2UgbmVlZCB0byByZXN0YXJ0LCBnbyB0byBmaXJzdCBzY3JlZW4gYW5kIHNldCBzY29yZSB0byAwXG4gICAgICovXG4gICAgcHVibGljIHJlc3RhcnQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMubWVzc2FnZVNjcmVlbi5oaWRlKCk7XG4gICAgICAgIHRoaXMubWVzc2FnZVNjcmVlbi5zaG93KCdnYW1lOnN0YXJ0Jyk7XG4gICAgICAgIHRoaXMuc2NvcmUudXBkYXRlKDAsIHRydWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAgICovXG4gICAgcHVibGljIGdldFNjb3JlKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnNjb3JlLmdldCgpO1xuICAgIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFV0aWxzIHtcbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgICAqL1xuICAgIHN0YXRpYyBnZXRSYW5kb21Db2xvcigpOiBzdHJpbmcge1xuICAgICAgICBsZXQgbyA9IE1hdGgucm91bmQsIHIgPSBNYXRoLnJhbmRvbSwgcyA9IDI1NTtcbiAgICAgICAgcmV0dXJuIGByZ2JhKCR7byhyKCkgKiBzKX0sJHtvKHIoKSAqIHMpfSwke28ocigpICogcyl9LDEpYDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gbWluXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG1heFxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAgICovXG4gICAgc3RhdGljIGdldFJhbmRvbUludChtaW46IG51bWJlciwgbWF4OiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0NsaWVudFJlY3R9IGFcbiAgICAgKiBAcGFyYW0ge0NsaWVudFJlY3R9IGJcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBzdGF0aWMgY2hlY2tDb2xsaXNpb24oYTogQ2xpZW50UmVjdCwgYjogQ2xpZW50UmVjdCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKGEubGVmdCA8PSBiLnJpZ2h0ICYmXG4gICAgICAgICAgICBiLmxlZnQgPD0gYS5yaWdodCAmJlxuICAgICAgICAgICAgYS50b3AgPD0gYi5ib3R0b20gJiZcbiAgICAgICAgICAgIGIudG9wIDw9IGEuYm90dG9tKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgRG9tRWxlbWVudCBmcm9tIFwiLi4vaGVscGVycy9kb21lbGVtZW50XCI7XG5pbXBvcnQgVXRpbHMgZnJvbSBcIi4uL2hlbHBlcnMvdXRpbHNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQmxvY2sgZXh0ZW5kcyBEb21FbGVtZW50IHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNwZWVkOiBudW1iZXI7XG4gICAgcHJpdmF0ZSByZWFkb25seSB3aWR0aDogbnVtYmVyO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgaGVpZ2h0OiBudW1iZXI7XG4gICAgcHVibGljIGNvbG9yOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBkZXN0aW5hdGlvbiA9IHt4OiAwLCB5OiAwfTtcblxuICAgIGNvbnN0cnVjdG9yKGNvbG9yOiBzdHJpbmcsIHNwZWVkOiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKCdibG9jaycsIDAsIDAsICdsZXZlbCcpO1xuXG4gICAgICAgIHRoaXMuc3BlZWQgPSBzcGVlZDtcbiAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yO1xuXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQoJHtVdGlscy5nZXRSYW5kb21JbnQoMCwgMzYwKX1kZWcsICMwMDAwMDAsICMwMDAwMDAgJHtVdGlscy5nZXRSYW5kb21JbnQoMiwgMTApfXB4LCAke3RoaXMuY29sb3J9IDEwcHgsICR7dGhpcy5jb2xvcn0gJHtVdGlscy5nZXRSYW5kb21JbnQoMjAsIDQwKX1weClgO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLndpZHRoID0gYCR7dGhpcy53aWR0aH1weGA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuaGVpZ2h0ID0gYCR7dGhpcy5oZWlnaHR9cHhgO1xuXG4gICAgICAgIHRoaXMueCA9IFV0aWxzLmdldFJhbmRvbUludCgwLCAod2luZG93Lm91dGVyV2lkdGggLSB0aGlzLndpZHRoKSk7XG4gICAgICAgIHRoaXMueSA9IFV0aWxzLmdldFJhbmRvbUludCgwLCAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAtIHRoaXMuaGVpZ2h0KSk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgke3RoaXMueH1weCwgJHt0aGlzLnl9cHgpYDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGVyIGZvciBjbGlja2luZyB0aGUgYmxvY2tzXG4gICAgICovXG4gICAgcHVibGljIGRlc3Ryb3koKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZWwucmVtb3ZlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWFpbiB1cGRhdGUgaGFuZGxlciBmb3IgdGhlIGdhbWUgZm9yIG1vdmluZyBvdXIgYmxvY2sgcmFuZG9tbHkgb3ZlciB0aGUgc2NyZWVuXG4gICAgICovXG4gICAgcHVibGljIHVwZGF0ZSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMueCA+ICh0aGlzLmRlc3RpbmF0aW9uLnggLSB0aGlzLnNwZWVkKSAmJiB0aGlzLnggPCAodGhpcy5kZXN0aW5hdGlvbi54ICsgdGhpcy5zcGVlZCkpIHtcbiAgICAgICAgICAgIHRoaXMuZGVzdGluYXRpb24ueCA9IFV0aWxzLmdldFJhbmRvbUludCgwLCAod2luZG93Lm91dGVyV2lkdGggLSB0aGlzLndpZHRoKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMueSA+ICh0aGlzLmRlc3RpbmF0aW9uLnkgLSB0aGlzLnNwZWVkKSAmJiB0aGlzLnkgPCAodGhpcy5kZXN0aW5hdGlvbi55ICsgdGhpcy5zcGVlZCkpIHtcbiAgICAgICAgICAgIHRoaXMuZGVzdGluYXRpb24ueSA9IFV0aWxzLmdldFJhbmRvbUludCgwLCAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAtIHRoaXMuaGVpZ2h0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5kZXN0aW5hdGlvbi54ID49IHRoaXMueCkge1xuICAgICAgICAgICAgdGhpcy54ICs9IHRoaXMuc3BlZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnggLT0gdGhpcy5zcGVlZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmRlc3RpbmF0aW9uLnkgPj0gdGhpcy55KSB7XG4gICAgICAgICAgICB0aGlzLnkgKz0gdGhpcy5zcGVlZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMueSAtPSB0aGlzLnNwZWVkO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lbC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7dGhpcy54fXB4LCAke3RoaXMueX1weClgO1xuICAgIH1cbn1cbiIsImltcG9ydCBjb25maWcgZnJvbSAnLi4vY29uZmlnLmpzb24nO1xuaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL2hlbHBlcnMvZG9tZWxlbWVudFwiO1xuaW1wb3J0IEJsb2NrIGZyb20gXCIuL2Jsb2NrXCI7XG5pbXBvcnQgV2luZG93RXZlbnRIYW5kbGVyIGZyb20gXCIuLi9oZWxwZXJzL3dpbmRvd2V2ZW50aGFuZGxlclwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQbGF5ZXIgZXh0ZW5kcyBEb21FbGVtZW50IHtcbiAgICBwcml2YXRlIGhlaWdodDogbnVtYmVyID0gMTA7XG4gICAgcHJpdmF0ZSB3aWR0aDogbnVtYmVyID0gMTA7XG4gICAgcHJpdmF0ZSBncm93dGhGYWN0b3I6IG51bWJlciA9IGNvbmZpZy5nYW1lLnBsYXllci5ncm93dGhGYWN0b3I7XG4gICAgcHJpdmF0ZSBzcGVlZDogbnVtYmVyID0gY29uZmlnLmdhbWUucGxheWVyLnNwZWVkO1xuICAgIHByaXZhdGUgc3BlZWRJbmNyZWFzZUZhY3RvcjogbnVtYmVyID0gY29uZmlnLmdhbWUucGxheWVyLnNwZWVkSW5jcmVhc2VGYWN0b3I7XG4gICAgcHJpdmF0ZSBrZXlzQWxsb3dlZDogc3RyaW5nW10gPSBbJ2Fycm93bGVmdCcsICdhcnJvd3VwJywgJ2Fycm93cmlnaHQnLCAnYXJyb3dkb3duJ107XG4gICAgcHJpdmF0ZSBrZXlzUHJlc3NlZDogc3RyaW5nW10gPSBbXTtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigncGxheWVyJywgMCwgMCwgJ2xldmVsJyk7XG4gICAgICAgIHRoaXMueCA9IHdpbmRvdy5vdXRlcldpZHRoIC8gMiAtIHRoaXMud2lkdGggLyAyO1xuICAgICAgICB0aGlzLnkgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC8gMiAtIHRoaXMuaGVpZ2h0IC8gMjtcblxuICAgICAgICB0aGlzLmVsLnN0eWxlLndpZHRoID0gYCR7dGhpcy53aWR0aH1weGA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuaGVpZ2h0ID0gYCR7dGhpcy5oZWlnaHR9cHhgO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLmJvcmRlclJhZGl1cyA9IGAke3RoaXMud2lkdGh9cHhgO1xuXG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duLnBsYXllcicsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB0aGlzLmtleURvd25IYW5kbGVyKGUpKTtcbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwLnBsYXllcicsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB0aGlzLmtleVVwSGFuZGxlcihlKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogS2V5IGRvd24gaGFuZGxlciBmb3IgbW92aW5nIHRoZSBwbGF5ZXJcbiAgICAgKlxuICAgICAqIEBwYXJhbSBlXG4gICAgICovXG4gICAgcHJpdmF0ZSBrZXlEb3duSGFuZGxlcihlOiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgICAgIGxldCBrZXkgPSBlLmtleS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAodGhpcy5rZXlzQWxsb3dlZC5pbmRleE9mKGtleSkgPiAtMSAmJiB0aGlzLmtleXNQcmVzc2VkLmluZGV4T2Yoa2V5KSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMua2V5c1ByZXNzZWQucHVzaChrZXkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogS2V5IGRvd24gaGFuZGxlciBmb3IgbW92aW5nIHRoZSBwbGF5ZXJcbiAgICAgKlxuICAgICAqIEBwYXJhbSBlXG4gICAgICovXG4gICAgcHJpdmF0ZSBrZXlVcEhhbmRsZXIoZTogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgICAgICBsZXQga2V5ID0gZS5rZXkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgbGV0IGtleVByZXNzZWRQb3NpdGlvbiA9IHRoaXMua2V5c1ByZXNzZWQuaW5kZXhPZihrZXkpO1xuICAgICAgICBpZiAodGhpcy5rZXlzQWxsb3dlZC5pbmRleE9mKGtleSkgPiAtMSAmJiBrZXlQcmVzc2VkUG9zaXRpb24gPiAtMSkge1xuICAgICAgICAgICAgdGhpcy5rZXlzUHJlc3NlZC5zcGxpY2Uoa2V5UHJlc3NlZFBvc2l0aW9uLCAxKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgYWN0dWFsIHBvc2l0aW9uIGJhc2VkIG9uIGVhcmxpZXIgZXZlbnRzXG4gICAgICovXG4gICAgcHVibGljIHVwZGF0ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5rZXlzUHJlc3NlZC5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnYXJyb3dsZWZ0JzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy54IC09IHRoaXMuc3BlZWQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnYXJyb3d1cCc6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMueSAtPSB0aGlzLnNwZWVkO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ2Fycm93cmlnaHQnOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnggKz0gdGhpcy5zcGVlZDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdhcnJvd2Rvd24nOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnkgKz0gdGhpcy5zcGVlZDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vQ2hlY2tzIHRvIHN0YXkgaW4gYm91bmRzXG4gICAgICAgIGlmICh0aGlzLnggPCAwKSB7XG4gICAgICAgICAgICB0aGlzLnggPSAwO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnkgPCAwKSB7XG4gICAgICAgICAgICB0aGlzLnkgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnggPiAod2luZG93Lm91dGVyV2lkdGggLSB0aGlzLndpZHRoKSkge1xuICAgICAgICAgICAgdGhpcy54ID0gKHdpbmRvdy5vdXRlcldpZHRoIC0gdGhpcy53aWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMueSA+IChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gdGhpcy5oZWlnaHQpKSB7XG4gICAgICAgICAgICB0aGlzLnkgPSAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAtIHRoaXMuaGVpZ2h0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZWwuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgke3RoaXMueH1weCwgJHt0aGlzLnl9cHgpYDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgcGxheWVyIHdoZW4gYSBibG9jayBnb3QgY2F1Z2h0XG4gICAgICpcbiAgICAgKiBAcGFyYW0gYmxvY2tcbiAgICAgKi9cbiAgICBwdWJsaWMgYmxvY2tDYXVnaHQoYmxvY2s6IEJsb2NrKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3BlZWQgKz0gdGhpcy5zcGVlZEluY3JlYXNlRmFjdG9yO1xuICAgICAgICB0aGlzLndpZHRoICs9IHRoaXMuZ3Jvd3RoRmFjdG9yO1xuICAgICAgICB0aGlzLmhlaWdodCArPSB0aGlzLmdyb3d0aEZhY3RvcjtcblxuICAgICAgICB0aGlzLmVsLnN0eWxlLmhlaWdodCA9IGAke3RoaXMuaGVpZ2h0fXB4YDtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS53aWR0aCA9IGAke3RoaXMud2lkdGh9cHhgO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLmJvcmRlclJhZGl1cyA9IGAke3RoaXMud2lkdGh9cHhgO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGJsb2NrLmNvbG9yO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsZWFuIHVwIVxuICAgICAqL1xuICAgIHB1YmxpYyBkZXN0cm95KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmVsLnJlbW92ZSgpO1xuICAgICAgICBXaW5kb3dFdmVudEhhbmRsZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bi5wbGF5ZXInKTtcbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleXVwLnBsYXllcicpO1xuICAgIH1cbn1cbiIsImltcG9ydCBjb25maWcgZnJvbSAnLi4vY29uZmlnLmpzb24nO1xuaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL2hlbHBlcnMvZG9tZWxlbWVudFwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUaW1lciBleHRlbmRzIERvbUVsZW1lbnQge1xuICAgIHNlY29uZHM6IG51bWJlciA9IGNvbmZpZy5nYW1lLnNlY29uZHNQZXJMZXZlbDtcbiAgICBpbnRlcnZhbElkOiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ3RpbWVyJywgLTEsIC0xLCAnbGV2ZWwnKTtcblxuICAgICAgICB0aGlzLnJlbmRlclRlbXBsYXRlKCk7XG4gICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LmFkZCgnbWVzc2FnZScsICdpcy1wcmltYXJ5Jyk7XG4gICAgICAgIHRoaXMuZWwucXVlcnlTZWxlY3RvcignLnNlY29uZHMnKS5pbm5lckhUTUwgPSB0aGlzLnNlY29uZHMudG9TdHJpbmcoKTtcblxuICAgICAgICB0aGlzLmludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzLnVwZGF0ZSgpLCAxMDAwKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb3VudGRvd24gb2Ygc2Vjb25kc1xuICAgICAqL1xuICAgIHByaXZhdGUgdXBkYXRlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNlY29uZHMtLTtcbiAgICAgICAgdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcuc2Vjb25kcycpLmlubmVySFRNTCA9IHRoaXMuc2Vjb25kcy50b1N0cmluZygpO1xuXG4gICAgICAgIGlmICh0aGlzLnNlY29uZHMgPD0gMykge1xuICAgICAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QucmVtb3ZlKCdpcy1wcmltYXJ5Jyk7XG4gICAgICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoJ2lzLWRhbmdlcicpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QuYWRkKCdpcy1wcmltYXJ5Jyk7XG4gICAgICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWRhbmdlcicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuc2Vjb25kcyA9PT0gMCkge1xuICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCd0aW1lcjpkb25lJykpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGRlc3Ryb3koKTogdm9pZCB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbElkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZW1wbGF0ZSBuZWVkZWQgdG8gc2hvdyBtb3JlIGVsZW1lbnRzXG4gICAgICovXG4gICAgcHJpdmF0ZSByZW5kZXJUZW1wbGF0ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5lbC5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVzc2FnZS1ib2R5XCI+XG4gICAgICAgICAgICAgICAgPHNwYW4+dGltZTogPC9zcGFuPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwic2Vjb25kc1wiPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICBgO1xuICAgIH1cbn1cbiIsImltcG9ydCBjb25maWcgZnJvbSAnLi4vY29uZmlnLmpzb24nO1xuaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL2hlbHBlcnMvZG9tZWxlbWVudFwiO1xuaW1wb3J0IEJsb2NrIGZyb20gXCIuL2Jsb2NrXCI7XG5pbXBvcnQgUGxheWVyIGZyb20gXCIuL3BsYXllclwiO1xuaW1wb3J0IFRpbWVyIGZyb20gXCIuL3RpbWVyXCI7XG5pbXBvcnQgVXRpbHMgZnJvbSBcIi4uL2hlbHBlcnMvdXRpbHNcIjtcbmltcG9ydCBXaW5kb3dFdmVudEhhbmRsZXIgZnJvbSBcIi4uL2hlbHBlcnMvd2luZG93ZXZlbnRoYW5kbGVyXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExldmVsIGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgcHJpdmF0ZSByZWFkb25seSB0b3RhbEJsb2NrczogbnVtYmVyO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgc2NvcmVQZXJCbG9jazogbnVtYmVyO1xuICAgIHByaXZhdGUgYmxvY2tzOiBCbG9ja1tdID0gW107XG4gICAgcHJpdmF0ZSBwbGF5ZXI6IFBsYXllcjtcbiAgICBwcml2YXRlIHRpbWVyOiBUaW1lcjtcbiAgICBwdWJsaWMgZmFpbGVkID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3Rvcih0b3RhbEJsb2NrczogbnVtYmVyLCBzY29yZVBlckJsb2NrOiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIoJ2xldmVsJywgMCwgMCk7XG5cbiAgICAgICAgdGhpcy50b3RhbEJsb2NrcyA9IHRvdGFsQmxvY2tzO1xuICAgICAgICB0aGlzLnNjb3JlUGVyQmxvY2sgPSBzY29yZVBlckJsb2NrO1xuICAgICAgICB0aGlzLnBsYXllciA9IG5ldyBQbGF5ZXIoKTtcbiAgICAgICAgdGhpcy50aW1lciA9IG5ldyBUaW1lcigpO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50b3RhbEJsb2NrczsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLmJsb2Nrcy5wdXNoKG5ldyBCbG9jayhVdGlscy5nZXRSYW5kb21Db2xvcigpLCBVdGlscy5nZXRSYW5kb21JbnQoY29uZmlnLmdhbWUuYmxvY2tTcGVlZC5taW4sIGNvbmZpZy5nYW1lLmJsb2NrU3BlZWQubWF4KSwgVXRpbHMuZ2V0UmFuZG9tSW50KGNvbmZpZy5nYW1lLmJsb2NrUGl4ZWxzLm1pbiwgY29uZmlnLmdhbWUuYmxvY2tQaXhlbHMubWF4KSwgVXRpbHMuZ2V0UmFuZG9tSW50KGNvbmZpZy5nYW1lLmJsb2NrUGl4ZWxzLm1pbiwgY29uZmlnLmdhbWUuYmxvY2tQaXhlbHMubWF4KSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RpbWVyOmRvbmUnLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmZhaWxlZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmRlc3Ryb3koJ2xldmVsOmZhaWxlZCcpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgZm9yIGNvbGxpc2lvbiBhbmQgcG90ZW50aWFsIHN1Y2Nlc3Mgb2YgdGhpcyBsZXZlbFxuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMucGxheWVyLnVwZGF0ZSgpO1xuICAgICAgICB0aGlzLmJsb2Nrcy5mb3JFYWNoKChibG9jaywgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGJsb2NrLnVwZGF0ZSgpO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuY2hlY2tDb2xsaXNpb24odGhpcy5wbGF5ZXIuZ2V0Q2xpZW50UmVhY3QoKSwgYmxvY2suZ2V0Q2xpZW50UmVhY3QoKSkgJiYgdGhpcy5mYWlsZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuYmxvY2tDYXVnaHQoYmxvY2spO1xuICAgICAgICAgICAgICAgIGJsb2NrLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJsb2Nrcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnbGV2ZWw6c2NvcmVVcGRhdGUnLCB7ZGV0YWlsOiB7c2NvcmU6IHRoaXMuc2NvcmVQZXJCbG9ja319KSk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ibG9ja3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVzdHJveSgnbGV2ZWw6c3VjY2VzcycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVzdHJveSBvYmplY3QgJiB0aW1lciBhbmQgdHJpZ2dlciBldmVudCB0byBub3RpZnkgdGhlIHdvcmxkIGFib3V0IHRoZSBzdGF0dXMgb2YgdGhpcyBsZXZlbFxuICAgICAqXG4gICAgICogQHBhcmFtIGV2ZW50VHlwZVxuICAgICAqL1xuICAgIHByaXZhdGUgZGVzdHJveShldmVudFR5cGU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICB0aGlzLnRpbWVyLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLmJsb2Nrcy5mb3JFYWNoKChibG9jaywgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGJsb2NrLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMuYmxvY2tzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH0pO1xuICAgICAgICBXaW5kb3dFdmVudEhhbmRsZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigndGltZXI6ZG9uZScpO1xuICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoZXZlbnRUeXBlKSk7XG4gICAgICAgIHRoaXMuZWwucmVtb3ZlKCk7XG4gICAgfVxufVxuIiwiaW1wb3J0IEdhbWUgZnJvbSAnLi9nYW1lJztcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IG5ldyBHYW1lKCkpO1xuIiwiaW1wb3J0IGNvbmZpZyBmcm9tICcuL2NvbmZpZy5qc29uJztcbmltcG9ydCBHVUkgZnJvbSAnLi9ndWkvZ3VpJztcbmltcG9ydCBMZXZlbCBmcm9tIFwiLi9sZXZlbC9sZXZlbFwiO1xuaW1wb3J0IERhdGFTZXJ2aWNlIGZyb20gXCIuL2RhdGFzZXJ2aWNlXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWUge1xuICAgIHByaXZhdGUgbGV2ZWwhOiBMZXZlbDtcbiAgICBwcml2YXRlIGxldmVsc1BlckdhbWU6IG51bWJlciA9IGNvbmZpZy5nYW1lLmxldmVsc1BlckdhbWU7XG4gICAgcHJpdmF0ZSBjdXJyZW50TGV2ZWxzUGxheWVkOiBudW1iZXIgPSAwO1xuICAgIHByaXZhdGUgc3RhcnRFbGVtZW50c1BlckxldmVsOiBudW1iZXIgPSBjb25maWcuZ2FtZS5zdGFydEVsZW1lbnRzUGVyTGV2ZWw7XG4gICAgcHJpdmF0ZSBlbGVtZW50c0luY3JlYXNlUGVyTGV2ZWw6IG51bWJlciA9IGNvbmZpZy5nYW1lLmVsZW1lbnRzSW5jcmVhc2VQZXJMZXZlbDtcbiAgICBwcml2YXRlIHNjb3JlUGVyRWxlbWVudDogbnVtYmVyID0gY29uZmlnLmdhbWUuc2NvcmVQZXJFbGVtZW50O1xuICAgIHByaXZhdGUgcmVhZG9ubHkgbWF4U2NvcmU6IG51bWJlcjtcbiAgICBwcml2YXRlIGd1aTogR1VJO1xuICAgIHByaXZhdGUgZGF0YVNlcnZpY2U6IERhdGFTZXJ2aWNlO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuZ3VpID0gbmV3IEdVSSgpO1xuICAgICAgICB0aGlzLm1heFNjb3JlID0gdGhpcy5jYWxjdWxhdGVNYXhTY29yZSgpO1xuICAgICAgICB0aGlzLmdhbWVMb29wKCk7XG4gICAgICAgIHRoaXMuZGF0YVNlcnZpY2UgPSBEYXRhU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuXG4gICAgICAgIFsnbGV2ZWw6c3VjY2VzcycsICdsZXZlbDpmYWlsZWQnXS5tYXAoKGV2ZW50VHlwZSkgPT4ge1xuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCAoZSkgPT4gdGhpcy51cGRhdGUoZS50eXBlKSk7XG4gICAgICAgIH0pO1xuICAgICAgICBbJ2dhbWU6c3RhcnQ6Y2xpY2snLCAnbGV2ZWw6c3VjY2VzczpjbGljaycsICdsZXZlbDpmYWlsZWQ6Y2xpY2snXS5tYXAoKGV2ZW50VHlwZSkgPT4ge1xuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCAoKSA9PiB0aGlzLnN0YXJ0TmV3TGV2ZWwoKSk7XG4gICAgICAgIH0pO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZ2FtZTplbmQ6Y2xpY2snLCAoKSA9PiB0aGlzLnJlc3RhcnQoKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlIHRoZSBzY29yZSB3aXRoIGF2YWlsYWJsZSBwYXJhbWV0ZXJzXG4gICAgICpcbiAgICAgKiBAdG9kbyBEbyBJIHJlYWxseSBuZWVkIHRvIGRvIHRoaXMgc28gaW5lZmZpY2llbnQuLj9cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgICAqL1xuICAgIHByaXZhdGUgY2FsY3VsYXRlTWF4U2NvcmUoKTogbnVtYmVyIHtcbiAgICAgICAgbGV0IG1heFNjb3JlID0gMDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmxldmVsc1BlckdhbWU7IGkrKykge1xuICAgICAgICAgICAgbGV0IGVsZW1lbnRzID0gdGhpcy5zdGFydEVsZW1lbnRzUGVyTGV2ZWwgKyAoaSA9PT0gMCA/IDAgOiAodGhpcy5lbGVtZW50c0luY3JlYXNlUGVyTGV2ZWwgKiBpKSk7XG4gICAgICAgICAgICBtYXhTY29yZSArPSAoZWxlbWVudHMgKiB0aGlzLnNjb3JlUGVyRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG1heFNjb3JlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBvbmx5IHBsYWNlIGZvciBhIHJlcXVlc3RBbmltYXRpb25GcmFtZVxuICAgICAqL1xuICAgIHByaXZhdGUgZ2FtZUxvb3AoKTogdm9pZCB7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5sZXZlbCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMubGV2ZWwudXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMuZ2FtZUxvb3AoKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIHRoZSBnYW1lIGJ5IGVpdGhlciB0aGUgZW5kIG9yIGFueXRoaW5nIGluIGJldHdlZW4gbGV2ZWxzXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZVxuICAgICAqL1xuICAgIHByaXZhdGUgdXBkYXRlKHR5cGU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICB0aGlzLmN1cnJlbnRMZXZlbHNQbGF5ZWQrKztcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudExldmVsc1BsYXllZCA9PT0gdGhpcy5sZXZlbHNQZXJHYW1lKSB7XG4gICAgICAgICAgICB0aGlzLmd1aS5nYW1lRW5kKHRoaXMubWF4U2NvcmUpO1xuICAgICAgICAgICAgdGhpcy5zYXZlU2NvcmUoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZ3VpLmxldmVsRG9uZSh0eXBlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaW1lIHRvIHN0YXJ0IGEgbmV3IGxldmVsIHdpdGggbWFkbmVzc1xuICAgICAqL1xuICAgIHByaXZhdGUgc3RhcnROZXdMZXZlbCgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMubGV2ZWwgJiYgdGhpcy5sZXZlbC5mYWlsZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0RWxlbWVudHNQZXJMZXZlbCArPSB0aGlzLmVsZW1lbnRzSW5jcmVhc2VQZXJMZXZlbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGRlbGV0ZSB0aGlzLmxldmVsO1xuICAgICAgICB0aGlzLmd1aS5uZXdMZXZlbCgpO1xuXG4gICAgICAgIHRoaXMubGV2ZWwgPSBuZXcgTGV2ZWwodGhpcy5zdGFydEVsZW1lbnRzUGVyTGV2ZWwsIHRoaXMuc2NvcmVQZXJFbGVtZW50KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTdGFydCBldmVyeXRoaW5nIGZyb20gdGhlIGJlZ2lubmluZ1xuICAgICAqL1xuICAgIHByaXZhdGUgcmVzdGFydCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5ndWkucmVzdGFydCgpO1xuICAgICAgICB0aGlzLmN1cnJlbnRMZXZlbHNQbGF5ZWQgPSAwO1xuICAgICAgICB0aGlzLnN0YXJ0RWxlbWVudHNQZXJMZXZlbCA9IGNvbmZpZy5nYW1lLnN0YXJ0RWxlbWVudHNQZXJMZXZlbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxsIHRoZSBkYXRhIHNlcnZpY2UgYW5kIGxldCBpdCBkbyBpdHMgbWFnaWNcbiAgICAgKi9cbiAgICBwcml2YXRlIHNhdmVTY29yZSgpOiB2b2lkIHtcbiAgICAgICAgbGV0IHNjb3JlID0gdGhpcy5ndWkuZ2V0U2NvcmUoKTtcbiAgICAgICAgdGhpcy5kYXRhU2VydmljZS5zYXZlU2NvcmUoc2NvcmUpLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YS5lcnJvciA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2dhbWU6c2NvcmVTYXZlZCcsIHtkZXRhaWw6IHtkYXRhfX0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==