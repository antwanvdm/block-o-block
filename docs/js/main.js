!function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e){e.exports={game:{levelsPerGame:1,startElementsPerLevel:5,elementsIncreasePerLevel:5,scorePerElement:10,secondsPerLevel:10,blockSpeed:{min:1,max:5},blockPixels:{min:10,max:150},player:{growthFactor:1.5,speed:3,speedIncreaseFactor:.2}},functionalities:{mLab:!0},mLab:{baseUrl:"https://api.mlab.com/api/1",apiKey:"X17utv1FH2dFTeUo4yhNGL54sA7CY2jS",databaseName:"typescript_scores",collectionName:"scores"}}},function(e,t,s){"use strict";s.r(t);var i=s(0);class r{constructor(e,t,s,i=""){this.x=t,this.y=s,this.el=document.createElement("div");let r=document.getElementById("main");if(null===r)throw new Error("<main> element doesn't exist!");if(this.x>-1&&this.y>-1&&(this.el.style.transform=`translate(${this.x}px, ${this.y}px)`),this.el.classList.add(`game-${e}`),""===i)r.appendChild(this.el);else{let e=document.querySelector(`.game-${i}`);if(null===e)throw new Error(`<.game-${i}> element doesn't exist!`);e.appendChild(this.el)}}getClientReact(){return this.el.getBoundingClientRect()}}class a extends r{constructor(){super("score",-1,-1,"gui"),this.score=0,this.renderTemplate(),this.el.querySelector(".score-count").innerHTML=this.score.toString(),this.el.classList.add("message","is-warning")}get(){return this.score}update(e,t=!1){this.score=t?e:this.score+e,this.el.querySelector(".score-count").innerHTML=this.score.toString()}renderTemplate(){this.el.innerHTML='\n            <div class="message-body">\n                <span>score: </span>\n                <span class="score-count"></span>\n            </div>\n        '}}class n{static addEventListener(e,t){n.functionMap[e]=t,window.addEventListener(e.split(".")[0],n.functionMap[e])}static removeEventListener(e){window.removeEventListener(e.split(".")[0],n.functionMap[e]),delete n.functionMap[e]}}n.functionMap={};class o extends r{constructor(){super("messagescreen",-1,-1,"gui"),this.isActive=!1,this.messages={"game:start":{header:"Welcome to Block-o-Block!",body:"It's time to catch them blocks!<br/><br/>Use your arrow keys to move your player around and press space to start.<br/><br/>Press -<strong>H</strong>- to view the highscore list",className:"is-info"},"game:end":{header:"Your game is over!",body:"You made it, your final score is __SCORE__ out of max __MAX_SCORE__ points.<br/><br/>Thanks for playing, press space to restart the madness.<br/><br/>Press -<strong>H</strong>- to view the highscore list",className:"is-success"},"level:success":{header:"YEAH! Level completed!",body:"Performing like a boss! Press space to proceed to the next level and catch even more blocks",className:"is-success"},"level:failed":{header:"AAH! Level failed!",body:"Try again and show us what you're made off! Press space to restart this level",className:"is-danger"}},this.el.classList.add("message"),this.renderTemplate(),this.show("game:start"),n.addEventListener("keyup.messagescreen",e=>this.keyBoardHandler(e))}keyBoardHandler(e){" "===e.key&&!0===this.isActive&&window.dispatchEvent(new Event(`${this.currentEvent}:click`))}show(e,t={}){let s=this.messages[e].header,i=this.messages[e].body;for(let e in t)i=i.replace(e,t[e]);this.el.querySelector(".message-header").innerHTML=s,this.el.querySelector(".message-body").innerHTML=i,this.el.classList.add("show",this.messages[e].className),this.currentEvent=e,this.isActive=!0}hide(){this.el.classList.remove("show","is-info","is-success","is-danger"),this.isActive=!1}renderTemplate(){this.el.innerHTML='\n            <div class="message-header"></div>\n            <div class="message-body"></div>\n        '}}class h{constructor(){this.endPointList=`/databases/${i.mLab.databaseName}/collections/${i.mLab.collectionName}?apiKey=${i.mLab.apiKey}`,this.endPointSave=`/databases/${i.mLab.databaseName}/collections/${i.mLab.collectionName}?apiKey=${i.mLab.apiKey}`,this.disabledMessage="Dataservice is disabled or you are offline",this.offlineUserScores=[],n.addEventListener("online.dataservice",()=>this.saveScoreToMlab())}static getInstance(){return h.instance||(h.instance=new h),h.instance}saveScore(e){if(!1===i.functionalities.mLab||!1===window.navigator.onLine)return this.offlineUserScores.push(e),this.disabled();let t=`${i.mLab.baseUrl}${this.endPointSave}`;return fetch(t,{body:JSON.stringify({score:e}),headers:{"content-type":"application/json"},method:"POST",mode:"cors"}).then(e=>e.json())}getScores(){if(!1===i.functionalities.mLab||!1===window.navigator.onLine)return new Promise(e=>{e(JSON.parse(localStorage.getItem("scores")))});let e=`${i.mLab.baseUrl}${this.endPointList}&s={"score": -1}&l=10`;return fetch(e,{mode:"cors"}).then(e=>e.json()).then(e=>localStorage.getItem("scores")===JSON.stringify(e)?JSON.parse(localStorage.getItem("scores")):(localStorage.setItem("scores",JSON.stringify(e)),e))}saveScoreToMlab(){this.offlineUserScores.length>0&&Promise.all(this.offlineUserScores.map(e=>this.saveScore(e))).then(()=>{this.offlineUserScores=[]})}disabled(){return new Promise(e=>{e({error:this.disabledMessage})})}}class l extends r{constructor(){super("highscorelist",-1,-1,"gui"),this.el.classList.add("message","is-warning"),this.renderTemplate(),this.tBody=this.el.querySelector(".tbody"),this.dataService=h.getInstance(),this.loadScoreData(),window.addEventListener("game:scoreSaved",e=>this.updateData(e.detail.data))}loadScoreData(e=!1){this.dataService.getScores().then(t=>{this.scores=t,this.tBody.innerHTML=this.getTbodyTemplate(),!0===e&&this.el.classList.add("show")})}updateData(e){((0===this.scores.length?-1:this.scores[this.scores.length-1].score)<e.score||this.scores.length<10)&&(this.scores.push(e),this.scores.sort((e,t)=>t.score-e.score),this.scores.splice(10,1),this.tBody.innerHTML=this.getTbodyTemplate())}show(){void 0===this.scores?this.loadScoreData(!0):this.el.classList.add("show")}hide(){this.el.classList.remove("show")}getTbodyTemplate(){return`\n            ${this.scores.map((e,t)=>`<tr>\n                <td>${t+1}</td>\n                <td>${e._id.$oid}</td>\n                <td>${e.score.toString()}</td>\n            </tr>`).join("")}\n        `}renderTemplate(){this.el.innerHTML='\n            <div class="message-header">\n                <p>Top 10 High Scores (press -<strong>ESC</strong>- to return)</p>\n            </div>\n            <div class="message-body">\n                <table class="table">\n                    <thead>\n                    <tr>\n                        <th>#</th>\n                        <th>MongoID</th>\n                        <th>Score</th>\n                    </tr>\n                    </thead>\n                    <tbody class="tbody"></tbody>\n                </table>\n            </div>\n        '}}class d extends r{constructor(){super("gui",-1,-1),this.highScoreListVisible=!1,this.score=new a,this.messageScreen=new o,window.addEventListener("level:scoreUpdate",e=>this.score.update(e.detail.score)),this.highScoreList=new l,n.addEventListener("keyup.highscorelist",e=>this.keyBoardHandler(e))}keyBoardHandler(e){let t=e.key.toLowerCase();"h"===t&&!1===this.highScoreListVisible?(this.highScoreListVisible=!0,this.highScoreList.show()):"escape"===t&&!0===this.highScoreListVisible&&(this.highScoreListVisible=!1,this.highScoreList.hide())}levelDone(e){this.messageScreen.show(e)}newLevel(){this.messageScreen.hide()}gameEnd(e){this.messageScreen.show("game:end",{__SCORE__:this.score.get().toString(),__MAX_SCORE__:e.toString()})}restart(){this.messageScreen.hide(),this.messageScreen.show("game:start"),this.score.update(0,!0)}getScore(){return this.score.get()}}class c{static getRandomColor(){let e=Math.round,t=Math.random;return`rgba(${e(255*t())},${e(255*t())},${e(255*t())},1)`}static getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}static checkCollision(e,t){return e.left<=t.right&&t.left<=e.right&&e.top<=t.bottom&&t.top<=e.bottom}}class m extends r{constructor(e,t,s,i){super("block",0,0,"level"),this.destination={x:0,y:0},this.speed=t,this.width=s,this.height=i,this.color=e,this.el.style.backgroundImage=`repeating-linear-gradient(${c.getRandomInt(0,360)}deg, #000000, #000000 ${c.getRandomInt(2,10)}px, ${this.color} 10px, ${this.color} ${c.getRandomInt(20,40)}px)`,this.el.style.width=`${this.width}px`,this.el.style.height=`${this.height}px`,this.x=c.getRandomInt(0,window.outerWidth-this.width),this.y=c.getRandomInt(0,document.documentElement.clientHeight-this.height),this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}destroy(){this.el.remove()}update(){this.x>this.destination.x-this.speed&&this.x<this.destination.x+this.speed&&(this.destination.x=c.getRandomInt(0,window.outerWidth-this.width)),this.y>this.destination.y-this.speed&&this.y<this.destination.y+this.speed&&(this.destination.y=c.getRandomInt(0,document.documentElement.clientHeight-this.height)),this.destination.x>=this.x?this.x+=this.speed:this.x-=this.speed,this.destination.y>=this.y?this.y+=this.speed:this.y-=this.speed,this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}}class g extends r{constructor(){super("player",0,0,"level"),this.height=10,this.width=10,this.growthFactor=i.game.player.growthFactor,this.speed=i.game.player.speed,this.speedIncreaseFactor=i.game.player.speedIncreaseFactor,this.keysAllowed=["arrowleft","arrowup","arrowright","arrowdown"],this.keysPressed=[],this.x=window.outerWidth/2-this.width/2,this.y=document.documentElement.clientHeight/2-this.height/2,this.el.style.width=`${this.width}px`,this.el.style.height=`${this.height}px`,this.el.style.borderRadius=`${this.width}px`,n.addEventListener("keydown.player",e=>this.keyDownHandler(e)),n.addEventListener("keyup.player",e=>this.keyUpHandler(e))}keyDownHandler(e){let t=e.key.toLowerCase();this.keysAllowed.indexOf(t)>-1&&-1===this.keysPressed.indexOf(t)&&this.keysPressed.push(t)}keyUpHandler(e){let t=e.key.toLowerCase(),s=this.keysPressed.indexOf(t);this.keysAllowed.indexOf(t)>-1&&s>-1&&this.keysPressed.splice(s,1)}update(){this.keysPressed.forEach(e=>{switch(e){case"arrowleft":this.x-=this.speed;break;case"arrowup":this.y-=this.speed;break;case"arrowright":this.x+=this.speed;break;case"arrowdown":this.y+=this.speed;break;default:return}}),this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x>window.outerWidth-this.width&&(this.x=window.outerWidth-this.width),this.y>document.documentElement.clientHeight-this.height&&(this.y=document.documentElement.clientHeight-this.height),this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}blockCaught(e){this.speed+=this.speedIncreaseFactor,this.width+=this.growthFactor,this.height+=this.growthFactor,this.el.style.height=`${this.height}px`,this.el.style.width=`${this.width}px`,this.el.style.borderRadius=`${this.width}px`,this.el.style.backgroundColor=e.color}destroy(){this.el.remove(),n.removeEventListener("keydown.player"),n.removeEventListener("keyup.player")}}class p extends r{constructor(){super("timer",-1,-1,"level"),this.seconds=i.game.secondsPerLevel,this.renderTemplate(),this.el.classList.add("message","is-primary"),this.el.querySelector(".seconds").innerHTML=this.seconds.toString(),this.intervalId=setInterval(()=>this.update(),1e3)}update(){this.seconds--,this.el.querySelector(".seconds").innerHTML=this.seconds.toString(),this.seconds<=3?(this.el.classList.remove("is-primary"),this.el.classList.add("is-danger")):(this.el.classList.add("is-primary"),this.el.classList.remove("is-danger")),0===this.seconds&&window.dispatchEvent(new Event("timer:done"))}destroy(){clearInterval(this.intervalId)}renderTemplate(){this.el.innerHTML='\n            <div class="message-body">\n                <span>time: </span>\n                <span class="seconds"></span>\n            </div>\n        '}}class u extends r{constructor(e,t){super("level",0,0),this.blocks=[],this.failed=!1,this.totalBlocks=e,this.scorePerBlock=t,this.player=new g,this.timer=new p;for(let e=0;e<this.totalBlocks;e++)this.blocks.push(new m(c.getRandomColor(),c.getRandomInt(i.game.blockSpeed.min,i.game.blockSpeed.max),c.getRandomInt(i.game.blockPixels.min,i.game.blockPixels.max),c.getRandomInt(i.game.blockPixels.min,i.game.blockPixels.max)));n.addEventListener("timer:done",()=>{this.failed=!0,this.destroy("level:failed")})}update(){this.player.update(),this.blocks.forEach((e,t)=>{e.update(),c.checkCollision(this.player.getClientReact(),e.getClientReact())&&!1===this.failed&&(this.player.blockCaught(e),e.destroy(),this.blocks.splice(t,1),window.dispatchEvent(new CustomEvent("level:scoreUpdate",{detail:{score:this.scorePerBlock}})),0===this.blocks.length&&this.destroy("level:success"))})}destroy(e){this.timer.destroy(),this.player.destroy(),this.blocks.forEach((e,t)=>{e.destroy(),this.blocks.splice(t,1)}),n.removeEventListener("timer:done"),window.dispatchEvent(new Event(e)),this.el.remove()}}window.addEventListener("load",()=>new class{constructor(){this.levelsPerGame=i.game.levelsPerGame,this.currentLevelsPlayed=0,this.startElementsPerLevel=i.game.startElementsPerLevel,this.elementsIncreasePerLevel=i.game.elementsIncreasePerLevel,this.scorePerElement=i.game.scorePerElement,this.gui=new d,this.maxScore=this.calculateMaxScore(),this.gameLoop(),this.dataService=h.getInstance(),["level:success","level:failed"].map(e=>{window.addEventListener(e,e=>this.update(e.type))}),["game:start:click","level:success:click","level:failed:click"].map(e=>{window.addEventListener(e,()=>this.startNewLevel())}),window.addEventListener("game:end:click",()=>this.restart())}calculateMaxScore(){let e=0;for(let t=0;t<this.levelsPerGame;t++)e+=(this.startElementsPerLevel+(0===t?0:this.elementsIncreasePerLevel*t))*this.scorePerElement;return e}gameLoop(){void 0!==this.level&&this.level.update(),requestAnimationFrame(()=>this.gameLoop())}update(e){if(this.currentLevelsPlayed++,this.currentLevelsPlayed===this.levelsPerGame)return this.gui.gameEnd(this.maxScore),void this.saveScore();this.gui.levelDone(e)}startNewLevel(){this.level&&!1===this.level.failed&&(this.startElementsPerLevel+=this.elementsIncreasePerLevel),delete this.level,this.gui.newLevel(),this.level=new u(this.startElementsPerLevel,this.scorePerElement)}restart(){this.gui.restart(),this.currentLevelsPlayed=0,this.startElementsPerLevel=i.game.startElementsPerLevel,delete this.level}saveScore(){let e=this.gui.getScore();this.dataService.saveScore(e).then(e=>{void 0===e.error&&window.dispatchEvent(new CustomEvent("game:scoreSaved",{detail:{data:e}}))})}})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vZGV2L2hlbHBlcnMvZG9tZWxlbWVudC50cyIsIndlYnBhY2s6Ly8vLi9kZXYvZ3VpL3Njb3JlLnRzIiwid2VicGFjazovLy8uL2Rldi9oZWxwZXJzL3dpbmRvd2V2ZW50aGFuZGxlci50cyIsIndlYnBhY2s6Ly8vLi9kZXYvZ3VpL21lc3NhZ2VzY3JlZW4udHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2RhdGFzZXJ2aWNlLnRzIiwid2VicGFjazovLy8uL2Rldi9ndWkvaGlnaHNjb3JlbGlzdC50cyIsIndlYnBhY2s6Ly8vLi9kZXYvZ3VpL2d1aS50cyIsIndlYnBhY2s6Ly8vLi9kZXYvaGVscGVycy91dGlscy50cyIsIndlYnBhY2s6Ly8vLi9kZXYvbGV2ZWwvYmxvY2sudHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2xldmVsL3BsYXllci50cyIsIndlYnBhY2s6Ly8vLi9kZXYvbGV2ZWwvdGltZXIudHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2xldmVsL2xldmVsLnRzIiwid2VicGFjazovLy8uL2Rldi9tYWluLnRzIiwid2VicGFjazovLy8uL2Rldi9nYW1lLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsInZhbHVlIiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJEb21FbGVtZW50IiwiW29iamVjdCBPYmplY3RdIiwidHlwZSIsIngiLCJ5IiwicGFyZW50Q2xhc3MiLCJ0aGlzIiwiZWwiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJtYWluIiwiZ2V0RWxlbWVudEJ5SWQiLCJFcnJvciIsInN0eWxlIiwidHJhbnNmb3JtIiwiY2xhc3NMaXN0IiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJwYXJlbnRFbCIsInF1ZXJ5U2VsZWN0b3IiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJzY29yZV9TY29yZSIsInN1cGVyIiwic2NvcmUiLCJyZW5kZXJUZW1wbGF0ZSIsImlubmVySFRNTCIsInRvU3RyaW5nIiwicmVzZXQiLCJXaW5kb3dFdmVudEhhbmRsZXIiLCJldmVudCIsImZ1bmMiLCJmdW5jdGlvbk1hcCIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJzcGxpdCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJtZXNzYWdlc2NyZWVuX01lc3NhZ2VTY3JlZW4iLCJpc0FjdGl2ZSIsIm1lc3NhZ2VzIiwiZ2FtZTpzdGFydCIsImhlYWRlciIsImJvZHkiLCJjbGFzc05hbWUiLCJnYW1lOmVuZCIsImxldmVsOnN1Y2Nlc3MiLCJsZXZlbDpmYWlsZWQiLCJzaG93IiwiZSIsImtleUJvYXJkSGFuZGxlciIsImtleSIsImRpc3BhdGNoRXZlbnQiLCJFdmVudCIsImN1cnJlbnRFdmVudCIsImJvZHlSZXBsYWNlbWVudHMiLCJtZXNzYWdlSGVhZGVyIiwibWVzc2FnZUJvZHkiLCJyZXBsYWNlbWVudCIsInJlcGxhY2UiLCJyZW1vdmUiLCJkYXRhc2VydmljZV9EYXRhU2VydmljZSIsImVuZFBvaW50TGlzdCIsImNvbmZpZyIsIm1MYWIiLCJkYXRhYmFzZU5hbWUiLCJjb2xsZWN0aW9uTmFtZSIsImFwaUtleSIsImVuZFBvaW50U2F2ZSIsImRpc2FibGVkTWVzc2FnZSIsIm9mZmxpbmVVc2VyU2NvcmVzIiwic2F2ZVNjb3JlVG9NbGFiIiwiaW5zdGFuY2UiLCJmdW5jdGlvbmFsaXRpZXMiLCJuYXZpZ2F0b3IiLCJvbkxpbmUiLCJwdXNoIiwiZGlzYWJsZWQiLCJ1cmwiLCJiYXNlVXJsIiwiZmV0Y2giLCJKU09OIiwic3RyaW5naWZ5IiwiaGVhZGVycyIsImNvbnRlbnQtdHlwZSIsIm1ldGhvZCIsIm1vZGUiLCJ0aGVuIiwicmVzcG9uc2UiLCJqc29uIiwiUHJvbWlzZSIsInJlc29sdmUiLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJkYXRhIiwic2V0SXRlbSIsImxlbmd0aCIsImFsbCIsIm1hcCIsInNhdmVTY29yZSIsImVycm9yIiwiaGlnaHNjb3JlbGlzdF9IaWdoU2NvcmVMaXN0IiwidEJvZHkiLCJkYXRhU2VydmljZSIsImdldEluc3RhbmNlIiwibG9hZFNjb3JlRGF0YSIsInVwZGF0ZURhdGEiLCJkZXRhaWwiLCJzaG93U2NyZWVuIiwiZ2V0U2NvcmVzIiwic2NvcmVzIiwiZ2V0VGJvZHlUZW1wbGF0ZSIsInNvcnQiLCJhIiwiYiIsInNwbGljZSIsIml0ZW0iLCJpbmRleCIsIl9pZCIsIiRvaWQiLCJqb2luIiwiZ3VpX0dVSSIsImhpZ2hTY29yZUxpc3RWaXNpYmxlIiwibWVzc2FnZVNjcmVlbiIsInVwZGF0ZSIsImhpZ2hTY29yZUxpc3QiLCJ0b0xvd2VyQ2FzZSIsImhpZGUiLCJtYXhTY29yZSIsIl9fU0NPUkVfXyIsIl9fTUFYX1NDT1JFX18iLCJVdGlscyIsIk1hdGgiLCJyb3VuZCIsInJhbmRvbSIsIm1pbiIsIm1heCIsImZsb29yIiwibGVmdCIsInJpZ2h0IiwidG9wIiwiYm90dG9tIiwiYmxvY2tfQmxvY2siLCJjb2xvciIsInNwZWVkIiwid2lkdGgiLCJoZWlnaHQiLCJkZXN0aW5hdGlvbiIsImJhY2tncm91bmRJbWFnZSIsImdldFJhbmRvbUludCIsIm91dGVyV2lkdGgiLCJkb2N1bWVudEVsZW1lbnQiLCJjbGllbnRIZWlnaHQiLCJwbGF5ZXJfUGxheWVyIiwiZ3Jvd3RoRmFjdG9yIiwiZ2FtZSIsInBsYXllciIsInNwZWVkSW5jcmVhc2VGYWN0b3IiLCJrZXlzQWxsb3dlZCIsImtleXNQcmVzc2VkIiwiYm9yZGVyUmFkaXVzIiwia2V5RG93bkhhbmRsZXIiLCJrZXlVcEhhbmRsZXIiLCJpbmRleE9mIiwia2V5UHJlc3NlZFBvc2l0aW9uIiwiZm9yRWFjaCIsImJsb2NrIiwiYmFja2dyb3VuZENvbG9yIiwidGltZXJfVGltZXIiLCJzZWNvbmRzIiwic2Vjb25kc1BlckxldmVsIiwiaW50ZXJ2YWxJZCIsInNldEludGVydmFsIiwiY2xlYXJJbnRlcnZhbCIsImxldmVsX0xldmVsIiwidG90YWxCbG9ja3MiLCJzY29yZVBlckJsb2NrIiwiYmxvY2tzIiwiZmFpbGVkIiwidGltZXIiLCJnZXRSYW5kb21Db2xvciIsImJsb2NrU3BlZWQiLCJibG9ja1BpeGVscyIsImRlc3Ryb3kiLCJjaGVja0NvbGxpc2lvbiIsImdldENsaWVudFJlYWN0IiwiYmxvY2tDYXVnaHQiLCJDdXN0b21FdmVudCIsImV2ZW50VHlwZSIsImxldmVsc1BlckdhbWUiLCJjdXJyZW50TGV2ZWxzUGxheWVkIiwic3RhcnRFbGVtZW50c1BlckxldmVsIiwiZWxlbWVudHNJbmNyZWFzZVBlckxldmVsIiwic2NvcmVQZXJFbGVtZW50IiwiZ3VpIiwiY2FsY3VsYXRlTWF4U2NvcmUiLCJnYW1lTG9vcCIsInN0YXJ0TmV3TGV2ZWwiLCJyZXN0YXJ0IiwibGV2ZWwiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJnYW1lRW5kIiwibGV2ZWxEb25lIiwibmV3TGV2ZWwiLCJnZXRTY29yZSJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEdBQ0FLLGNBQUEsRUFDQUMsWUFBQSxFQUNBQyxJQUFBTixLQU1BWixFQUFBbUIsRUFBQSxTQUFBakIsR0FDQVksT0FBQUMsZUFBQWIsRUFBQSxjQUFpRGtCLE9BQUEsS0FJakRwQixFQUFBcUIsRUFBQSxTQUFBbEIsR0FDQSxJQUFBUyxFQUFBVCxLQUFBbUIsV0FDQSxXQUEyQixPQUFBbkIsRUFBQSxTQUMzQixXQUFpQyxPQUFBQSxHQUVqQyxPQURBSCxFQUFBVSxFQUFBRSxFQUFBLElBQUFBLEdBQ0FBLEdBSUFaLEVBQUFhLEVBQUEsU0FBQVUsRUFBQUMsR0FBc0QsT0FBQVYsT0FBQVcsVUFBQUMsZUFBQW5CLEtBQUFnQixFQUFBQyxJQUd0RHhCLEVBQUEyQixFQUFBLEdBSUEzQixJQUFBNEIsRUFBQSwyZENuRWNDLEVBV1ZDLFlBQVlDLEVBQWNDLEVBQVdDLEVBQVdDLEVBQXNCLElBQ2xFQyxLQUFLSCxFQUFJQSxFQUNURyxLQUFLRixFQUFJQSxFQUVURSxLQUFLQyxHQUFLQyxTQUFTQyxjQUFjLE9BQ2pDLElBQUlDLEVBQU9GLFNBQVNHLGVBQWUsUUFDbkMsR0FBYSxPQUFURCxFQUNBLE1BQU0sSUFBSUUsTUFBTSxpQ0FTcEIsR0FMSU4sS0FBS0gsR0FBSyxHQUFLRyxLQUFLRixHQUFLLElBQ3pCRSxLQUFLQyxHQUFHTSxNQUFNQyx1QkFBeUJSLEtBQUtILFFBQVFHLEtBQUtGLFFBRTdERSxLQUFLQyxHQUFHUSxVQUFVQyxZQUFZZCxLQUVWLEtBQWhCRyxFQUNBSyxFQUFLTyxZQUFZWCxLQUFLQyxRQUNuQixDQUNILElBQUlXLEVBQVdWLFNBQVNXLHVCQUF1QmQsS0FDL0MsR0FBaUIsT0FBYmEsRUFDQSxNQUFNLElBQUlOLGdCQUFnQlAsNkJBRTlCYSxFQUFTRCxZQUFZWCxLQUFLQyxLQU8zQk4saUJBQ0gsT0FBT0ssS0FBS0MsR0FBR2EsK0JDeENUQyxVQUFxQnJCLEVBRy9CQyxjQUNJcUIsTUFBTSxTQUFVLEdBQUksRUFBRyxPQUhuQmhCLEtBQUFpQixNQUFnQixFQUtwQmpCLEtBQUtrQixpQkFDTGxCLEtBQUtDLEdBQUdZLGNBQWMsZ0JBQWdCTSxVQUFZbkIsS0FBS2lCLE1BQU1HLFdBQzdEcEIsS0FBS0MsR0FBR1EsVUFBVUMsSUFBSSxVQUFXLGNBUTlCZixNQUNILE9BQU9LLEtBQUtpQixNQVNUdEIsT0FBT3NCLEVBQWVJLEdBQWlCLEdBQzFDckIsS0FBS2lCLE1BQVFJLEVBQVFKLEVBQVFqQixLQUFLaUIsTUFBUUEsRUFDMUNqQixLQUFLQyxHQUFHWSxjQUFjLGdCQUFnQk0sVUFBWW5CLEtBQUtpQixNQUFNRyxXQU16RHpCLGlCQUNKSyxLQUFLQyxHQUFHa0IsVUFBWSx5S0NyQ2RHLEVBU0gzQix3QkFBd0I0QixFQUFlQyxHQUMxQ0YsRUFBbUJHLFlBQVlGLEdBQVNDLEVBQ3hDRSxPQUFPQyxpQkFBaUJKLEVBQU1LLE1BQU0sS0FBSyxHQUFJTixFQUFtQkcsWUFBWUYsSUFRekU1QiwyQkFBMkI0QixHQUM5QkcsT0FBT0csb0JBQW9CTixFQUFNSyxNQUFNLEtBQUssR0FBSU4sRUFBbUJHLFlBQVlGLFdBQ3hFRCxFQUFtQkcsWUFBWUYsSUFwQjNCRCxFQUFBRyxxQkNFTEssVUFBNkJwQyxFQTJCdkNDLGNBQ0lxQixNQUFNLGlCQUFrQixHQUFJLEVBQUcsT0ExQjNCaEIsS0FBQStCLFVBQW9CLEVBRXBCL0IsS0FBQWdDLFVBQ0pDLGNBQ0lDLE9BQVUsNEJBQ1ZDLEtBQVEsbUxBQ1JDLFVBQWEsV0FFakJDLFlBQ0lILE9BQVUscUJBQ1ZDLEtBQVEsOE1BQ1JDLFVBQWEsY0FFakJFLGlCQUNJSixPQUFVLHlCQUNWQyxLQUFRLDhGQUNSQyxVQUFhLGNBRWpCRyxnQkFDSUwsT0FBVSxxQkFDVkMsS0FBUSxnRkFDUkMsVUFBYSxjQU1qQnBDLEtBQUtDLEdBQUdRLFVBQVVDLElBQUksV0FFdEJWLEtBQUtrQixpQkFDTGxCLEtBQUt3QyxLQUFLLGNBQ1ZsQixFQUFtQkssaUJBQWlCLHNCQUF3QmMsR0FBcUJ6QyxLQUFLMEMsZ0JBQWdCRCxJQVFsRzlDLGdCQUFnQjhDLEdBQ04sTUFBVkEsRUFBRUUsTUFBaUMsSUFBbEIzQyxLQUFLK0IsVUFDdEJMLE9BQU9rQixjQUFjLElBQUlDLFNBQVM3QyxLQUFLOEMsdUJBVXhDbkQsS0FBS0MsRUFBY21ELE1BQ3RCLElBQUlDLEVBQWdCaEQsS0FBS2dDLFNBQVNwQyxHQUFNc0MsT0FDcENlLEVBQWNqRCxLQUFLZ0MsU0FBU3BDLEdBQU11QyxLQUN0QyxJQUFLLElBQUllLEtBQWVILEVBQ3BCRSxFQUFjQSxFQUFZRSxRQUFRRCxFQUFhSCxFQUFpQkcsSUFHcEVsRCxLQUFLQyxHQUFHWSxjQUFjLG1CQUFtQk0sVUFBWTZCLEVBQ3JEaEQsS0FBS0MsR0FBR1ksY0FBYyxpQkFBaUJNLFVBQVk4QixFQUVuRGpELEtBQUtDLEdBQUdRLFVBQVVDLElBQUksT0FBUVYsS0FBS2dDLFNBQVNwQyxHQUFNd0MsV0FDbERwQyxLQUFLOEMsYUFBZWxELEVBQ3BCSSxLQUFLK0IsVUFBVyxFQU1icEMsT0FDSEssS0FBS0MsR0FBR1EsVUFBVTJDLE9BQU8sT0FBUSxVQUFXLGFBQWMsYUFDMURwRCxLQUFLK0IsVUFBVyxFQU1acEMsaUJBQ0pLLEtBQUtDLEdBQUdrQixVQUFZLGtIQ2hGZGtDLEVBUVYxRCxjQUxRSyxLQUFBc0QsMkJBQXFDQyxFQUFPQyxLQUFLQyw0QkFBNEJGLEVBQU9DLEtBQUtFLHlCQUF5QkgsRUFBT0MsS0FBS0csU0FDOUgzRCxLQUFBNEQsMkJBQXFDTCxFQUFPQyxLQUFLQyw0QkFBNEJGLEVBQU9DLEtBQUtFLHlCQUF5QkgsRUFBT0MsS0FBS0csU0FDOUgzRCxLQUFBNkQsZ0JBQTBCLDZDQUMxQjdELEtBQUE4RCxxQkFHSnhDLEVBQW1CSyxpQkFBaUIscUJBQXNCLElBQU0zQixLQUFLK0QsbUJBUWxFcEUscUJBSUgsT0FISzBELEVBQVlXLFdBQ2JYLEVBQVlXLFNBQVcsSUFBSVgsR0FFeEJBLEVBQVlXLFNBU2hCckUsVUFBVXNCLEdBQ2IsSUFBb0MsSUFBaENzQyxFQUFPVSxnQkFBZ0JULE9BQThDLElBQTVCOUIsT0FBT3dDLFVBQVVDLE9BRTFELE9BREFuRSxLQUFLOEQsa0JBQWtCTSxLQUFLbkQsR0FDckJqQixLQUFLcUUsV0FHaEIsSUFBSUMsS0FBU2YsRUFBT0MsS0FBS2UsVUFBVXZFLEtBQUs0RCxlQUN4QyxPQUFPWSxNQUFNRixHQUNUbkMsS0FBTXNDLEtBQUtDLFdBQ1B6RCxNQUFPQSxJQUVYMEQsU0FDSUMsZUFBZ0Isb0JBRXBCQyxPQUFRLE9BQ1JDLEtBQU0sU0FDUEMsS0FBS0MsR0FBWUEsRUFBU0MsUUFRMUJ0RixZQUNILElBQW9DLElBQWhDNEQsRUFBT1UsZ0JBQWdCVCxPQUE4QyxJQUE1QjlCLE9BQU93QyxVQUFVQyxPQUMxRCxPQUFPLElBQUllLFFBQVNDLElBQ2hCQSxFQUFRVixLQUFLVyxNQUFNQyxhQUFhQyxRQUFRLGNBSWhELElBQUloQixLQUFTZixFQUFPQyxLQUFLZSxVQUFVdkUsS0FBS3NELG9DQUN4QyxPQUFPa0IsTUFBTUYsR0FDVFEsS0FBTSxTQUNQQyxLQUFLQyxHQUFZQSxFQUFTQyxRQUFRRixLQUFNUSxHQUNuQ0YsYUFBYUMsUUFBUSxZQUFjYixLQUFLQyxVQUFVYSxHQUMzQ2QsS0FBS1csTUFBTUMsYUFBYUMsUUFBUSxZQUV2Q0QsYUFBYUcsUUFBUSxTQUFVZixLQUFLQyxVQUFVYSxJQUN2Q0EsSUFRWDVGLGtCQUNBSyxLQUFLOEQsa0JBQWtCMkIsT0FBUyxHQUNoQ1AsUUFBUVEsSUFBSTFGLEtBQUs4RCxrQkFBa0I2QixJQUFLMUUsR0FBVWpCLEtBQUs0RixVQUFVM0UsS0FBUzhELEtBQUssS0FDM0UvRSxLQUFLOEQsdUJBVVRuRSxXQUNKLE9BQU8sSUFBSXVGLFFBQVNDLElBQ2hCQSxHQUFTVSxNQUFTN0YsS0FBSzZELDJCQzVGckJpQyxVQUE2QnBHLEVBS3ZDQyxjQUNJcUIsTUFBTSxpQkFBa0IsR0FBSSxFQUFHLE9BQy9CaEIsS0FBS0MsR0FBR1EsVUFBVUMsSUFBSSxVQUFXLGNBRWpDVixLQUFLa0IsaUJBQ0xsQixLQUFLK0YsTUFBUS9GLEtBQUtDLEdBQUdZLGNBQWMsVUFFbkNiLEtBQUtnRyxZQUFjM0MsRUFBWTRDLGNBQy9CakcsS0FBS2tHLGdCQUVMeEUsT0FBT0MsaUJBQWlCLGtCQUFvQmMsR0FBTXpDLEtBQUttRyxXQUFZMUQsRUFBa0IyRCxPQUFPYixPQVF4RjVGLGNBQWMwRyxHQUFzQixHQUN4Q3JHLEtBQUtnRyxZQUFZTSxZQUFZdkIsS0FBTVEsSUFDL0J2RixLQUFLdUcsT0FBU2hCLEVBQ2R2RixLQUFLK0YsTUFBTTVFLFVBQVluQixLQUFLd0csb0JBRVQsSUFBZkgsR0FDQXJHLEtBQUtDLEdBQUdRLFVBQVVDLElBQUksVUFVMUJmLFdBQVc0RixLQUVpQyxJQUF2QnZGLEtBQUt1RyxPQUFPZCxRQUFnQixFQUFJekYsS0FBS3VHLE9BQU92RyxLQUFLdUcsT0FBT2QsT0FBUyxHQUFHeEUsT0FDcEVzRSxFQUFLdEUsT0FBU2pCLEtBQUt1RyxPQUFPZCxPQUFTLE1BRXhEekYsS0FBS3VHLE9BQU9uQyxLQUFLbUIsR0FDakJ2RixLQUFLdUcsT0FBT0UsS0FBSyxDQUFDQyxFQUFHQyxJQUFNQSxFQUFFMUYsTUFBUXlGLEVBQUV6RixPQUN2Q2pCLEtBQUt1RyxPQUFPSyxPQUFPLEdBQUksR0FDdkI1RyxLQUFLK0YsTUFBTTVFLFVBQVluQixLQUFLd0csb0JBTzdCN0csWUFDd0IsSUFBaEJLLEtBQUt1RyxPQUNadkcsS0FBS2tHLGVBQWMsR0FFbkJsRyxLQUFLQyxHQUFHUSxVQUFVQyxJQUFJLFFBT3ZCZixPQUNISyxLQUFLQyxHQUFHUSxVQUFVMkMsT0FBTyxRQVFyQnpELG1CQUNKLHVCQUNNSyxLQUFLdUcsT0FBT1osSUFBSSxDQUFDa0IsRUFBTUMsaUNBQ2ZBLEVBQVEsK0JBQ1JELEVBQUtFLElBQUlDLGtDQUNUSCxFQUFLNUYsTUFBTUcsc0NBQ2I2RixLQUFLLGdCQU9idEgsaUJBQ0pLLEtBQUtDLEdBQUdrQixVQUFZLDRqQkNyRmQrRixVQUFtQnhILEVBTTdCQyxjQUNJcUIsTUFBTSxPQUFRLEdBQUksR0FIZGhCLEtBQUFtSCxzQkFBZ0MsRUFLcENuSCxLQUFLaUIsTUFBUSxJQUFJRixFQUNqQmYsS0FBS29ILGNBQWdCLElBQUl0RixFQUN6QkosT0FBT0MsaUJBQWlCLG9CQUFzQmMsR0FBTXpDLEtBQUtpQixNQUFNb0csT0FBUTVFLEVBQWtCMkQsT0FBT25GLFFBRWhHakIsS0FBS3NILGNBQWdCLElBQUl4QixFQUN6QnhFLEVBQW1CSyxpQkFBaUIsc0JBQXdCYyxHQUFxQnpDLEtBQUswQyxnQkFBZ0JELElBUTFHOUMsZ0JBQWdCOEMsR0FDWixJQUFJRSxFQUFNRixFQUFFRSxJQUFJNEUsY0FDSixNQUFSNUUsSUFBNkMsSUFBOUIzQyxLQUFLbUgsc0JBQ3BCbkgsS0FBS21ILHNCQUF1QixFQUM1Qm5ILEtBQUtzSCxjQUFjOUUsUUFDSixXQUFSRyxJQUFrRCxJQUE5QjNDLEtBQUttSCx1QkFDaENuSCxLQUFLbUgsc0JBQXVCLEVBQzVCbkgsS0FBS3NILGNBQWNFLFFBU3BCN0gsVUFBVUMsR0FDYkksS0FBS29ILGNBQWM1RSxLQUFLNUMsR0FNckJELFdBQ0hLLEtBQUtvSCxjQUFjSSxPQVFoQjdILFFBQVE4SCxHQUNYekgsS0FBS29ILGNBQWM1RSxLQUFLLFlBQ3BCa0YsVUFBYTFILEtBQUtpQixNQUFNbEMsTUFBTXFDLFdBQzlCdUcsY0FBaUJGLEVBQVNyRyxhQU8zQnpCLFVBQ0hLLEtBQUtvSCxjQUFjSSxPQUNuQnhILEtBQUtvSCxjQUFjNUUsS0FBSyxjQUN4QnhDLEtBQUtpQixNQUFNb0csT0FBTyxHQUFHLEdBTWxCMUgsV0FDSCxPQUFPSyxLQUFLaUIsTUFBTWxDLGFDaEZaNkksRUFJVmpJLHdCQUNJLElBQUlqQixFQUFJbUosS0FBS0MsTUFBTzlJLEVBQUk2SSxLQUFLRSxPQUM3QixjQUFlckosRUFEMEIsSUFDeEJNLFFBQVlOLEVBRFksSUFDVk0sUUFBWU4sRUFERixJQUNJTSxVQVFqRFcsb0JBQW9CcUksRUFBYUMsR0FDN0IsT0FBT0osS0FBS0ssTUFBTUwsS0FBS0UsVUFBWUUsRUFBTUQsRUFBTSxJQUFNQSxFQVF6RHJJLHNCQUFzQitHLEVBQWVDLEdBQ2pDLE9BQVFELEVBQUV5QixNQUFReEIsRUFBRXlCLE9BQ2hCekIsRUFBRXdCLE1BQVF6QixFQUFFMEIsT0FDWjFCLEVBQUUyQixLQUFPMUIsRUFBRTJCLFFBQ1gzQixFQUFFMEIsS0FBTzNCLEVBQUU0QixjQ3hCVEMsVUFBcUI3SSxFQU8vQkMsWUFBWTZJLEVBQWVDLEVBQWVDLEVBQWVDLEdBQ3JEM0gsTUFBTSxRQUFTLEVBQUcsRUFBRyxTQUhqQmhCLEtBQUE0SSxhQUFlL0ksRUFBRyxFQUFHQyxFQUFHLEdBSzVCRSxLQUFLeUksTUFBUUEsRUFDYnpJLEtBQUswSSxNQUFRQSxFQUNiMUksS0FBSzJJLE9BQVNBLEVBQ2QzSSxLQUFLd0ksTUFBUUEsRUFFYnhJLEtBQUtDLEdBQUdNLE1BQU1zSSw2Q0FBK0NqQixFQUFNa0IsYUFBYSxFQUFHLDZCQUE2QmxCLEVBQU1rQixhQUFhLEVBQUcsVUFBVTlJLEtBQUt3SSxlQUFleEksS0FBS3dJLFNBQVNaLEVBQU1rQixhQUFhLEdBQUksU0FDek05SSxLQUFLQyxHQUFHTSxNQUFNbUksU0FBVzFJLEtBQUswSSxVQUM5QjFJLEtBQUtDLEdBQUdNLE1BQU1vSSxVQUFZM0ksS0FBSzJJLFdBRS9CM0ksS0FBS0gsRUFBSStILEVBQU1rQixhQUFhLEVBQUlwSCxPQUFPcUgsV0FBYS9JLEtBQUswSSxPQUN6RDFJLEtBQUtGLEVBQUk4SCxFQUFNa0IsYUFBYSxFQUFJNUksU0FBUzhJLGdCQUFnQkMsYUFBZWpKLEtBQUsySSxRQUM3RTNJLEtBQUtDLEdBQUdNLE1BQU1DLHVCQUF5QlIsS0FBS0gsUUFBUUcsS0FBS0YsT0FNdERILFVBQ0hLLEtBQUtDLEdBQUdtRCxTQU1MekQsU0FDQ0ssS0FBS0gsRUFBS0csS0FBSzRJLFlBQVkvSSxFQUFJRyxLQUFLeUksT0FBVXpJLEtBQUtILEVBQUtHLEtBQUs0SSxZQUFZL0ksRUFBSUcsS0FBS3lJLFFBQ2xGekksS0FBSzRJLFlBQVkvSSxFQUFJK0gsRUFBTWtCLGFBQWEsRUFBSXBILE9BQU9xSCxXQUFhL0ksS0FBSzBJLFFBRXJFMUksS0FBS0YsRUFBS0UsS0FBSzRJLFlBQVk5SSxFQUFJRSxLQUFLeUksT0FBVXpJLEtBQUtGLEVBQUtFLEtBQUs0SSxZQUFZOUksRUFBSUUsS0FBS3lJLFFBQ2xGekksS0FBSzRJLFlBQVk5SSxFQUFJOEgsRUFBTWtCLGFBQWEsRUFBSTVJLFNBQVM4SSxnQkFBZ0JDLGFBQWVqSixLQUFLMkksU0FHekYzSSxLQUFLNEksWUFBWS9JLEdBQUtHLEtBQUtILEVBQzNCRyxLQUFLSCxHQUFLRyxLQUFLeUksTUFFZnpJLEtBQUtILEdBQUtHLEtBQUt5SSxNQUdmekksS0FBSzRJLFlBQVk5SSxHQUFLRSxLQUFLRixFQUMzQkUsS0FBS0YsR0FBS0UsS0FBS3lJLE1BRWZ6SSxLQUFLRixHQUFLRSxLQUFLeUksTUFHbkJ6SSxLQUFLQyxHQUFHTSxNQUFNQyx1QkFBeUJSLEtBQUtILFFBQVFHLEtBQUtGLGNDcERuRG9KLFVBQXNCeEosRUFTaENDLGNBQ0lxQixNQUFNLFNBQVUsRUFBRyxFQUFHLFNBVGxCaEIsS0FBQTJJLE9BQWlCLEdBQ2pCM0ksS0FBQTBJLE1BQWdCLEdBQ2hCMUksS0FBQW1KLGFBQXVCNUYsRUFBTzZGLEtBQUtDLE9BQU9GLGFBQzFDbkosS0FBQXlJLE1BQWdCbEYsRUFBTzZGLEtBQUtDLE9BQU9aLE1BQ25DekksS0FBQXNKLG9CQUE4Qi9GLEVBQU82RixLQUFLQyxPQUFPQyxvQkFDakR0SixLQUFBdUosYUFBeUIsWUFBYSxVQUFXLGFBQWMsYUFDL0R2SixLQUFBd0osZUFJSnhKLEtBQUtILEVBQUk2QixPQUFPcUgsV0FBYSxFQUFJL0ksS0FBSzBJLE1BQVEsRUFDOUMxSSxLQUFLRixFQUFJSSxTQUFTOEksZ0JBQWdCQyxhQUFlLEVBQUlqSixLQUFLMkksT0FBUyxFQUVuRTNJLEtBQUtDLEdBQUdNLE1BQU1tSSxTQUFXMUksS0FBSzBJLFVBQzlCMUksS0FBS0MsR0FBR00sTUFBTW9JLFVBQVkzSSxLQUFLMkksV0FDL0IzSSxLQUFLQyxHQUFHTSxNQUFNa0osZ0JBQWtCekosS0FBSzBJLFVBRXJDcEgsRUFBbUJLLGlCQUFpQixpQkFBbUJjLEdBQXFCekMsS0FBSzBKLGVBQWVqSCxJQUNoR25CLEVBQW1CSyxpQkFBaUIsZUFBaUJjLEdBQXFCekMsS0FBSzJKLGFBQWFsSCxJQVF4RjlDLGVBQWU4QyxHQUNuQixJQUFJRSxFQUFNRixFQUFFRSxJQUFJNEUsY0FDWnZILEtBQUt1SixZQUFZSyxRQUFRakgsSUFBUSxJQUF3QyxJQUFuQzNDLEtBQUt3SixZQUFZSSxRQUFRakgsSUFDL0QzQyxLQUFLd0osWUFBWXBGLEtBQUt6QixHQVN0QmhELGFBQWE4QyxHQUNqQixJQUFJRSxFQUFNRixFQUFFRSxJQUFJNEUsY0FDWnNDLEVBQXFCN0osS0FBS3dKLFlBQVlJLFFBQVFqSCxHQUM5QzNDLEtBQUt1SixZQUFZSyxRQUFRakgsSUFBUSxHQUFLa0gsR0FBc0IsR0FDNUQ3SixLQUFLd0osWUFBWTVDLE9BQU9pRCxFQUFvQixHQU83Q2xLLFNBQ0hLLEtBQUt3SixZQUFZTSxRQUFTbkgsSUFDdEIsT0FBUUEsR0FDSixJQUFLLFlBQ0QzQyxLQUFLSCxHQUFLRyxLQUFLeUksTUFDZixNQUVKLElBQUssVUFDRHpJLEtBQUtGLEdBQUtFLEtBQUt5SSxNQUNmLE1BRUosSUFBSyxhQUNEekksS0FBS0gsR0FBS0csS0FBS3lJLE1BQ2YsTUFFSixJQUFLLFlBQ0R6SSxLQUFLRixHQUFLRSxLQUFLeUksTUFDZixNQUVKLFFBQ0ksVUFLUnpJLEtBQUtILEVBQUksSUFDVEcsS0FBS0gsRUFBSSxHQUVURyxLQUFLRixFQUFJLElBQ1RFLEtBQUtGLEVBQUksR0FFVEUsS0FBS0gsRUFBSzZCLE9BQU9xSCxXQUFhL0ksS0FBSzBJLFFBQ25DMUksS0FBS0gsRUFBSzZCLE9BQU9xSCxXQUFhL0ksS0FBSzBJLE9BRW5DMUksS0FBS0YsRUFBS0ksU0FBUzhJLGdCQUFnQkMsYUFBZWpKLEtBQUsySSxTQUN2RDNJLEtBQUtGLEVBQUtJLFNBQVM4SSxnQkFBZ0JDLGFBQWVqSixLQUFLMkksUUFHM0QzSSxLQUFLQyxHQUFHTSxNQUFNQyx1QkFBeUJSLEtBQUtILFFBQVFHLEtBQUtGLE9BUXRESCxZQUFZb0ssR0FDZi9KLEtBQUt5SSxPQUFTekksS0FBS3NKLG9CQUNuQnRKLEtBQUswSSxPQUFTMUksS0FBS21KLGFBQ25CbkosS0FBSzJJLFFBQVUzSSxLQUFLbUosYUFFcEJuSixLQUFLQyxHQUFHTSxNQUFNb0ksVUFBWTNJLEtBQUsySSxXQUMvQjNJLEtBQUtDLEdBQUdNLE1BQU1tSSxTQUFXMUksS0FBSzBJLFVBQzlCMUksS0FBS0MsR0FBR00sTUFBTWtKLGdCQUFrQnpKLEtBQUswSSxVQUNyQzFJLEtBQUtDLEdBQUdNLE1BQU15SixnQkFBa0JELEVBQU12QixNQU1uQzdJLFVBQ0hLLEtBQUtDLEdBQUdtRCxTQUNSOUIsRUFBbUJPLG9CQUFvQixrQkFDdkNQLEVBQW1CTyxvQkFBb0IsdUJDbkhqQ29JLFVBQXFCdkssRUFJL0JDLGNBQ0lxQixNQUFNLFNBQVUsR0FBSSxFQUFHLFNBSjNCaEIsS0FBQWtLLFFBQWtCM0csRUFBTzZGLEtBQUtlLGdCQU0xQm5LLEtBQUtrQixpQkFDTGxCLEtBQUtDLEdBQUdRLFVBQVVDLElBQUksVUFBVyxjQUNqQ1YsS0FBS0MsR0FBR1ksY0FBYyxZQUFZTSxVQUFZbkIsS0FBS2tLLFFBQVE5SSxXQUUzRHBCLEtBQUtvSyxXQUFhQyxZQUFZLElBQU1ySyxLQUFLcUgsU0FBVSxLQU0vQzFILFNBQ0pLLEtBQUtrSyxVQUNMbEssS0FBS0MsR0FBR1ksY0FBYyxZQUFZTSxVQUFZbkIsS0FBS2tLLFFBQVE5SSxXQUV2RHBCLEtBQUtrSyxTQUFXLEdBQ2hCbEssS0FBS0MsR0FBR1EsVUFBVTJDLE9BQU8sY0FDekJwRCxLQUFLQyxHQUFHUSxVQUFVQyxJQUFJLGVBRXRCVixLQUFLQyxHQUFHUSxVQUFVQyxJQUFJLGNBQ3RCVixLQUFLQyxHQUFHUSxVQUFVMkMsT0FBTyxjQUdSLElBQWpCcEQsS0FBS2tLLFNBQ0x4SSxPQUFPa0IsY0FBYyxJQUFJQyxNQUFNLGVBSWhDbEQsVUFDSDJLLGNBQWN0SyxLQUFLb0ssWUFNZnpLLGlCQUNKSyxLQUFLQyxHQUFHa0IsVUFBWSxvS0NyQ2RvSixVQUFxQjdLLEVBUS9CQyxZQUFZNkssRUFBcUJDLEdBQzdCekosTUFBTSxRQUFTLEVBQUcsR0FOZGhCLEtBQUEwSyxVQUdEMUssS0FBQTJLLFFBQVMsRUFLWjNLLEtBQUt3SyxZQUFjQSxFQUNuQnhLLEtBQUt5SyxjQUFnQkEsRUFDckJ6SyxLQUFLcUosT0FBUyxJQUFJSCxFQUNsQmxKLEtBQUs0SyxNQUFRLElBQUlYLEVBRWpCLElBQUssSUFBSWhNLEVBQUksRUFBR0EsRUFBSStCLEtBQUt3SyxZQUFhdk0sSUFDbEMrQixLQUFLMEssT0FBT3RHLEtBQUssSUFBSW1FLEVBQU1YLEVBQU1pRCxpQkFBa0JqRCxFQUFNa0IsYUFBYXZGLEVBQU82RixLQUFLMEIsV0FBVzlDLElBQUt6RSxFQUFPNkYsS0FBSzBCLFdBQVc3QyxLQUFNTCxFQUFNa0IsYUFBYXZGLEVBQU82RixLQUFLMkIsWUFBWS9DLElBQUt6RSxFQUFPNkYsS0FBSzJCLFlBQVk5QyxLQUFNTCxFQUFNa0IsYUFBYXZGLEVBQU82RixLQUFLMkIsWUFBWS9DLElBQUt6RSxFQUFPNkYsS0FBSzJCLFlBQVk5QyxPQUd6UjNHLEVBQW1CSyxpQkFBaUIsYUFBYyxLQUM5QzNCLEtBQUsySyxRQUFTLEVBQ2QzSyxLQUFLZ0wsUUFBUSxrQkFPZHJMLFNBQ0hLLEtBQUtxSixPQUFPaEMsU0FDWnJILEtBQUswSyxPQUFPWixRQUFRLENBQUNDLEVBQU9qRCxLQUN4QmlELEVBQU0xQyxTQUVGTyxFQUFNcUQsZUFBZWpMLEtBQUtxSixPQUFPNkIsaUJBQWtCbkIsRUFBTW1CLG9CQUFxQyxJQUFoQmxMLEtBQUsySyxTQUNuRjNLLEtBQUtxSixPQUFPOEIsWUFBWXBCLEdBQ3hCQSxFQUFNaUIsVUFDTmhMLEtBQUswSyxPQUFPOUQsT0FBT0UsRUFBTyxHQUMxQnBGLE9BQU9rQixjQUFjLElBQUl3SSxZQUFZLHFCQUFzQmhGLFFBQVNuRixNQUFPakIsS0FBS3lLLGtCQUVyRCxJQUF2QnpLLEtBQUswSyxPQUFPakYsUUFDWnpGLEtBQUtnTCxRQUFRLG9CQVdyQnJMLFFBQVEwTCxHQUNackwsS0FBSzRLLE1BQU1JLFVBQ1hoTCxLQUFLcUosT0FBTzJCLFVBQ1poTCxLQUFLMEssT0FBT1osUUFBUSxDQUFDQyxFQUFPakQsS0FDeEJpRCxFQUFNaUIsVUFDTmhMLEtBQUswSyxPQUFPOUQsT0FBT0UsRUFBTyxLQUU5QnhGLEVBQW1CTyxvQkFBb0IsY0FDdkNILE9BQU9rQixjQUFjLElBQUlDLE1BQU13SSxJQUMvQnJMLEtBQUtDLEdBQUdtRCxVQ25FaEIxQixPQUFPQyxpQkFBaUIsT0FBUSxJQUFNLFVDY2xDaEMsY0FUUUssS0FBQXNMLGNBQXdCL0gsRUFBTzZGLEtBQUtrQyxjQUNwQ3RMLEtBQUF1TCxvQkFBOEIsRUFDOUJ2TCxLQUFBd0wsc0JBQWdDakksRUFBTzZGLEtBQUtvQyxzQkFDNUN4TCxLQUFBeUwseUJBQW1DbEksRUFBTzZGLEtBQUtxQyx5QkFDL0N6TCxLQUFBMEwsZ0JBQTBCbkksRUFBTzZGLEtBQUtzQyxnQkFNMUMxTCxLQUFLMkwsSUFBTSxJQUFJekUsRUFDZmxILEtBQUt5SCxTQUFXekgsS0FBSzRMLG9CQUNyQjVMLEtBQUs2TCxXQUNMN0wsS0FBS2dHLFlBQWMzQyxFQUFZNEMsZUFFOUIsZ0JBQWlCLGdCQUFnQk4sSUFBSzBGLElBQ25DM0osT0FBT0MsaUJBQWlCMEosRUFBWTVJLEdBQU16QyxLQUFLcUgsT0FBTzVFLEVBQUU3QyxVQUUzRCxtQkFBb0Isc0JBQXVCLHNCQUFzQitGLElBQUswRixJQUNuRTNKLE9BQU9DLGlCQUFpQjBKLEVBQVcsSUFBTXJMLEtBQUs4TCxtQkFFbERwSyxPQUFPQyxpQkFBaUIsaUJBQWtCLElBQU0zQixLQUFLK0wsV0FTakRwTSxvQkFDSixJQUFJOEgsRUFBVyxFQUNmLElBQUssSUFBSXhKLEVBQUksRUFBR0EsRUFBSStCLEtBQUtzTCxjQUFlck4sSUFFcEN3SixJQURlekgsS0FBS3dMLHVCQUErQixJQUFOdk4sRUFBVSxFQUFLK0IsS0FBS3lMLHlCQUEyQnhOLElBQ3BFK0IsS0FBSzBMLGdCQUVqQyxPQUFPakUsRUFNSDlILGdCQUNzQixJQUFmSyxLQUFLZ00sT0FDWmhNLEtBQUtnTSxNQUFNM0UsU0FFZjRFLHNCQUFzQixJQUFNak0sS0FBSzZMLFlBUTdCbE0sT0FBT0MsR0FFWCxHQURBSSxLQUFLdUwsc0JBQ0R2TCxLQUFLdUwsc0JBQXdCdkwsS0FBS3NMLGNBR2xDLE9BRkF0TCxLQUFLMkwsSUFBSU8sUUFBUWxNLEtBQUt5SCxlQUN0QnpILEtBQUs0RixZQUlUNUYsS0FBSzJMLElBQUlRLFVBQVV2TSxHQU1mRCxnQkFDQUssS0FBS2dNLFFBQStCLElBQXRCaE0sS0FBS2dNLE1BQU1yQixTQUN6QjNLLEtBQUt3TCx1QkFBeUJ4TCxLQUFLeUwsaUNBR2hDekwsS0FBS2dNLE1BQ1poTSxLQUFLMkwsSUFBSVMsV0FFVHBNLEtBQUtnTSxNQUFRLElBQUl6QixFQUFNdkssS0FBS3dMLHNCQUF1QnhMLEtBQUswTCxpQkFNcEQvTCxVQUNKSyxLQUFLMkwsSUFBSUksVUFDVC9MLEtBQUt1TCxvQkFBc0IsRUFDM0J2TCxLQUFLd0wsc0JBQXdCakksRUFBTzZGLEtBQUtvQyw2QkFDbEN4TCxLQUFLZ00sTUFNUnJNLFlBQ0osSUFBSXNCLEVBQVFqQixLQUFLMkwsSUFBSVUsV0FDckJyTSxLQUFLZ0csWUFBWUosVUFBVTNFLEdBQU84RCxLQUFNUSxTQUNWLElBQWZBLEVBQUtNLE9BQ1puRSxPQUFPa0IsY0FBYyxJQUFJd0ksWUFBWSxtQkFBb0JoRixRQUFTYiIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAxKTtcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIERvbUVsZW1lbnQge1xuICAgIHByb3RlY3RlZCBlbDogSFRNTEVsZW1lbnQ7XG4gICAgcHJvdGVjdGVkIHg6IG51bWJlcjtcbiAgICBwcm90ZWN0ZWQgeTogbnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGVcbiAgICAgKiBAcGFyYW0ge251bWJlcn0geFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB5XG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHBhcmVudENsYXNzXG4gICAgICovXG4gICAgY29uc3RydWN0b3IodHlwZTogc3RyaW5nLCB4OiBudW1iZXIsIHk6IG51bWJlciwgcGFyZW50Q2xhc3M6IHN0cmluZyA9ICcnKSB7XG4gICAgICAgIHRoaXMueCA9IHg7XG4gICAgICAgIHRoaXMueSA9IHk7XG5cbiAgICAgICAgdGhpcy5lbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBsZXQgbWFpbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluJyk7XG4gICAgICAgIGlmIChtYWluID09PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCI8bWFpbj4gZWxlbWVudCBkb2Vzbid0IGV4aXN0IVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vLTEgY2hlY2sgaXMgdG8gbGV0IENTUyBkbyBpdHMgb3duIGpvYiBAdG9kbyBjbGVhbmVyIHNvbHV0aW9uP1xuICAgICAgICBpZiAodGhpcy54ID4gLTEgJiYgdGhpcy55ID4gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuZWwuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgke3RoaXMueH1weCwgJHt0aGlzLnl9cHgpYDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoYGdhbWUtJHt0eXBlfWApO1xuXG4gICAgICAgIGlmIChwYXJlbnRDbGFzcyA9PT0gJycpIHtcbiAgICAgICAgICAgIG1haW4uYXBwZW5kQ2hpbGQodGhpcy5lbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZXQgcGFyZW50RWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuZ2FtZS0ke3BhcmVudENsYXNzfWApO1xuICAgICAgICAgICAgaWYgKHBhcmVudEVsID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGA8LmdhbWUtJHtwYXJlbnRDbGFzc30+IGVsZW1lbnQgZG9lc24ndCBleGlzdCFgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBhcmVudEVsLmFwcGVuZENoaWxkKHRoaXMuZWwpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMgQ2xpZW50UmVjdFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRDbGllbnRSZWFjdCgpOiBDbGllbnRSZWN0IHwgRE9NUmVjdCB7XG4gICAgICAgIHJldHVybiB0aGlzLmVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIH1cbn1cbiIsImltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuLi9oZWxwZXJzL2RvbWVsZW1lbnRcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2NvcmUgZXh0ZW5kcyBEb21FbGVtZW50IHtcbiAgICBwcml2YXRlIHNjb3JlOiBudW1iZXIgPSAwO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCdzY29yZScsIC0xLCAtMSwgJ2d1aScpO1xuXG4gICAgICAgIHRoaXMucmVuZGVyVGVtcGxhdGUoKTtcbiAgICAgICAgdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcuc2NvcmUtY291bnQnKS5pbm5lckhUTUwgPSB0aGlzLnNjb3JlLnRvU3RyaW5nKCk7XG4gICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LmFkZCgnbWVzc2FnZScsICdpcy13YXJuaW5nJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgY3VycmVudCBzY29yZVxuICAgICAqXG4gICAgICogQHJldHVybnMge251bWJlcn1cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnNjb3JlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgc2NvcmUgYmFzZWQgb24gYSBDdXN0b20gRXZlbnQgZnJvbSB0aGUgQmxvY2sgb2JqZWN0XG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2NvcmVcbiAgICAgKiBAcGFyYW0gW3Jlc2V0XVxuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGUoc2NvcmU6IG51bWJlciwgcmVzZXQ6IGJvb2xlYW4gPSBmYWxzZSk6IHZvaWQge1xuICAgICAgICB0aGlzLnNjb3JlID0gcmVzZXQgPyBzY29yZSA6IHRoaXMuc2NvcmUgKyBzY29yZTtcbiAgICAgICAgdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcuc2NvcmUtY291bnQnKS5pbm5lckhUTUwgPSB0aGlzLnNjb3JlLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVtcGxhdGUgbmVlZGVkIHRvIHNob3cgbW9yZSBlbGVtZW50c1xuICAgICAqL1xuICAgIHByaXZhdGUgcmVuZGVyVGVtcGxhdGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZWwuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lc3NhZ2UtYm9keVwiPlxuICAgICAgICAgICAgICAgIDxzcGFuPnNjb3JlOiA8L3NwYW4+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJzY29yZS1jb3VudFwiPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICBgO1xuICAgIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFdpbmRvd0V2ZW50SGFuZGxlciB7XG4gICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb25NYXA6IHsgW2s6IHN0cmluZ106IGFueSB9ID0ge307XG5cbiAgICAvKipcbiAgICAgKiBBZGQgbGlzdGVuZXIgdG8gd2luZG93IHdpdGggbmFtZSBzcGFjaW5nXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRcbiAgICAgKiBAcGFyYW0gZnVuY1xuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgYWRkRXZlbnRMaXN0ZW5lcihldmVudDogc3RyaW5nLCBmdW5jOiBhbnkpOiB2b2lkIHtcbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLmZ1bmN0aW9uTWFwW2V2ZW50XSA9IGZ1bmM7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKGV2ZW50LnNwbGl0KCcuJylbMF0sIFdpbmRvd0V2ZW50SGFuZGxlci5mdW5jdGlvbk1hcFtldmVudF0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBsaXN0ZW5lciBmcm9tIHdpbmRvdyB3aXRoIG5hbWUgc3BhY2luZ1xuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50XG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyByZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQuc3BsaXQoJy4nKVswXSwgV2luZG93RXZlbnRIYW5kbGVyLmZ1bmN0aW9uTWFwW2V2ZW50XSk7XG4gICAgICAgIGRlbGV0ZSBXaW5kb3dFdmVudEhhbmRsZXIuZnVuY3Rpb25NYXBbZXZlbnRdO1xuICAgIH1cbn1cbiIsImltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuLi9oZWxwZXJzL2RvbWVsZW1lbnRcIjtcbmltcG9ydCBXaW5kb3dFdmVudEhhbmRsZXIgZnJvbSBcIi4uL2hlbHBlcnMvd2luZG93ZXZlbnRoYW5kbGVyXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1lc3NhZ2VTY3JlZW4gZXh0ZW5kcyBEb21FbGVtZW50IHtcbiAgICBwcml2YXRlIGN1cnJlbnRFdmVudCE6IHN0cmluZztcbiAgICBwcml2YXRlIGlzQWN0aXZlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBwcml2YXRlIG1lc3NhZ2VzOiB7IFtrOiBzdHJpbmddOiB7ICdoZWFkZXInOiBzdHJpbmcsICdib2R5Jzogc3RyaW5nLCAnY2xhc3NOYW1lJzogc3RyaW5nIH0gfSA9IHtcbiAgICAgICAgJ2dhbWU6c3RhcnQnOiB7XG4gICAgICAgICAgICAnaGVhZGVyJzogJ1dlbGNvbWUgdG8gQmxvY2stby1CbG9jayEnLFxuICAgICAgICAgICAgJ2JvZHknOiAnSXRcXCdzIHRpbWUgdG8gY2F0Y2ggdGhlbSBibG9ja3MhPGJyLz48YnIvPlVzZSB5b3VyIGFycm93IGtleXMgdG8gbW92ZSB5b3VyIHBsYXllciBhcm91bmQgYW5kIHByZXNzIHNwYWNlIHRvIHN0YXJ0Ljxici8+PGJyLz5QcmVzcyAtPHN0cm9uZz5IPC9zdHJvbmc+LSB0byB2aWV3IHRoZSBoaWdoc2NvcmUgbGlzdCcsXG4gICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2lzLWluZm8nXG4gICAgICAgIH0sXG4gICAgICAgICdnYW1lOmVuZCc6IHtcbiAgICAgICAgICAgICdoZWFkZXInOiAnWW91ciBnYW1lIGlzIG92ZXIhJyxcbiAgICAgICAgICAgICdib2R5JzogJ1lvdSBtYWRlIGl0LCB5b3VyIGZpbmFsIHNjb3JlIGlzIF9fU0NPUkVfXyBvdXQgb2YgbWF4IF9fTUFYX1NDT1JFX18gcG9pbnRzLjxici8+PGJyLz5UaGFua3MgZm9yIHBsYXlpbmcsIHByZXNzIHNwYWNlIHRvIHJlc3RhcnQgdGhlIG1hZG5lc3MuPGJyLz48YnIvPlByZXNzIC08c3Ryb25nPkg8L3N0cm9uZz4tIHRvIHZpZXcgdGhlIGhpZ2hzY29yZSBsaXN0JyxcbiAgICAgICAgICAgICdjbGFzc05hbWUnOiAnaXMtc3VjY2VzcydcbiAgICAgICAgfSxcbiAgICAgICAgJ2xldmVsOnN1Y2Nlc3MnOiB7XG4gICAgICAgICAgICAnaGVhZGVyJzogJ1lFQUghIExldmVsIGNvbXBsZXRlZCEnLFxuICAgICAgICAgICAgJ2JvZHknOiAnUGVyZm9ybWluZyBsaWtlIGEgYm9zcyEgUHJlc3Mgc3BhY2UgdG8gcHJvY2VlZCB0byB0aGUgbmV4dCBsZXZlbCBhbmQgY2F0Y2ggZXZlbiBtb3JlIGJsb2NrcycsXG4gICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2lzLXN1Y2Nlc3MnXG4gICAgICAgIH0sXG4gICAgICAgICdsZXZlbDpmYWlsZWQnOiB7XG4gICAgICAgICAgICAnaGVhZGVyJzogJ0FBSCEgTGV2ZWwgZmFpbGVkIScsXG4gICAgICAgICAgICAnYm9keSc6ICdUcnkgYWdhaW4gYW5kIHNob3cgdXMgd2hhdCB5b3VcXCdyZSBtYWRlIG9mZiEgUHJlc3Mgc3BhY2UgdG8gcmVzdGFydCB0aGlzIGxldmVsJyxcbiAgICAgICAgICAgICdjbGFzc05hbWUnOiAnaXMtZGFuZ2VyJ1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcignbWVzc2FnZXNjcmVlbicsIC0xLCAtMSwgJ2d1aScpO1xuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoJ21lc3NhZ2UnKTtcblxuICAgICAgICB0aGlzLnJlbmRlclRlbXBsYXRlKCk7XG4gICAgICAgIHRoaXMuc2hvdygnZ2FtZTpzdGFydCcpO1xuICAgICAgICBXaW5kb3dFdmVudEhhbmRsZXIuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAubWVzc2FnZXNjcmVlbicsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB0aGlzLmtleUJvYXJkSGFuZGxlcihlKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIHRoZSBzcGFjZWJhclxuICAgICAqXG4gICAgICogQHBhcmFtIHtLZXlib2FyZEV2ZW50fSBlXG4gICAgICovXG4gICAgcHJpdmF0ZSBrZXlCb2FyZEhhbmRsZXIoZTogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgICAgICBpZiAoZS5rZXkgPT09ICcgJyAmJiB0aGlzLmlzQWN0aXZlID09PSB0cnVlKSB7XG4gICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoYCR7dGhpcy5jdXJyZW50RXZlbnR9OmNsaWNrYCkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2hvdyB0aGUgZGVzaXJlZCBtZXNzYWdlICh0eXBlIG1hdGNoZXMgaW5kZXggaW4gb2JqZWN0KVxuICAgICAqXG4gICAgICogQHBhcmFtIHR5cGVcbiAgICAgKiBAcGFyYW0gW2JvZHlSZXBsYWNlbWVudHNdXG4gICAgICovXG4gICAgcHVibGljIHNob3codHlwZTogc3RyaW5nLCBib2R5UmVwbGFjZW1lbnRzOiB7IFtrOiBzdHJpbmddOiBzdHJpbmcgfSA9IHt9KTogdm9pZCB7XG4gICAgICAgIGxldCBtZXNzYWdlSGVhZGVyID0gdGhpcy5tZXNzYWdlc1t0eXBlXS5oZWFkZXI7XG4gICAgICAgIGxldCBtZXNzYWdlQm9keSA9IHRoaXMubWVzc2FnZXNbdHlwZV0uYm9keTtcbiAgICAgICAgZm9yIChsZXQgcmVwbGFjZW1lbnQgaW4gYm9keVJlcGxhY2VtZW50cykge1xuICAgICAgICAgICAgbWVzc2FnZUJvZHkgPSBtZXNzYWdlQm9keS5yZXBsYWNlKHJlcGxhY2VtZW50LCBib2R5UmVwbGFjZW1lbnRzW3JlcGxhY2VtZW50XSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoJy5tZXNzYWdlLWhlYWRlcicpLmlubmVySFRNTCA9IG1lc3NhZ2VIZWFkZXI7XG4gICAgICAgIHRoaXMuZWwucXVlcnlTZWxlY3RvcignLm1lc3NhZ2UtYm9keScpLmlubmVySFRNTCA9IG1lc3NhZ2VCb2R5O1xuXG4gICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LmFkZCgnc2hvdycsIHRoaXMubWVzc2FnZXNbdHlwZV0uY2xhc3NOYW1lKTtcbiAgICAgICAgdGhpcy5jdXJyZW50RXZlbnQgPSB0eXBlO1xuICAgICAgICB0aGlzLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIaWRlIG1lc3NhZ2Ugb24gc2NyZWVuXG4gICAgICovXG4gICAgcHVibGljIGhpZGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycsICdpcy1pbmZvJywgJ2lzLXN1Y2Nlc3MnLCAnaXMtZGFuZ2VyJyk7XG4gICAgICAgIHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZW1wbGF0ZSBuZWVkZWQgdG8gc2hvdyBtb3JlIGVsZW1lbnRzXG4gICAgICovXG4gICAgcHJpdmF0ZSByZW5kZXJUZW1wbGF0ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5lbC5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVzc2FnZS1oZWFkZXJcIj48L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZXNzYWdlLWJvZHlcIj48L2Rpdj5cbiAgICAgICAgYDtcbiAgICB9XG59XG4iLCJpbXBvcnQgY29uZmlnIGZyb20gJy4vY29uZmlnLmpzb24nO1xuaW1wb3J0IFdpbmRvd0V2ZW50SGFuZGxlciBmcm9tIFwiLi9oZWxwZXJzL3dpbmRvd2V2ZW50aGFuZGxlclwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEYXRhU2VydmljZSB7XG4gICAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IERhdGFTZXJ2aWNlO1xuXG4gICAgcHJpdmF0ZSBlbmRQb2ludExpc3Q6IHN0cmluZyA9IGAvZGF0YWJhc2VzLyR7Y29uZmlnLm1MYWIuZGF0YWJhc2VOYW1lfS9jb2xsZWN0aW9ucy8ke2NvbmZpZy5tTGFiLmNvbGxlY3Rpb25OYW1lfT9hcGlLZXk9JHtjb25maWcubUxhYi5hcGlLZXl9YDtcbiAgICBwcml2YXRlIGVuZFBvaW50U2F2ZTogc3RyaW5nID0gYC9kYXRhYmFzZXMvJHtjb25maWcubUxhYi5kYXRhYmFzZU5hbWV9L2NvbGxlY3Rpb25zLyR7Y29uZmlnLm1MYWIuY29sbGVjdGlvbk5hbWV9P2FwaUtleT0ke2NvbmZpZy5tTGFiLmFwaUtleX1gO1xuICAgIHByaXZhdGUgZGlzYWJsZWRNZXNzYWdlOiBzdHJpbmcgPSAnRGF0YXNlcnZpY2UgaXMgZGlzYWJsZWQgb3IgeW91IGFyZSBvZmZsaW5lJztcbiAgICBwcml2YXRlIG9mZmxpbmVVc2VyU2NvcmVzOiBudW1iZXJbXSA9IFtdO1xuXG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZS5kYXRhc2VydmljZScsICgpID0+IHRoaXMuc2F2ZVNjb3JlVG9NbGFiKCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgY2xhc3MgbmVlZHMgdG8gd29yayBhcyBTaW5nbGVUb24gdG8gcHJldmVudCBkb3VibGUgZGF0YSBjYWxscyBldGMuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7RGF0YVNlcnZpY2V9XG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBEYXRhU2VydmljZSB7XG4gICAgICAgIGlmICghRGF0YVNlcnZpY2UuaW5zdGFuY2UpIHtcbiAgICAgICAgICAgIERhdGFTZXJ2aWNlLmluc3RhbmNlID0gbmV3IERhdGFTZXJ2aWNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIERhdGFTZXJ2aWNlLmluc3RhbmNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN0b3JlIHRoZSBsYXRlc3Qgc2NvcmUgaW4gdGhlIERCXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2NvcmVcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx7fT59XG4gICAgICovXG4gICAgcHVibGljIHNhdmVTY29yZShzY29yZTogbnVtYmVyKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgaWYgKGNvbmZpZy5mdW5jdGlvbmFsaXRpZXMubUxhYiA9PT0gZmFsc2UgfHwgd2luZG93Lm5hdmlnYXRvci5vbkxpbmUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICB0aGlzLm9mZmxpbmVVc2VyU2NvcmVzLnB1c2goc2NvcmUpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB1cmwgPSBgJHtjb25maWcubUxhYi5iYXNlVXJsfSR7dGhpcy5lbmRQb2ludFNhdmV9YDtcbiAgICAgICAgcmV0dXJuIGZldGNoKHVybCwge1xuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIHNjb3JlOiBzY29yZVxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgbW9kZTogJ2NvcnMnXG4gICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIHRoZSBjdXJyZW50IHNjb3JlcyBmcm9tIHRoZSBEQlxuICAgICAqXG4gICAgICogQHJldHVybnMge1Byb21pc2U8W10+fVxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRTY29yZXMoKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgaWYgKGNvbmZpZy5mdW5jdGlvbmFsaXRpZXMubUxhYiA9PT0gZmFsc2UgfHwgd2luZG93Lm5hdmlnYXRvci5vbkxpbmUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Njb3JlcycpKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB1cmwgPSBgJHtjb25maWcubUxhYi5iYXNlVXJsfSR7dGhpcy5lbmRQb2ludExpc3R9JnM9e1wic2NvcmVcIjogLTF9Jmw9MTBgO1xuICAgICAgICByZXR1cm4gZmV0Y2godXJsLCB7XG4gICAgICAgICAgICBtb2RlOiAnY29ycydcbiAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc2NvcmVzJykgPT09IEpTT04uc3RyaW5naWZ5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Njb3JlcycpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Njb3JlcycsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2F2ZSB0aGUgc2NvcmUgdG8gbUxhYiBvbmNlIGJhY2sgb25saW5lXG4gICAgICovXG4gICAgcHJpdmF0ZSBzYXZlU2NvcmVUb01sYWIoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLm9mZmxpbmVVc2VyU2NvcmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIFByb21pc2UuYWxsKHRoaXMub2ZmbGluZVVzZXJTY29yZXMubWFwKChzY29yZSkgPT4gdGhpcy5zYXZlU2NvcmUoc2NvcmUpKSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5vZmZsaW5lVXNlclNjb3JlcyA9IFtdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZW5lcmFsIG1lc3NhZ2Ugd2hlbiB0aGlzIHNlcnZpY2UgaXMgaW5hY3RpdmVcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPHt9Pn1cbiAgICAgKi9cbiAgICBwcml2YXRlIGRpc2FibGVkKCk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgcmVzb2x2ZSh7XCJlcnJvclwiOiB0aGlzLmRpc2FibGVkTWVzc2FnZX0pO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4iLCJpbXBvcnQgRG9tRWxlbWVudCBmcm9tIFwiLi4vaGVscGVycy9kb21lbGVtZW50XCI7XG5pbXBvcnQgRGF0YVNlcnZpY2UgZnJvbSBcIi4uL2RhdGFzZXJ2aWNlXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEhpZ2hTY29yZUxpc3QgZXh0ZW5kcyBEb21FbGVtZW50IHtcbiAgICBwcml2YXRlIGRhdGFTZXJ2aWNlOiBEYXRhU2VydmljZTtcbiAgICBwcml2YXRlIHNjb3JlczogeyBzY29yZTogbnVtYmVyLCBfaWQ6IHsgJG9pZDogc3RyaW5nIH0gfVtdO1xuICAgIHByaXZhdGUgdEJvZHk6IEhUTUxFbGVtZW50O1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCdoaWdoc2NvcmVsaXN0JywgLTEsIC0xLCAnZ3VpJyk7XG4gICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LmFkZCgnbWVzc2FnZScsICdpcy13YXJuaW5nJyk7XG5cbiAgICAgICAgdGhpcy5yZW5kZXJUZW1wbGF0ZSgpO1xuICAgICAgICB0aGlzLnRCb2R5ID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcudGJvZHknKTtcblxuICAgICAgICB0aGlzLmRhdGFTZXJ2aWNlID0gRGF0YVNlcnZpY2UuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgdGhpcy5sb2FkU2NvcmVEYXRhKCk7XG5cbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2dhbWU6c2NvcmVTYXZlZCcsIChlKSA9PiB0aGlzLnVwZGF0ZURhdGEoKGUgYXMgQ3VzdG9tRXZlbnQpLmRldGFpbC5kYXRhKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbCBzY29yZSBsb2FkaW5nXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNob3dTY3JlZW5cbiAgICAgKi9cbiAgICBwcml2YXRlIGxvYWRTY29yZURhdGEoc2hvd1NjcmVlbjogYm9vbGVhbiA9IGZhbHNlKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZGF0YVNlcnZpY2UuZ2V0U2NvcmVzKCkudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zY29yZXMgPSBkYXRhO1xuICAgICAgICAgICAgdGhpcy50Qm9keS5pbm5lckhUTUwgPSB0aGlzLmdldFRib2R5VGVtcGxhdGUoKTtcblxuICAgICAgICAgICAgaWYgKHNob3dTY3JlZW4gPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgY3VycmVudCBzY29yZSBvZiB1c2VyIGluIGF2YWlsYWJsZSBkYXRhXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3t9fSBkYXRhXG4gICAgICovXG4gICAgcHJpdmF0ZSB1cGRhdGVEYXRhKGRhdGE6IHsgc2NvcmU6IG51bWJlciwgX2lkOiB7ICRvaWQ6IHN0cmluZyB9IH0pOiB2b2lkIHtcbiAgICAgICAgLy9DaGVjayBpZiBnaXZlbiBzY29yZSBpcyB0b3AgMTAgd29ydGh5XG4gICAgICAgIGxldCBsb3dlc3RDdXJyZW50U2NvcmUgPSB0aGlzLnNjb3Jlcy5sZW5ndGggPT09IDAgPyAtMSA6IHRoaXMuc2NvcmVzW3RoaXMuc2NvcmVzLmxlbmd0aCAtIDFdLnNjb3JlO1xuICAgICAgICBpZiAobG93ZXN0Q3VycmVudFNjb3JlIDwgZGF0YS5zY29yZSB8fCB0aGlzLnNjb3Jlcy5sZW5ndGggPCAxMCkge1xuICAgICAgICAgICAgLy9VcGRhdGluZyB0aGUgc2NvcmVzIGFycmF5ICYgcHJlc2VudFxuICAgICAgICAgICAgdGhpcy5zY29yZXMucHVzaChkYXRhKTtcbiAgICAgICAgICAgIHRoaXMuc2NvcmVzLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKTtcbiAgICAgICAgICAgIHRoaXMuc2NvcmVzLnNwbGljZSgxMCwgMSk7XG4gICAgICAgICAgICB0aGlzLnRCb2R5LmlubmVySFRNTCA9IHRoaXMuZ2V0VGJvZHlUZW1wbGF0ZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2hvdyB0aGUgaGlnaCBzY29yZSBsaXN0XG4gICAgICovXG4gICAgcHVibGljIHNob3coKTogdm9pZCB7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5zY29yZXMgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWRTY29yZURhdGEodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhpZGUgaXQgcGVyaW9kXG4gICAgICovXG4gICAgcHVibGljIGhpZGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgbWFwcGVkIEhUTUwgPHRyPiBsaXN0IGZvciBhcHBlbmRpbmcgaW4gPHRib2R5PlxuICAgICAqXG4gICAgICogQHJldHVybnMge3N0cmluZ31cbiAgICAgKi9cbiAgICBwcml2YXRlIGdldFRib2R5VGVtcGxhdGUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGBcbiAgICAgICAgICAgICR7dGhpcy5zY29yZXMubWFwKChpdGVtLCBpbmRleCkgPT4gYDx0cj5cbiAgICAgICAgICAgICAgICA8dGQ+JHtpbmRleCArIDF9PC90ZD5cbiAgICAgICAgICAgICAgICA8dGQ+JHtpdGVtLl9pZC4kb2lkfTwvdGQ+XG4gICAgICAgICAgICAgICAgPHRkPiR7aXRlbS5zY29yZS50b1N0cmluZygpfTwvdGQ+XG4gICAgICAgICAgICA8L3RyPmApLmpvaW4oJycpfVxuICAgICAgICBgO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlbXBsYXRlIG5lZWRlZCB0byBzaG93IG1vcmUgZWxlbWVudHNcbiAgICAgKi9cbiAgICBwcml2YXRlIHJlbmRlclRlbXBsYXRlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmVsLmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZXNzYWdlLWhlYWRlclwiPlxuICAgICAgICAgICAgICAgIDxwPlRvcCAxMCBIaWdoIFNjb3JlcyAocHJlc3MgLTxzdHJvbmc+RVNDPC9zdHJvbmc+LSB0byByZXR1cm4pPC9wPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVzc2FnZS1ib2R5XCI+XG4gICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzPVwidGFibGVcIj5cbiAgICAgICAgICAgICAgICAgICAgPHRoZWFkPlxuICAgICAgICAgICAgICAgICAgICA8dHI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8dGg+IzwvdGg+XG4gICAgICAgICAgICAgICAgICAgICAgICA8dGg+TW9uZ29JRDwvdGg+XG4gICAgICAgICAgICAgICAgICAgICAgICA8dGg+U2NvcmU8L3RoPlxuICAgICAgICAgICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgICAgICAgICA8L3RoZWFkPlxuICAgICAgICAgICAgICAgICAgICA8dGJvZHkgY2xhc3M9XCJ0Ym9keVwiPjwvdGJvZHk+XG4gICAgICAgICAgICAgICAgPC90YWJsZT5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICBgO1xuICAgIH1cbn1cbiIsImltcG9ydCBTY29yZSBmcm9tICcuL3Njb3JlJztcbmltcG9ydCBNZXNzYWdlU2NyZWVuIGZyb20gJy4vbWVzc2FnZXNjcmVlbic7XG5pbXBvcnQgRG9tRWxlbWVudCBmcm9tIFwiLi4vaGVscGVycy9kb21lbGVtZW50XCI7XG5pbXBvcnQgSGlnaFNjb3JlTGlzdCBmcm9tIFwiLi9oaWdoc2NvcmVsaXN0XCI7XG5pbXBvcnQgV2luZG93RXZlbnRIYW5kbGVyIGZyb20gXCIuLi9oZWxwZXJzL3dpbmRvd2V2ZW50aGFuZGxlclwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHVUkgZXh0ZW5kcyBEb21FbGVtZW50IHtcbiAgICBwcml2YXRlIHNjb3JlOiBTY29yZTtcbiAgICBwcml2YXRlIG1lc3NhZ2VTY3JlZW46IE1lc3NhZ2VTY3JlZW47XG4gICAgcHJpdmF0ZSBoaWdoU2NvcmVMaXN0OiBIaWdoU2NvcmVMaXN0O1xuICAgIHByaXZhdGUgaGlnaFNjb3JlTGlzdFZpc2libGU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcignZ3VpJywgLTEsIC0xKTtcblxuICAgICAgICB0aGlzLnNjb3JlID0gbmV3IFNjb3JlKCk7XG4gICAgICAgIHRoaXMubWVzc2FnZVNjcmVlbiA9IG5ldyBNZXNzYWdlU2NyZWVuKCk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsZXZlbDpzY29yZVVwZGF0ZScsIChlKSA9PiB0aGlzLnNjb3JlLnVwZGF0ZSgoZSBhcyBDdXN0b21FdmVudCkuZGV0YWlsLnNjb3JlKSk7XG5cbiAgICAgICAgdGhpcy5oaWdoU2NvcmVMaXN0ID0gbmV3IEhpZ2hTY29yZUxpc3QoKTtcbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwLmhpZ2hzY29yZWxpc3QnLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4gdGhpcy5rZXlCb2FyZEhhbmRsZXIoZSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSB0aGUgc3BhY2ViYXJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7S2V5Ym9hcmRFdmVudH0gZVxuICAgICAqL1xuICAgIGtleUJvYXJkSGFuZGxlcihlOiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgICAgIGxldCBrZXkgPSBlLmtleS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAoa2V5ID09PSAnaCcgJiYgdGhpcy5oaWdoU2NvcmVMaXN0VmlzaWJsZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHRoaXMuaGlnaFNjb3JlTGlzdFZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5oaWdoU2NvcmVMaXN0LnNob3coKTtcbiAgICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdlc2NhcGUnICYmIHRoaXMuaGlnaFNjb3JlTGlzdFZpc2libGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHRoaXMuaGlnaFNjb3JlTGlzdFZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaGlnaFNjb3JlTGlzdC5oaWRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgd2hlbiBhIGxldmVsIGlzIGRvbmVcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlXG4gICAgICovXG4gICAgcHVibGljIGxldmVsRG9uZSh0eXBlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlU2NyZWVuLnNob3codHlwZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIHdoZW4gYSBuZXcgbGV2ZWwgc3RhcnRzXG4gICAgICovXG4gICAgcHVibGljIG5ld0xldmVsKCk6IHZvaWQge1xuICAgICAgICB0aGlzLm1lc3NhZ2VTY3JlZW4uaGlkZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCB3aGVuIHRoZSBnYW1lIGlzIGRvbmVcbiAgICAgKlxuICAgICAqIEBwYXJhbSBtYXhTY29yZVxuICAgICAqL1xuICAgIHB1YmxpYyBnYW1lRW5kKG1heFNjb3JlOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlU2NyZWVuLnNob3coJ2dhbWU6ZW5kJywge1xuICAgICAgICAgICAgJ19fU0NPUkVfXyc6IHRoaXMuc2NvcmUuZ2V0KCkudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICdfX01BWF9TQ09SRV9fJzogbWF4U2NvcmUudG9TdHJpbmcoKVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgd2hlbiB3ZSBuZWVkIHRvIHJlc3RhcnQsIGdvIHRvIGZpcnN0IHNjcmVlbiBhbmQgc2V0IHNjb3JlIHRvIDBcbiAgICAgKi9cbiAgICBwdWJsaWMgcmVzdGFydCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlU2NyZWVuLmhpZGUoKTtcbiAgICAgICAgdGhpcy5tZXNzYWdlU2NyZWVuLnNob3coJ2dhbWU6c3RhcnQnKTtcbiAgICAgICAgdGhpcy5zY29yZS51cGRhdGUoMCwgdHJ1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge251bWJlcn1cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0U2NvcmUoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NvcmUuZ2V0KCk7XG4gICAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXRpbHMge1xuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAgICovXG4gICAgc3RhdGljIGdldFJhbmRvbUNvbG9yKCk6IHN0cmluZyB7XG4gICAgICAgIGxldCBvID0gTWF0aC5yb3VuZCwgciA9IE1hdGgucmFuZG9tLCBzID0gMjU1O1xuICAgICAgICByZXR1cm4gYHJnYmEoJHtvKHIoKSAqIHMpfSwke28ocigpICogcyl9LCR7byhyKCkgKiBzKX0sMSlgO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBtaW5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gbWF4XG4gICAgICogQHJldHVybnMge251bWJlcn1cbiAgICAgKi9cbiAgICBzdGF0aWMgZ2V0UmFuZG9tSW50KG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpICsgbWluO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7Q2xpZW50UmVjdH0gYVxuICAgICAqIEBwYXJhbSB7Q2xpZW50UmVjdH0gYlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAqL1xuICAgIHN0YXRpYyBjaGVja0NvbGxpc2lvbihhOiBDbGllbnRSZWN0LCBiOiBDbGllbnRSZWN0KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAoYS5sZWZ0IDw9IGIucmlnaHQgJiZcbiAgICAgICAgICAgIGIubGVmdCA8PSBhLnJpZ2h0ICYmXG4gICAgICAgICAgICBhLnRvcCA8PSBiLmJvdHRvbSAmJlxuICAgICAgICAgICAgYi50b3AgPD0gYS5ib3R0b20pO1xuICAgIH1cbn1cbiIsImltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuLi9oZWxwZXJzL2RvbWVsZW1lbnRcIjtcbmltcG9ydCBVdGlscyBmcm9tIFwiLi4vaGVscGVycy91dGlsc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCbG9jayBleHRlbmRzIERvbUVsZW1lbnQge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgc3BlZWQ6IG51bWJlcjtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHdpZHRoOiBudW1iZXI7XG4gICAgcHJpdmF0ZSByZWFkb25seSBoZWlnaHQ6IG51bWJlcjtcbiAgICBwdWJsaWMgY29sb3I6IHN0cmluZztcbiAgICBwcml2YXRlIGRlc3RpbmF0aW9uID0ge3g6IDAsIHk6IDB9O1xuXG4gICAgY29uc3RydWN0b3IoY29sb3I6IHN0cmluZywgc3BlZWQ6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIoJ2Jsb2NrJywgMCwgMCwgJ2xldmVsJyk7XG5cbiAgICAgICAgdGhpcy5zcGVlZCA9IHNwZWVkO1xuICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICB0aGlzLmNvbG9yID0gY29sb3I7XG5cbiAgICAgICAgdGhpcy5lbC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgcmVwZWF0aW5nLWxpbmVhci1ncmFkaWVudCgke1V0aWxzLmdldFJhbmRvbUludCgwLCAzNjApfWRlZywgIzAwMDAwMCwgIzAwMDAwMCAke1V0aWxzLmdldFJhbmRvbUludCgyLCAxMCl9cHgsICR7dGhpcy5jb2xvcn0gMTBweCwgJHt0aGlzLmNvbG9yfSAke1V0aWxzLmdldFJhbmRvbUludCgyMCwgNDApfXB4KWA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUud2lkdGggPSBgJHt0aGlzLndpZHRofXB4YDtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5oZWlnaHQgPSBgJHt0aGlzLmhlaWdodH1weGA7XG5cbiAgICAgICAgdGhpcy54ID0gVXRpbHMuZ2V0UmFuZG9tSW50KDAsICh3aW5kb3cub3V0ZXJXaWR0aCAtIHRoaXMud2lkdGgpKTtcbiAgICAgICAgdGhpcy55ID0gVXRpbHMuZ2V0UmFuZG9tSW50KDAsIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gdGhpcy5oZWlnaHQpKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7dGhpcy54fXB4LCAke3RoaXMueX1weClgO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZXIgZm9yIGNsaWNraW5nIHRoZSBibG9ja3NcbiAgICAgKi9cbiAgICBwdWJsaWMgZGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5lbC5yZW1vdmUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYWluIHVwZGF0ZSBoYW5kbGVyIGZvciB0aGUgZ2FtZSBmb3IgbW92aW5nIG91ciBibG9jayByYW5kb21seSBvdmVyIHRoZSBzY3JlZW5cbiAgICAgKi9cbiAgICBwdWJsaWMgdXBkYXRlKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy54ID4gKHRoaXMuZGVzdGluYXRpb24ueCAtIHRoaXMuc3BlZWQpICYmIHRoaXMueCA8ICh0aGlzLmRlc3RpbmF0aW9uLnggKyB0aGlzLnNwZWVkKSkge1xuICAgICAgICAgICAgdGhpcy5kZXN0aW5hdGlvbi54ID0gVXRpbHMuZ2V0UmFuZG9tSW50KDAsICh3aW5kb3cub3V0ZXJXaWR0aCAtIHRoaXMud2lkdGgpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy55ID4gKHRoaXMuZGVzdGluYXRpb24ueSAtIHRoaXMuc3BlZWQpICYmIHRoaXMueSA8ICh0aGlzLmRlc3RpbmF0aW9uLnkgKyB0aGlzLnNwZWVkKSkge1xuICAgICAgICAgICAgdGhpcy5kZXN0aW5hdGlvbi55ID0gVXRpbHMuZ2V0UmFuZG9tSW50KDAsIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gdGhpcy5oZWlnaHQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmRlc3RpbmF0aW9uLnggPj0gdGhpcy54KSB7XG4gICAgICAgICAgICB0aGlzLnggKz0gdGhpcy5zcGVlZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMueCAtPSB0aGlzLnNwZWVkO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZGVzdGluYXRpb24ueSA+PSB0aGlzLnkpIHtcbiAgICAgICAgICAgIHRoaXMueSArPSB0aGlzLnNwZWVkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy55IC09IHRoaXMuc3BlZWQ7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVsLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHt0aGlzLnh9cHgsICR7dGhpcy55fXB4KWA7XG4gICAgfVxufVxuIiwiaW1wb3J0IGNvbmZpZyBmcm9tICcuLi9jb25maWcuanNvbic7XG5pbXBvcnQgRG9tRWxlbWVudCBmcm9tIFwiLi4vaGVscGVycy9kb21lbGVtZW50XCI7XG5pbXBvcnQgQmxvY2sgZnJvbSBcIi4vYmxvY2tcIjtcbmltcG9ydCBXaW5kb3dFdmVudEhhbmRsZXIgZnJvbSBcIi4uL2hlbHBlcnMvd2luZG93ZXZlbnRoYW5kbGVyXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBsYXllciBleHRlbmRzIERvbUVsZW1lbnQge1xuICAgIHByaXZhdGUgaGVpZ2h0OiBudW1iZXIgPSAxMDtcbiAgICBwcml2YXRlIHdpZHRoOiBudW1iZXIgPSAxMDtcbiAgICBwcml2YXRlIGdyb3d0aEZhY3RvcjogbnVtYmVyID0gY29uZmlnLmdhbWUucGxheWVyLmdyb3d0aEZhY3RvcjtcbiAgICBwcml2YXRlIHNwZWVkOiBudW1iZXIgPSBjb25maWcuZ2FtZS5wbGF5ZXIuc3BlZWQ7XG4gICAgcHJpdmF0ZSBzcGVlZEluY3JlYXNlRmFjdG9yOiBudW1iZXIgPSBjb25maWcuZ2FtZS5wbGF5ZXIuc3BlZWRJbmNyZWFzZUZhY3RvcjtcbiAgICBwcml2YXRlIGtleXNBbGxvd2VkOiBzdHJpbmdbXSA9IFsnYXJyb3dsZWZ0JywgJ2Fycm93dXAnLCAnYXJyb3dyaWdodCcsICdhcnJvd2Rvd24nXTtcbiAgICBwcml2YXRlIGtleXNQcmVzc2VkOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCdwbGF5ZXInLCAwLCAwLCAnbGV2ZWwnKTtcbiAgICAgICAgdGhpcy54ID0gd2luZG93Lm91dGVyV2lkdGggLyAyIC0gdGhpcy53aWR0aCAvIDI7XG4gICAgICAgIHRoaXMueSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLyAyIC0gdGhpcy5oZWlnaHQgLyAyO1xuXG4gICAgICAgIHRoaXMuZWwuc3R5bGUud2lkdGggPSBgJHt0aGlzLndpZHRofXB4YDtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5oZWlnaHQgPSBgJHt0aGlzLmhlaWdodH1weGA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuYm9yZGVyUmFkaXVzID0gYCR7dGhpcy53aWR0aH1weGA7XG5cbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24ucGxheWVyJywgKGU6IEtleWJvYXJkRXZlbnQpID0+IHRoaXMua2V5RG93bkhhbmRsZXIoZSkpO1xuICAgICAgICBXaW5kb3dFdmVudEhhbmRsZXIuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAucGxheWVyJywgKGU6IEtleWJvYXJkRXZlbnQpID0+IHRoaXMua2V5VXBIYW5kbGVyKGUpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBLZXkgZG93biBoYW5kbGVyIGZvciBtb3ZpbmcgdGhlIHBsYXllclxuICAgICAqXG4gICAgICogQHBhcmFtIGVcbiAgICAgKi9cbiAgICBwcml2YXRlIGtleURvd25IYW5kbGVyKGU6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgbGV0IGtleSA9IGUua2V5LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGlmICh0aGlzLmtleXNBbGxvd2VkLmluZGV4T2Yoa2V5KSA+IC0xICYmIHRoaXMua2V5c1ByZXNzZWQuaW5kZXhPZihrZXkpID09PSAtMSkge1xuICAgICAgICAgICAgdGhpcy5rZXlzUHJlc3NlZC5wdXNoKGtleSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBLZXkgZG93biBoYW5kbGVyIGZvciBtb3ZpbmcgdGhlIHBsYXllclxuICAgICAqXG4gICAgICogQHBhcmFtIGVcbiAgICAgKi9cbiAgICBwcml2YXRlIGtleVVwSGFuZGxlcihlOiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgICAgIGxldCBrZXkgPSBlLmtleS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBsZXQga2V5UHJlc3NlZFBvc2l0aW9uID0gdGhpcy5rZXlzUHJlc3NlZC5pbmRleE9mKGtleSk7XG4gICAgICAgIGlmICh0aGlzLmtleXNBbGxvd2VkLmluZGV4T2Yoa2V5KSA+IC0xICYmIGtleVByZXNzZWRQb3NpdGlvbiA+IC0xKSB7XG4gICAgICAgICAgICB0aGlzLmtleXNQcmVzc2VkLnNwbGljZShrZXlQcmVzc2VkUG9zaXRpb24sIDEpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIHRoZSBhY3R1YWwgcG9zaXRpb24gYmFzZWQgb24gZWFybGllciBldmVudHNcbiAgICAgKi9cbiAgICBwdWJsaWMgdXBkYXRlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmtleXNQcmVzc2VkLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICAgICAgc3dpdGNoIChrZXkpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdhcnJvd2xlZnQnOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnggLT0gdGhpcy5zcGVlZDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdhcnJvd3VwJzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy55IC09IHRoaXMuc3BlZWQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnYXJyb3dyaWdodCc6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMueCArPSB0aGlzLnNwZWVkO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ2Fycm93ZG93bic6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMueSArPSB0aGlzLnNwZWVkO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9DaGVja3MgdG8gc3RheSBpbiBib3VuZHNcbiAgICAgICAgaWYgKHRoaXMueCA8IDApIHtcbiAgICAgICAgICAgIHRoaXMueCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMueSA8IDApIHtcbiAgICAgICAgICAgIHRoaXMueSA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMueCA+ICh3aW5kb3cub3V0ZXJXaWR0aCAtIHRoaXMud2lkdGgpKSB7XG4gICAgICAgICAgICB0aGlzLnggPSAod2luZG93Lm91dGVyV2lkdGggLSB0aGlzLndpZHRoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy55ID4gKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLSB0aGlzLmhlaWdodCkpIHtcbiAgICAgICAgICAgIHRoaXMueSA9IChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gdGhpcy5oZWlnaHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lbC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7dGhpcy54fXB4LCAke3RoaXMueX1weClgO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSBwbGF5ZXIgd2hlbiBhIGJsb2NrIGdvdCBjYXVnaHRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBibG9ja1xuICAgICAqL1xuICAgIHB1YmxpYyBibG9ja0NhdWdodChibG9jazogQmxvY2spOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zcGVlZCArPSB0aGlzLnNwZWVkSW5jcmVhc2VGYWN0b3I7XG4gICAgICAgIHRoaXMud2lkdGggKz0gdGhpcy5ncm93dGhGYWN0b3I7XG4gICAgICAgIHRoaXMuaGVpZ2h0ICs9IHRoaXMuZ3Jvd3RoRmFjdG9yO1xuXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuaGVpZ2h0ID0gYCR7dGhpcy5oZWlnaHR9cHhgO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLndpZHRoID0gYCR7dGhpcy53aWR0aH1weGA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuYm9yZGVyUmFkaXVzID0gYCR7dGhpcy53aWR0aH1weGA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gYmxvY2suY29sb3I7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xlYW4gdXAhXG4gICAgICovXG4gICAgcHVibGljIGRlc3Ryb3koKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZWwucmVtb3ZlKCk7XG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duLnBsYXllcicpO1xuICAgICAgICBXaW5kb3dFdmVudEhhbmRsZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5dXAucGxheWVyJyk7XG4gICAgfVxufVxuIiwiaW1wb3J0IGNvbmZpZyBmcm9tICcuLi9jb25maWcuanNvbic7XG5pbXBvcnQgRG9tRWxlbWVudCBmcm9tIFwiLi4vaGVscGVycy9kb21lbGVtZW50XCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRpbWVyIGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgc2Vjb25kczogbnVtYmVyID0gY29uZmlnLmdhbWUuc2Vjb25kc1BlckxldmVsO1xuICAgIGludGVydmFsSWQ6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigndGltZXInLCAtMSwgLTEsICdsZXZlbCcpO1xuXG4gICAgICAgIHRoaXMucmVuZGVyVGVtcGxhdGUoKTtcbiAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QuYWRkKCdtZXNzYWdlJywgJ2lzLXByaW1hcnknKTtcbiAgICAgICAgdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcuc2Vjb25kcycpLmlubmVySFRNTCA9IHRoaXMuc2Vjb25kcy50b1N0cmluZygpO1xuXG4gICAgICAgIHRoaXMuaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKCgpID0+IHRoaXMudXBkYXRlKCksIDEwMDApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvdW50ZG93biBvZiBzZWNvbmRzXG4gICAgICovXG4gICAgcHJpdmF0ZSB1cGRhdGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2Vjb25kcy0tO1xuICAgICAgICB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoJy5zZWNvbmRzJykuaW5uZXJIVE1MID0gdGhpcy5zZWNvbmRzLnRvU3RyaW5nKCk7XG5cbiAgICAgICAgaWYgKHRoaXMuc2Vjb25kcyA8PSAzKSB7XG4gICAgICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5yZW1vdmUoJ2lzLXByaW1hcnknKTtcbiAgICAgICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LmFkZCgnaXMtZGFuZ2VyJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoJ2lzLXByaW1hcnknKTtcbiAgICAgICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LnJlbW92ZSgnaXMtZGFuZ2VyJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zZWNvbmRzID09PSAwKSB7XG4gICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ3RpbWVyOmRvbmUnKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsSWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlbXBsYXRlIG5lZWRlZCB0byBzaG93IG1vcmUgZWxlbWVudHNcbiAgICAgKi9cbiAgICBwcml2YXRlIHJlbmRlclRlbXBsYXRlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmVsLmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZXNzYWdlLWJvZHlcIj5cbiAgICAgICAgICAgICAgICA8c3Bhbj50aW1lOiA8L3NwYW4+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJzZWNvbmRzXCI+PC9zcGFuPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIGA7XG4gICAgfVxufVxuIiwiaW1wb3J0IGNvbmZpZyBmcm9tICcuLi9jb25maWcuanNvbic7XG5pbXBvcnQgRG9tRWxlbWVudCBmcm9tIFwiLi4vaGVscGVycy9kb21lbGVtZW50XCI7XG5pbXBvcnQgQmxvY2sgZnJvbSBcIi4vYmxvY2tcIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vcGxheWVyXCI7XG5pbXBvcnQgVGltZXIgZnJvbSBcIi4vdGltZXJcIjtcbmltcG9ydCBVdGlscyBmcm9tIFwiLi4vaGVscGVycy91dGlsc1wiO1xuaW1wb3J0IFdpbmRvd0V2ZW50SGFuZGxlciBmcm9tIFwiLi4vaGVscGVycy93aW5kb3dldmVudGhhbmRsZXJcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGV2ZWwgZXh0ZW5kcyBEb21FbGVtZW50IHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHRvdGFsQmxvY2tzOiBudW1iZXI7XG4gICAgcHJpdmF0ZSByZWFkb25seSBzY29yZVBlckJsb2NrOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBibG9ja3M6IEJsb2NrW10gPSBbXTtcbiAgICBwcml2YXRlIHBsYXllcjogUGxheWVyO1xuICAgIHByaXZhdGUgdGltZXI6IFRpbWVyO1xuICAgIHB1YmxpYyBmYWlsZWQgPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKHRvdGFsQmxvY2tzOiBudW1iZXIsIHNjb3JlUGVyQmxvY2s6IG51bWJlcikge1xuICAgICAgICBzdXBlcignbGV2ZWwnLCAwLCAwKTtcblxuICAgICAgICB0aGlzLnRvdGFsQmxvY2tzID0gdG90YWxCbG9ja3M7XG4gICAgICAgIHRoaXMuc2NvcmVQZXJCbG9jayA9IHNjb3JlUGVyQmxvY2s7XG4gICAgICAgIHRoaXMucGxheWVyID0gbmV3IFBsYXllcigpO1xuICAgICAgICB0aGlzLnRpbWVyID0gbmV3IFRpbWVyKCk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRvdGFsQmxvY2tzOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuYmxvY2tzLnB1c2gobmV3IEJsb2NrKFV0aWxzLmdldFJhbmRvbUNvbG9yKCksIFV0aWxzLmdldFJhbmRvbUludChjb25maWcuZ2FtZS5ibG9ja1NwZWVkLm1pbiwgY29uZmlnLmdhbWUuYmxvY2tTcGVlZC5tYXgpLCBVdGlscy5nZXRSYW5kb21JbnQoY29uZmlnLmdhbWUuYmxvY2tQaXhlbHMubWluLCBjb25maWcuZ2FtZS5ibG9ja1BpeGVscy5tYXgpLCBVdGlscy5nZXRSYW5kb21JbnQoY29uZmlnLmdhbWUuYmxvY2tQaXhlbHMubWluLCBjb25maWcuZ2FtZS5ibG9ja1BpeGVscy5tYXgpKSk7XG4gICAgICAgIH1cblxuICAgICAgICBXaW5kb3dFdmVudEhhbmRsZXIuYWRkRXZlbnRMaXN0ZW5lcigndGltZXI6ZG9uZScsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZmFpbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveSgnbGV2ZWw6ZmFpbGVkJyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBmb3IgY29sbGlzaW9uIGFuZCBwb3RlbnRpYWwgc3VjY2VzcyBvZiB0aGlzIGxldmVsXG4gICAgICovXG4gICAgcHVibGljIHVwZGF0ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIudXBkYXRlKCk7XG4gICAgICAgIHRoaXMuYmxvY2tzLmZvckVhY2goKGJsb2NrLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgYmxvY2sudXBkYXRlKCk7XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5jaGVja0NvbGxpc2lvbih0aGlzLnBsYXllci5nZXRDbGllbnRSZWFjdCgpLCBibG9jay5nZXRDbGllbnRSZWFjdCgpKSAmJiB0aGlzLmZhaWxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllci5ibG9ja0NhdWdodChibG9jayk7XG4gICAgICAgICAgICAgICAgYmxvY2suZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYmxvY2tzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdsZXZlbDpzY29yZVVwZGF0ZScsIHtkZXRhaWw6IHtzY29yZTogdGhpcy5zY29yZVBlckJsb2NrfX0pKTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmJsb2Nrcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXN0cm95KCdsZXZlbDpzdWNjZXNzJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXN0cm95IG9iamVjdCAmIHRpbWVyIGFuZCB0cmlnZ2VyIGV2ZW50IHRvIG5vdGlmeSB0aGUgd29ybGQgYWJvdXQgdGhlIHN0YXR1cyBvZiB0aGlzIGxldmVsXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZXZlbnRUeXBlXG4gICAgICovXG4gICAgcHJpdmF0ZSBkZXN0cm95KGV2ZW50VHlwZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMudGltZXIuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLnBsYXllci5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMuYmxvY2tzLmZvckVhY2goKGJsb2NrLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgYmxvY2suZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5ibG9ja3Muc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5yZW1vdmVFdmVudExpc3RlbmVyKCd0aW1lcjpkb25lJyk7XG4gICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChldmVudFR5cGUpKTtcbiAgICAgICAgdGhpcy5lbC5yZW1vdmUoKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgR2FtZSBmcm9tICcuL2dhbWUnO1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgKCkgPT4gbmV3IEdhbWUoKSk7XG4iLCJpbXBvcnQgY29uZmlnIGZyb20gJy4vY29uZmlnLmpzb24nO1xuaW1wb3J0IEdVSSBmcm9tICcuL2d1aS9ndWknO1xuaW1wb3J0IExldmVsIGZyb20gXCIuL2xldmVsL2xldmVsXCI7XG5pbXBvcnQgRGF0YVNlcnZpY2UgZnJvbSBcIi4vZGF0YXNlcnZpY2VcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZSB7XG4gICAgcHJpdmF0ZSBsZXZlbDogTGV2ZWw7XG4gICAgcHJpdmF0ZSBsZXZlbHNQZXJHYW1lOiBudW1iZXIgPSBjb25maWcuZ2FtZS5sZXZlbHNQZXJHYW1lO1xuICAgIHByaXZhdGUgY3VycmVudExldmVsc1BsYXllZDogbnVtYmVyID0gMDtcbiAgICBwcml2YXRlIHN0YXJ0RWxlbWVudHNQZXJMZXZlbDogbnVtYmVyID0gY29uZmlnLmdhbWUuc3RhcnRFbGVtZW50c1BlckxldmVsO1xuICAgIHByaXZhdGUgZWxlbWVudHNJbmNyZWFzZVBlckxldmVsOiBudW1iZXIgPSBjb25maWcuZ2FtZS5lbGVtZW50c0luY3JlYXNlUGVyTGV2ZWw7XG4gICAgcHJpdmF0ZSBzY29yZVBlckVsZW1lbnQ6IG51bWJlciA9IGNvbmZpZy5nYW1lLnNjb3JlUGVyRWxlbWVudDtcbiAgICBwcml2YXRlIHJlYWRvbmx5IG1heFNjb3JlOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBndWk6IEdVSTtcbiAgICBwcml2YXRlIGRhdGFTZXJ2aWNlOiBEYXRhU2VydmljZTtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmd1aSA9IG5ldyBHVUkoKTtcbiAgICAgICAgdGhpcy5tYXhTY29yZSA9IHRoaXMuY2FsY3VsYXRlTWF4U2NvcmUoKTtcbiAgICAgICAgdGhpcy5nYW1lTG9vcCgpO1xuICAgICAgICB0aGlzLmRhdGFTZXJ2aWNlID0gRGF0YVNlcnZpY2UuZ2V0SW5zdGFuY2UoKTtcblxuICAgICAgICBbJ2xldmVsOnN1Y2Nlc3MnLCAnbGV2ZWw6ZmFpbGVkJ10ubWFwKChldmVudFR5cGUpID0+IHtcbiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgKGUpID0+IHRoaXMudXBkYXRlKGUudHlwZSkpO1xuICAgICAgICB9KTtcbiAgICAgICAgWydnYW1lOnN0YXJ0OmNsaWNrJywgJ2xldmVsOnN1Y2Nlc3M6Y2xpY2snLCAnbGV2ZWw6ZmFpbGVkOmNsaWNrJ10ubWFwKChldmVudFR5cGUpID0+IHtcbiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgKCkgPT4gdGhpcy5zdGFydE5ld0xldmVsKCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2dhbWU6ZW5kOmNsaWNrJywgKCkgPT4gdGhpcy5yZXN0YXJ0KCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbGN1bGF0ZSB0aGUgc2NvcmUgd2l0aCBhdmFpbGFibGUgcGFyYW1ldGVyc1xuICAgICAqXG4gICAgICogQHRvZG8gRG8gSSByZWFsbHkgbmVlZCB0byBkbyB0aGlzIHNvIGluZWZmaWNpZW50Li4/XG4gICAgICogQHJldHVybnMge251bWJlcn1cbiAgICAgKi9cbiAgICBwcml2YXRlIGNhbGN1bGF0ZU1heFNjb3JlKCk6IG51bWJlciB7XG4gICAgICAgIGxldCBtYXhTY29yZSA9IDA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5sZXZlbHNQZXJHYW1lOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBlbGVtZW50cyA9IHRoaXMuc3RhcnRFbGVtZW50c1BlckxldmVsICsgKGkgPT09IDAgPyAwIDogKHRoaXMuZWxlbWVudHNJbmNyZWFzZVBlckxldmVsICogaSkpO1xuICAgICAgICAgICAgbWF4U2NvcmUgKz0gKGVsZW1lbnRzICogdGhpcy5zY29yZVBlckVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtYXhTY29yZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgb25seSBwbGFjZSBmb3IgYSByZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgKi9cbiAgICBwcml2YXRlIGdhbWVMb29wKCk6IHZvaWQge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMubGV2ZWwgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmxldmVsLnVwZGF0ZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmdhbWVMb29wKCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgZ2FtZSBieSBlaXRoZXIgdGhlIGVuZCBvciBhbnl0aGluZyBpbiBiZXR3ZWVuIGxldmVsc1xuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGVcbiAgICAgKi9cbiAgICBwcml2YXRlIHVwZGF0ZSh0eXBlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jdXJyZW50TGV2ZWxzUGxheWVkKys7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRMZXZlbHNQbGF5ZWQgPT09IHRoaXMubGV2ZWxzUGVyR2FtZSkge1xuICAgICAgICAgICAgdGhpcy5ndWkuZ2FtZUVuZCh0aGlzLm1heFNjb3JlKTtcbiAgICAgICAgICAgIHRoaXMuc2F2ZVNjb3JlKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmd1aS5sZXZlbERvbmUodHlwZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGltZSB0byBzdGFydCBhIG5ldyBsZXZlbCB3aXRoIG1hZG5lc3NcbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXJ0TmV3TGV2ZWwoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmxldmVsICYmIHRoaXMubGV2ZWwuZmFpbGVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy5zdGFydEVsZW1lbnRzUGVyTGV2ZWwgKz0gdGhpcy5lbGVtZW50c0luY3JlYXNlUGVyTGV2ZWw7XG4gICAgICAgIH1cblxuICAgICAgICBkZWxldGUgdGhpcy5sZXZlbDtcbiAgICAgICAgdGhpcy5ndWkubmV3TGV2ZWwoKTtcblxuICAgICAgICB0aGlzLmxldmVsID0gbmV3IExldmVsKHRoaXMuc3RhcnRFbGVtZW50c1BlckxldmVsLCB0aGlzLnNjb3JlUGVyRWxlbWVudCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU3RhcnQgZXZlcnl0aGluZyBmcm9tIHRoZSBiZWdpbm5pbmdcbiAgICAgKi9cbiAgICBwcml2YXRlIHJlc3RhcnQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZ3VpLnJlc3RhcnQoKTtcbiAgICAgICAgdGhpcy5jdXJyZW50TGV2ZWxzUGxheWVkID0gMDtcbiAgICAgICAgdGhpcy5zdGFydEVsZW1lbnRzUGVyTGV2ZWwgPSBjb25maWcuZ2FtZS5zdGFydEVsZW1lbnRzUGVyTGV2ZWw7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmxldmVsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbGwgdGhlIGRhdGEgc2VydmljZSBhbmQgbGV0IGl0IGRvIGl0cyBtYWdpY1xuICAgICAqL1xuICAgIHByaXZhdGUgc2F2ZVNjb3JlKCk6IHZvaWQge1xuICAgICAgICBsZXQgc2NvcmUgPSB0aGlzLmd1aS5nZXRTY29yZSgpO1xuICAgICAgICB0aGlzLmRhdGFTZXJ2aWNlLnNhdmVTY29yZShzY29yZSkudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhLmVycm9yID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnZ2FtZTpzY29yZVNhdmVkJywge2RldGFpbDoge2RhdGF9fSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9