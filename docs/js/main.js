!function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e){e.exports={functionalities:{dataService:!0},dataService:{baseUrl:"https://api.mlab.com/api/1",apiKey:"X17utv1FH2dFTeUo4yhNGL54sA7CY2jS",databaseName:"typescript_scores",collectionName:"scores"}}},function(e,t,s){"use strict";s.r(t);class i{constructor(e,t,s,i=""){this.x=t,this.y=s,this.el=document.createElement("div");let r=document.getElementById("main");if(null===r)throw new Error("<main> element doesn't exist!");if(this.x>-1&&this.y>-1&&(this.el.style.transform=`translate(${this.x}px, ${this.y}px)`),this.el.classList.add(`game-${e}`),""===i)r.appendChild(this.el);else{let e=document.querySelector(`.game-${i}`);if(null===e)throw new Error(`<.game-${i}> element doesn't exist!`);e.appendChild(this.el)}}getClientReact(){return this.el.getBoundingClientRect()}}class r extends i{constructor(){super("score",-1,-1,"gui"),this.score=0,this.renderTemplate(),this.el.querySelector(".score-count").innerHTML=this.score.toString(),this.el.classList.add("message","is-warning")}get(){return this.score}update(e,t=!1){this.score=t?e:this.score+e,this.el.querySelector(".score-count").innerHTML=this.score.toString()}renderTemplate(){this.el.innerHTML='\n            <div class="message-body">\n                <span>score: </span>\n                <span class="score-count"></span>\n            </div>\n        '}}class n{static addEventListener(e,t){n.functionMap[e]=t,window.addEventListener(e.split(".")[0],n.functionMap[e])}static removeEventListener(e){window.removeEventListener(e.split(".")[0],n.functionMap[e]),delete n.functionMap[e]}}n.functionMap={};class a extends i{constructor(){super("messagescreen",0,0,"gui"),this.height=200,this.width=400,this.isActive=!1,this.messages={"game:start":{header:"Welcome to Block-o-Block!",body:"It's time to catch them blocks!<br/><br/>Use your arrow keys to move your player around and press space to start.",className:"is-info"},"game:end":{header:"Your game is over!",body:"You made it, your final score is __SCORE__ out of max __MAX_SCORE__ points.<br/><br/>Thanks for playing, press space to restart the madness",className:"is-success"},"level:success":{header:"YEAH! Level completed!",body:"Performing like a boss! Press space to proceed to the next level and catch even more blocks",className:"is-success"},"level:failed":{header:"AAH! Level failed!",body:"Try again and show us what you're made off! Press space to restart this level",className:"is-danger"}},this.x=window.outerWidth/2-this.width/2,this.y=document.documentElement.clientHeight/2-this.height/2,this.el.classList.add("message"),this.el.style.width=`${this.width}px`,this.el.style.transform=`translate(${this.x}px, ${this.y}px)`,this.renderTemplate(),this.show("game:start"),n.addEventListener("keyup.messagescreen",e=>this.keyBoardHandler(e))}keyBoardHandler(e){32===e.keyCode&&!0===this.isActive&&window.dispatchEvent(new Event(`${this.currentEvent}:click`))}show(e,t={}){let s=this.messages[e].header,i=this.messages[e].body;for(let e in t)i=i.replace(e,t[e]);this.el.querySelector(".message-header").innerHTML=s,this.el.querySelector(".message-body").innerHTML=i,this.el.classList.add("show",this.messages[e].className),this.currentEvent=e,this.isActive=!0}hide(){this.el.classList.remove("show","is-info","is-success","is-danger"),this.isActive=!1}renderTemplate(){this.el.innerHTML='\n            <div class="message-header"></div>\n            <div class="message-body"></div>\n        '}}class h extends i{constructor(){super("gui",0,0),this.score=new r,this.messageScreen=new a,window.addEventListener("level:scoreUpdate",e=>this.score.update(e.detail.score))}levelDone(e){this.messageScreen.show(e)}newLevel(){this.messageScreen.hide()}gameEnd(e){this.messageScreen.show("game:end",{__SCORE__:this.score.get().toString(),__MAX_SCORE__:e.toString()})}restart(){this.messageScreen.hide(),this.messageScreen.show("game:start"),this.score.update(0,!0)}getScore(){return this.score.get()}}class o{static getRandomColor(){let e=Math.round,t=Math.random;return`rgba(${e(255*t())},${e(255*t())},${e(255*t())},1)`}static getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}static checkCollision(e,t){return e.left<=t.right&&t.left<=e.right&&e.top<=t.bottom&&t.top<=e.bottom}}class l extends i{constructor(e,t,s,i){super("block",0,0,"level"),this.destination={x:0,y:0},this.speed=t,this.width=s,this.height=i,this.color=e,this.el.style.backgroundImage=`repeating-linear-gradient(${o.getRandomInt(0,360)}deg, #000000, #000000 ${o.getRandomInt(2,10)}px, ${this.color} 10px, ${this.color} ${o.getRandomInt(20,40)}px)`,this.el.style.width=`${this.width}px`,this.el.style.height=`${this.height}px`,this.x=o.getRandomInt(0,window.outerWidth-this.width),this.y=o.getRandomInt(0,document.documentElement.clientHeight-this.height),this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}destroy(){this.el.remove()}update(){this.x>this.destination.x-this.speed&&this.x<this.destination.x+this.speed&&(this.destination.x=o.getRandomInt(0,window.outerWidth-this.width)),this.y>this.destination.y-this.speed&&this.y<this.destination.y+this.speed&&(this.destination.y=o.getRandomInt(0,document.documentElement.clientHeight-this.height)),this.destination.x>=this.x?this.x+=this.speed:this.x-=this.speed,this.destination.y>=this.y?this.y+=this.speed:this.y-=this.speed,this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}}class d extends i{constructor(){super("player",0,0,"level"),this.height=10,this.width=10,this.growthFactor=1.5,this.speed=2,this.speedIncreaseFactor=.2,this.keysAllowed=[37,38,39,40],this.keysPressed=[],this.x=window.outerWidth/2-this.width/2,this.y=document.documentElement.clientHeight/2-this.height/2,this.el.style.width=`${this.width}px`,this.el.style.height=`${this.height}px`,this.el.style.borderRadius=`${this.width}px`,n.addEventListener("keydown.player",e=>this.keyDownHandler(e)),n.addEventListener("keyup.player",e=>this.keyUpHandler(e))}keyDownHandler(e){let t=e.keyCode;this.keysAllowed.indexOf(t)>-1&&-1===this.keysPressed.indexOf(t)&&this.keysPressed.push(t)}keyUpHandler(e){let t=e.keyCode,s=this.keysPressed.indexOf(t);this.keysAllowed.indexOf(t)>-1&&s>-1&&this.keysPressed.splice(s,1)}update(){this.keysPressed.forEach(e=>{switch(e){case 37:this.x-=this.speed;break;case 38:this.y-=this.speed;break;case 39:this.x+=this.speed;break;case 40:this.y+=this.speed;break;default:return}}),this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x>window.outerWidth-this.width&&(this.x=window.outerWidth-this.width),this.y>document.documentElement.clientHeight-this.height&&(this.y=document.documentElement.clientHeight-this.height),this.el.style.transform=`translate(${this.x}px, ${this.y}px)`}blockCaught(e){this.speed+=this.speedIncreaseFactor,this.width+=this.growthFactor,this.height+=this.growthFactor,this.el.style.height=`${this.height}px`,this.el.style.width=`${this.width}px`,this.el.style.borderRadius=`${this.width}px`,this.el.style.backgroundColor=e.color}destroy(){n.removeEventListener("keydown.player"),n.removeEventListener("keyup.player")}}class c extends i{constructor(){super("timer",-1,-1,"level"),this.seconds=10,this.renderTemplate(),this.el.classList.add("message","is-primary"),this.el.querySelector(".seconds").innerHTML=this.seconds.toString(),this.intervalId=setInterval(()=>this.update(),1e3)}update(){this.seconds--,this.el.querySelector(".seconds").innerHTML=this.seconds.toString(),this.seconds<=3?(this.el.classList.remove("is-primary"),this.el.classList.add("is-danger")):(this.el.classList.add("is-primary"),this.el.classList.remove("is-danger")),0===this.seconds&&window.dispatchEvent(new Event("timer:done"))}destroy(){clearInterval(this.intervalId)}renderTemplate(){this.el.innerHTML='\n            <div class="message-body">\n                <span>time: </span>\n                <span class="seconds"></span>\n            </div>\n        '}}class m extends i{constructor(e,t){super("level",0,0),this.blocks=[],this.failed=!1,this.totalBlocks=e,this.scorePerBlock=t,this.player=new d,this.timer=new c;for(let e=0;e<this.totalBlocks;e++)this.blocks.push(new l(o.getRandomColor(),o.getRandomInt(1,5),o.getRandomInt(10,150),o.getRandomInt(10,150)));n.addEventListener("timer:done",()=>{this.failed=!0,this.destroy("level:failed")})}update(){this.player.update(),this.blocks.forEach((e,t)=>{e.update(),o.checkCollision(this.player.getClientReact(),e.getClientReact())&&!1===this.failed&&(this.player.blockCaught(e),e.destroy(),this.blocks.splice(t,1),window.dispatchEvent(new CustomEvent("level:scoreUpdate",{detail:{score:this.scorePerBlock}})),0===this.blocks.length&&this.destroy("level:success"))})}destroy(e){this.timer.destroy(),this.player.destroy(),this.blocks.forEach((e,t)=>{e.destroy(),this.blocks.splice(t,1)}),n.removeEventListener("timer:done"),window.dispatchEvent(new Event(e)),this.el.remove()}}var p=s(0);class u{constructor(){this.endPointList=`/databases/${p.dataService.databaseName}/collections/${p.dataService.collectionName}?apiKey=${p.dataService.apiKey}`,this.endPointSave=`/databases/${p.dataService.databaseName}/collections/${p.dataService.collectionName}?apiKey=${p.dataService.apiKey}`}saveScore(e){if(!1===p.functionalities.dataService)return this.disabled();let t=`${p.dataService.baseUrl}${this.endPointSave}`;return fetch(t,{body:JSON.stringify({score:e}),headers:{"content-type":"application/json"},method:"POST",mode:"cors"}).then(e=>e.json())}getScores(){if(!1===p.functionalities.dataService)return this.disabled();let e=`${p.dataService.baseUrl}${this.endPointList}`;return fetch(e,{mode:"cors"}).then(e=>e.json())}disabled(){return new Promise(e=>{e({error:"Dataservice is disabled"})})}}window.addEventListener("load",()=>new class{constructor(){this.levelsPerGame=10,this.currentLevelsPlayed=0,this.elementsPerLevel=5,this.elementsIncreasePerLevel=5,this.scorePerElement=10,this.gui=new h,this.maxScore=this.calculateMaxScore(),this.gameLoop(),this.dataService=new u,this.dataService.getScores().then(e=>{console.log("Current scores",e)}),["level:success","level:failed"].map(e=>{window.addEventListener(e,e=>this.update(e.type))}),["game:start:click","level:success:click","level:failed:click"].map(e=>{window.addEventListener(e,()=>this.startNewLevel())}),window.addEventListener("game:end:click",()=>this.restart())}calculateMaxScore(){let e=0;for(let t=0;t<this.levelsPerGame;t++)e+=(this.elementsPerLevel+(0===t?0:this.elementsIncreasePerLevel*t))*this.scorePerElement;return e}gameLoop(){void 0!==this.level&&this.level.update(),requestAnimationFrame(()=>this.gameLoop())}update(e){if(this.currentLevelsPlayed++,this.currentLevelsPlayed===this.levelsPerGame)return this.gui.gameEnd(this.maxScore),void this.saveScore();this.gui.levelDone(e)}startNewLevel(){this.level&&!1===this.level.failed&&(this.elementsPerLevel+=this.elementsIncreasePerLevel),delete this.level,this.gui.newLevel(),this.level=new m(this.elementsPerLevel,this.scorePerElement)}restart(){this.gui.restart(),this.currentLevelsPlayed=0,this.elementsPerLevel=5}saveScore(){let e=this.gui.getScore();this.dataService.saveScore(e).then(e=>{console.log("Response after saving score",e)})}})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vZGV2L2hlbHBlcnMvZG9tZWxlbWVudC50cyIsIndlYnBhY2s6Ly8vLi9kZXYvZ3VpL3Njb3JlLnRzIiwid2VicGFjazovLy8uL2Rldi9oZWxwZXJzL3dpbmRvd2V2ZW50aGFuZGxlci50cyIsIndlYnBhY2s6Ly8vLi9kZXYvZ3VpL21lc3NhZ2VzY3JlZW4udHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2d1aS9ndWkudHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2hlbHBlcnMvdXRpbHMudHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2xldmVsL2Jsb2NrLnRzIiwid2VicGFjazovLy8uL2Rldi9sZXZlbC9wbGF5ZXIudHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2xldmVsL3RpbWVyLnRzIiwid2VicGFjazovLy8uL2Rldi9sZXZlbC9sZXZlbC50cyIsIndlYnBhY2s6Ly8vLi9kZXYvZGF0YXNlcnZpY2UudHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L21haW4udHMiLCJ3ZWJwYWNrOi8vLy4vZGV2L2dhbWUudHMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImNvbmZpZ3VyYWJsZSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwidmFsdWUiLCJuIiwiX19lc01vZHVsZSIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIkRvbUVsZW1lbnQiLCJbb2JqZWN0IE9iamVjdF0iLCJ0eXBlIiwieCIsInkiLCJwYXJlbnRDbGFzcyIsInRoaXMiLCJlbCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsIm1haW4iLCJnZXRFbGVtZW50QnlJZCIsIkVycm9yIiwic3R5bGUiLCJ0cmFuc2Zvcm0iLCJjbGFzc0xpc3QiLCJhZGQiLCJhcHBlbmRDaGlsZCIsInBhcmVudEVsIiwicXVlcnlTZWxlY3RvciIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInNjb3JlX1Njb3JlIiwic3VwZXIiLCJzY29yZSIsInJlbmRlclRlbXBsYXRlIiwiaW5uZXJIVE1MIiwidG9TdHJpbmciLCJyZXNldCIsIldpbmRvd0V2ZW50SGFuZGxlciIsImV2ZW50IiwiZnVuYyIsImZ1bmN0aW9uTWFwIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsInNwbGl0IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIm1lc3NhZ2VzY3JlZW5fTWVzc2FnZVNjcmVlbiIsImhlaWdodCIsIndpZHRoIiwiaXNBY3RpdmUiLCJtZXNzYWdlcyIsImdhbWU6c3RhcnQiLCJoZWFkZXIiLCJib2R5IiwiY2xhc3NOYW1lIiwiZ2FtZTplbmQiLCJsZXZlbDpzdWNjZXNzIiwibGV2ZWw6ZmFpbGVkIiwib3V0ZXJXaWR0aCIsImRvY3VtZW50RWxlbWVudCIsImNsaWVudEhlaWdodCIsInNob3ciLCJlIiwia2V5Qm9hcmRIYW5kbGVyIiwia2V5Q29kZSIsImRpc3BhdGNoRXZlbnQiLCJFdmVudCIsImN1cnJlbnRFdmVudCIsImJvZHlSZXBsYWNlbWVudHMiLCJtZXNzYWdlSGVhZGVyIiwibWVzc2FnZUJvZHkiLCJyZXBsYWNlbWVudCIsInJlcGxhY2UiLCJyZW1vdmUiLCJndWlfR1VJIiwibWVzc2FnZVNjcmVlbiIsInVwZGF0ZSIsImRldGFpbCIsImhpZGUiLCJtYXhTY29yZSIsIl9fU0NPUkVfXyIsIl9fTUFYX1NDT1JFX18iLCJVdGlscyIsIk1hdGgiLCJyb3VuZCIsInJhbmRvbSIsIm1pbiIsIm1heCIsImZsb29yIiwiYSIsImIiLCJsZWZ0IiwicmlnaHQiLCJ0b3AiLCJib3R0b20iLCJibG9ja19CbG9jayIsImNvbG9yIiwic3BlZWQiLCJkZXN0aW5hdGlvbiIsImJhY2tncm91bmRJbWFnZSIsImdldFJhbmRvbUludCIsInBsYXllcl9QbGF5ZXIiLCJncm93dGhGYWN0b3IiLCJzcGVlZEluY3JlYXNlRmFjdG9yIiwia2V5c0FsbG93ZWQiLCJrZXlzUHJlc3NlZCIsImJvcmRlclJhZGl1cyIsImtleURvd25IYW5kbGVyIiwia2V5VXBIYW5kbGVyIiwia2V5IiwiaW5kZXhPZiIsInB1c2giLCJrZXlQcmVzc2VkUG9zaXRpb24iLCJzcGxpY2UiLCJmb3JFYWNoIiwiYmxvY2siLCJiYWNrZ3JvdW5kQ29sb3IiLCJ0aW1lcl9UaW1lciIsInNlY29uZHMiLCJpbnRlcnZhbElkIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwibGV2ZWxfTGV2ZWwiLCJ0b3RhbEJsb2NrcyIsInNjb3JlUGVyQmxvY2siLCJibG9ja3MiLCJmYWlsZWQiLCJwbGF5ZXIiLCJ0aW1lciIsImdldFJhbmRvbUNvbG9yIiwiZGVzdHJveSIsImluZGV4IiwiY2hlY2tDb2xsaXNpb24iLCJnZXRDbGllbnRSZWFjdCIsImJsb2NrQ2F1Z2h0IiwiQ3VzdG9tRXZlbnQiLCJsZW5ndGgiLCJldmVudFR5cGUiLCJkYXRhc2VydmljZV9EYXRhU2VydmljZSIsImVuZFBvaW50TGlzdCIsImNvbmZpZyIsImRhdGFTZXJ2aWNlIiwiZGF0YWJhc2VOYW1lIiwiY29sbGVjdGlvbk5hbWUiLCJhcGlLZXkiLCJlbmRQb2ludFNhdmUiLCJmdW5jdGlvbmFsaXRpZXMiLCJkaXNhYmxlZCIsInVybCIsImJhc2VVcmwiLCJmZXRjaCIsIkpTT04iLCJzdHJpbmdpZnkiLCJoZWFkZXJzIiwiY29udGVudC10eXBlIiwibWV0aG9kIiwibW9kZSIsInRoZW4iLCJyZXNwb25zZSIsImpzb24iLCJQcm9taXNlIiwicmVzb2x2ZSIsImVycm9yIiwibGV2ZWxzUGVyR2FtZSIsImN1cnJlbnRMZXZlbHNQbGF5ZWQiLCJlbGVtZW50c1BlckxldmVsIiwiZWxlbWVudHNJbmNyZWFzZVBlckxldmVsIiwic2NvcmVQZXJFbGVtZW50IiwiZ3VpIiwiY2FsY3VsYXRlTWF4U2NvcmUiLCJnYW1lTG9vcCIsImdldFNjb3JlcyIsImRhdGEiLCJjb25zb2xlIiwibG9nIiwibWFwIiwic3RhcnROZXdMZXZlbCIsInJlc3RhcnQiLCJsZXZlbCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImdhbWVFbmQiLCJzYXZlU2NvcmUiLCJsZXZlbERvbmUiLCJuZXdMZXZlbCIsImdldFNjb3JlIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxLQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLElBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsWUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsR0FDQUssY0FBQSxFQUNBQyxZQUFBLEVBQ0FDLElBQUFOLEtBTUFaLEVBQUFtQixFQUFBLFNBQUFqQixHQUNBWSxPQUFBQyxlQUFBYixFQUFBLGNBQWlEa0IsT0FBQSxLQUlqRHBCLEVBQUFxQixFQUFBLFNBQUFsQixHQUNBLElBQUFTLEVBQUFULEtBQUFtQixXQUNBLFdBQTJCLE9BQUFuQixFQUFBLFNBQzNCLFdBQWlDLE9BQUFBLEdBRWpDLE9BREFILEVBQUFVLEVBQUFFLEVBQUEsSUFBQUEsR0FDQUEsR0FJQVosRUFBQWEsRUFBQSxTQUFBVSxFQUFBQyxHQUFzRCxPQUFBVixPQUFBVyxVQUFBQyxlQUFBbkIsS0FBQWdCLEVBQUFDLElBR3REeEIsRUFBQTJCLEVBQUEsR0FJQTNCLElBQUE0QixFQUFBLCtQQ25FY0MsRUFLVkMsWUFBWUMsRUFBY0MsRUFBV0MsRUFBV0MsRUFBc0IsSUFDbEVDLEtBQUtILEVBQUlBLEVBQ1RHLEtBQUtGLEVBQUlBLEVBRVRFLEtBQUtDLEdBQUtDLFNBQVNDLGNBQWMsT0FDakMsSUFBSUMsRUFBT0YsU0FBU0csZUFBZSxRQUNuQyxHQUFhLE9BQVRELEVBQ0EsTUFBTSxJQUFJRSxNQUFNLGlDQVNwQixHQUxJTixLQUFLSCxHQUFLLEdBQUtHLEtBQUtGLEdBQUssSUFDekJFLEtBQUtDLEdBQUdNLE1BQU1DLHVCQUF5QlIsS0FBS0gsUUFBUUcsS0FBS0YsUUFFN0RFLEtBQUtDLEdBQUdRLFVBQVVDLFlBQVlkLEtBRVYsS0FBaEJHLEVBQ0FLLEVBQUtPLFlBQVlYLEtBQUtDLFFBQ25CLENBQ0gsSUFBSVcsRUFBV1YsU0FBU1csdUJBQXVCZCxLQUMvQyxHQUFpQixPQUFiYSxFQUNBLE1BQU0sSUFBSU4sZ0JBQWdCUCw2QkFFOUJhLEVBQVNELFlBQVlYLEtBQUtDLEtBTzNCTixpQkFDSCxPQUFPSyxLQUFLQyxHQUFHYSwrQkNsQ1RDLFVBQXFCckIsRUFHL0JDLGNBQ0lxQixNQUFNLFNBQVUsR0FBSSxFQUFHLE9BSG5CaEIsS0FBQWlCLE1BQWdCLEVBS3BCakIsS0FBS2tCLGlCQUNMbEIsS0FBS0MsR0FBR1ksY0FBYyxnQkFBZ0JNLFVBQVluQixLQUFLaUIsTUFBTUcsV0FDN0RwQixLQUFLQyxHQUFHUSxVQUFVQyxJQUFJLFVBQVcsY0FROUJmLE1BQ0gsT0FBT0ssS0FBS2lCLE1BU1R0QixPQUFPc0IsRUFBZUksR0FBaUIsR0FDMUNyQixLQUFLaUIsTUFBUUksRUFBUUosRUFBUWpCLEtBQUtpQixNQUFRQSxFQUMxQ2pCLEtBQUtDLEdBQUdZLGNBQWMsZ0JBQWdCTSxVQUFZbkIsS0FBS2lCLE1BQU1HLFdBTXpEekIsaUJBQ0pLLEtBQUtDLEdBQUdrQixVQUFZLHlLQ3JDZEcsRUFHSDNCLHdCQUF3QjRCLEVBQWVDLEdBQzFDRixFQUFtQkcsWUFBWUYsR0FBU0MsRUFDeENFLE9BQU9DLGlCQUFpQkosRUFBTUssTUFBTSxLQUFLLEdBQUlOLEVBQW1CRyxZQUFZRixJQUd6RTVCLDJCQUEyQjRCLEdBQzlCRyxPQUFPRyxvQkFBb0JOLEVBQU1LLE1BQU0sS0FBSyxHQUFJTixFQUFtQkcsWUFBWUYsV0FDeEVELEVBQW1CRyxZQUFZRixJQVQzQkQsRUFBQUcscUJDRUxLLFVBQTZCcEMsRUE2QnZDQyxjQUNJcUIsTUFBTSxnQkFBaUIsRUFBRyxFQUFHLE9BN0J6QmhCLEtBQUErQixPQUFpQixJQUNqQi9CLEtBQUFnQyxNQUFnQixJQUVoQmhDLEtBQUFpQyxVQUFvQixFQUVwQmpDLEtBQUFrQyxVQUNKQyxjQUNJQyxPQUFVLDRCQUNWQyxLQUFRLG9IQUNSQyxVQUFhLFdBRWpCQyxZQUNJSCxPQUFVLHFCQUNWQyxLQUFRLDhJQUNSQyxVQUFhLGNBRWpCRSxpQkFDSUosT0FBVSx5QkFDVkMsS0FBUSw4RkFDUkMsVUFBYSxjQUVqQkcsZ0JBQ0lMLE9BQVUscUJBQ1ZDLEtBQVEsZ0ZBQ1JDLFVBQWEsY0FPakJ0QyxLQUFLSCxFQUFJNkIsT0FBT2dCLFdBQWEsRUFBSTFDLEtBQUtnQyxNQUFRLEVBQzlDaEMsS0FBS0YsRUFBSUksU0FBU3lDLGdCQUFnQkMsYUFBZSxFQUFJNUMsS0FBSytCLE9BQVMsRUFFbkUvQixLQUFLQyxHQUFHUSxVQUFVQyxJQUFJLFdBQ3RCVixLQUFLQyxHQUFHTSxNQUFNeUIsU0FBV2hDLEtBQUtnQyxVQUM5QmhDLEtBQUtDLEdBQUdNLE1BQU1DLHVCQUF5QlIsS0FBS0gsUUFBUUcsS0FBS0YsT0FFekRFLEtBQUtrQixpQkFDTGxCLEtBQUs2QyxLQUFLLGNBQ1Z2QixFQUFtQkssaUJBQWlCLHNCQUF3Qm1CLEdBQXFCOUMsS0FBSytDLGdCQUFnQkQsSUFRMUduRCxnQkFBZ0JtRCxHQUNNLEtBQWRBLEVBQUVFLFVBQW9DLElBQWxCaEQsS0FBS2lDLFVBQ3pCUCxPQUFPdUIsY0FBYyxJQUFJQyxTQUFTbEQsS0FBS21ELHVCQVV4Q3hELEtBQUtDLEVBQWN3RCxNQUN0QixJQUFJQyxFQUFnQnJELEtBQUtrQyxTQUFTdEMsR0FBTXdDLE9BQ3BDa0IsRUFBY3RELEtBQUtrQyxTQUFTdEMsR0FBTXlDLEtBQ3RDLElBQUssSUFBSWtCLEtBQWVILEVBQ3BCRSxFQUFjQSxFQUFZRSxRQUFRRCxFQUFhSCxFQUFpQkcsSUFHcEV2RCxLQUFLQyxHQUFHWSxjQUFjLG1CQUFtQk0sVUFBWWtDLEVBQ3JEckQsS0FBS0MsR0FBR1ksY0FBYyxpQkFBaUJNLFVBQVltQyxFQUVuRHRELEtBQUtDLEdBQUdRLFVBQVVDLElBQUksT0FBUVYsS0FBS2tDLFNBQVN0QyxHQUFNMEMsV0FDbER0QyxLQUFLbUQsYUFBZXZELEVBQ3BCSSxLQUFLaUMsVUFBVyxFQU1idEMsT0FDSEssS0FBS0MsR0FBR1EsVUFBVWdELE9BQU8sT0FBUSxVQUFXLGFBQWMsYUFDMUR6RCxLQUFLaUMsVUFBVyxFQU1adEMsaUJBQ0pLLEtBQUtDLEdBQUdrQixVQUFZLGtIQ3ZGZHVDLFVBQW1CaEUsRUFJN0JDLGNBQ0lxQixNQUFNLE1BQU8sRUFBRyxHQUVoQmhCLEtBQUtpQixNQUFRLElBQUlGLEVBQ2pCZixLQUFLMkQsY0FBZ0IsSUFBSTdCLEVBRXpCSixPQUFPQyxpQkFBaUIsb0JBQXNCbUIsR0FBTTlDLEtBQUtpQixNQUFNMkMsT0FBUWQsRUFBa0JlLE9BQU81QyxRQVE3RnRCLFVBQVVDLEdBQ2JJLEtBQUsyRCxjQUFjZCxLQUFLakQsR0FNckJELFdBQ0hLLEtBQUsyRCxjQUFjRyxPQVFoQm5FLFFBQVFvRSxHQUNYL0QsS0FBSzJELGNBQWNkLEtBQUssWUFDcEJtQixVQUFhaEUsS0FBS2lCLE1BQU1sQyxNQUFNcUMsV0FDOUI2QyxjQUFpQkYsRUFBUzNDLGFBTzNCekIsVUFDSEssS0FBSzJELGNBQWNHLE9BQ25COUQsS0FBSzJELGNBQWNkLEtBQUssY0FDeEI3QyxLQUFLaUIsTUFBTTJDLE9BQU8sR0FBRyxHQU1sQmpFLFdBQ0gsT0FBT0ssS0FBS2lCLE1BQU1sQyxhQzFEWm1GLEVBQ1Z2RSx3QkFDSSxJQUFJakIsRUFBSXlGLEtBQUtDLE1BQU9wRixFQUFJbUYsS0FBS0UsT0FDN0IsY0FBZTNGLEVBRDBCLElBQ3hCTSxRQUFZTixFQURZLElBQ1ZNLFFBQVlOLEVBREYsSUFDSU0sVUFHakRXLG9CQUFvQjJFLEVBQWFDLEdBQzdCLE9BQU9KLEtBQUtLLE1BQU1MLEtBQUtFLFVBQVlFLEVBQU1ELEVBQU0sSUFBTUEsRUFHekQzRSxzQkFBc0I4RSxFQUFlQyxHQUNqQyxPQUFRRCxFQUFFRSxNQUFRRCxFQUFFRSxPQUNoQkYsRUFBRUMsTUFBUUYsRUFBRUcsT0FDWkgsRUFBRUksS0FBT0gsRUFBRUksUUFDWEosRUFBRUcsS0FBT0osRUFBRUssY0NYVEMsVUFBcUJyRixFQU8vQkMsWUFBWXFGLEVBQWVDLEVBQWVqRCxFQUFlRCxHQUNyRGYsTUFBTSxRQUFTLEVBQUcsRUFBRyxTQUhqQmhCLEtBQUFrRixhQUFlckYsRUFBRyxFQUFHQyxFQUFHLEdBSzVCRSxLQUFLaUYsTUFBUUEsRUFDYmpGLEtBQUtnQyxNQUFRQSxFQUNiaEMsS0FBSytCLE9BQVNBLEVBQ2QvQixLQUFLZ0YsTUFBUUEsRUFFYmhGLEtBQUtDLEdBQUdNLE1BQU00RSw2Q0FBK0NqQixFQUFNa0IsYUFBYSxFQUFFLDZCQUE2QmxCLEVBQU1rQixhQUFhLEVBQUUsVUFBVXBGLEtBQUtnRixlQUFlaEYsS0FBS2dGLFNBQVNkLEVBQU1rQixhQUFhLEdBQUcsU0FDdE1wRixLQUFLQyxHQUFHTSxNQUFNeUIsU0FBV2hDLEtBQUtnQyxVQUM5QmhDLEtBQUtDLEdBQUdNLE1BQU13QixVQUFZL0IsS0FBSytCLFdBRS9CL0IsS0FBS0gsRUFBSXFFLEVBQU1rQixhQUFhLEVBQUkxRCxPQUFPZ0IsV0FBYTFDLEtBQUtnQyxPQUN6RGhDLEtBQUtGLEVBQUlvRSxFQUFNa0IsYUFBYSxFQUFJbEYsU0FBU3lDLGdCQUFnQkMsYUFBZTVDLEtBQUsrQixRQUM3RS9CLEtBQUtDLEdBQUdNLE1BQU1DLHVCQUF5QlIsS0FBS0gsUUFBUUcsS0FBS0YsT0FNdERILFVBQ0hLLEtBQUtDLEdBQUd3RCxTQU1MOUQsU0FDQ0ssS0FBS0gsRUFBS0csS0FBS2tGLFlBQVlyRixFQUFJRyxLQUFLaUYsT0FBVWpGLEtBQUtILEVBQUtHLEtBQUtrRixZQUFZckYsRUFBSUcsS0FBS2lGLFFBQ2xGakYsS0FBS2tGLFlBQVlyRixFQUFJcUUsRUFBTWtCLGFBQWEsRUFBSTFELE9BQU9nQixXQUFhMUMsS0FBS2dDLFFBRXJFaEMsS0FBS0YsRUFBS0UsS0FBS2tGLFlBQVlwRixFQUFJRSxLQUFLaUYsT0FBVWpGLEtBQUtGLEVBQUtFLEtBQUtrRixZQUFZcEYsRUFBSUUsS0FBS2lGLFFBQ2xGakYsS0FBS2tGLFlBQVlwRixFQUFJb0UsRUFBTWtCLGFBQWEsRUFBSWxGLFNBQVN5QyxnQkFBZ0JDLGFBQWU1QyxLQUFLK0IsU0FHekYvQixLQUFLa0YsWUFBWXJGLEdBQUtHLEtBQUtILEVBQzNCRyxLQUFLSCxHQUFLRyxLQUFLaUYsTUFFZmpGLEtBQUtILEdBQUtHLEtBQUtpRixNQUdmakYsS0FBS2tGLFlBQVlwRixHQUFLRSxLQUFLRixFQUMzQkUsS0FBS0YsR0FBS0UsS0FBS2lGLE1BRWZqRixLQUFLRixHQUFLRSxLQUFLaUYsTUFHbkJqRixLQUFLQyxHQUFHTSxNQUFNQyx1QkFBeUJSLEtBQUtILFFBQVFHLEtBQUtGLGNDckRuRHVGLFVBQXNCM0YsRUFTaENDLGNBQ0lxQixNQUFNLFNBQVUsRUFBRyxFQUFHLFNBVGxCaEIsS0FBQStCLE9BQWlCLEdBQ2pCL0IsS0FBQWdDLE1BQWdCLEdBQ2hCaEMsS0FBQXNGLGFBQXVCLElBQ3ZCdEYsS0FBQWlGLE1BQWdCLEVBQ2hCakYsS0FBQXVGLG9CQUE4QixHQUM5QnZGLEtBQUF3RixhQUF5QixHQUFJLEdBQUksR0FBSSxJQUNyQ3hGLEtBQUF5RixlQUlKekYsS0FBS0gsRUFBSTZCLE9BQU9nQixXQUFhLEVBQUkxQyxLQUFLZ0MsTUFBUSxFQUM5Q2hDLEtBQUtGLEVBQUlJLFNBQVN5QyxnQkFBZ0JDLGFBQWUsRUFBSTVDLEtBQUsrQixPQUFTLEVBRW5FL0IsS0FBS0MsR0FBR00sTUFBTXlCLFNBQVdoQyxLQUFLZ0MsVUFDOUJoQyxLQUFLQyxHQUFHTSxNQUFNd0IsVUFBWS9CLEtBQUsrQixXQUMvQi9CLEtBQUtDLEdBQUdNLE1BQU1tRixnQkFBa0IxRixLQUFLZ0MsVUFFckNWLEVBQW1CSyxpQkFBaUIsaUJBQW1CbUIsR0FBcUI5QyxLQUFLMkYsZUFBZTdDLElBQ2hHeEIsRUFBbUJLLGlCQUFpQixlQUFpQm1CLEdBQXFCOUMsS0FBSzRGLGFBQWE5QyxJQVF4Rm5ELGVBQWVtRCxHQUNuQixJQUFJK0MsRUFBTS9DLEVBQUVFLFFBQ1JoRCxLQUFLd0YsWUFBWU0sUUFBUUQsSUFBUSxJQUF3QyxJQUFuQzdGLEtBQUt5RixZQUFZSyxRQUFRRCxJQUMvRDdGLEtBQUt5RixZQUFZTSxLQUFLRixHQVN0QmxHLGFBQWFtRCxHQUNqQixJQUFJK0MsRUFBTS9DLEVBQUVFLFFBQ1JnRCxFQUFxQmhHLEtBQUt5RixZQUFZSyxRQUFRRCxHQUM5QzdGLEtBQUt3RixZQUFZTSxRQUFRRCxJQUFRLEdBQUtHLEdBQXNCLEdBQzVEaEcsS0FBS3lGLFlBQVlRLE9BQU9ELEVBQW9CLEdBTzdDckcsU0FDSEssS0FBS3lGLFlBQVlTLFFBQVNMLElBQ3RCLE9BQVFBLEdBQ0osS0FBSyxHQUNEN0YsS0FBS0gsR0FBS0csS0FBS2lGLE1BQ2YsTUFFSixLQUFLLEdBQ0RqRixLQUFLRixHQUFLRSxLQUFLaUYsTUFDZixNQUVKLEtBQUssR0FDRGpGLEtBQUtILEdBQUtHLEtBQUtpRixNQUNmLE1BRUosS0FBSyxHQUNEakYsS0FBS0YsR0FBS0UsS0FBS2lGLE1BQ2YsTUFFSixRQUNJLFVBS1JqRixLQUFLSCxFQUFJLElBQ1RHLEtBQUtILEVBQUksR0FFVEcsS0FBS0YsRUFBSSxJQUNURSxLQUFLRixFQUFJLEdBRVRFLEtBQUtILEVBQUs2QixPQUFPZ0IsV0FBYTFDLEtBQUtnQyxRQUNuQ2hDLEtBQUtILEVBQUs2QixPQUFPZ0IsV0FBYTFDLEtBQUtnQyxPQUVuQ2hDLEtBQUtGLEVBQUtJLFNBQVN5QyxnQkFBZ0JDLGFBQWU1QyxLQUFLK0IsU0FDdkQvQixLQUFLRixFQUFLSSxTQUFTeUMsZ0JBQWdCQyxhQUFlNUMsS0FBSytCLFFBRzNEL0IsS0FBS0MsR0FBR00sTUFBTUMsdUJBQXlCUixLQUFLSCxRQUFRRyxLQUFLRixPQVF0REgsWUFBWXdHLEdBQ2ZuRyxLQUFLaUYsT0FBU2pGLEtBQUt1RixvQkFDbkJ2RixLQUFLZ0MsT0FBU2hDLEtBQUtzRixhQUNuQnRGLEtBQUsrQixRQUFVL0IsS0FBS3NGLGFBRXBCdEYsS0FBS0MsR0FBR00sTUFBTXdCLFVBQVkvQixLQUFLK0IsV0FDL0IvQixLQUFLQyxHQUFHTSxNQUFNeUIsU0FBV2hDLEtBQUtnQyxVQUM5QmhDLEtBQUtDLEdBQUdNLE1BQU1tRixnQkFBa0IxRixLQUFLZ0MsVUFDckNoQyxLQUFLQyxHQUFHTSxNQUFNNkYsZ0JBQWtCRCxFQUFNbkIsTUFNbkNyRixVQUNIMkIsRUFBbUJPLG9CQUFvQixrQkFDdkNQLEVBQW1CTyxvQkFBb0IsdUJDbEhqQ3dFLFVBQXFCM0csRUFJL0JDLGNBQ0lxQixNQUFNLFNBQVUsR0FBSSxFQUFHLFNBSjNCaEIsS0FBQXNHLFFBQWtCLEdBTWR0RyxLQUFLa0IsaUJBQ0xsQixLQUFLQyxHQUFHUSxVQUFVQyxJQUFJLFVBQVcsY0FDakNWLEtBQUtDLEdBQUdZLGNBQWMsWUFBWU0sVUFBWW5CLEtBQUtzRyxRQUFRbEYsV0FFM0RwQixLQUFLdUcsV0FBYUMsWUFBWSxJQUFNeEcsS0FBSzRELFNBQVUsS0FNL0NqRSxTQUNKSyxLQUFLc0csVUFDTHRHLEtBQUtDLEdBQUdZLGNBQWMsWUFBWU0sVUFBWW5CLEtBQUtzRyxRQUFRbEYsV0FFdkRwQixLQUFLc0csU0FBVyxHQUNoQnRHLEtBQUtDLEdBQUdRLFVBQVVnRCxPQUFPLGNBQ3pCekQsS0FBS0MsR0FBR1EsVUFBVUMsSUFBSSxlQUV0QlYsS0FBS0MsR0FBR1EsVUFBVUMsSUFBSSxjQUN0QlYsS0FBS0MsR0FBR1EsVUFBVWdELE9BQU8sY0FHUixJQUFqQnpELEtBQUtzRyxTQUNMNUUsT0FBT3VCLGNBQWMsSUFBSUMsTUFBTSxlQUloQ3ZELFVBQ0g4RyxjQUFjekcsS0FBS3VHLFlBTWY1RyxpQkFDSkssS0FBS0MsR0FBR2tCLFVBQVksb0tDckNkdUYsVUFBcUJoSCxFQVEvQkMsWUFBWWdILEVBQXFCQyxHQUM3QjVGLE1BQU0sUUFBUyxFQUFHLEdBTmRoQixLQUFBNkcsVUFHRDdHLEtBQUE4RyxRQUFTLEVBS1o5RyxLQUFLMkcsWUFBY0EsRUFDbkIzRyxLQUFLNEcsY0FBZ0JBLEVBQ3JCNUcsS0FBSytHLE9BQVMsSUFBSTFCLEVBQ2xCckYsS0FBS2dILE1BQVEsSUFBSVgsRUFFakIsSUFBSyxJQUFJcEksRUFBSSxFQUFHQSxFQUFJK0IsS0FBSzJHLFlBQWExSSxJQUNsQytCLEtBQUs2RyxPQUFPZCxLQUFLLElBQUloQixFQUFNYixFQUFNK0MsaUJBQWtCL0MsRUFBTWtCLGFBQWEsRUFBRyxHQUFJbEIsRUFBTWtCLGFBQWEsR0FBSSxLQUFNbEIsRUFBTWtCLGFBQWEsR0FBSSxPQUdySTlELEVBQW1CSyxpQkFBaUIsYUFBYyxLQUM5QzNCLEtBQUs4RyxRQUFTLEVBQ2Q5RyxLQUFLa0gsUUFBUSxrQkFPZHZILFNBQ0hLLEtBQUsrRyxPQUFPbkQsU0FDWjVELEtBQUs2RyxPQUFPWCxRQUFRLENBQUNDLEVBQU9nQixLQUN4QmhCLEVBQU12QyxTQUVGTSxFQUFNa0QsZUFBZXBILEtBQUsrRyxPQUFPTSxpQkFBa0JsQixFQUFNa0Isb0JBQXFDLElBQWhCckgsS0FBSzhHLFNBQ25GOUcsS0FBSytHLE9BQU9PLFlBQVluQixHQUN4QkEsRUFBTWUsVUFDTmxILEtBQUs2RyxPQUFPWixPQUFPa0IsRUFBTyxHQUMxQnpGLE9BQU91QixjQUFjLElBQUlzRSxZQUFZLHFCQUFzQjFELFFBQVM1QyxNQUFPakIsS0FBSzRHLGtCQUVyRCxJQUF2QjVHLEtBQUs2RyxPQUFPVyxRQUNaeEgsS0FBS2tILFFBQVEsb0JBV3JCdkgsUUFBUThILEdBQ1p6SCxLQUFLZ0gsTUFBTUUsVUFDWGxILEtBQUsrRyxPQUFPRyxVQUNabEgsS0FBSzZHLE9BQU9YLFFBQVEsQ0FBQ0MsRUFBT2dCLEtBQ3hCaEIsRUFBTWUsVUFDTmxILEtBQUs2RyxPQUFPWixPQUFPa0IsRUFBTyxLQUU5QjdGLEVBQW1CTyxvQkFBb0IsY0FDdkNILE9BQU91QixjQUFjLElBQUlDLE1BQU11RSxJQUMvQnpILEtBQUtDLEdBQUd3RCwyQkNsRUZpRSxFQUFkL0gsY0FDWUssS0FBQTJILDJCQUFxQ0MsRUFBT0MsWUFBWUMsNEJBQTRCRixFQUFPQyxZQUFZRSx5QkFBeUJILEVBQU9DLFlBQVlHLFNBQ25KaEksS0FBQWlJLDJCQUFxQ0wsRUFBT0MsWUFBWUMsNEJBQTRCRixFQUFPQyxZQUFZRSx5QkFBeUJILEVBQU9DLFlBQVlHLFNBUXBKckksVUFBVXNCLEdBQ2IsSUFBMkMsSUFBdkMyRyxFQUFPTSxnQkFBZ0JMLFlBQ3ZCLE9BQU83SCxLQUFLbUksV0FHaEIsSUFBSUMsS0FBU1IsRUFBT0MsWUFBWVEsVUFBVXJJLEtBQUtpSSxlQUMvQyxPQUFPSyxNQUFNRixHQUNUL0YsS0FBTWtHLEtBQUtDLFdBQ1B2SCxNQUFPQSxJQUVYd0gsU0FDSUMsZUFBZ0Isb0JBRXBCQyxPQUFRLE9BQ1JDLEtBQU0sU0FDUEMsS0FBS0MsR0FBWUEsRUFBU0MsUUFRMUJwSixZQUNILElBQTJDLElBQXZDaUksRUFBT00sZ0JBQWdCTCxZQUN2QixPQUFPN0gsS0FBS21JLFdBR2hCLElBQUlDLEtBQVNSLEVBQU9DLFlBQVlRLFVBQVVySSxLQUFLMkgsZUFDL0MsT0FBT1csTUFBTUYsR0FDVFEsS0FBTSxTQUNQQyxLQUFLQyxHQUFZQSxFQUFTQyxRQVF6QnBKLFdBQ0osT0FBTyxJQUFJcUosUUFBU0MsSUFDaEJBLEdBQVNDLE1BQVMsK0JDbkQ5QnhILE9BQU9DLGlCQUFpQixPQUFRLElBQU0sVUNhbENoQyxjQVRRSyxLQUFBbUosY0FBd0IsR0FDeEJuSixLQUFBb0osb0JBQThCLEVBQzlCcEosS0FBQXFKLGlCQUEyQixFQUMzQnJKLEtBQUFzSix5QkFBbUMsRUFDbkN0SixLQUFBdUosZ0JBQTBCLEdBTTlCdkosS0FBS3dKLElBQU0sSUFBSTlGLEVBQ2YxRCxLQUFLK0QsU0FBVy9ELEtBQUt5SixvQkFDckJ6SixLQUFLMEosV0FDTDFKLEtBQUs2SCxZQUFjLElBQUlILEVBQ3ZCMUgsS0FBSzZILFlBQVk4QixZQUFZZCxLQUFNZSxJQUMvQkMsUUFBUUMsSUFBSSxpQkFBa0JGLE1BR2pDLGdCQUFpQixnQkFBZ0JHLElBQUt0QyxJQUNuQy9GLE9BQU9DLGlCQUFpQjhGLEVBQVkzRSxHQUFNOUMsS0FBSzRELE9BQU9kLEVBQUVsRCxVQUUzRCxtQkFBb0Isc0JBQXVCLHNCQUFzQm1LLElBQUt0QyxJQUNuRS9GLE9BQU9DLGlCQUFpQjhGLEVBQVcsSUFBTXpILEtBQUtnSyxtQkFFbER0SSxPQUFPQyxpQkFBaUIsaUJBQWtCLElBQU0zQixLQUFLaUssV0FTakR0SyxvQkFDSixJQUFJb0UsRUFBVyxFQUNmLElBQUssSUFBSTlGLEVBQUksRUFBR0EsRUFBSStCLEtBQUttSixjQUFlbEwsSUFFcEM4RixJQURlL0QsS0FBS3FKLGtCQUEwQixJQUFOcEwsRUFBVSxFQUFLK0IsS0FBS3NKLHlCQUEyQnJMLElBQy9EK0IsS0FBS3VKLGdCQUVqQyxPQUFPeEYsRUFNSHBFLGdCQUNzQixJQUFmSyxLQUFLa0ssT0FDWmxLLEtBQUtrSyxNQUFNdEcsU0FFZnVHLHNCQUFzQixJQUFNbkssS0FBSzBKLFlBUTdCL0osT0FBT0MsR0FFWCxHQURBSSxLQUFLb0osc0JBQ0RwSixLQUFLb0osc0JBQXdCcEosS0FBS21KLGNBR2xDLE9BRkFuSixLQUFLd0osSUFBSVksUUFBUXBLLEtBQUsrRCxlQUN0Qi9ELEtBQUtxSyxZQUlUckssS0FBS3dKLElBQUljLFVBQVUxSyxHQU1mRCxnQkFDQUssS0FBS2tLLFFBQStCLElBQXRCbEssS0FBS2tLLE1BQU1wRCxTQUN6QjlHLEtBQUtxSixrQkFBb0JySixLQUFLc0osaUNBRzNCdEosS0FBS2tLLE1BQ1psSyxLQUFLd0osSUFBSWUsV0FFVHZLLEtBQUtrSyxNQUFRLElBQUl4RCxFQUFNMUcsS0FBS3FKLGlCQUFrQnJKLEtBQUt1SixpQkFNL0M1SixVQUNKSyxLQUFLd0osSUFBSVMsVUFDVGpLLEtBQUtvSixvQkFBc0IsRUFDM0JwSixLQUFLcUosaUJBQW1CLEVBTXBCMUosWUFDSixJQUFJc0IsRUFBUWpCLEtBQUt3SixJQUFJZ0IsV0FDckJ4SyxLQUFLNkgsWUFBWXdDLFVBQVVwSixHQUFPNEgsS0FBTWUsSUFDcENDLFFBQVFDLElBQUksOEJBQStCRiIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAxKTtcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIERvbUVsZW1lbnQge1xuICAgIHByb3RlY3RlZCBlbDogSFRNTEVsZW1lbnQ7XG4gICAgcHJvdGVjdGVkIHg6IG51bWJlcjtcbiAgICBwcm90ZWN0ZWQgeTogbnVtYmVyO1xuXG4gICAgY29uc3RydWN0b3IodHlwZTogc3RyaW5nLCB4OiBudW1iZXIsIHk6IG51bWJlciwgcGFyZW50Q2xhc3M6IHN0cmluZyA9ICcnKSB7XG4gICAgICAgIHRoaXMueCA9IHg7XG4gICAgICAgIHRoaXMueSA9IHk7XG5cbiAgICAgICAgdGhpcy5lbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBsZXQgbWFpbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluJyk7XG4gICAgICAgIGlmIChtYWluID09PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCI8bWFpbj4gZWxlbWVudCBkb2Vzbid0IGV4aXN0IVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vLTEgY2hlY2sgaXMgdG8gbGV0IENTUyBkbyBpdHMgb3duIGpvYiBAdG9kbyBjbGVhbmVyIHNvbHV0aW9uP1xuICAgICAgICBpZiAodGhpcy54ID4gLTEgJiYgdGhpcy55ID4gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuZWwuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgke3RoaXMueH1weCwgJHt0aGlzLnl9cHgpYDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoYGdhbWUtJHt0eXBlfWApO1xuXG4gICAgICAgIGlmIChwYXJlbnRDbGFzcyA9PT0gJycpIHtcbiAgICAgICAgICAgIG1haW4uYXBwZW5kQ2hpbGQodGhpcy5lbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZXQgcGFyZW50RWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuZ2FtZS0ke3BhcmVudENsYXNzfWApO1xuICAgICAgICAgICAgaWYgKHBhcmVudEVsID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGA8LmdhbWUtJHtwYXJlbnRDbGFzc30+IGVsZW1lbnQgZG9lc24ndCBleGlzdCFgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBhcmVudEVsLmFwcGVuZENoaWxkKHRoaXMuZWwpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMgQ2xpZW50UmVjdFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRDbGllbnRSZWFjdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgfVxufVxuIiwiaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL2hlbHBlcnMvZG9tZWxlbWVudFwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTY29yZSBleHRlbmRzIERvbUVsZW1lbnQge1xuICAgIHByaXZhdGUgc2NvcmU6IG51bWJlciA9IDA7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ3Njb3JlJywgLTEsIC0xLCAnZ3VpJyk7XG5cbiAgICAgICAgdGhpcy5yZW5kZXJUZW1wbGF0ZSgpO1xuICAgICAgICB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoJy5zY29yZS1jb3VudCcpLmlubmVySFRNTCA9IHRoaXMuc2NvcmUudG9TdHJpbmcoKTtcbiAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QuYWRkKCdtZXNzYWdlJywgJ2lzLXdhcm5pbmcnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZSBjdXJyZW50IHNjb3JlXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNjb3JlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgc2NvcmUgYmFzZWQgb24gYSBDdXN0b20gRXZlbnQgZnJvbSB0aGUgQmxvY2sgb2JqZWN0XG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2NvcmVcbiAgICAgKiBAcGFyYW0gW3Jlc2V0XVxuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGUoc2NvcmU6IG51bWJlciwgcmVzZXQ6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgICAgICB0aGlzLnNjb3JlID0gcmVzZXQgPyBzY29yZSA6IHRoaXMuc2NvcmUgKyBzY29yZTtcbiAgICAgICAgdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcuc2NvcmUtY291bnQnKS5pbm5lckhUTUwgPSB0aGlzLnNjb3JlLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVtcGxhdGUgbmVlZGVkIHRvIHNob3cgbW9yZSBlbGVtZW50c1xuICAgICAqL1xuICAgIHByaXZhdGUgcmVuZGVyVGVtcGxhdGUoKSB7XG4gICAgICAgIHRoaXMuZWwuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lc3NhZ2UtYm9keVwiPlxuICAgICAgICAgICAgICAgIDxzcGFuPnNjb3JlOiA8L3NwYW4+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJzY29yZS1jb3VudFwiPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICBgO1xuICAgIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFdpbmRvd0V2ZW50SGFuZGxlciB7XG4gICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb25NYXA6IHsgW2s6IHN0cmluZ106IGFueSB9ID0ge307XG5cbiAgICBwdWJsaWMgc3RhdGljIGFkZEV2ZW50TGlzdGVuZXIoZXZlbnQ6IHN0cmluZywgZnVuYzogYW55KSB7XG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5mdW5jdGlvbk1hcFtldmVudF0gPSBmdW5jO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihldmVudC5zcGxpdCgnLicpWzBdLCBXaW5kb3dFdmVudEhhbmRsZXIuZnVuY3Rpb25NYXBbZXZlbnRdKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIHJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQ6IHN0cmluZykge1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudC5zcGxpdCgnLicpWzBdLCBXaW5kb3dFdmVudEhhbmRsZXIuZnVuY3Rpb25NYXBbZXZlbnRdKTtcbiAgICAgICAgZGVsZXRlIFdpbmRvd0V2ZW50SGFuZGxlci5mdW5jdGlvbk1hcFtldmVudF07XG4gICAgfVxufVxuIiwiaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL2hlbHBlcnMvZG9tZWxlbWVudFwiO1xuaW1wb3J0IFdpbmRvd0V2ZW50SGFuZGxlciBmcm9tIFwiLi4vaGVscGVycy93aW5kb3dldmVudGhhbmRsZXJcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWVzc2FnZVNjcmVlbiBleHRlbmRzIERvbUVsZW1lbnQge1xuICAgIHByaXZhdGUgaGVpZ2h0OiBudW1iZXIgPSAyMDA7XG4gICAgcHJpdmF0ZSB3aWR0aDogbnVtYmVyID0gNDAwO1xuICAgIHByaXZhdGUgY3VycmVudEV2ZW50ITogc3RyaW5nO1xuICAgIHByaXZhdGUgaXNBY3RpdmU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIHByaXZhdGUgbWVzc2FnZXM6IHsgW2s6IHN0cmluZ106IHsgJ2hlYWRlcic6IHN0cmluZywgJ2JvZHknOiBzdHJpbmcsICdjbGFzc05hbWUnOiBzdHJpbmcgfSB9ID0ge1xuICAgICAgICAnZ2FtZTpzdGFydCc6IHtcbiAgICAgICAgICAgICdoZWFkZXInOiAnV2VsY29tZSB0byBCbG9jay1vLUJsb2NrIScsXG4gICAgICAgICAgICAnYm9keSc6ICdJdFxcJ3MgdGltZSB0byBjYXRjaCB0aGVtIGJsb2NrcyE8YnIvPjxici8+VXNlIHlvdXIgYXJyb3cga2V5cyB0byBtb3ZlIHlvdXIgcGxheWVyIGFyb3VuZCBhbmQgcHJlc3Mgc3BhY2UgdG8gc3RhcnQuJyxcbiAgICAgICAgICAgICdjbGFzc05hbWUnOiAnaXMtaW5mbydcbiAgICAgICAgfSxcbiAgICAgICAgJ2dhbWU6ZW5kJzoge1xuICAgICAgICAgICAgJ2hlYWRlcic6ICdZb3VyIGdhbWUgaXMgb3ZlciEnLFxuICAgICAgICAgICAgJ2JvZHknOiAnWW91IG1hZGUgaXQsIHlvdXIgZmluYWwgc2NvcmUgaXMgX19TQ09SRV9fIG91dCBvZiBtYXggX19NQVhfU0NPUkVfXyBwb2ludHMuPGJyLz48YnIvPlRoYW5rcyBmb3IgcGxheWluZywgcHJlc3Mgc3BhY2UgdG8gcmVzdGFydCB0aGUgbWFkbmVzcycsXG4gICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2lzLXN1Y2Nlc3MnXG4gICAgICAgIH0sXG4gICAgICAgICdsZXZlbDpzdWNjZXNzJzoge1xuICAgICAgICAgICAgJ2hlYWRlcic6ICdZRUFIISBMZXZlbCBjb21wbGV0ZWQhJyxcbiAgICAgICAgICAgICdib2R5JzogJ1BlcmZvcm1pbmcgbGlrZSBhIGJvc3MhIFByZXNzIHNwYWNlIHRvIHByb2NlZWQgdG8gdGhlIG5leHQgbGV2ZWwgYW5kIGNhdGNoIGV2ZW4gbW9yZSBibG9ja3MnLFxuICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdpcy1zdWNjZXNzJ1xuICAgICAgICB9LFxuICAgICAgICAnbGV2ZWw6ZmFpbGVkJzoge1xuICAgICAgICAgICAgJ2hlYWRlcic6ICdBQUghIExldmVsIGZhaWxlZCEnLFxuICAgICAgICAgICAgJ2JvZHknOiAnVHJ5IGFnYWluIGFuZCBzaG93IHVzIHdoYXQgeW91XFwncmUgbWFkZSBvZmYhIFByZXNzIHNwYWNlIHRvIHJlc3RhcnQgdGhpcyBsZXZlbCcsXG4gICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2lzLWRhbmdlcidcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ21lc3NhZ2VzY3JlZW4nLCAwLCAwLCAnZ3VpJyk7XG5cbiAgICAgICAgdGhpcy54ID0gd2luZG93Lm91dGVyV2lkdGggLyAyIC0gdGhpcy53aWR0aCAvIDI7XG4gICAgICAgIHRoaXMueSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLyAyIC0gdGhpcy5oZWlnaHQgLyAyO1xuXG4gICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LmFkZCgnbWVzc2FnZScpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLndpZHRoID0gYCR7dGhpcy53aWR0aH1weGA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgke3RoaXMueH1weCwgJHt0aGlzLnl9cHgpYDtcblxuICAgICAgICB0aGlzLnJlbmRlclRlbXBsYXRlKCk7XG4gICAgICAgIHRoaXMuc2hvdygnZ2FtZTpzdGFydCcpO1xuICAgICAgICBXaW5kb3dFdmVudEhhbmRsZXIuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAubWVzc2FnZXNjcmVlbicsIChlOiBLZXlib2FyZEV2ZW50KSA9PiB0aGlzLmtleUJvYXJkSGFuZGxlcihlKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIHRoZSBzcGFjZWJhclxuICAgICAqXG4gICAgICogQHBhcmFtIHtLZXlib2FyZEV2ZW50fSBlXG4gICAgICovXG4gICAga2V5Qm9hcmRIYW5kbGVyKGU6IEtleWJvYXJkRXZlbnQpIHtcbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMzIgJiYgdGhpcy5pc0FjdGl2ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KGAke3RoaXMuY3VycmVudEV2ZW50fTpjbGlja2ApKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNob3cgdGhlIGRlc2lyZWQgbWVzc2FnZSAodHlwZSBtYXRjaGVzIGluZGV4IGluIG9iamVjdClcbiAgICAgKlxuICAgICAqIEBwYXJhbSB0eXBlXG4gICAgICogQHBhcmFtIFtib2R5UmVwbGFjZW1lbnRzXVxuICAgICAqL1xuICAgIHB1YmxpYyBzaG93KHR5cGU6IHN0cmluZywgYm9keVJlcGxhY2VtZW50czogeyBbazogc3RyaW5nXTogc3RyaW5nIH0gPSB7fSkge1xuICAgICAgICBsZXQgbWVzc2FnZUhlYWRlciA9IHRoaXMubWVzc2FnZXNbdHlwZV0uaGVhZGVyO1xuICAgICAgICBsZXQgbWVzc2FnZUJvZHkgPSB0aGlzLm1lc3NhZ2VzW3R5cGVdLmJvZHk7XG4gICAgICAgIGZvciAobGV0IHJlcGxhY2VtZW50IGluIGJvZHlSZXBsYWNlbWVudHMpIHtcbiAgICAgICAgICAgIG1lc3NhZ2VCb2R5ID0gbWVzc2FnZUJvZHkucmVwbGFjZShyZXBsYWNlbWVudCwgYm9keVJlcGxhY2VtZW50c1tyZXBsYWNlbWVudF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcubWVzc2FnZS1oZWFkZXInKS5pbm5lckhUTUwgPSBtZXNzYWdlSGVhZGVyO1xuICAgICAgICB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoJy5tZXNzYWdlLWJvZHknKS5pbm5lckhUTUwgPSBtZXNzYWdlQm9keTtcblxuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoJ3Nob3cnLCB0aGlzLm1lc3NhZ2VzW3R5cGVdLmNsYXNzTmFtZSk7XG4gICAgICAgIHRoaXMuY3VycmVudEV2ZW50ID0gdHlwZTtcbiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGlkZSBtZXNzYWdlIG9uIHNjcmVlblxuICAgICAqL1xuICAgIHB1YmxpYyBoaWRlKCkge1xuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnLCAnaXMtaW5mbycsICdpcy1zdWNjZXNzJywgJ2lzLWRhbmdlcicpO1xuICAgICAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVtcGxhdGUgbmVlZGVkIHRvIHNob3cgbW9yZSBlbGVtZW50c1xuICAgICAqL1xuICAgIHByaXZhdGUgcmVuZGVyVGVtcGxhdGUoKSB7XG4gICAgICAgIHRoaXMuZWwuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lc3NhZ2UtaGVhZGVyXCI+PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVzc2FnZS1ib2R5XCI+PC9kaXY+XG4gICAgICAgIGA7XG4gICAgfVxufVxuIiwiaW1wb3J0IFNjb3JlIGZyb20gJy4vc2NvcmUnO1xuaW1wb3J0IE1lc3NhZ2VTY3JlZW4gZnJvbSAnLi9tZXNzYWdlc2NyZWVuJztcbmltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuLi9oZWxwZXJzL2RvbWVsZW1lbnRcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR1VJIGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgcHJpdmF0ZSBzY29yZTogU2NvcmU7XG4gICAgcHJpdmF0ZSBtZXNzYWdlU2NyZWVuOiBNZXNzYWdlU2NyZWVuO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCdndWknLCAwLCAwKTtcblxuICAgICAgICB0aGlzLnNjb3JlID0gbmV3IFNjb3JlKCk7XG4gICAgICAgIHRoaXMubWVzc2FnZVNjcmVlbiA9IG5ldyBNZXNzYWdlU2NyZWVuKCk7XG5cbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xldmVsOnNjb3JlVXBkYXRlJywgKGUpID0+IHRoaXMuc2NvcmUudXBkYXRlKChlIGFzIEN1c3RvbUV2ZW50KS5kZXRhaWwuc2NvcmUpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgd2hlbiBhIGxldmVsIGlzIGRvbmVcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlXG4gICAgICovXG4gICAgcHVibGljIGxldmVsRG9uZSh0eXBlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlU2NyZWVuLnNob3codHlwZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIHdoZW4gYSBuZXcgbGV2ZWwgc3RhcnRzXG4gICAgICovXG4gICAgcHVibGljIG5ld0xldmVsKCkge1xuICAgICAgICB0aGlzLm1lc3NhZ2VTY3JlZW4uaGlkZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCB3aGVuIHRoZSBnYW1lIGlzIGRvbmVcbiAgICAgKlxuICAgICAqIEBwYXJhbSBtYXhTY29yZVxuICAgICAqL1xuICAgIHB1YmxpYyBnYW1lRW5kKG1heFNjb3JlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlU2NyZWVuLnNob3coJ2dhbWU6ZW5kJywge1xuICAgICAgICAgICAgJ19fU0NPUkVfXyc6IHRoaXMuc2NvcmUuZ2V0KCkudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICdfX01BWF9TQ09SRV9fJzogbWF4U2NvcmUudG9TdHJpbmcoKVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgd2hlbiB3ZSBuZWVkIHRvIHJlc3RhcnQsIGdvIHRvIGZpcnN0IHNjcmVlbiBhbmQgc2V0IHNjb3JlIHRvIDBcbiAgICAgKi9cbiAgICBwdWJsaWMgcmVzdGFydCgpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlU2NyZWVuLmhpZGUoKTtcbiAgICAgICAgdGhpcy5tZXNzYWdlU2NyZWVuLnNob3coJ2dhbWU6c3RhcnQnKTtcbiAgICAgICAgdGhpcy5zY29yZS51cGRhdGUoMCwgdHJ1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge251bWJlcn1cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0U2NvcmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNjb3JlLmdldCgpO1xuICAgIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFV0aWxzIHtcbiAgICBzdGF0aWMgZ2V0UmFuZG9tQ29sb3IoKSB7XG4gICAgICAgIGxldCBvID0gTWF0aC5yb3VuZCwgciA9IE1hdGgucmFuZG9tLCBzID0gMjU1O1xuICAgICAgICByZXR1cm4gYHJnYmEoJHtvKHIoKSAqIHMpfSwke28ocigpICogcyl9LCR7byhyKCkgKiBzKX0sMSlgO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRSYW5kb21JbnQobWluOiBudW1iZXIsIG1heDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpICsgbWluO1xuICAgIH1cblxuICAgIHN0YXRpYyBjaGVja0NvbGxpc2lvbihhOiBDbGllbnRSZWN0LCBiOiBDbGllbnRSZWN0KSB7XG4gICAgICAgIHJldHVybiAoYS5sZWZ0IDw9IGIucmlnaHQgJiZcbiAgICAgICAgICAgIGIubGVmdCA8PSBhLnJpZ2h0ICYmXG4gICAgICAgICAgICBhLnRvcCA8PSBiLmJvdHRvbSAmJlxuICAgICAgICAgICAgYi50b3AgPD0gYS5ib3R0b20pO1xuICAgIH1cbn1cbiIsImltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuLi9oZWxwZXJzL2RvbWVsZW1lbnRcIjtcbmltcG9ydCBVdGlscyBmcm9tIFwiLi4vaGVscGVycy91dGlsc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCbG9jayBleHRlbmRzIERvbUVsZW1lbnQge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgc3BlZWQ6IG51bWJlcjtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHdpZHRoOiBudW1iZXI7XG4gICAgcHJpdmF0ZSByZWFkb25seSBoZWlnaHQ6IG51bWJlcjtcbiAgICBwdWJsaWMgY29sb3I6IHN0cmluZztcbiAgICBwcml2YXRlIGRlc3RpbmF0aW9uID0ge3g6IDAsIHk6IDB9O1xuXG4gICAgY29uc3RydWN0b3IoY29sb3I6IHN0cmluZywgc3BlZWQ6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIoJ2Jsb2NrJywgMCwgMCwgJ2xldmVsJyk7XG5cbiAgICAgICAgdGhpcy5zcGVlZCA9IHNwZWVkO1xuICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICB0aGlzLmNvbG9yID0gY29sb3I7XG5cbiAgICAgICAgdGhpcy5lbC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgcmVwZWF0aW5nLWxpbmVhci1ncmFkaWVudCgke1V0aWxzLmdldFJhbmRvbUludCgwLDM2MCl9ZGVnLCAjMDAwMDAwLCAjMDAwMDAwICR7VXRpbHMuZ2V0UmFuZG9tSW50KDIsMTApfXB4LCAke3RoaXMuY29sb3J9IDEwcHgsICR7dGhpcy5jb2xvcn0gJHtVdGlscy5nZXRSYW5kb21JbnQoMjAsNDApfXB4KWA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUud2lkdGggPSBgJHt0aGlzLndpZHRofXB4YDtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5oZWlnaHQgPSBgJHt0aGlzLmhlaWdodH1weGA7XG5cbiAgICAgICAgdGhpcy54ID0gVXRpbHMuZ2V0UmFuZG9tSW50KDAsICh3aW5kb3cub3V0ZXJXaWR0aCAtIHRoaXMud2lkdGgpKTtcbiAgICAgICAgdGhpcy55ID0gVXRpbHMuZ2V0UmFuZG9tSW50KDAsIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gdGhpcy5oZWlnaHQpKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7dGhpcy54fXB4LCAke3RoaXMueX1weClgO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZXIgZm9yIGNsaWNraW5nIHRoZSBibG9ja3NcbiAgICAgKi9cbiAgICBwdWJsaWMgZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5lbC5yZW1vdmUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYWluIHVwZGF0ZSBoYW5kbGVyIGZvciB0aGUgZ2FtZSBmb3IgbW92aW5nIG91ciBibG9jayByYW5kb21seSBvdmVyIHRoZSBzY3JlZW5cbiAgICAgKi9cbiAgICBwdWJsaWMgdXBkYXRlKCkge1xuICAgICAgICBpZiAodGhpcy54ID4gKHRoaXMuZGVzdGluYXRpb24ueCAtIHRoaXMuc3BlZWQpICYmIHRoaXMueCA8ICh0aGlzLmRlc3RpbmF0aW9uLnggKyB0aGlzLnNwZWVkKSkge1xuICAgICAgICAgICAgdGhpcy5kZXN0aW5hdGlvbi54ID0gVXRpbHMuZ2V0UmFuZG9tSW50KDAsICh3aW5kb3cub3V0ZXJXaWR0aCAtIHRoaXMud2lkdGgpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy55ID4gKHRoaXMuZGVzdGluYXRpb24ueSAtIHRoaXMuc3BlZWQpICYmIHRoaXMueSA8ICh0aGlzLmRlc3RpbmF0aW9uLnkgKyB0aGlzLnNwZWVkKSkge1xuICAgICAgICAgICAgdGhpcy5kZXN0aW5hdGlvbi55ID0gVXRpbHMuZ2V0UmFuZG9tSW50KDAsIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gdGhpcy5oZWlnaHQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmRlc3RpbmF0aW9uLnggPj0gdGhpcy54KSB7XG4gICAgICAgICAgICB0aGlzLnggKz0gdGhpcy5zcGVlZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMueCAtPSB0aGlzLnNwZWVkO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZGVzdGluYXRpb24ueSA+PSB0aGlzLnkpIHtcbiAgICAgICAgICAgIHRoaXMueSArPSB0aGlzLnNwZWVkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy55IC09IHRoaXMuc3BlZWQ7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVsLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHt0aGlzLnh9cHgsICR7dGhpcy55fXB4KWA7XG4gICAgfVxufVxuIiwiaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL2hlbHBlcnMvZG9tZWxlbWVudFwiO1xuaW1wb3J0IEJsb2NrIGZyb20gXCIuL2Jsb2NrXCI7XG5pbXBvcnQgV2luZG93RXZlbnRIYW5kbGVyIGZyb20gXCIuLi9oZWxwZXJzL3dpbmRvd2V2ZW50aGFuZGxlclwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQbGF5ZXIgZXh0ZW5kcyBEb21FbGVtZW50IHtcbiAgICBwcml2YXRlIGhlaWdodDogbnVtYmVyID0gMTA7XG4gICAgcHJpdmF0ZSB3aWR0aDogbnVtYmVyID0gMTA7XG4gICAgcHJpdmF0ZSBncm93dGhGYWN0b3I6IG51bWJlciA9IDEuNTtcbiAgICBwcml2YXRlIHNwZWVkOiBudW1iZXIgPSAyO1xuICAgIHByaXZhdGUgc3BlZWRJbmNyZWFzZUZhY3RvcjogbnVtYmVyID0gMC4yO1xuICAgIHByaXZhdGUga2V5c0FsbG93ZWQ6IG51bWJlcltdID0gWzM3LCAzOCwgMzksIDQwXTtcbiAgICBwcml2YXRlIGtleXNQcmVzc2VkOiBudW1iZXJbXSA9IFtdO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCdwbGF5ZXInLCAwLCAwLCAnbGV2ZWwnKTtcbiAgICAgICAgdGhpcy54ID0gd2luZG93Lm91dGVyV2lkdGggLyAyIC0gdGhpcy53aWR0aCAvIDI7XG4gICAgICAgIHRoaXMueSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLyAyIC0gdGhpcy5oZWlnaHQgLyAyO1xuXG4gICAgICAgIHRoaXMuZWwuc3R5bGUud2lkdGggPSBgJHt0aGlzLndpZHRofXB4YDtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5oZWlnaHQgPSBgJHt0aGlzLmhlaWdodH1weGA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuYm9yZGVyUmFkaXVzID0gYCR7dGhpcy53aWR0aH1weGA7XG5cbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24ucGxheWVyJywgKGU6IEtleWJvYXJkRXZlbnQpID0+IHRoaXMua2V5RG93bkhhbmRsZXIoZSkpO1xuICAgICAgICBXaW5kb3dFdmVudEhhbmRsZXIuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAucGxheWVyJywgKGU6IEtleWJvYXJkRXZlbnQpID0+IHRoaXMua2V5VXBIYW5kbGVyKGUpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBLZXkgZG93biBoYW5kbGVyIGZvciBtb3ZpbmcgdGhlIHBsYXllclxuICAgICAqXG4gICAgICogQHBhcmFtIGVcbiAgICAgKi9cbiAgICBwcml2YXRlIGtleURvd25IYW5kbGVyKGU6IEtleWJvYXJkRXZlbnQpIHtcbiAgICAgICAgbGV0IGtleSA9IGUua2V5Q29kZTtcbiAgICAgICAgaWYgKHRoaXMua2V5c0FsbG93ZWQuaW5kZXhPZihrZXkpID4gLTEgJiYgdGhpcy5rZXlzUHJlc3NlZC5pbmRleE9mKGtleSkgPT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLmtleXNQcmVzc2VkLnB1c2goa2V5KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEtleSBkb3duIGhhbmRsZXIgZm9yIG1vdmluZyB0aGUgcGxheWVyXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZVxuICAgICAqL1xuICAgIHByaXZhdGUga2V5VXBIYW5kbGVyKGU6IEtleWJvYXJkRXZlbnQpIHtcbiAgICAgICAgbGV0IGtleSA9IGUua2V5Q29kZTtcbiAgICAgICAgbGV0IGtleVByZXNzZWRQb3NpdGlvbiA9IHRoaXMua2V5c1ByZXNzZWQuaW5kZXhPZihrZXkpO1xuICAgICAgICBpZiAodGhpcy5rZXlzQWxsb3dlZC5pbmRleE9mKGtleSkgPiAtMSAmJiBrZXlQcmVzc2VkUG9zaXRpb24gPiAtMSkge1xuICAgICAgICAgICAgdGhpcy5rZXlzUHJlc3NlZC5zcGxpY2Uoa2V5UHJlc3NlZFBvc2l0aW9uLCAxKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgYWN0dWFsIHBvc2l0aW9uIGJhc2VkIG9uIGVhcmxpZXIgZXZlbnRzXG4gICAgICovXG4gICAgcHVibGljIHVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5rZXlzUHJlc3NlZC5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgICAgICAgICAgY2FzZSAzNzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy54IC09IHRoaXMuc3BlZWQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAzODpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy55IC09IHRoaXMuc3BlZWQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAzOTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy54ICs9IHRoaXMuc3BlZWQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSA0MDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy55ICs9IHRoaXMuc3BlZWQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvL0NoZWNrcyB0byBzdGF5IGluIGJvdW5kc1xuICAgICAgICBpZiAodGhpcy54IDwgMCkge1xuICAgICAgICAgICAgdGhpcy54ID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy55IDwgMCkge1xuICAgICAgICAgICAgdGhpcy55ID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy54ID4gKHdpbmRvdy5vdXRlcldpZHRoIC0gdGhpcy53aWR0aCkpIHtcbiAgICAgICAgICAgIHRoaXMueCA9ICh3aW5kb3cub3V0ZXJXaWR0aCAtIHRoaXMud2lkdGgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnkgPiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAtIHRoaXMuaGVpZ2h0KSkge1xuICAgICAgICAgICAgdGhpcy55ID0gKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLSB0aGlzLmhlaWdodCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVsLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHt0aGlzLnh9cHgsICR7dGhpcy55fXB4KWA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIHBsYXllciB3aGVuIGEgYmxvY2sgZ290IGNhdWdodFxuICAgICAqXG4gICAgICogQHBhcmFtIGJsb2NrXG4gICAgICovXG4gICAgcHVibGljIGJsb2NrQ2F1Z2h0KGJsb2NrOiBCbG9jaykge1xuICAgICAgICB0aGlzLnNwZWVkICs9IHRoaXMuc3BlZWRJbmNyZWFzZUZhY3RvcjtcbiAgICAgICAgdGhpcy53aWR0aCArPSB0aGlzLmdyb3d0aEZhY3RvcjtcbiAgICAgICAgdGhpcy5oZWlnaHQgKz0gdGhpcy5ncm93dGhGYWN0b3I7XG5cbiAgICAgICAgdGhpcy5lbC5zdHlsZS5oZWlnaHQgPSBgJHt0aGlzLmhlaWdodH1weGA7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUud2lkdGggPSBgJHt0aGlzLndpZHRofXB4YDtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5ib3JkZXJSYWRpdXMgPSBgJHt0aGlzLndpZHRofXB4YDtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBibG9jay5jb2xvcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbGVhbiB1cCFcbiAgICAgKi9cbiAgICBwdWJsaWMgZGVzdHJveSgpIHtcbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24ucGxheWVyJyk7XG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXl1cC5wbGF5ZXInKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgRG9tRWxlbWVudCBmcm9tIFwiLi4vaGVscGVycy9kb21lbGVtZW50XCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRpbWVyIGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gICAgc2Vjb25kczogbnVtYmVyID0gMTA7XG4gICAgaW50ZXJ2YWxJZDogbnVtYmVyO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCd0aW1lcicsIC0xLCAtMSwgJ2xldmVsJyk7XG5cbiAgICAgICAgdGhpcy5yZW5kZXJUZW1wbGF0ZSgpO1xuICAgICAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoJ21lc3NhZ2UnLCAnaXMtcHJpbWFyeScpO1xuICAgICAgICB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoJy5zZWNvbmRzJykuaW5uZXJIVE1MID0gdGhpcy5zZWNvbmRzLnRvU3RyaW5nKCk7XG5cbiAgICAgICAgdGhpcy5pbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoKCkgPT4gdGhpcy51cGRhdGUoKSwgMTAwMCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ291bnRkb3duIG9mIHNlY29uZHNcbiAgICAgKi9cbiAgICBwcml2YXRlIHVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5zZWNvbmRzLS07XG4gICAgICAgIHRoaXMuZWwucXVlcnlTZWxlY3RvcignLnNlY29uZHMnKS5pbm5lckhUTUwgPSB0aGlzLnNlY29uZHMudG9TdHJpbmcoKTtcblxuICAgICAgICBpZiAodGhpcy5zZWNvbmRzIDw9IDMpIHtcbiAgICAgICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LnJlbW92ZSgnaXMtcHJpbWFyeScpO1xuICAgICAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QuYWRkKCdpcy1kYW5nZXInKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LmFkZCgnaXMtcHJpbWFyeScpO1xuICAgICAgICAgICAgdGhpcy5lbC5jbGFzc0xpc3QucmVtb3ZlKCdpcy1kYW5nZXInKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnNlY29uZHMgPT09IDApIHtcbiAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgndGltZXI6ZG9uZScpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBkZXN0cm95KCkge1xuICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVtcGxhdGUgbmVlZGVkIHRvIHNob3cgbW9yZSBlbGVtZW50c1xuICAgICAqL1xuICAgIHByaXZhdGUgcmVuZGVyVGVtcGxhdGUoKSB7XG4gICAgICAgIHRoaXMuZWwuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lc3NhZ2UtYm9keVwiPlxuICAgICAgICAgICAgICAgIDxzcGFuPnRpbWU6IDwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInNlY29uZHNcIj48L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcbiAgICB9XG59XG4iLCJpbXBvcnQgRG9tRWxlbWVudCBmcm9tIFwiLi4vaGVscGVycy9kb21lbGVtZW50XCI7XG5pbXBvcnQgQmxvY2sgZnJvbSBcIi4vYmxvY2tcIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vcGxheWVyXCI7XG5pbXBvcnQgVGltZXIgZnJvbSBcIi4vdGltZXJcIjtcbmltcG9ydCBVdGlscyBmcm9tIFwiLi4vaGVscGVycy91dGlsc1wiO1xuaW1wb3J0IFdpbmRvd0V2ZW50SGFuZGxlciBmcm9tIFwiLi4vaGVscGVycy93aW5kb3dldmVudGhhbmRsZXJcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGV2ZWwgZXh0ZW5kcyBEb21FbGVtZW50IHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHRvdGFsQmxvY2tzOiBudW1iZXI7XG4gICAgcHJpdmF0ZSByZWFkb25seSBzY29yZVBlckJsb2NrOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBibG9ja3M6IEJsb2NrW10gPSBbXTtcbiAgICBwcml2YXRlIHBsYXllcjogUGxheWVyO1xuICAgIHByaXZhdGUgdGltZXI6IFRpbWVyO1xuICAgIHB1YmxpYyBmYWlsZWQgPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKHRvdGFsQmxvY2tzOiBudW1iZXIsIHNjb3JlUGVyQmxvY2s6IG51bWJlcikge1xuICAgICAgICBzdXBlcignbGV2ZWwnLCAwLCAwKTtcblxuICAgICAgICB0aGlzLnRvdGFsQmxvY2tzID0gdG90YWxCbG9ja3M7XG4gICAgICAgIHRoaXMuc2NvcmVQZXJCbG9jayA9IHNjb3JlUGVyQmxvY2s7XG4gICAgICAgIHRoaXMucGxheWVyID0gbmV3IFBsYXllcigpO1xuICAgICAgICB0aGlzLnRpbWVyID0gbmV3IFRpbWVyKCk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRvdGFsQmxvY2tzOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuYmxvY2tzLnB1c2gobmV3IEJsb2NrKFV0aWxzLmdldFJhbmRvbUNvbG9yKCksIFV0aWxzLmdldFJhbmRvbUludCgxLCA1KSwgVXRpbHMuZ2V0UmFuZG9tSW50KDEwLCAxNTApLCBVdGlscy5nZXRSYW5kb21JbnQoMTAsIDE1MCkpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIFdpbmRvd0V2ZW50SGFuZGxlci5hZGRFdmVudExpc3RlbmVyKCd0aW1lcjpkb25lJywgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5mYWlsZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5kZXN0cm95KCdsZXZlbDpmYWlsZWQnKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGZvciBjb2xsaXNpb24gYW5kIHBvdGVudGlhbCBzdWNjZXNzIG9mIHRoaXMgbGV2ZWxcbiAgICAgKi9cbiAgICBwdWJsaWMgdXBkYXRlKCkge1xuICAgICAgICB0aGlzLnBsYXllci51cGRhdGUoKTtcbiAgICAgICAgdGhpcy5ibG9ja3MuZm9yRWFjaCgoYmxvY2ssIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBibG9jay51cGRhdGUoKTtcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmNoZWNrQ29sbGlzaW9uKHRoaXMucGxheWVyLmdldENsaWVudFJlYWN0KCksIGJsb2NrLmdldENsaWVudFJlYWN0KCkpICYmIHRoaXMuZmFpbGVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLmJsb2NrQ2F1Z2h0KGJsb2NrKTtcbiAgICAgICAgICAgICAgICBibG9jay5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5ibG9ja3Muc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2xldmVsOnNjb3JlVXBkYXRlJywge2RldGFpbDoge3Njb3JlOiB0aGlzLnNjb3JlUGVyQmxvY2t9fSkpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYmxvY2tzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRlc3Ryb3koJ2xldmVsOnN1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlc3Ryb3kgb2JqZWN0ICYgdGltZXIgYW5kIHRyaWdnZXIgZXZlbnQgdG8gbm90aWZ5IHRoZSB3b3JsZCBhYm91dCB0aGUgc3RhdHVzIG9mIHRoaXMgbGV2ZWxcbiAgICAgKlxuICAgICAqIEBwYXJhbSBldmVudFR5cGVcbiAgICAgKi9cbiAgICBwcml2YXRlIGRlc3Ryb3koZXZlbnRUeXBlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy50aW1lci5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMucGxheWVyLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5ibG9ja3MuZm9yRWFjaCgoYmxvY2ssIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBibG9jay5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLmJsb2Nrcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9KTtcbiAgICAgICAgV2luZG93RXZlbnRIYW5kbGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RpbWVyOmRvbmUnKTtcbiAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KGV2ZW50VHlwZSkpO1xuICAgICAgICB0aGlzLmVsLnJlbW92ZSgpO1xuICAgIH1cbn1cbiIsImltcG9ydCBjb25maWcgZnJvbSAnLi9jb25maWcuanNvbic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERhdGFTZXJ2aWNlIHtcbiAgICBwcml2YXRlIGVuZFBvaW50TGlzdDogc3RyaW5nID0gYC9kYXRhYmFzZXMvJHtjb25maWcuZGF0YVNlcnZpY2UuZGF0YWJhc2VOYW1lfS9jb2xsZWN0aW9ucy8ke2NvbmZpZy5kYXRhU2VydmljZS5jb2xsZWN0aW9uTmFtZX0/YXBpS2V5PSR7Y29uZmlnLmRhdGFTZXJ2aWNlLmFwaUtleX1gO1xuICAgIHByaXZhdGUgZW5kUG9pbnRTYXZlOiBzdHJpbmcgPSBgL2RhdGFiYXNlcy8ke2NvbmZpZy5kYXRhU2VydmljZS5kYXRhYmFzZU5hbWV9L2NvbGxlY3Rpb25zLyR7Y29uZmlnLmRhdGFTZXJ2aWNlLmNvbGxlY3Rpb25OYW1lfT9hcGlLZXk9JHtjb25maWcuZGF0YVNlcnZpY2UuYXBpS2V5fWA7XG5cbiAgICAvKipcbiAgICAgKiBTdG9yZSB0aGUgbGF0ZXN0IHNjb3JlIGluIHRoZSBEQlxuICAgICAqXG4gICAgICogQHBhcmFtIHNjb3JlXG4gICAgICogQHJldHVybnMge1Byb21pc2U8e30+fVxuICAgICAqL1xuICAgIHB1YmxpYyBzYXZlU2NvcmUoc2NvcmU6IG51bWJlcikge1xuICAgICAgICBpZiAoY29uZmlnLmZ1bmN0aW9uYWxpdGllcy5kYXRhU2VydmljZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpc2FibGVkKCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgdXJsID0gYCR7Y29uZmlnLmRhdGFTZXJ2aWNlLmJhc2VVcmx9JHt0aGlzLmVuZFBvaW50U2F2ZX1gO1xuICAgICAgICByZXR1cm4gZmV0Y2godXJsLCB7XG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgc2NvcmU6IHNjb3JlXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICBtb2RlOiAnY29ycydcbiAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhbGwgdGhlIGN1cnJlbnQgc2NvcmVzIGZyb20gdGhlIERCXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxbXT59XG4gICAgICovXG4gICAgcHVibGljIGdldFNjb3JlcygpIHtcbiAgICAgICAgaWYgKGNvbmZpZy5mdW5jdGlvbmFsaXRpZXMuZGF0YVNlcnZpY2UgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kaXNhYmxlZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHVybCA9IGAke2NvbmZpZy5kYXRhU2VydmljZS5iYXNlVXJsfSR7dGhpcy5lbmRQb2ludExpc3R9YDtcbiAgICAgICAgcmV0dXJuIGZldGNoKHVybCwge1xuICAgICAgICAgICAgbW9kZTogJ2NvcnMnXG4gICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZW5lcmFsIG1lc3NhZ2Ugd2hlbiB0aGlzIHNlcnZpY2UgaXMgaW5hY3RpdmVcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPHt9Pn1cbiAgICAgKi9cbiAgICBwcml2YXRlIGRpc2FibGVkKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUoe1wiZXJyb3JcIjogXCJEYXRhc2VydmljZSBpcyBkaXNhYmxlZFwifSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiIsImltcG9ydCBHYW1lIGZyb20gJy4vZ2FtZSc7XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoKSA9PiBuZXcgR2FtZSgpKTtcbiIsImltcG9ydCBHVUkgZnJvbSAnLi9ndWkvZ3VpJztcbmltcG9ydCBMZXZlbCBmcm9tIFwiLi9sZXZlbC9sZXZlbFwiO1xuaW1wb3J0IERhdGFTZXJ2aWNlIGZyb20gXCIuL2RhdGFzZXJ2aWNlXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWUge1xuICAgIHByaXZhdGUgbGV2ZWwhOiBMZXZlbDtcbiAgICBwcml2YXRlIGxldmVsc1BlckdhbWU6IG51bWJlciA9IDEwO1xuICAgIHByaXZhdGUgY3VycmVudExldmVsc1BsYXllZDogbnVtYmVyID0gMDtcbiAgICBwcml2YXRlIGVsZW1lbnRzUGVyTGV2ZWw6IG51bWJlciA9IDU7XG4gICAgcHJpdmF0ZSBlbGVtZW50c0luY3JlYXNlUGVyTGV2ZWw6IG51bWJlciA9IDU7XG4gICAgcHJpdmF0ZSBzY29yZVBlckVsZW1lbnQ6IG51bWJlciA9IDEwO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgbWF4U2NvcmU6IG51bWJlcjtcbiAgICBwcml2YXRlIGd1aTogR1VJO1xuICAgIHByaXZhdGUgZGF0YVNlcnZpY2U6IERhdGFTZXJ2aWNlO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuZ3VpID0gbmV3IEdVSSgpO1xuICAgICAgICB0aGlzLm1heFNjb3JlID0gdGhpcy5jYWxjdWxhdGVNYXhTY29yZSgpO1xuICAgICAgICB0aGlzLmdhbWVMb29wKCk7XG4gICAgICAgIHRoaXMuZGF0YVNlcnZpY2UgPSBuZXcgRGF0YVNlcnZpY2UoKTtcbiAgICAgICAgdGhpcy5kYXRhU2VydmljZS5nZXRTY29yZXMoKS50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQ3VycmVudCBzY29yZXMnLCBkYXRhKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgWydsZXZlbDpzdWNjZXNzJywgJ2xldmVsOmZhaWxlZCddLm1hcCgoZXZlbnRUeXBlKSA9PiB7XG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsIChlKSA9PiB0aGlzLnVwZGF0ZShlLnR5cGUpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFsnZ2FtZTpzdGFydDpjbGljaycsICdsZXZlbDpzdWNjZXNzOmNsaWNrJywgJ2xldmVsOmZhaWxlZDpjbGljayddLm1hcCgoZXZlbnRUeXBlKSA9PiB7XG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsICgpID0+IHRoaXMuc3RhcnROZXdMZXZlbCgpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdnYW1lOmVuZDpjbGljaycsICgpID0+IHRoaXMucmVzdGFydCgpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGUgdGhlIHNjb3JlIHdpdGggYXZhaWxhYmxlIHBhcmFtZXRlcnNcbiAgICAgKlxuICAgICAqIEB0b2RvIERvIEkgcmVhbGx5IG5lZWQgdG8gdG8gdGhpcyBzbyBpbmVmZmljaWVudC4uP1xuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAgICovXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGVNYXhTY29yZSgpIHtcbiAgICAgICAgbGV0IG1heFNjb3JlID0gMDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmxldmVsc1BlckdhbWU7IGkrKykge1xuICAgICAgICAgICAgbGV0IGVsZW1lbnRzID0gdGhpcy5lbGVtZW50c1BlckxldmVsICsgKGkgPT09IDAgPyAwIDogKHRoaXMuZWxlbWVudHNJbmNyZWFzZVBlckxldmVsICogaSkpO1xuICAgICAgICAgICAgbWF4U2NvcmUgKz0gKGVsZW1lbnRzICogdGhpcy5zY29yZVBlckVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtYXhTY29yZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgb25seSBwbGFjZSBmb3IgYSByZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgKi9cbiAgICBwcml2YXRlIGdhbWVMb29wKCkge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMubGV2ZWwgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmxldmVsLnVwZGF0ZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmdhbWVMb29wKCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgZ2FtZSBieSBlaXRoZXIgdGhlIGVuZCBvciBhbnl0aGluZyBpbiBiZXR3ZWVuIGxldmVsc1xuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGVcbiAgICAgKi9cbiAgICBwcml2YXRlIHVwZGF0ZSh0eXBlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50TGV2ZWxzUGxheWVkKys7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRMZXZlbHNQbGF5ZWQgPT09IHRoaXMubGV2ZWxzUGVyR2FtZSkge1xuICAgICAgICAgICAgdGhpcy5ndWkuZ2FtZUVuZCh0aGlzLm1heFNjb3JlKTtcbiAgICAgICAgICAgIHRoaXMuc2F2ZVNjb3JlKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmd1aS5sZXZlbERvbmUodHlwZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGltZSB0byBzdGFydCBhIG5ldyBsZXZlbCB3aXRoIG1hZG5lc3NcbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXJ0TmV3TGV2ZWwoKSB7XG4gICAgICAgIGlmICh0aGlzLmxldmVsICYmIHRoaXMubGV2ZWwuZmFpbGVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50c1BlckxldmVsICs9IHRoaXMuZWxlbWVudHNJbmNyZWFzZVBlckxldmVsO1xuICAgICAgICB9XG5cbiAgICAgICAgZGVsZXRlIHRoaXMubGV2ZWw7XG4gICAgICAgIHRoaXMuZ3VpLm5ld0xldmVsKCk7XG5cbiAgICAgICAgdGhpcy5sZXZlbCA9IG5ldyBMZXZlbCh0aGlzLmVsZW1lbnRzUGVyTGV2ZWwsIHRoaXMuc2NvcmVQZXJFbGVtZW50KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTdGFydCBldmVyeXRoaW5nIGZyb20gdGhlIGJlZ2lubmluZ1xuICAgICAqL1xuICAgIHByaXZhdGUgcmVzdGFydCgpIHtcbiAgICAgICAgdGhpcy5ndWkucmVzdGFydCgpO1xuICAgICAgICB0aGlzLmN1cnJlbnRMZXZlbHNQbGF5ZWQgPSAwO1xuICAgICAgICB0aGlzLmVsZW1lbnRzUGVyTGV2ZWwgPSA1O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbGwgdGhlIGRhdGEgc2VydmljZSBhbmQgbGV0IGl0IGRvIGl0cyBtYWdpY1xuICAgICAqL1xuICAgIHByaXZhdGUgc2F2ZVNjb3JlKCkge1xuICAgICAgICBsZXQgc2NvcmUgPSB0aGlzLmd1aS5nZXRTY29yZSgpO1xuICAgICAgICB0aGlzLmRhdGFTZXJ2aWNlLnNhdmVTY29yZShzY29yZSkudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1Jlc3BvbnNlIGFmdGVyIHNhdmluZyBzY29yZScsIGRhdGEpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9